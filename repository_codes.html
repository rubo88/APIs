<!DOCTYPE html>
<html>
<head>
<title>repository_codes.md</title>
<meta http-equiv="Content-type" content="text/html;charset=UTF-8">

<style>
/* https://github.com/microsoft/vscode/blob/master/extensions/markdown-language-features/media/markdown.css */
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/

body {
	font-family: var(--vscode-markdown-font-family, -apple-system, BlinkMacSystemFont, "Segoe WPC", "Segoe UI", "Ubuntu", "Droid Sans", sans-serif);
	font-size: var(--vscode-markdown-font-size, 14px);
	padding: 0 26px;
	line-height: var(--vscode-markdown-line-height, 22px);
	word-wrap: break-word;
}

#code-csp-warning {
	position: fixed;
	top: 0;
	right: 0;
	color: white;
	margin: 16px;
	text-align: center;
	font-size: 12px;
	font-family: sans-serif;
	background-color:#444444;
	cursor: pointer;
	padding: 6px;
	box-shadow: 1px 1px 1px rgba(0,0,0,.25);
}

#code-csp-warning:hover {
	text-decoration: none;
	background-color:#007acc;
	box-shadow: 2px 2px 2px rgba(0,0,0,.25);
}

body.scrollBeyondLastLine {
	margin-bottom: calc(100vh - 22px);
}

body.showEditorSelection .code-line {
	position: relative;
}

body.showEditorSelection .code-active-line:before,
body.showEditorSelection .code-line:hover:before {
	content: "";
	display: block;
	position: absolute;
	top: 0;
	left: -12px;
	height: 100%;
}

body.showEditorSelection li.code-active-line:before,
body.showEditorSelection li.code-line:hover:before {
	left: -30px;
}

.vscode-light.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(0, 0, 0, 0.15);
}

.vscode-light.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(0, 0, 0, 0.40);
}

.vscode-light.showEditorSelection .code-line .code-line:hover:before {
	border-left: none;
}

.vscode-dark.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(255, 255, 255, 0.4);
}

.vscode-dark.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(255, 255, 255, 0.60);
}

.vscode-dark.showEditorSelection .code-line .code-line:hover:before {
	border-left: none;
}

.vscode-high-contrast.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(255, 160, 0, 0.7);
}

.vscode-high-contrast.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(255, 160, 0, 1);
}

.vscode-high-contrast.showEditorSelection .code-line .code-line:hover:before {
	border-left: none;
}

img {
	max-width: 100%;
	max-height: 100%;
}

a {
	text-decoration: none;
}

a:hover {
	text-decoration: underline;
}

a:focus,
input:focus,
select:focus,
textarea:focus {
	outline: 1px solid -webkit-focus-ring-color;
	outline-offset: -1px;
}

hr {
	border: 0;
	height: 2px;
	border-bottom: 2px solid;
}

h1 {
	padding-bottom: 0.3em;
	line-height: 1.2;
	border-bottom-width: 1px;
	border-bottom-style: solid;
}

h1, h2, h3 {
	font-weight: normal;
}

table {
	border-collapse: collapse;
}

table > thead > tr > th {
	text-align: left;
	border-bottom: 1px solid;
}

table > thead > tr > th,
table > thead > tr > td,
table > tbody > tr > th,
table > tbody > tr > td {
	padding: 5px 10px;
}

table > tbody > tr + tr > td {
	border-top: 1px solid;
}

blockquote {
	margin: 0 7px 0 5px;
	padding: 0 16px 0 10px;
	border-left-width: 5px;
	border-left-style: solid;
}

code {
	font-family: Menlo, Monaco, Consolas, "Droid Sans Mono", "Courier New", monospace, "Droid Sans Fallback";
	font-size: 1em;
	line-height: 1.357em;
}

body.wordWrap pre {
	white-space: pre-wrap;
}

pre:not(.hljs),
pre.hljs code > div {
	padding: 16px;
	border-radius: 3px;
	overflow: auto;
}

pre code {
	color: var(--vscode-editor-foreground);
	tab-size: 4;
}

/** Theming */

.vscode-light pre {
	background-color: rgba(220, 220, 220, 0.4);
}

.vscode-dark pre {
	background-color: rgba(10, 10, 10, 0.4);
}

.vscode-high-contrast pre {
	background-color: rgb(0, 0, 0);
}

.vscode-high-contrast h1 {
	border-color: rgb(0, 0, 0);
}

.vscode-light table > thead > tr > th {
	border-color: rgba(0, 0, 0, 0.69);
}

.vscode-dark table > thead > tr > th {
	border-color: rgba(255, 255, 255, 0.69);
}

.vscode-light h1,
.vscode-light hr,
.vscode-light table > tbody > tr + tr > td {
	border-color: rgba(0, 0, 0, 0.18);
}

.vscode-dark h1,
.vscode-dark hr,
.vscode-dark table > tbody > tr + tr > td {
	border-color: rgba(255, 255, 255, 0.18);
}

</style>

<style>
/* Tomorrow Theme */
/* http://jmblog.github.com/color-themes-for-google-code-highlightjs */
/* Original theme - https://github.com/chriskempson/tomorrow-theme */

/* Tomorrow Comment */
.hljs-comment,
.hljs-quote {
	color: #8e908c;
}

/* Tomorrow Red */
.hljs-variable,
.hljs-template-variable,
.hljs-tag,
.hljs-name,
.hljs-selector-id,
.hljs-selector-class,
.hljs-regexp,
.hljs-deletion {
	color: #c82829;
}

/* Tomorrow Orange */
.hljs-number,
.hljs-built_in,
.hljs-builtin-name,
.hljs-literal,
.hljs-type,
.hljs-params,
.hljs-meta,
.hljs-link {
	color: #f5871f;
}

/* Tomorrow Yellow */
.hljs-attribute {
	color: #eab700;
}

/* Tomorrow Green */
.hljs-string,
.hljs-symbol,
.hljs-bullet,
.hljs-addition {
	color: #718c00;
}

/* Tomorrow Blue */
.hljs-title,
.hljs-section {
	color: #4271ae;
}

/* Tomorrow Purple */
.hljs-keyword,
.hljs-selector-tag {
	color: #8959a8;
}

.hljs {
	display: block;
	overflow-x: auto;
	color: #4d4d4c;
	padding: 0.5em;
}

.hljs-emphasis {
	font-style: italic;
}

.hljs-strong {
	font-weight: bold;
}
</style>

<style>
/*
 * Markdown PDF CSS
 */

 body {
	font-family: -apple-system, BlinkMacSystemFont, "Segoe WPC", "Segoe UI", "Ubuntu", "Droid Sans", sans-serif, "Meiryo";
	padding: 0 12px;
}

pre {
	background-color: #f8f8f8;
	border: 1px solid #cccccc;
	border-radius: 3px;
	overflow-x: auto;
	white-space: pre-wrap;
	overflow-wrap: break-word;
}

pre:not(.hljs) {
	padding: 23px;
	line-height: 19px;
}

blockquote {
	background: rgba(127, 127, 127, 0.1);
	border-color: rgba(0, 122, 204, 0.5);
}

.emoji {
	height: 1.4em;
}

code {
	font-size: 14px;
	line-height: 19px;
}

/* for inline code */
:not(pre):not(.hljs) > code {
	color: #C9AE75; /* Change the old color so it seems less like an error */
	font-size: inherit;
}

/* Page Break : use <div class="page"/> to insert page break
-------------------------------------------------------- */
.page {
	page-break-after: always;
}

</style>

<script src="https://unpkg.com/mermaid/dist/mermaid.min.js"></script>
</head>
<body>
  <script>
    mermaid.initialize({
      startOnLoad: true,
      theme: document.body.classList.contains('vscode-dark') || document.body.classList.contains('vscode-high-contrast')
          ? 'dark'
          : 'default'
    });
  </script>
<h1 id="repository-codes-documentation">Repository Codes Documentation</h1>
<h1 id="python">Python</h1>
<h2 id="comext">COMEXT</h2>
<h3 id="gu%C3%ADa-r%C3%A1pida-eurostat-comext-con-python">Guía rápida: Eurostat Comext con Python</h3>
<p>Este documento explica cómo usar la función en <code>python/comext/comext_function.py</code> para descargar datos desde el endpoint Eurostat COMEXT en JSON y convertirlos a un <code>pandas.DataFrame</code> etiquetado.</p>
<h4 id="requisitos">Requisitos</h4>
<ul>
<li>Paquetes: <code>requests</code>, <code>pandas</code></li>
</ul>
<h4 id="codigos-ejemplo">Codigos ejemplo</h4>
<ul>
<li><code>comext_min.py</code>: ejemplo mínimo que descarga y guarda <code>comext_min.csv</code>.</li>
<li><code>comext_example.py</code>: ejemplo de uso de la función <code>comext_api_function</code> (implícito en la descripción).</li>
</ul>
<h4 id="inputs">Inputs</h4>
<ul>
<li><strong>Obligatorios</strong>
<ul>
<li><code>dataset_id</code>: id del dataset Comext (p. ej., <code>&quot;DS-059341&quot;</code>).</li>
<li><code>filters</code>: diccionario nombrado dimensión -&gt; lista de valores. Para multiselección se envían parámetros repetidos.</li>
</ul>
</li>
</ul>
<h4 id="c%C3%B3mo-elegir-inputs">Cómo elegir inputs</h4>
<ol>
<li>Identifique el dataset en la guía de Comext y el portal de Eurostat.</li>
<li>Consulte la estructura del dataset en la guía Comext para conocer las dimensiones válidas y sus valores.</li>
<li>Ajuste <code>filters</code> con nombres de dimensiones válidos. Para múltiples valores use listas (enviamos parámetros repetidos).</li>
</ol>
<h4 id="sintaxis-de-la-api-comext">Sintaxis de la API (COMEXT)</h4>
<ul>
<li>
<p><strong>Formato general:</strong></p>
<pre class="hljs"><code><div>https://ec.europa.eu/eurostat/api/comext/dissemination/statistics/1.0/data/{dataset_id}?{dim}={val}&amp;{dim}={val}...
</div></code></pre>
</li>
<li>
<p><strong>Ejemplo:</strong></p>
<pre class="hljs"><code><div>https://ec.europa.eu/eurostat/api/comext/dissemination/statistics/1.0/data/DS-059341?reporter=ES&amp;partner=US&amp;product=1509&amp;product=8703&amp;flow=2&amp;freq=A&amp;time=2015&amp;time=2016
</div></code></pre>
</li>
</ul>
<h4 id="output">Output</h4>
<ul>
<li>Un <code>pandas.DataFrame</code> con códigos por dimensión, columnas de etiquetas <code>*_label</code> y la columna numérica <code>value</code>.</li>
</ul>
<h4 id="notas">Notas</h4>
<ul>
<li>Si la API devuelve error, verifique el <code>dataset_id</code> y las dimensiones en la documentación de Comext.</li>
</ul>
<h4 id="funci%C3%B3n-auxiliar-para-convertir-json-a-dataframe">Función auxiliar para convertir JSON a DataFrame</h4>
<p>La función <code>comext_json_to_labeled_df</code> convierte el JSON en un DataFrame con columnas por dimensión (códigos y <code>*_label</code>) y la columna <code>value</code> (numérica cuando procede).</p>
<h4 id="enlaces-%C3%BAtiles">Enlaces útiles</h4>
<ul>
<li>Guía de Comext: https://ec.europa.eu/eurostat/web/user-guides/data-browser/api-data-access/api-getting-started/comext-database</li>
<li>Portal Eurostat: https://ec.europa.eu/eurostat/</li>
</ul>
<h3 id="comextexamplepy">comext_example.py</h3>
<pre class="hljs"><code><div><span class="hljs-comment"># Ejemplo de uso — Eurostat COMEXT (JSON -&gt; DataFrame -&gt; CSV)</span>
<span class="hljs-comment"># ----------------------------------------------------------------------------</span>
<span class="hljs-comment"># 1) Cargar la función</span>
<span class="hljs-comment"># 2) Ejecutar la consulta con filtros (parámetros repetidos para multiselección)</span>
<span class="hljs-comment"># 3) Guardar el resultado como CSV</span>
<span class="hljs-comment"># ----------------------------------------------------------------------------</span>
<span class="hljs-keyword">import</span> os
<span class="hljs-keyword">from</span> comext_function <span class="hljs-keyword">import</span> comext_api_function


<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> -&gt; <span class="hljs-keyword">None</span>:</span>
    <span class="hljs-comment"># Asegurar rutas relativas coherentes</span>
    os.chdir(os.path.dirname(os.path.abspath(__file__)))

    <span class="hljs-comment"># Ejecutar la consulta</span>
    df = comext_api_function(
        dataset_id=<span class="hljs-string">"DS-059341"</span>,
        filters={
            <span class="hljs-string">"reporter"</span>: [<span class="hljs-string">"ES"</span>],
            <span class="hljs-string">"partner"</span>: [<span class="hljs-string">"US"</span>],
            <span class="hljs-string">"product"</span>: [<span class="hljs-string">"1509"</span>],
            <span class="hljs-string">"flow"</span>: [<span class="hljs-string">"2"</span>],
            <span class="hljs-string">"freq"</span>: [<span class="hljs-string">"A"</span>],
            <span class="hljs-string">"time"</span>: [<span class="hljs-string">"2019"</span>, <span class="hljs-string">"2020"</span>],
        },
    )

    <span class="hljs-comment"># Guardar el resultado</span>
    df.to_csv(<span class="hljs-string">"comext_example.csv"</span>, index=<span class="hljs-literal">False</span>)


<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">"__main__"</span>:
    main()



</div></code></pre>
<h3 id="comextfunctionpy">comext_function.py</h3>
<pre class="hljs"><code><div><span class="hljs-keyword">from</span> __future__ <span class="hljs-keyword">import</span> annotations

<span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> Dict, Iterable, List

<span class="hljs-keyword">import</span> pandas <span class="hljs-keyword">as</span> pd
<span class="hljs-keyword">import</span> requests

<span class="hljs-keyword">from</span> comext_utils <span class="hljs-keyword">import</span> comext_json_to_labeled_df


<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">_build_query_params</span><span class="hljs-params">(filters: Dict[str, Iterable[str]])</span> -&gt; List[tuple]:</span>
    params: List[tuple] = []
    <span class="hljs-keyword">for</span> dim_name, values <span class="hljs-keyword">in</span> filters.items():
        <span class="hljs-keyword">if</span> values <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span>:
            <span class="hljs-keyword">continue</span>
        <span class="hljs-keyword">for</span> v <span class="hljs-keyword">in</span> values:
            params.append((dim_name, str(v)))
    <span class="hljs-keyword">return</span> params


<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">comext_api_function</span><span class="hljs-params">(dataset_id: str, filters: Dict[str, Iterable[str]])</span> -&gt; pd.DataFrame:</span>
    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> isinstance(filters, dict) <span class="hljs-keyword">or</span> <span class="hljs-keyword">not</span> filters:
        <span class="hljs-keyword">raise</span> ValueError(<span class="hljs-string">"'filters' debe ser un dict nombrado: dimension -&gt; lista de valores"</span>)

    base = <span class="hljs-string">f"https://ec.europa.eu/eurostat/api/comext/dissemination/statistics/1.0/data/<span class="hljs-subst">{dataset_id}</span>"</span>
    params = _build_query_params(filters)
    resp = requests.get(base, params=params, headers={<span class="hljs-string">"Accept"</span>: <span class="hljs-string">"application/json"</span>}, timeout=<span class="hljs-number">120</span>)
    resp.raise_for_status()

    doc = resp.json()
    df = comext_json_to_labeled_df(doc)
    <span class="hljs-keyword">return</span> df



</div></code></pre>
<h3 id="comextminpy">comext_min.py</h3>
<pre class="hljs"><code><div><span class="hljs-keyword">import</span> os
<span class="hljs-keyword">import</span> requests
<span class="hljs-keyword">import</span> pandas <span class="hljs-keyword">as</span> pd
<span class="hljs-keyword">from</span> comext_utils <span class="hljs-keyword">import</span> comext_json_to_labeled_df


<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> -&gt; <span class="hljs-keyword">None</span>:</span>
    <span class="hljs-comment"># Cambiar directorio a la carpeta del script para rutas consistentes</span>
    os.chdir(os.path.dirname(os.path.abspath(__file__)))

    <span class="hljs-comment"># Parámetros del dataset y filtros (parámetros repetidos para multiselección)</span>
    dataset_id = <span class="hljs-string">"DS-059341"</span>
    base = <span class="hljs-string">f"https://ec.europa.eu/eurostat/api/comext/dissemination/statistics/1.0/data/<span class="hljs-subst">{dataset_id}</span>"</span>
    params = [
        (<span class="hljs-string">"reporter"</span>, <span class="hljs-string">"ES"</span>),
        (<span class="hljs-string">"partner"</span>, <span class="hljs-string">"US"</span>),
        (<span class="hljs-string">"product"</span>, <span class="hljs-string">"1509"</span>),
        (<span class="hljs-string">"product"</span>, <span class="hljs-string">"8703"</span>),
        (<span class="hljs-string">"flow"</span>, <span class="hljs-string">"2"</span>),
        (<span class="hljs-string">"freq"</span>, <span class="hljs-string">"A"</span>),
        (<span class="hljs-string">"time"</span>, <span class="hljs-string">"2015"</span>),
        (<span class="hljs-string">"time"</span>, <span class="hljs-string">"2016"</span>),
        (<span class="hljs-string">"time"</span>, <span class="hljs-string">"2017"</span>),
        (<span class="hljs-string">"time"</span>, <span class="hljs-string">"2018"</span>),
        (<span class="hljs-string">"time"</span>, <span class="hljs-string">"2019"</span>),
        (<span class="hljs-string">"time"</span>, <span class="hljs-string">"2020"</span>),
    ]

    resp = requests.get(base, params=params, headers={<span class="hljs-string">"Accept"</span>: <span class="hljs-string">"application/json"</span>}, timeout=<span class="hljs-number">180</span>)
    resp.raise_for_status()
    doc = resp.json()
    df = comext_json_to_labeled_df(doc)
    df.to_csv(<span class="hljs-string">"comext_min.csv"</span>, index=<span class="hljs-literal">False</span>)


<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">"__main__"</span>:
    main()



</div></code></pre>
<h3 id="comextutilspy">comext_utils.py</h3>
<pre class="hljs"><code><div><span class="hljs-keyword">from</span> __future__ <span class="hljs-keyword">import</span> annotations

<span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> Any, Dict, List

<span class="hljs-keyword">import</span> pandas <span class="hljs-keyword">as</span> pd


<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">_compute_strides</span><span class="hljs-params">(sizes: List[int])</span> -&gt; List[int]:</span>
    n = len(sizes)
    strides: List[int] = [<span class="hljs-number">0</span>] * n
    <span class="hljs-keyword">for</span> k <span class="hljs-keyword">in</span> range(n):
        <span class="hljs-keyword">if</span> k == n - <span class="hljs-number">1</span>:
            strides[k] = <span class="hljs-number">1</span>
        <span class="hljs-keyword">else</span>:
            prod = <span class="hljs-number">1</span>
            <span class="hljs-keyword">for</span> v <span class="hljs-keyword">in</span> sizes[k + <span class="hljs-number">1</span> :]:
                prod *= int(v)
            strides[k] = prod
    <span class="hljs-keyword">return</span> strides


<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">_invert_index_map</span><span class="hljs-params">(index_map: Dict[str, int])</span> -&gt; Dict[int, str]:</span>
    <span class="hljs-comment"># index_map is like {code: pos}; invert to {pos: code}</span>
    <span class="hljs-keyword">return</span> {int(pos): code <span class="hljs-keyword">for</span> code, pos <span class="hljs-keyword">in</span> index_map.items()}


<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">comext_json_to_labeled_df</span><span class="hljs-params">(doc: Dict[str, Any])</span> -&gt; pd.DataFrame:</span>
    <span class="hljs-string">"""
    Convert Eurostat COMEXT JSON (SDMX-like) to a labeled pandas DataFrame.

    Expected keys in doc: value (dict), id (list), size (list), dimension (dict)
    """</span>
    values_obj = doc.get(<span class="hljs-string">"value"</span>)
    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> values_obj:
        <span class="hljs-keyword">return</span> pd.DataFrame()

    dim_ids: List[str] = list(doc.get(<span class="hljs-string">"id"</span>, []))
    sizes = [int(s) <span class="hljs-keyword">for</span> s <span class="hljs-keyword">in</span> doc.get(<span class="hljs-string">"size"</span>, [])]
    dims = doc.get(<span class="hljs-string">"dimension"</span>, {})
    num_dims = len(dim_ids)

    strides = _compute_strides(sizes)

    <span class="hljs-comment"># Prepare per-dimension inverted index maps and labels</span>
    dim_pos_to_code: Dict[str, Dict[int, str]] = {}
    dim_code_to_label: Dict[str, Dict[str, str]] = {}
    <span class="hljs-keyword">for</span> dn <span class="hljs-keyword">in</span> dim_ids:
        d = dims.get(dn) <span class="hljs-keyword">or</span> {}
        cat = d.get(<span class="hljs-string">"category"</span>) <span class="hljs-keyword">or</span> {}
        index_map = cat.get(<span class="hljs-string">"index"</span>) <span class="hljs-keyword">or</span> {}
        labels = cat.get(<span class="hljs-string">"label"</span>) <span class="hljs-keyword">or</span> {}
        dim_pos_to_code[dn] = _invert_index_map({k: int(v) <span class="hljs-keyword">for</span> k, v <span class="hljs-keyword">in</span> index_map.items()})
        dim_code_to_label[dn] = {str(k): str(v) <span class="hljs-keyword">for</span> k, v <span class="hljs-keyword">in</span> labels.items()} <span class="hljs-keyword">if</span> isinstance(labels, dict) <span class="hljs-keyword">else</span> {}

    value_keys = [int(k) <span class="hljs-keyword">for</span> k <span class="hljs-keyword">in</span> values_obj.keys()]
    value_vals = list(values_obj.values())

    records: List[Dict[str, Any]] = []
    <span class="hljs-keyword">for</span> i, idx <span class="hljs-keyword">in</span> enumerate(value_keys):
        r = int(idx)
        pos: List[int] = [<span class="hljs-number">0</span>] * num_dims
        <span class="hljs-keyword">for</span> k <span class="hljs-keyword">in</span> range(num_dims):
            stride = strides[k]
            pos[k] = r // stride
            r = r % stride

        rec: Dict[str, Any] = {<span class="hljs-string">"value"</span>: pd.to_numeric(value_vals[i], errors=<span class="hljs-string">"coerce"</span>)}
        <span class="hljs-keyword">for</span> k, dn <span class="hljs-keyword">in</span> enumerate(dim_ids):
            code = dim_pos_to_code.get(dn, {}).get(pos[k])
            rec[dn] = code
            lbl_map = dim_code_to_label.get(dn, {})
            rec[<span class="hljs-string">f"<span class="hljs-subst">{dn}</span>_label"</span>] = lbl_map.get(code) <span class="hljs-keyword">if</span> code <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span> <span class="hljs-keyword">else</span> <span class="hljs-literal">None</span>

        records.append(rec)

    df = pd.DataFrame.from_records(records)
    <span class="hljs-keyword">return</span> df



</div></code></pre>
<h2 id="ecb">ECB</h2>
<h3 id="gu%C3%ADa-r%C3%A1pida-bce-con-python">Guía rápida: BCE con Python</h3>
<p>Este documento explica cómo usar <code>python/ecb/ecb_function.py</code> para descargar series del BCE en formato CSV y obtener un <code>pandas.DataFrame</code>.</p>
<h4 id="requisitos">Requisitos</h4>
<ul>
<li>Paquetes: <code>requests</code>, <code>pandas</code></li>
</ul>
<h4 id="codigos-ejemplo">Codigos ejemplo</h4>
<ul>
<li><code>ecb_onlylink.py</code>: ejemplo que descarga y lee el csv directamente del link de la API en una linea.</li>
<li><code>ecb_min.py</code>: ejemplo mínimo para descargar datos del BCE sin usar la función <code>ecb_api_function</code>.</li>
<li><code>ecb_example.py</code>: ejemplo de uso de la función <code>ecb_api_function</code>.</li>
</ul>
<h4 id="inputs">Inputs</h4>
<ul>
<li><strong>Obligatorios</strong>
<ul>
<li><code>dataset</code>: identificador del dataset (p. ej., <code>&quot;BSI&quot;</code>).</li>
<li><code>series_key</code>: clave completa de la serie (dimensiones separadas por <code>.</code>).</li>
</ul>
</li>
</ul>
<h4 id="c%C3%B3mo-elegir-inputs">Cómo elegir inputs</h4>
<ol>
<li>Abra el dataset en el portal BCE (p. ej., BSI): https://data.ecb.europa.eu/data/datasets/BSI</li>
<li>Use los filtros hasta ver la serie concreta; la clave <code>series_key</code> aparece en el recuadro de la serie.</li>
<li>Cada elemento de <code>series_key</code> es una dimensión del dataset; puede cambiar <code>U2</code> (Área del euro) por <code>ES</code> (España), etc. Pinchando en <code>view all</code> se pueden ver todas las dimensiones del dataset y sus códigos. Para conocer qué valores puede tomar una dimensión, vea un dataset concreto con <code>.../structure</code>.</li>
</ol>
<h4 id="sintaxis-de-la-api-bce">Sintaxis de la API (BCE)</h4>
<ul>
<li>
<p><strong>Formato general:</strong></p>
<pre class="hljs"><code><div>https://data-api.ecb.europa.eu/service/data/{dataset}/{seriesKey}?format=csvdata
</div></code></pre>
</li>
<li>
<p><strong>Ejemplo:</strong></p>
<pre class="hljs"><code><div>https://data-api.ecb.europa.eu/service/data/BSI/M.U2.Y.V.M30.X.I.U2.2300.Z01.A?format=csvdata
</div></code></pre>
</li>
</ul>
<h4 id="output">Output</h4>
<ul>
<li>Un <code>pandas.DataFrame</code> con los datos descargados.</li>
</ul>
<h4 id="notas">Notas</h4>
<ul>
<li>El parámetro <code>format=csvdata</code> se añade automáticamente.</li>
</ul>
<h4 id="enlaces-%C3%BAtiles">Enlaces útiles</h4>
<ul>
<li>Portal de datos del BCE (datasets): https://data.ecb.europa.eu/data/datasets/</li>
<li>Documentación de la API de datos del BCE: https://data.ecb.europa.eu/help/api/overview</li>
<li>API de datos (servicio): https://data-api.ecb.europa.eu/service/</li>
</ul>
<h3 id="ecbexamplepy">ecb_example.py</h3>
<pre class="hljs"><code><div><span class="hljs-comment"># Ejemplo de uso — BCE Data API (CSV)</span>
<span class="hljs-comment"># ----------------------------------------------------------------------------</span>
<span class="hljs-comment"># 1) Cargar la función</span>
<span class="hljs-comment"># 2) Ejecutar la consulta indicando dataset y series_key</span>
<span class="hljs-comment"># 3) Guardar el resultado como CSV</span>
<span class="hljs-comment"># ----------------------------------------------------------------------------</span>
<span class="hljs-keyword">import</span> os
<span class="hljs-keyword">from</span> ecb_function <span class="hljs-keyword">import</span> ecb_api_function


<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> -&gt; <span class="hljs-keyword">None</span>:</span>
    <span class="hljs-comment"># Asegurar rutas relativas coherentes</span>
    os.chdir(os.path.dirname(os.path.abspath(__file__)))

    <span class="hljs-comment"># Ejecutar la consulta</span>
    df = ecb_api_function(
        dataset=<span class="hljs-string">"BSI"</span>,
        series_key=<span class="hljs-string">"M.U2.Y.V.M30.X.I.U2.2300.Z01.A"</span>,
    )

    <span class="hljs-comment"># Guardar el resultado</span>
    df.to_csv(<span class="hljs-string">"ecb_example.csv"</span>, index=<span class="hljs-literal">False</span>)


<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">"__main__"</span>:
    main()



</div></code></pre>
<h3 id="ecbfunctionpy">ecb_function.py</h3>
<pre class="hljs"><code><div><span class="hljs-keyword">from</span> __future__ <span class="hljs-keyword">import</span> annotations

<span class="hljs-keyword">import</span> io
<span class="hljs-keyword">import</span> pandas <span class="hljs-keyword">as</span> pd
<span class="hljs-keyword">import</span> requests


<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">ecb_api_function</span><span class="hljs-params">(
    dataset: str,
    series_key: str,
    base_url: str = <span class="hljs-string">"https://data-api.ecb.europa.eu/service/data"</span>,
)</span> -&gt; pd.DataFrame:</span>
    <span class="hljs-string">"""
    Descargar datos del BCE (ECB Data) en CSV (csvdata) y devolver DataFrame.

    Parameters
    ----------
    dataset : str
        Identificador del dataset (p. ej., "BSI").
    series_key : str
        Clave completa de la serie (dimensiones concatenadas con '.').
    base_url : str
        Host del servicio de datos del BCE.
    """</span>

    url = <span class="hljs-string">f"<span class="hljs-subst">{base_url}</span>/<span class="hljs-subst">{dataset}</span>/<span class="hljs-subst">{series_key}</span>"</span>
    params = {<span class="hljs-string">"format"</span>: <span class="hljs-string">"csvdata"</span>}
    resp = requests.get(url, params=params, headers={<span class="hljs-string">"Accept"</span>: <span class="hljs-string">"text/csv"</span>}, timeout=<span class="hljs-number">120</span>)
    resp.raise_for_status()

    text_stream = io.StringIO(resp.content.decode(<span class="hljs-string">"utf-8"</span>))
    df = pd.read_csv(text_stream)
    <span class="hljs-keyword">return</span> df



</div></code></pre>
<h3 id="ecbminpy">ecb_min.py</h3>
<pre class="hljs"><code><div><span class="hljs-comment"># Descargador mínimo BCE Data API (CSV) — autocontenido (no usa la función)</span>
<span class="hljs-comment"># ----------------------------------------------------------------------------</span>
<span class="hljs-comment"># Objetivo</span>
<span class="hljs-comment">#   Descarga una serie del BCE (csvdata) y la guarda como CSV</span>
<span class="hljs-comment"># ----------------------------------------------------------------------------</span>
<span class="hljs-keyword">import</span> os
<span class="hljs-keyword">import</span> io
<span class="hljs-keyword">import</span> pandas <span class="hljs-keyword">as</span> pd
<span class="hljs-keyword">import</span> requests


<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> -&gt; <span class="hljs-keyword">None</span>:</span>
    <span class="hljs-comment"># Cambiar directorio a la carpeta del script para rutas consistentes</span>
    os.chdir(os.path.dirname(os.path.abspath(__file__)))

    <span class="hljs-comment"># Parámetros mínimos</span>
    dataset = <span class="hljs-string">"BSI"</span>
    series_key = <span class="hljs-string">"M.U2.Y.V.M30.X.I.U2.2300.Z01.A"</span>

    <span class="hljs-comment"># Construcción de URL y petición</span>
    url = <span class="hljs-string">f"https://data-api.ecb.europa.eu/service/data/<span class="hljs-subst">{dataset}</span>/<span class="hljs-subst">{series_key}</span>"</span>
    params = {<span class="hljs-string">"format"</span>: <span class="hljs-string">"csvdata"</span>}
    resp = requests.get(url, params=params, headers={<span class="hljs-string">"Accept"</span>: <span class="hljs-string">"text/csv"</span>}, timeout=<span class="hljs-number">120</span>)
    resp.raise_for_status()

    <span class="hljs-comment"># Guardar CSV</span>
    text_stream = io.StringIO(resp.content.decode(<span class="hljs-string">"utf-8"</span>))
    pd.read_csv(text_stream).to_csv(<span class="hljs-string">"ecb_min.csv"</span>, index=<span class="hljs-literal">False</span>)


<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">"__main__"</span>:
    main()



</div></code></pre>
<h3 id="ecbonlylinkpy">ecb_onlylink.py</h3>
<pre class="hljs"><code><div><span class="hljs-comment"># Minimal ECB Data API downloader (link only)</span>
<span class="hljs-keyword">import</span> pandas <span class="hljs-keyword">as</span> pd
df = pd.read_csv(<span class="hljs-string">"https://data-api.ecb.europa.eu/service/data/BSI/M.U2.Y.V.M30.X.I.U2.2300.Z01.A?format=csvdata"</span>)


</div></code></pre>
<h2 id="esios">ESIOS</h2>
<h2 id="eurostat">EUROSTAT</h2>
<h3 id="gu%C3%ADa-r%C3%A1pida-eurostat-con-python">Guía rápida: Eurostat con Python</h3>
<p>Este documento explica cómo usar <code>python/eurostat/eurostat_function.py</code> para descargar datos Eurostat en formato SDMX-CSV 2.0 y obtener un <code>pandas.DataFrame</code>.</p>
<h4 id="requisitos">Requisitos</h4>
<ul>
<li>Paquetes: <code>requests</code>, <code>pandas</code></li>
</ul>
<h4 id="codigos-ejemplo">Codigos ejemplo</h4>
<ul>
<li><code>eurostat_onlylink.py</code>: ejemplo que descarga y lee el csv directamente del link de la API en una linea.</li>
<li><code>eurostat_min.py</code> es un ejemplo mínimo para descargar datos de Eurostat sin usar la función <code>eurostat_api_function</code>.</li>
<li><code>eurostat_example.py</code> es un ejemplo de uso de la función <code>eurostat_api_function</code>.</li>
</ul>
<h4 id="inputs">Inputs</h4>
<ul>
<li>
<p><strong>Obligatorios</strong></p>
<ul>
<li><code>dataset_identifier</code>: identificador del dataset.</li>
<li><code>filters</code>: diccionario de filtros (c[dim] en R), por ejemplo <code>{&quot;geo&quot;: [&quot;IT&quot;], ...}</code>.</li>
</ul>
</li>
<li>
<p><strong>Opcionales</strong></p>
<ul>
<li><code>agency_identifier</code> (por defecto <code>&quot;ESTAT&quot;</code>).</li>
<li><code>dataset_version</code> (<code>&quot;1.0&quot;</code>).</li>
<li><code>compress</code>, <code>format</code>, <code>formatVersion</code>, <code>lang</code>, <code>labels</code> (opcionales).</li>
</ul>
</li>
</ul>
<h4 id="c%C3%B3mo-elegir-inputs">Cómo elegir inputs</h4>
<ol>
<li>Lo más sencillo es ir a Eurostat, buscar la serie de interés y copiar el código de la serie. Mire el código de las variables y los valores a filtrar.</li>
<li>Use el código de la serie como <code>dataset_identifier</code>.</li>
<li>Ajuste filtros (<code>filters</code>):
<ul>
<li>Añada o cambie dimensiones válidas del dataset (p. ej., <code>geo</code>, <code>na_item</code>, <code>unit</code>, <code>freq</code>, <code>TIME_PERIOD</code>).</li>
<li>Para valores múltiples use listas en Python: <code>[&quot;ES&quot;, &quot;FR&quot;]</code>.</li>
<li>En <code>TIME_PERIOD</code> puede usar operadores SDMX: <code>ge:YYYY</code>, <code>le:YYYY</code>, <code>YYYY:YYYY</code>, <code>ge:200Q1</code>, etc.</li>
</ul>
</li>
<li>Cambie parámetros opcionales si es necesario.</li>
</ol>
<h4 id="sintaxis-de-la-api-sdmx-30">Sintaxis de la API (SDMX 3.0)</h4>
<ul>
<li>
<p><strong>Formato general:</strong></p>
<pre class="hljs"><code><div>{base_url}/{agency_identifier}/{dataset_identifier}/{dataset_version}/?{filters_params}&amp;{common_params}
</div></code></pre>
<p>Donde <code>base_url</code> es <code>https://ec.europa.eu/eurostat/api/dissemination/sdmx/3.0/data/dataflow</code>.</p>
</li>
<li>
<p><strong>Ejemplo:</strong></p>
<pre class="hljs"><code><div>https://ec.europa.eu/eurostat/api/dissemination/sdmx/3.0/data/dataflow/ESTAT/nama_10_a64/1.0/?c[geo]=ES,FR&amp;c[na_item]=B1G,P1&amp;c[freq]=A&amp;c[unit]=CLV20_MEUR&amp;c[TIME_PERIOD]=ge:1995&amp;compress=false&amp;format=csvdata&amp;formatVersion=2.0&amp;lang=en&amp;labels=name
</div></code></pre>
</li>
</ul>
<h4 id="output">Output</h4>
<ul>
<li>Un <code>pandas.DataFrame</code> con los datos descargados.</li>
</ul>
<h4 id="notas">Notas</h4>
<ul>
<li>Se usa el encabezado <code>Accept: application/vnd.sdmx.data+csv; version=2.0.0</code>.</li>
</ul>
<h4 id="enlaces-%C3%BAtiles">Enlaces útiles</h4>
<ul>
<li>Guía de consultas de datos (SDMX 3.0, Eurostat): <a href="https://ec.europa.eu/eurostat/web/user-guides/data-browser/api-data-access/api-detailed-guidelines/sdmx3-0/data-query">API - Detailed guidelines - SDMX3.0 API - data query</a></li>
<li><a href="https://ec.europa.eu/eurostat/web/user-guides/data-browser/api-data-access/api-getting-started/api#APIGettingstartedwithstatisticsAPI-Retrievingyourfirstcontent">API - Getting started with statistics API - Retrieving your first content</a></li>
</ul>
<h3 id="eurostatexamplepy">eurostat_example.py</h3>
<pre class="hljs"><code><div><span class="hljs-comment"># Ejemplo de uso — Eurostat SDMX 3.0 (CSV)</span>
<span class="hljs-comment"># ----------------------------------------------------------------------------</span>
<span class="hljs-comment"># 1) Cargar la función</span>
<span class="hljs-comment"># 2) Ejecutar la consulta con filtros (c[dim] en R -&gt; dict en Python)</span>
<span class="hljs-comment"># 3) Guardar el resultado como CSV</span>
<span class="hljs-comment"># ----------------------------------------------------------------------------</span>
<span class="hljs-keyword">import</span> os
<span class="hljs-keyword">from</span> eurostat_function <span class="hljs-keyword">import</span> eurostat_api_function


<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> -&gt; <span class="hljs-keyword">None</span>:</span>
    <span class="hljs-comment"># Asegurar rutas relativas coherentes</span>
    os.chdir(os.path.dirname(os.path.abspath(__file__)))

    <span class="hljs-comment"># Ejecutar la consulta</span>
    df = eurostat_api_function(
        dataset_identifier=<span class="hljs-string">"nama_10_a64"</span>,
        filters={
            <span class="hljs-string">"geo"</span>: [<span class="hljs-string">"IT"</span>],
            <span class="hljs-string">"na_item"</span>: [<span class="hljs-string">"B1G"</span>],
            <span class="hljs-string">"unit"</span>: <span class="hljs-string">"CLV20_MEUR"</span>,
            <span class="hljs-string">"TIME_PERIOD"</span>: <span class="hljs-string">"ge:1995"</span>,
        },
    )

    <span class="hljs-comment"># Guardar el resultado</span>
    df.to_csv(<span class="hljs-string">"eurostat_example.csv"</span>, index=<span class="hljs-literal">False</span>)


<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">"__main__"</span>:
    main()



</div></code></pre>
<h3 id="eurostatfunctionpy">eurostat_function.py</h3>
<pre class="hljs"><code><div><span class="hljs-keyword">from</span> __future__ <span class="hljs-keyword">import</span> annotations

<span class="hljs-keyword">import</span> io
<span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> Dict, Iterable

<span class="hljs-keyword">import</span> pandas <span class="hljs-keyword">as</span> pd
<span class="hljs-keyword">import</span> requests


<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">eurostat_api_function</span><span class="hljs-params">(
    dataset_identifier: str,
    filters: Dict[str, Iterable[str]],
    agency_identifier: str = <span class="hljs-string">"ESTAT"</span>,
    dataset_version: str = <span class="hljs-string">"1.0"</span>,
    compress: str = <span class="hljs-string">"false"</span>,
    format: str = <span class="hljs-string">"csvdata"</span>,
    formatVersion: str = <span class="hljs-string">"2.0"</span>,
    lang: str = <span class="hljs-string">"en"</span>,
    labels: str = <span class="hljs-string">"name"</span>,
)</span>:</span>
    <span class="hljs-string">"""
    Descargar datos desde Eurostat SDMX 3.0 (CSV) y devolver DataFrame.
    Replica la firma de la función R correspondiente.
    """</span>
    base_url = <span class="hljs-string">"https://ec.europa.eu/eurostat/api/dissemination/sdmx/3.0/data/dataflow"</span>

    data_identifier = <span class="hljs-string">f"<span class="hljs-subst">{agency_identifier}</span>/<span class="hljs-subst">{dataset_identifier}</span>/<span class="hljs-subst">{dataset_version}</span>"</span>
    url = <span class="hljs-string">f"<span class="hljs-subst">{base_url}</span>/<span class="hljs-subst">{data_identifier}</span>/"</span>

    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> isinstance(filters, dict):
        <span class="hljs-keyword">raise</span> ValueError(<span class="hljs-string">"'filters' debe ser un dict nombrado de dimension -&gt; valores"</span>)

    <span class="hljs-comment"># Convertir filtros a c[dim]=val1,val2</span>
    filters_params = {<span class="hljs-string">f"c[<span class="hljs-subst">{k}</span>]"</span>: <span class="hljs-string">","</span>.join(map(str, v)) <span class="hljs-keyword">if</span> isinstance(v, (list, tuple, set)) <span class="hljs-keyword">else</span> str(v) <span class="hljs-keyword">for</span> k, v <span class="hljs-keyword">in</span> filters.items()}

    common_params = dict(
        compress=compress,
        format=format,
        formatVersion=formatVersion,
        lang=lang,
        labels=labels,
    )
    params = {**filters_params, **common_params}

    headers = {<span class="hljs-string">"Accept"</span>: <span class="hljs-string">"application/vnd.sdmx.data+csv; version=2.0.0"</span>}
    resp = requests.get(url, params=params, headers=headers, timeout=<span class="hljs-number">180</span>)
    resp.raise_for_status()

    text_stream = io.StringIO(resp.content.decode(<span class="hljs-string">"utf-8"</span>))
    df = pd.read_csv(text_stream)
    <span class="hljs-keyword">return</span> df



</div></code></pre>
<h3 id="eurostatminpy">eurostat_min.py</h3>
<pre class="hljs"><code><div><span class="hljs-comment"># Descargador mínimo Eurostat SDMX 3.0 (CSV)</span>
<span class="hljs-comment"># ----------------------------------------------------------------------------</span>
<span class="hljs-comment"># Objetivo</span>
<span class="hljs-comment">#   Descarga datos Eurostat (SDMX CSV) con filtros y guarda un CSV</span>
<span class="hljs-comment"># ----------------------------------------------------------------------------</span>
<span class="hljs-keyword">import</span> os
<span class="hljs-keyword">import</span> io
<span class="hljs-keyword">import</span> pandas <span class="hljs-keyword">as</span> pd
<span class="hljs-keyword">import</span> requests


<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> -&gt; <span class="hljs-keyword">None</span>:</span>
    <span class="hljs-comment"># Cambiar directorio a la carpeta del script para rutas consistentes</span>
    os.chdir(os.path.dirname(os.path.abspath(__file__)))

    <span class="hljs-comment"># Construcción de URL y parámetros (c[dim]=val1,val2)</span>
    base_url = <span class="hljs-string">"https://ec.europa.eu/eurostat/api/dissemination/sdmx/3.0/data/dataflow"</span>
    data_identifier = <span class="hljs-string">"ESTAT/nama_10_a64/1.0"</span>
    url = <span class="hljs-string">f"<span class="hljs-subst">{base_url}</span>/<span class="hljs-subst">{data_identifier}</span>/"</span>
    params = {
        <span class="hljs-string">"c[geo]"</span>: <span class="hljs-string">"IT"</span>,
        <span class="hljs-string">"c[na_item]"</span>: <span class="hljs-string">"B1G"</span>,
        <span class="hljs-string">"c[unit]"</span>: <span class="hljs-string">"CLV20_MEUR"</span>,
        <span class="hljs-string">"c[TIME_PERIOD]"</span>: <span class="hljs-string">"ge:1995"</span>,
        <span class="hljs-string">"compress"</span>: <span class="hljs-string">"false"</span>,
        <span class="hljs-string">"format"</span>: <span class="hljs-string">"csvdata"</span>,
        <span class="hljs-string">"formatVersion"</span>: <span class="hljs-string">"2.0"</span>,
        <span class="hljs-string">"lang"</span>: <span class="hljs-string">"en"</span>,
        <span class="hljs-string">"labels"</span>: <span class="hljs-string">"name"</span>,
    }
    headers = {<span class="hljs-string">"Accept"</span>: <span class="hljs-string">"application/vnd.sdmx.data+csv; version=2.0.0"</span>}
    resp = requests.get(url, params=params, headers=headers, timeout=<span class="hljs-number">180</span>)
    resp.raise_for_status()
    text_stream = io.StringIO(resp.content.decode(<span class="hljs-string">"utf-8"</span>))
    pd.read_csv(text_stream).to_csv(<span class="hljs-string">"eurostat_min.csv"</span>, index=<span class="hljs-literal">False</span>)


<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">"__main__"</span>:
    main()



</div></code></pre>
<h3 id="eurostatonlylinkpy">eurostat_onlylink.py</h3>
<pre class="hljs"><code><div><span class="hljs-comment"># Minimal Eurostat API downloader (link only)</span>
<span class="hljs-keyword">import</span> pandas <span class="hljs-keyword">as</span> pd
df = pd.read_csv(<span class="hljs-string">"https://ec.europa.eu/eurostat/api/dissemination/sdmx/3.0/data/dataflow/ESTAT/nama_10_a64/1.0/?c[geo]=ES,FR&amp;c[na_item]=B1G,P1&amp;c[unit]=CLV20_MEUR&amp;c[TIME_PERIOD]=ge:1995&amp;compress=false&amp;format=csvdata&amp;formatVersion=2.0&amp;lang=en&amp;labels=name"</span>)


</div></code></pre>
<h2 id="fred">FRED</h2>
<h3 id="gu%C3%ADa-r%C3%A1pida-fred-con-python">Guía rápida: FRED con Python</h3>
<p>Este documento explica cómo usar las funciones en <code>python/fred/fred_function.py</code> para descargar datos desde FRED.</p>
<h4 id="requisitos">Requisitos</h4>
<ul>
<li>Paquetes: <code>requests</code>, <code>pandas</code></li>
</ul>
<h4 id="codigos-ejemplo">Codigos ejemplo</h4>
<ul>
<li><code>fred_onlylink.py</code> es un ejemplo que descarga y lee el csv directamente del link de la API en una linea.</li>
<li><code>fred_min.py</code> es un ejemplo mínimo para descargar datos de FRED sin usar la función.</li>
<li><code>fred_example.py</code> es un ejemplo de uso de la función <code>fred_api_function</code>.</li>
</ul>
<h4 id="inputs">Inputs</h4>
<ul>
<li>
<p><strong>fredgraph_api_function</strong></p>
<ul>
<li><code>graph_id</code> (Obligatorio): identificador del gráfico compartido en FRED.</li>
</ul>
</li>
<li>
<p><strong>fred_api_function</strong></p>
<ul>
<li><code>series_id</code> (Obligatorio): identificador de la serie (p. ej., <code>&quot;GDP&quot;</code>).</li>
<li>Opcionales: <code>observation_start</code>, <code>observation_end</code>, <code>realtime_start</code>, <code>realtime_end</code>, <code>limit</code>, <code>offset</code>, <code>sort_order</code>, <code>units</code>, <code>frequency</code>, <code>aggregation_method</code>, <code>output_type</code>, <code>vintage_dates</code>, <code>api_key</code>.</li>
</ul>
</li>
</ul>
<h4 id="c%C3%B3mo-elegir-inputs">Cómo elegir inputs</h4>
<ul>
<li>
<p>Para <code>fredgraph_api_function</code>:</p>
<ul>
<li>Obtenga <code>graph_id</code> desde el enlace compartido del gráfico (parámetro <code>?g=</code> en la URL).</li>
</ul>
</li>
<li>
<p>Para <code>fred_api_function</code>:</p>
<ol>
<li>Elija <code>series_id</code> (p. ej., <code>GDP</code>, esto suele estar al lado del nombre de la serie en FRED entre paréntesis).</li>
<li>Defina <code>FRED_API_KEY</code> como variable de entorno o pásela como argumento.</li>
<li>Si es necesario, cambie los otros parámetros opcionales.</li>
</ol>
</li>
</ul>
<h4 id="sintaxis-de-la-api">Sintaxis de la API</h4>
<ul>
<li><strong>fredgraph CSV:</strong><pre class="hljs"><code><div>https://fred.stlouisfed.org/graph/fredgraph.csv?g={graphId}
</div></code></pre>
</li>
<li><strong>API v1 observaciones:</strong><pre class="hljs"><code><div>https://api.stlouisfed.org/fred/series/observations?series_id={id}&amp;api_key=...&amp;file_type=json
</div></code></pre>
</li>
</ul>
<h4 id="output">Output</h4>
<ul>
<li><code>pandas.DataFrame</code> con las observaciones devueltas por cada método.</li>
</ul>
<h4 id="notas">Notas</h4>
<ul>
<li>La API v1 admite parámetros como <code>units</code>, <code>frequency</code>, <code>aggregation_method</code>, etc. con validación básica.</li>
</ul>
<h4 id="enlaces-%C3%BAtiles">Enlaces útiles</h4>
<ul>
<li>Referencia oficial: <a href="https://fred.stlouisfed.org/docs/api/fred/series_observations.html">FRED observations API docs</a></li>
</ul>
<h3 id="fredexamplepy">fred_example.py</h3>
<pre class="hljs"><code><div><span class="hljs-keyword">import</span> os
<span class="hljs-comment"># Ejemplo de uso — FRED (fredgraph y API v1)</span>
<span class="hljs-comment"># ----------------------------------------------------------------------------</span>
<span class="hljs-comment"># 1) Descargar CSV de fredgraph (no requiere API key)</span>
<span class="hljs-comment"># 2) (Opcional) Consultar API v1 con FRED_API_KEY</span>
<span class="hljs-comment"># ----------------------------------------------------------------------------</span>
<span class="hljs-keyword">from</span> fred_function <span class="hljs-keyword">import</span> fredgraph_api_function, fred_api_function


<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> -&gt; <span class="hljs-keyword">None</span>:</span>
    os.chdir(os.path.dirname(os.path.abspath(__file__)))

    <span class="hljs-comment"># Ejemplo fredgraph</span>
    df_graph = fredgraph_api_function(<span class="hljs-string">"1wmdD"</span>)
    df_graph.to_csv(<span class="hljs-string">"fred_graph_example.csv"</span>, index=<span class="hljs-literal">False</span>)

    <span class="hljs-comment"># Ejemplo API v1 (requiere FRED_API_KEY)</span>
    os.environ[<span class="hljs-string">"FRED_API_KEY"</span>] = <span class="hljs-string">"28ee932ab037f5486dae766aebf0bec3"</span>
    df_api = fred_api_function(series_id=<span class="hljs-string">"GDPC1"</span>, observation_start=<span class="hljs-string">"2000-01-01"</span>)
    df_api.to_csv(<span class="hljs-string">"fred_api_example.csv"</span>, index=<span class="hljs-literal">False</span>)


<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">"__main__"</span>:
    main()



</div></code></pre>
<h3 id="fredfunctionpy">fred_function.py</h3>
<pre class="hljs"><code><div><span class="hljs-keyword">from</span> __future__ <span class="hljs-keyword">import</span> annotations

<span class="hljs-keyword">import</span> io
<span class="hljs-keyword">import</span> os
<span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> Optional

<span class="hljs-keyword">import</span> pandas <span class="hljs-keyword">as</span> pd
<span class="hljs-keyword">import</span> requests


<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">fredgraph_api_function</span><span class="hljs-params">(graph_id: str)</span> -&gt; pd.DataFrame:</span>
    url = <span class="hljs-string">"https://fred.stlouisfed.org/graph/fredgraph.csv"</span>
    resp = requests.get(url, params={<span class="hljs-string">"g"</span>: graph_id}, headers={<span class="hljs-string">"Accept"</span>: <span class="hljs-string">"text/csv"</span>}, timeout=<span class="hljs-number">120</span>)
    resp.raise_for_status()
    text_stream = io.StringIO(resp.content.decode(<span class="hljs-string">"utf-8"</span>))
    <span class="hljs-keyword">return</span> pd.read_csv(text_stream)


<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">fred_api_function</span><span class="hljs-params">(
    series_id: str,
    observation_start: Optional[str] = None,
    observation_end: Optional[str] = None,
    realtime_start: Optional[str] = None,
    realtime_end: Optional[str] = None,
    limit: Optional[int] = None,
    offset: Optional[int] = None,
    sort_order: str = <span class="hljs-string">"asc"</span>,
    units: Optional[str] = None,
    frequency: Optional[str] = None,
    aggregation_method: Optional[str] = None,
    output_type: Optional[int] = None,
    vintage_dates: Optional[str] = None,
    api_key: Optional[str] = None,
)</span>:</span>
    <span class="hljs-keyword">if</span> api_key <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span>:
        api_key = os.environ.get(<span class="hljs-string">"FRED_API_KEY"</span>)
    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> api_key:
        <span class="hljs-keyword">raise</span> RuntimeError(<span class="hljs-string">"Defina la variable de entorno FRED_API_KEY para usar fred_api_function."</span>)

    <span class="hljs-keyword">if</span> units <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span>:
        allowed_units = {<span class="hljs-string">"lin"</span>,<span class="hljs-string">"chg"</span>,<span class="hljs-string">"ch1"</span>,<span class="hljs-string">"pch"</span>,<span class="hljs-string">"pc1"</span>,<span class="hljs-string">"pca"</span>,<span class="hljs-string">"cch"</span>,<span class="hljs-string">"cca"</span>,<span class="hljs-string">"log"</span>}
        <span class="hljs-keyword">if</span> units <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> allowed_units:
            <span class="hljs-keyword">raise</span> ValueError(<span class="hljs-string">f"Valor de 'units' no válido: <span class="hljs-subst">{units}</span>"</span>)
    <span class="hljs-keyword">if</span> frequency <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span>:
        allowed_freq = {<span class="hljs-string">"d"</span>,<span class="hljs-string">"w"</span>,<span class="hljs-string">"bw"</span>,<span class="hljs-string">"m"</span>,<span class="hljs-string">"q"</span>,<span class="hljs-string">"sa"</span>,<span class="hljs-string">"a"</span>,<span class="hljs-string">"wef"</span>,<span class="hljs-string">"weth"</span>,<span class="hljs-string">"wew"</span>,<span class="hljs-string">"wetu"</span>,<span class="hljs-string">"wem"</span>,<span class="hljs-string">"wesu"</span>,<span class="hljs-string">"wesa"</span>,<span class="hljs-string">"bwew"</span>,<span class="hljs-string">"bwem"</span>}
        <span class="hljs-keyword">if</span> frequency <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> allowed_freq:
            <span class="hljs-keyword">raise</span> ValueError(<span class="hljs-string">f"Valor de 'frequency' no válido: <span class="hljs-subst">{frequency}</span>"</span>)
    <span class="hljs-keyword">if</span> aggregation_method <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span>:
        allowed_agg = {<span class="hljs-string">"avg"</span>,<span class="hljs-string">"sum"</span>,<span class="hljs-string">"eop"</span>}
        <span class="hljs-keyword">if</span> aggregation_method <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> allowed_agg:
            <span class="hljs-keyword">raise</span> ValueError(<span class="hljs-string">f"Valor de 'aggregation_method' no válido: <span class="hljs-subst">{aggregation_method}</span>"</span>)
    <span class="hljs-keyword">if</span> output_type <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span> <span class="hljs-keyword">and</span> output_type <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> {<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>,<span class="hljs-number">4</span>}:
        <span class="hljs-keyword">raise</span> ValueError(<span class="hljs-string">"'output_type' debe ser uno de 1,2,3,4"</span>)

    url = <span class="hljs-string">"https://api.stlouisfed.org/fred/series/observations"</span>
    q = {
        <span class="hljs-string">"series_id"</span>: series_id,
        <span class="hljs-string">"api_key"</span>: api_key,
        <span class="hljs-string">"file_type"</span>: <span class="hljs-string">"json"</span>,
    }
    <span class="hljs-keyword">if</span> observation_start: q[<span class="hljs-string">"observation_start"</span>] = observation_start
    <span class="hljs-keyword">if</span> observation_end: q[<span class="hljs-string">"observation_end"</span>] = observation_end
    <span class="hljs-keyword">if</span> realtime_start: q[<span class="hljs-string">"realtime_start"</span>] = realtime_start
    <span class="hljs-keyword">if</span> realtime_end: q[<span class="hljs-string">"realtime_end"</span>] = realtime_end
    <span class="hljs-keyword">if</span> limit <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span>: q[<span class="hljs-string">"limit"</span>] = limit
    <span class="hljs-keyword">if</span> offset <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span>: q[<span class="hljs-string">"offset"</span>] = offset
    <span class="hljs-keyword">if</span> sort_order: q[<span class="hljs-string">"sort_order"</span>] = sort_order
    <span class="hljs-keyword">if</span> units: q[<span class="hljs-string">"units"</span>] = units
    <span class="hljs-keyword">if</span> frequency: q[<span class="hljs-string">"frequency"</span>] = frequency
    <span class="hljs-keyword">if</span> aggregation_method: q[<span class="hljs-string">"aggregation_method"</span>] = aggregation_method
    <span class="hljs-keyword">if</span> output_type <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span>: q[<span class="hljs-string">"output_type"</span>] = output_type
    <span class="hljs-keyword">if</span> vintage_dates: q[<span class="hljs-string">"vintage_dates"</span>] = vintage_dates

    resp = requests.get(url, params=q, headers={<span class="hljs-string">"Accept"</span>: <span class="hljs-string">"application/json"</span>}, timeout=<span class="hljs-number">120</span>)
    resp.raise_for_status()
    obj = resp.json()
    <span class="hljs-keyword">if</span> <span class="hljs-string">"observations"</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> obj:
        <span class="hljs-keyword">raise</span> RuntimeError(<span class="hljs-string">"Estructura inesperada de la API de FRED; falta 'observations'."</span>)
    <span class="hljs-keyword">return</span> pd.DataFrame(obj[<span class="hljs-string">"observations"</span>])  <span class="hljs-comment"># already flattened keys</span>



</div></code></pre>
<h3 id="fredminpy">fred_min.py</h3>
<pre class="hljs"><code><div><span class="hljs-comment"># Descargador mínimo FRED (fredgraph CSV) — autocontenido (no usa la función)</span>
<span class="hljs-comment"># ----------------------------------------------------------------------------</span>
<span class="hljs-comment"># Objetivo</span>
<span class="hljs-comment">#   Descarga el CSV de un gráfico compartido de FRED y lo guarda</span>
<span class="hljs-comment"># ----------------------------------------------------------------------------</span>
<span class="hljs-keyword">import</span> os
<span class="hljs-keyword">import</span> io
<span class="hljs-keyword">import</span> pandas <span class="hljs-keyword">as</span> pd
<span class="hljs-keyword">import</span> requests


<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> -&gt; <span class="hljs-keyword">None</span>:</span>
    <span class="hljs-comment"># Cambiar directorio a la carpeta del script para rutas consistentes</span>
    os.chdir(os.path.dirname(os.path.abspath(__file__)))

    <span class="hljs-comment"># Parámetros mínimos</span>
    graph_id = <span class="hljs-string">"1wmdD"</span>
    url = <span class="hljs-string">"https://fred.stlouisfed.org/graph/fredgraph.csv"</span>

    <span class="hljs-comment"># Petición y guardado</span>
    resp = requests.get(url, params={<span class="hljs-string">"g"</span>: graph_id}, headers={<span class="hljs-string">"Accept"</span>: <span class="hljs-string">"text/csv"</span>}, timeout=<span class="hljs-number">120</span>)
    resp.raise_for_status()
    text_stream = io.StringIO(resp.content.decode(<span class="hljs-string">"utf-8"</span>))
    pd.read_csv(text_stream).to_csv(<span class="hljs-string">"fred_graph_min.csv"</span>, index=<span class="hljs-literal">False</span>)


<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">"__main__"</span>:
    main()



</div></code></pre>
<h3 id="fredonlylinkpy">fred_onlylink.py</h3>
<pre class="hljs"><code><div><span class="hljs-comment"># Minimal FRED API downloader (link only)</span>
<span class="hljs-keyword">import</span> pandas <span class="hljs-keyword">as</span> pd
df = pd.read_csv(<span class="hljs-string">"https://fred.stlouisfed.org/graph/fredgraph.csv?g=1wmdD"</span>)


</div></code></pre>
<h2 id="imf">IMF</h2>
<h3 id="gu%C3%ADa-r%C3%A1pida-fmi-con-python">Guía rápida: FMI con Python</h3>
<p>Este documento explica cómo usar la función en <code>python/imf/imf_function.py</code> para descargar datos SDMX-CSV de la API SDMX 3.0 del FMI y obtenerlos como un <code>pandas.DataFrame</code>.</p>
<h4 id="requisitos">Requisitos</h4>
<ul>
<li>Paquetes: <code>requests</code>, <code>pandas</code></li>
</ul>
<h4 id="codigos-ejemplo">Codigos ejemplo</h4>
<ul>
<li><code>imf_onlylink.py</code>: ejemplo que descarga y lee el csv directamente del link de la API en una linea (usando <code>pandasdmx</code>).</li>
<li><code>imf_min.py</code>: ejemplo mínimo para construir la URL SDMX-CSV y guardar en CSV.</li>
<li><code>imf_example.py</code>: ejemplo de uso de la función <code>imf_api_function</code> devolviendo un DataFrame y exportándolo a CSV.</li>
</ul>
<h4 id="inputs">Inputs</h4>
<ul>
<li>
<p><strong>Obligatorios</strong></p>
<ul>
<li><code>dataset_identifier</code>: identificador del dataset (p. ej., &quot;QNEA&quot;).</li>
<li><code>data_selection</code>: clave SDMX completa tras la <code>/</code> (orden y códigos según el dataset). Ej.: &quot;ESP.B1GQ.Q.SA.XDC.Q&quot; o múltiples países &quot;ESP+FRA.B1GQ.Q.SA.XDC.Q&quot;.</li>
</ul>
</li>
<li>
<p><strong>Opcionales</strong></p>
<ul>
<li><code>filters</code> (dict): filtros SDMX convertidos a <code>c[DIM]</code>. Para varias condiciones use <code>+</code>.</li>
<li><code>agency_identifier</code>: por defecto &quot;IMF.STA&quot;.</li>
<li><code>dataset_version</code>: por defecto &quot;+&quot; (última versión).</li>
<li><code>accept_csv_version</code>: por defecto &quot;1.0.0&quot;.</li>
</ul>
</li>
</ul>
<h4 id="c%C3%B3mo-elegir-inputs">Cómo elegir inputs</h4>
<ol>
<li>Localice el dataset y el indicador en el portal del FMI o en la documentación de SDMX.</li>
<li>Construya la <code>key</code> con las dimensiones requeridas por el dataset.</li>
<li>Use <code>filters</code> para condiciones adicionales.</li>
</ol>
<h4 id="sintaxis-de-la-api-fmi-sdmx-30">Sintaxis de la API (FMI SDMX 3.0)</h4>
<ul>
<li>
<p><strong>Formato general (CSV):</strong></p>
<pre class="hljs"><code><div>https://api.imf.org/external/sdmx/3.0/data/dataflow/{agency}/{dataset}/{version}/{key}?c[DIM]=...
</div></code></pre>
<p>Referencia al servicio SDMX JSON del FMI: <code>https://dataservices.imf.org/REST/SDMX_JSON.svc</code></p>
</li>
<li>
<p><strong>Ejemplo:</strong></p>
<pre class="hljs"><code><div>https://api.imf.org/external/sdmx/3.0/data/dataflow/IMF.STA/QNEA/+/ESP+FRA.B1GQ.Q.SA.XDC.Q?c[TIME_PERIOD]=ge:2020-Q1
</div></code></pre>
</li>
</ul>
<h4 id="output">Output</h4>
<ul>
<li>Un <code>pandas.DataFrame</code> con los datos descargados en formato SDMX-CSV.</li>
</ul>
<h4 id="notas">Notas</h4>
<ul>
<li>Los filtros <code>c[DIM]</code> solo aplican a dimensiones que queden comodín en la clave; si fija <code>COUNTRY</code> en la clave, <code>c[COUNTRY]</code> no surtirá efecto.</li>
<li>Para seleccionar múltiples países, una forma robusta es ponerlos en la clave con <code>+</code> (p. ej., <code>ESP+FRA....</code>).</li>
</ul>
<h4 id="enlaces-%C3%BAtiles">Enlaces útiles</h4>
<ul>
<li>Conocimiento/soporte del FMI (categoría API/SDMX): https://datasupport.imf.org/knowledge?id=knowledge_category&amp;sys_kb_id=d41858e747294ad8805d07c4f16d43e0&amp;category_id=9959b2bc1b6391903dba646fbd4bcb6a</li>
</ul>
<h3 id="imfexamplepy">imf_example.py</h3>
<pre class="hljs"><code><div><span class="hljs-keyword">from</span> __future__ <span class="hljs-keyword">import</span> annotations

<span class="hljs-keyword">from</span> imf_function <span class="hljs-keyword">import</span> imf_api_function

<span class="hljs-comment"># Ejemplo: QNEA PIB trimestral SA XDC para España y Francia, 2020-Q1..2020-Q4</span>
df = imf_api_function(
    dataset_identifier=<span class="hljs-string">"QNEA"</span>,
    data_selection=<span class="hljs-string">"ESP+FRA.B1GQ.Q.SA.XDC.Q"</span>,
    filters={
        <span class="hljs-string">"TIME_PERIOD"</span>: [<span class="hljs-string">"ge:2020-Q1"</span>, <span class="hljs-string">"le:2020-Q4"</span>],
    },
)

df.to_csv(<span class="hljs-string">"imf_example.csv"</span>, index=<span class="hljs-literal">False</span>)

</div></code></pre>
<h3 id="imffunctionpy">imf_function.py</h3>
<pre class="hljs"><code><div><span class="hljs-keyword">from</span> __future__ <span class="hljs-keyword">import</span> annotations

<span class="hljs-keyword">import</span> io
<span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> Dict, Iterable

<span class="hljs-keyword">import</span> pandas <span class="hljs-keyword">as</span> pd
<span class="hljs-keyword">import</span> requests


<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">imf_api_function</span><span class="hljs-params">(
    dataset_identifier: str,
    data_selection: str,
    filters: Dict[str, Iterable[str]] | None = None,
    agency_identifier: str = <span class="hljs-string">"IMF.STA"</span>,
    dataset_version: str = <span class="hljs-string">"+"</span>,
    accept_csv_version: str = <span class="hljs-string">"1.0.0"</span>,
    base_url: str = <span class="hljs-string">"https://api.imf.org/external/sdmx/3.0/data/dataflow"</span>,
)</span> -&gt; pd.DataFrame:</span>
    <span class="hljs-string">"""
    Descargar datos desde el FMI (SDMX 3.0 CSV) y devolver un DataFrame.
    - dataset_identifier: p. ej., "QNEA"
    - data_selection: clave SDMX (p. ej., "ESP.B1GQ.Q.SA.XDC.Q" o "ESP+FRA.B1GQ.Q.SA.XDC.Q")
    - filters: dict como { 'TIME_PERIOD': ['ge:2020-Q1','le:2020-Q4'] }
    """</span>
    <span class="hljs-keyword">if</span> filters <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span>:
        filters = {}

    <span class="hljs-comment"># Construir la URL SDMX 3.0 CSV: base/agency/dataset/version/key</span>
    <span class="hljs-comment"># Codificar conservando reservados útiles (+,*,:,/ ,)</span>
    <span class="hljs-keyword">from</span> urllib.parse <span class="hljs-keyword">import</span> quote

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">urlencode_keep_reserved</span><span class="hljs-params">(s: str)</span> -&gt; str:</span>
        <span class="hljs-keyword">return</span> quote(str(s), safe=<span class="hljs-string">"+*:,/,"</span>)

    url = (
        <span class="hljs-string">f"<span class="hljs-subst">{base_url}</span>/"</span>
        <span class="hljs-string">f"<span class="hljs-subst">{agency_identifier}</span>/"</span>
        <span class="hljs-string">f"<span class="hljs-subst">{dataset_identifier}</span>/"</span>
        <span class="hljs-string">f"<span class="hljs-subst">{urlencode_keep_reserved(dataset_version)}</span>/"</span>
        <span class="hljs-string">f"<span class="hljs-subst">{urlencode_keep_reserved(data_selection)}</span>"</span>
    )

    <span class="hljs-comment"># Filtros como c[DIM] = v1+v2 (unir con '+')</span>
    params: Dict[str, str] = {}
    <span class="hljs-keyword">for</span> dim, values <span class="hljs-keyword">in</span> filters.items():
        <span class="hljs-keyword">if</span> values <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span>:
            <span class="hljs-keyword">continue</span>
        <span class="hljs-keyword">if</span> isinstance(values, (list, tuple, set)):
            joined = <span class="hljs-string">"+"</span>.join(map(str, values))
        <span class="hljs-keyword">else</span>:
            joined = str(values)
        params[<span class="hljs-string">f"c[<span class="hljs-subst">{dim}</span>]"</span>] = joined

    headers = {
        <span class="hljs-string">"Accept"</span>: <span class="hljs-string">f"application/vnd.sdmx.data+csv;version=<span class="hljs-subst">{accept_csv_version}</span>"</span>,
        <span class="hljs-string">"Cache-Control"</span>: <span class="hljs-string">"no-cache"</span>,
    }

    resp = requests.get(url, params=params, headers=headers, timeout=<span class="hljs-number">180</span>)
    resp.raise_for_status()

    text_stream = io.StringIO(resp.content.decode(<span class="hljs-string">"utf-8"</span>))
    df = pd.read_csv(text_stream)
    <span class="hljs-keyword">return</span> df

</div></code></pre>
<h3 id="imfminpy">imf_min.py</h3>
<pre class="hljs"><code><div><span class="hljs-keyword">from</span> __future__ <span class="hljs-keyword">import</span> annotations

<span class="hljs-keyword">import</span> io
<span class="hljs-keyword">from</span> urllib.parse <span class="hljs-keyword">import</span> quote

<span class="hljs-keyword">import</span> pandas <span class="hljs-keyword">as</span> pd
<span class="hljs-keyword">import</span> requests

<span class="hljs-comment"># Parámetros básicos (análogos a R/imf/imf_min.R)</span>
base_url = <span class="hljs-string">"https://api.imf.org/external/sdmx/3.0/data/dataflow"</span>
agency_identifier = <span class="hljs-string">"IMF.STA"</span>
dataset_identifier = <span class="hljs-string">"QNEA"</span>
dataset_version = <span class="hljs-string">"+"</span>

<span class="hljs-comment"># Clave SDMX (múltiples países con '+')</span>
data_selection = <span class="hljs-string">"ESP+FRA.B1GQ.Q.SA.XDC.Q"</span>

<span class="hljs-comment"># Filtro de fechas</span>
filters = {
    <span class="hljs-string">"TIME_PERIOD"</span>: [<span class="hljs-string">"ge:2020-Q1"</span>, <span class="hljs-string">"le:2020-Q4"</span>],
}

<span class="hljs-comment"># Construcción de URL y query</span>
url = (
    <span class="hljs-string">f"<span class="hljs-subst">{base_url}</span>/"</span>
    <span class="hljs-string">f"<span class="hljs-subst">{agency_identifier}</span>/"</span>
    <span class="hljs-string">f"<span class="hljs-subst">{dataset_identifier}</span>/"</span>
    <span class="hljs-string">f"<span class="hljs-subst">{quote(dataset_version, safe=<span class="hljs-string">'+*:,/ ,'</span>)}</span>/"</span>
    <span class="hljs-string">f"<span class="hljs-subst">{quote(data_selection, safe=<span class="hljs-string">'+*:,/ ,'</span>)}</span>"</span>
)
params = {<span class="hljs-string">f"c[<span class="hljs-subst">{k}</span>]"</span>: <span class="hljs-string">"+"</span>.join(v) <span class="hljs-keyword">for</span> k, v <span class="hljs-keyword">in</span> filters.items()}

headers = {
    <span class="hljs-string">"Accept"</span>: <span class="hljs-string">"application/vnd.sdmx.data+csv;version=1.0.0"</span>,
    <span class="hljs-string">"Cache-Control"</span>: <span class="hljs-string">"no-cache"</span>,
}

resp = requests.get(url, params=params, headers=headers, timeout=<span class="hljs-number">180</span>)
resp.raise_for_status()

df = pd.read_csv(io.StringIO(resp.content.decode(<span class="hljs-string">"utf-8"</span>)))
df.to_csv(<span class="hljs-string">"imf_min.csv"</span>, index=<span class="hljs-literal">False</span>)

</div></code></pre>
<h3 id="imfonlylinkpy">imf_onlylink.py</h3>
<pre class="hljs"><code><div><span class="hljs-comment"># Minimal IMF API downloader (link only). Notice is a xml file, not a csv file.</span>
<span class="hljs-comment"># Requires: pip install pandasdmx</span>
<span class="hljs-keyword">import</span> pandasdmx <span class="hljs-keyword">as</span> sdmx
df = sdmx.read_url(<span class="hljs-string">"https://api.imf.org/external/sdmx/3.0/data/dataflow/IMF.STA/QNEA/%2B/ESP%2BFRA.B1GQ.Q.SA.XDC.Q"</span>).to_pandas()


</div></code></pre>
<h2 id="ine">INE</h2>
<h3 id="gu%C3%ADa-r%C3%A1pida-ine-jaxit3-con-python">Guía rápida: INE JAXIT3 con Python</h3>
<p>Este documento explica cómo usar la función en <code>python/ine/ine_jaxi_function.py</code> para descargar datos desde la API de INE JAXIT3 en formato CSV y obtenerlos como un <code>pandas.DataFrame</code> en Python.</p>
<h4 id="requisitos">Requisitos</h4>
<ul>
<li>Paquetes: <code>requests</code>, <code>pandas</code></li>
</ul>
<h4 id="codigos-ejemplo">Codigos ejemplo</h4>
<ul>
<li><code>ine_jaxi_onlylink.py</code> es un ejemplo que descarga y lee el csv directamente del link de la API en una linea.</li>
<li><code>ine_jaxi_min.py</code> es un ejemplo mínimo que descarga y guarda <code>ine_jaxi_min.csv</code>.</li>
<li><code>ine_jaxi_example.py</code> es un ejemplo de uso de la función <code>ine_jaxi_api_function</code>.</li>
</ul>
<h4 id="inputs">Inputs</h4>
<ul>
<li>
<p><strong>Obligatorios</strong></p>
<ul>
<li><code>table_id</code>: identificador de la tabla INE (p. ej., <code>&quot;67821&quot;</code>).</li>
</ul>
</li>
<li>
<p><strong>Opcionales</strong></p>
<ul>
<li><code>nocab</code>: <code>&quot;1&quot;</code> para evitar cabeceras adicionales (opcional).</li>
<li><code>directory</code>: segmento de directorio (por defecto <code>&quot;t&quot;</code>).</li>
<li><code>locale</code>: idioma del recurso (por defecto <code>&quot;es&quot;</code>).</li>
<li><code>variant</code>: variante del CSV (por defecto <code>&quot;csv_bdsc&quot;</code>).</li>
</ul>
</li>
</ul>
<h4 id="c%C3%B3mo-elegir-inputs">Cómo elegir inputs</h4>
<ol>
<li>Vaya a la página de la tabla en INE y copie el identificador (número al final de la URL).</li>
<li>Use ese identificador como <code>table_id</code>.</li>
<li>Ajuste parámetros opcionales (<code>nocab</code>, <code>locale</code>, <code>variant</code>, <code>directory</code>) si es necesario.</li>
<li>Si necesita cabeceras compactas para procesamiento, mantenga <code>nocab = &quot;1&quot;</code>.</li>
</ol>
<h4 id="sintaxis-de-la-api-ine-jaxit3">Sintaxis de la API (INE JAXIT3)</h4>
<ul>
<li>
<p><strong>Formato general:</strong></p>
<pre class="hljs"><code><div>https://www.ine.es/jaxiT3/files/{directory}/{locale}/{variant}/{tableId}.csv?nocab={nocab}
</div></code></pre>
<p>Donde el Host URL es <code>https://www.ine.es/jaxiT3/files</code>.</p>
</li>
<li>
<p><strong>Ejemplo:</strong></p>
<pre class="hljs"><code><div>https://www.ine.es/jaxiT3/files/t/es/csv_bdsc/67821.csv?nocab=1
</div></code></pre>
</li>
</ul>
<h4 id="output">Output</h4>
<ul>
<li>Un <code>pandas.DataFrame</code> con los datos descargados desde INE JAXIT3.</li>
</ul>
<h4 id="notas">Notas</h4>
<ul>
<li>Si la API devuelve error, verifique que el <code>table_id</code> exista y sea accesible.</li>
<li>El CSV se parsea con <code>pandas.read_csv(..., sep=';', dtype=str)</code> (todas las columnas como texto).</li>
</ul>
<h4 id="enlaces-%C3%BAtiles">Enlaces útiles</h4>
<ul>
<li>INE (Banco de datos JAXIT3): https://www.ine.es/</li>
</ul>
<h3 id="inejaxiexamplepy">ine_jaxi_example.py</h3>
<pre class="hljs"><code><div><span class="hljs-comment"># Importamos la función y las librerías necesarias</span>
<span class="hljs-keyword">from</span> ine_jaxi_function <span class="hljs-keyword">import</span> ine_jaxi_api_function
<span class="hljs-keyword">import</span> os
<span class="hljs-keyword">from</span> pathlib <span class="hljs-keyword">import</span> Path
<span class="hljs-keyword">import</span> pandas <span class="hljs-keyword">as</span> pd

<span class="hljs-comment"># Cambiamos el directorio de trabajo a la carpeta de este archivo</span>
os.chdir(os.path.dirname(os.path.abspath(__file__)))
<span class="hljs-comment"># Llamamos a la función (retorna un pandas DataFrame)</span>
df = ine_jaxi_api_function(
    table_id=<span class="hljs-string">"67821"</span>,
    nocab=<span class="hljs-string">"1"</span>,
    )

<span class="hljs-comment"># Guardamos el DataFrame en un archivo CSV</span>
df.to_csv(<span class="hljs-string">"ine_jaxi_example.csv"</span>, index=<span class="hljs-literal">False</span>, sep=<span class="hljs-string">";"</span>, encoding=<span class="hljs-string">"utf-8"</span>)





</div></code></pre>
<h3 id="inejaxifunctionpy">ine_jaxi_function.py</h3>
<pre class="hljs"><code><div><span class="hljs-keyword">import</span> io
<span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> Optional

<span class="hljs-keyword">import</span> requests
<span class="hljs-keyword">import</span> pandas <span class="hljs-keyword">as</span> pd


<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">ine_jaxi_api_function</span><span class="hljs-params">(
    table_id: str,
    nocab: str = <span class="hljs-string">"1"</span>,
    directory: str = <span class="hljs-string">"t"</span>,
    locale: str = <span class="hljs-string">"es"</span>,
    variant: str = <span class="hljs-string">"csv_bdsc"</span>,
)</span> -&gt; pd.DataFrame:</span>
    <span class="hljs-string">"""
    Descarga un archivo CSV de INE JAXIT3 y retorna un pandas DataFrame.

    Parámetros
    ----------
    table_id : str
        Identificador de la tabla INE (p. ej., "67821").
    nocab : str, optional
        Control de cabecera; "1" evita cabeceras adicionales. Por defecto "1".
    directory : str, optional
        Segmento de directorio. Por defecto "t".
    locale : str, optional
        Idioma del recurso. Por defecto "es".
    variant : str, optional
        Variante del CSV. Por defecto "csv_bdsc".

    Retorna
    -------
    pandas.DataFrame
        CSV parseado como un DataFrame con columnas de texto.
    """</span>

    <span class="hljs-comment"># URL de la API de INE JAXIT3</span>
    base_url = <span class="hljs-string">"https://www.ine.es/jaxiT3/files"</span>
    url = <span class="hljs-string">f"<span class="hljs-subst">{base_url}</span>/<span class="hljs-subst">{directory}</span>/<span class="hljs-subst">{locale}</span>/<span class="hljs-subst">{variant}</span>/<span class="hljs-subst">{table_id}</span>.csv"</span>

    <span class="hljs-comment"># Parámetros de la petición</span>
    headers = {<span class="hljs-string">"Accept"</span>: <span class="hljs-string">"text/csv"</span>}
    params = {<span class="hljs-string">"nocab"</span>: nocab}

    <span class="hljs-comment"># Hacemos la petición</span>
    resp = requests.get(url, headers=headers, params=params, timeout=<span class="hljs-number">60</span>)
    <span class="hljs-keyword">try</span>:
        resp.raise_for_status()
    <span class="hljs-keyword">except</span> requests.HTTPError <span class="hljs-keyword">as</span> exc:
        <span class="hljs-keyword">raise</span> RuntimeError(<span class="hljs-string">f"INE JAXIT3 request failed [<span class="hljs-subst">{resp.status_code}</span>]"</span>) <span class="hljs-keyword">from</span> exc

    <span class="hljs-comment"># Parseamos el CSV con pandas</span>
    text_stream = io.StringIO(resp.content.decode(<span class="hljs-string">"utf-8-sig"</span>))
    df: pd.DataFrame = pd.read_csv(text_stream, sep=<span class="hljs-string">";"</span>, dtype=str)
    <span class="hljs-keyword">return</span> df



</div></code></pre>
<h3 id="inejaximinpy">ine_jaxi_min.py</h3>
<pre class="hljs"><code><div><span class="hljs-comment"># Descargador mínimo INE JAXIT3 (CSV) — autocontenido (no usa la función)</span>
<span class="hljs-comment"># ----------------------------------------------------------------------------</span>
<span class="hljs-comment"># Objetivo</span>
<span class="hljs-comment">#   Descarga el CSV del INE JAXIT3 con parámetros mínimos y lo guarda</span>
<span class="hljs-comment"># ----------------------------------------------------------------------------</span>
<span class="hljs-keyword">import</span> os
<span class="hljs-keyword">import</span> requests

<span class="hljs-comment"># Cambiamos el directorio de trabajo a la carpeta de este archivo</span>
os.chdir(os.path.dirname(os.path.abspath(__file__)))

<span class="hljs-comment"># Parámetros mínimos</span>
table_id = <span class="hljs-string">"67821"</span>  <span class="hljs-comment"># identificador de la tabla INE (p. ej., "67821")</span>
nocab = <span class="hljs-string">"1"</span>         <span class="hljs-comment"># "1" para evitar cabeceras adicionales</span>

<span class="hljs-comment"># Construcción de URL y petición</span>
url = <span class="hljs-string">f"https://www.ine.es/jaxiT3/files/t/es/csv_bdsc/<span class="hljs-subst">{table_id}</span>.csv"</span>
params = {<span class="hljs-string">"nocab"</span>: nocab}
resp = requests.get(url, params=params, headers={<span class="hljs-string">"Accept"</span>: <span class="hljs-string">"text/csv"</span>}, timeout=<span class="hljs-number">60</span>)
resp.raise_for_status()

<span class="hljs-comment"># Guardar contenido en CSV en esta carpeta</span>
<span class="hljs-keyword">with</span> open(<span class="hljs-string">"ine_jaxi_min.csv"</span>, <span class="hljs-string">"wb"</span>) <span class="hljs-keyword">as</span> f:
    f.write(resp.content)



</div></code></pre>
<h3 id="inejaxionlylinkpy">ine_jaxi_onlylink.py</h3>
<pre class="hljs"><code><div><span class="hljs-comment"># Minimal INE JAXIT3 API downloader (link only)</span>
<span class="hljs-keyword">import</span> pandas <span class="hljs-keyword">as</span> pd
df = pd.read_csv(<span class="hljs-string">"https://www.ine.es/jaxiT3/files/t/es/csv_bdsc/67821.csv?nocab=1"</span>)


</div></code></pre>
<h2 id="oecd">OECD</h2>
<h3 id="gu%C3%ADa-r%C3%A1pida-oecd-con-python">Guía rápida: OECD con Python</h3>
<p>Este documento explica cómo usar la función en <code>python/oecd/oecd_function.py</code> para descargar datos SDMX de la OCDE en CSV y obtener un <code>pandas.DataFrame</code>.</p>
<h4 id="requisitos">Requisitos</h4>
<ul>
<li>Paquetes: <code>requests</code>, <code>pandas</code></li>
</ul>
<h4 id="codigos-ejemplo">Codigos ejemplo</h4>
<ul>
<li><code>oecd_onlylink.py</code> es un ejemplo que descarga y lee el csv directamente del link de la API en una linea.</li>
<li><code>oecd_min.py</code> es un ejemplo mínimo para descargar datos de la OCDE sin usar la función <code>oecd_api_function</code>.</li>
<li><code>oecd_example.py</code> es un ejemplo de uso de la función <code>oecd_api_function</code>.</li>
</ul>
<h4 id="inputs">Inputs</h4>
<ul>
<li>
<p><strong>Obligatorios</strong></p>
<ul>
<li><code>agency_identifier</code>: identificador de la agencia (p. ej., <code>&quot;OECD.ECO.MAD&quot;</code>).</li>
<li><code>dataset_identifier</code>: identificador del dataset (p. ej., <code>&quot;DSD_EO@DF_EO&quot;</code>).</li>
<li><code>data_selection</code>: clave SDMX (dimensiones) tras la <code>/</code> (p. ej., <code>&quot;FRA+DEU.PDTY.A&quot;</code>).</li>
</ul>
</li>
<li>
<p><strong>Opcionales</strong></p>
<ul>
<li><code>dataset_version</code>: versión del dataset (p. ej., <code>&quot;&quot;</code>).</li>
<li><code>startPeriod</code>, <code>endPeriod</code>, <code>dimensionAtObservation</code>: parámetros comunes de consulta.</li>
</ul>
</li>
</ul>
<h4 id="c%C3%B3mo-elegir-inputs">Cómo elegir inputs</h4>
<ol>
<li>Buscar el dataset en el explorador OCDE: https://data-explorer.oecd.org/</li>
<li>Seleccionar las dimensiones que se quieren descargar y consultar la sección &quot;Developer API&quot; para obtener <code>Agency identifier</code>, <code>Dataset identifier</code> y <code>Dataset version</code>.</li>
<li>Construir <code>data_selection</code> con las dimensiones requeridas por el dataset (p. ej., <code>PAISES.VARIABLE.FRECUENCIA</code>).</li>
<li>Ajustar parámetros opcionales (<code>startPeriod</code>, <code>endPeriod</code>, <code>dimensionAtObservation</code>).</li>
</ol>
<h4 id="sintaxis-de-la-api-ocde">Sintaxis de la API (OCDE)</h4>
<ul>
<li>
<p><strong>Formato general:</strong></p>
<pre class="hljs"><code><div>{Host URL}/{Agency identifier},{Dataset identifier},{Dataset version}/{Data selection}?{otros parámetros}
</div></code></pre>
<p>Donde <code>base_url</code> por defecto es <code>https://sdmx.oecd.org/public/rest/data</code>.</p>
</li>
<li>
<p><strong>Ejemplo:</strong></p>
<pre class="hljs"><code><div>https://sdmx.oecd.org/public/rest/data/OECD.ECO.MAD,DSD_EO@DF_EO, /FRA+DEU.PDTY.A?startPeriod=1965&amp;endPeriod=2023&amp;dimensionAtObservation=AllDimensions
</div></code></pre>
</li>
</ul>
<h4 id="output">Output</h4>
<ul>
<li>Un <code>pandas.DataFrame</code> con los datos descargados.</li>
</ul>
<h4 id="notas">Notas</h4>
<ul>
<li>Si la API devuelve error, verifique que <code>agency_identifier</code>, <code>dataset_identifier</code> y <code>data_selection</code> sean válidos.</li>
<li>Revise la documentación del dataset para conocer las dimensiones y códigos disponibles.</li>
</ul>
<h4 id="enlaces-%C3%BAtiles">Enlaces útiles</h4>
<ul>
<li>Explorador OCDE: https://data-explorer.oecd.org/</li>
<li>Documentación de la API: https://www.oecd.org/en/data/insights/data-explainers/2024/09/api.html</li>
</ul>
<h3 id="oecdexamplepy">oecd_example.py</h3>
<pre class="hljs"><code><div><span class="hljs-comment"># Ejemplo de uso — OCDE SDMX (CSV)</span>
<span class="hljs-comment"># ----------------------------------------------------------------------------</span>
<span class="hljs-comment"># 1) Cargar la función</span>
<span class="hljs-comment"># 2) Ejecutar la consulta indicando agencia, dataset y selección</span>
<span class="hljs-comment"># 3) Guardar el resultado como CSV</span>
<span class="hljs-comment"># ----------------------------------------------------------------------------</span>
<span class="hljs-keyword">import</span> os
<span class="hljs-keyword">from</span> oecd_function <span class="hljs-keyword">import</span> oecd_api_function


<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> -&gt; <span class="hljs-keyword">None</span>:</span>
    <span class="hljs-comment"># Asegurar rutas relativas coherentes</span>
    os.chdir(os.path.dirname(os.path.abspath(__file__)))

    <span class="hljs-comment"># Ejecutar la consulta</span>
    df = oecd_api_function(
        agency_identifier=<span class="hljs-string">"OECD.ECO.MAD"</span>,
        dataset_identifier=<span class="hljs-string">"DSD_EO@DF_EO"</span>,
        data_selection=<span class="hljs-string">"FRA+DEU.PDTY.A"</span>,
        startPeriod=<span class="hljs-string">"1965"</span>,
        endPeriod=<span class="hljs-string">"2023"</span>,
        dimensionAtObservation=<span class="hljs-string">"AllDimensions"</span>,
    )

    <span class="hljs-comment"># Guardar el resultado</span>
    df.to_csv(<span class="hljs-string">"oecd_example.csv"</span>, index=<span class="hljs-literal">False</span>)


<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">"__main__"</span>:
    main()



</div></code></pre>
<h3 id="oecdfunctionpy">oecd_function.py</h3>
<pre class="hljs"><code><div><span class="hljs-keyword">from</span> __future__ <span class="hljs-keyword">import</span> annotations

<span class="hljs-keyword">import</span> io
<span class="hljs-keyword">import</span> pandas <span class="hljs-keyword">as</span> pd
<span class="hljs-keyword">import</span> requests


<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">oecd_api_function</span><span class="hljs-params">(
    agency_identifier: str,
    dataset_identifier: str,
    data_selection: str,
    base_url: str = <span class="hljs-string">"https://sdmx.oecd.org/public/rest/data"</span>,
    dataset_version: str = <span class="hljs-string">""</span>,
    startPeriod: str | None = None,
    endPeriod: str | None = None,
    dimensionAtObservation: str | None = None,
)</span> -&gt; pd.DataFrame:</span>
    <span class="hljs-string">"""
    Descargar datos de la OCDE (SDMX CSV) y devolver DataFrame.
    """</span>
    data_identifier = <span class="hljs-string">f"<span class="hljs-subst">{agency_identifier}</span>,<span class="hljs-subst">{dataset_identifier}</span>,<span class="hljs-subst">{dataset_version}</span>"</span>
    params: dict[str, str] = {}
    <span class="hljs-keyword">if</span> startPeriod:
        params[<span class="hljs-string">"startPeriod"</span>] = startPeriod
    <span class="hljs-keyword">if</span> endPeriod:
        params[<span class="hljs-string">"endPeriod"</span>] = endPeriod
    <span class="hljs-keyword">if</span> dimensionAtObservation:
        params[<span class="hljs-string">"dimensionAtObservation"</span>] = dimensionAtObservation

    url = <span class="hljs-string">f"<span class="hljs-subst">{base_url}</span>/<span class="hljs-subst">{data_identifier}</span>/<span class="hljs-subst">{data_selection}</span>"</span>
    resp = requests.get(url, params=params, headers={<span class="hljs-string">"Accept"</span>: <span class="hljs-string">"text/csv"</span>}, timeout=<span class="hljs-number">180</span>)
    resp.raise_for_status()

    text_stream = io.StringIO(resp.content.decode(<span class="hljs-string">"utf-8"</span>))
    df = pd.read_csv(text_stream)
    <span class="hljs-keyword">return</span> df



</div></code></pre>
<h3 id="oecdminpy">oecd_min.py</h3>
<pre class="hljs"><code><div><span class="hljs-comment"># Descargador mínimo OCDE SDMX (CSV)</span>
<span class="hljs-comment"># ----------------------------------------------------------------------------</span>
<span class="hljs-comment"># Objetivo</span>
<span class="hljs-comment">#   Descarga datos SDMX de la OCDE y guarda un CSV</span>
<span class="hljs-comment"># ----------------------------------------------------------------------------</span>
<span class="hljs-keyword">import</span> os
<span class="hljs-keyword">import</span> io
<span class="hljs-keyword">import</span> pandas <span class="hljs-keyword">as</span> pd
<span class="hljs-keyword">import</span> requests


<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> -&gt; <span class="hljs-keyword">None</span>:</span>
    <span class="hljs-comment"># Cambiar directorio a la carpeta del script para rutas consistentes</span>
    os.chdir(os.path.dirname(os.path.abspath(__file__)))

    <span class="hljs-comment"># Parámetros</span>
    base_url = <span class="hljs-string">"https://sdmx.oecd.org/public/rest/data"</span>
    agency_identifier = <span class="hljs-string">"OECD.ECO.MAD"</span>
    dataset_identifier = <span class="hljs-string">"DSD_EO@DF_EO"</span>
    dataset_version = <span class="hljs-string">""</span>

    <span class="hljs-comment"># Construcción de URL y petición</span>
    data_identifier = <span class="hljs-string">f"<span class="hljs-subst">{agency_identifier}</span>,<span class="hljs-subst">{dataset_identifier}</span>,<span class="hljs-subst">{dataset_version}</span>"</span>
    url = <span class="hljs-string">f"<span class="hljs-subst">{base_url}</span>/<span class="hljs-subst">{data_identifier}</span>/FRA+DEU.PDTY.A"</span>
    params = {
        <span class="hljs-string">"startPeriod"</span>: <span class="hljs-string">"1965"</span>,
        <span class="hljs-string">"endPeriod"</span>: <span class="hljs-string">"2023"</span>,
        <span class="hljs-string">"dimensionAtObservation"</span>: <span class="hljs-string">"AllDimensions"</span>,
    }
    resp = requests.get(url, params=params, headers={<span class="hljs-string">"Accept"</span>: <span class="hljs-string">"text/csv"</span>}, timeout=<span class="hljs-number">180</span>)
    resp.raise_for_status()
    text_stream = io.StringIO(resp.content.decode(<span class="hljs-string">"utf-8"</span>))
    pd.read_csv(text_stream).to_csv(<span class="hljs-string">"oecd_min.csv"</span>, index=<span class="hljs-literal">False</span>)


<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">"__main__"</span>:
    main()



</div></code></pre>
<h3 id="oecdonlylinkpy">oecd_onlylink.py</h3>
<pre class="hljs"><code><div><span class="hljs-comment"># Minimal OECD API downloader (link only)</span>
<span class="hljs-keyword">import</span> pandas <span class="hljs-keyword">as</span> pd
df = pd.read_csv(<span class="hljs-string">"https://sdmx.oecd.org/public/rest/data/OECD.ECO.MAD,DSD_EO@DF_EO,/FRA+DEU.PDTY.A?format=csvfile&amp;startPeriod=1965&amp;endPeriod=2023"</span>)


</div></code></pre>
<h2 id="ourworldindata">OURWORLDINDATA</h2>
<h3 id="gu%C3%ADa-r%C3%A1pida-our-world-in-data-con-python">Guía rápida: Our World in Data con Python</h3>
<p>Este documento muestra cómo importar datos directamente desde los gráficos de Our World in Data (OWID) a Python usando <code>pandas</code>.</p>
<h4 id="requisitos">Requisitos</h4>
<ul>
<li>Paquetes: <code>pandas</code>, <code>requests</code></li>
</ul>
<h4 id="codigos-ejemplo">Codigos ejemplo</h4>
<ul>
<li><code>worldindata_onlylink.py</code> es un ejemplo que descarga y lee el csv directamente del link de la API en una linea.</li>
<li><code>worldindata_min.py</code> es un ejemplo mínimo para descargar datos de OWID.</li>
</ul>
<h4 id="inputs">Inputs</h4>
<ul>
<li><strong>Obligatorios</strong>
<ul>
<li><code>url</code>: URL directa del archivo CSV proporcionada por OWID para un gráfico específico.</li>
</ul>
</li>
</ul>
<h4 id="c%C3%B3mo-elegir-inputs">Cómo elegir inputs</h4>
<ol>
<li>Vaya a un gráfico en <a href="https://ourworldindata.org/">Our World in Data</a>.</li>
<li>Haga clic en la pestaña &quot;Download&quot;.</li>
<li>Haga clic derecho en el botón de descarga &quot;Full data (CSV)&quot; y seleccione &quot;Copiar dirección del enlace&quot;.</li>
<li>Use esa URL en su script de Python.</li>
</ol>
<h4 id="sintaxis-de-la-api">Sintaxis de la API</h4>
<ul>
<li>
<p><strong>Formato general:</strong></p>
<pre class="hljs"><code><div>https://ourworldindata.org/grapher/{chart-slug}.csv?v=1&amp;csvType=full&amp;useColumnShortNames=true
</div></code></pre>
</li>
<li>
<p><strong>Ejemplo:</strong></p>
<pre class="hljs"><code><div>https://ourworldindata.org/grapher/labor-productivity-per-hour-pennworldtable.csv?v=1&amp;csvType=full&amp;useColumnShortNames=true
</div></code></pre>
</li>
</ul>
<h4 id="output">Output</h4>
<ul>
<li>Un <code>pandas.DataFrame</code> con los datos descargados desde OWID.</li>
</ul>
<h4 id="enlaces-%C3%BAtiles">Enlaces útiles</h4>
<ul>
<li>Portal: https://ourworldindata.org/</li>
</ul>
<h3 id="worldindataminpy">worldindata_min.py</h3>
<pre class="hljs"><code><div><span class="hljs-keyword">import</span> pandas <span class="hljs-keyword">as</span> pd
<span class="hljs-keyword">import</span> requests
<span class="hljs-keyword">import</span> os

<span class="hljs-comment"># Fetch the data.</span>
df = pd.read_csv(<span class="hljs-string">"https://ourworldindata.org/grapher/labor-productivity-per-hour-pennworldtable.csv?v=1&amp;csvType=full&amp;useColumnShortNames=true"</span>, storage_options = {<span class="hljs-string">'User-Agent'</span>: <span class="hljs-string">'Our World In Data data fetch/1.0'</span>})

<span class="hljs-comment"># Fetch the metadata</span>
metadata = requests.get(<span class="hljs-string">"https://ourworldindata.org/grapher/labor-productivity-per-hour-pennworldtable.metadata.json?v=1&amp;csvType=full&amp;useColumnShortNames=true"</span>).json()

<span class="hljs-comment"># Save the data to CSV</span>
output_path = os.path.join(os.path.dirname(__file__), <span class="hljs-string">"labor_productivity.csv"</span>)
df.to_csv(output_path, index=<span class="hljs-literal">False</span>)
print(<span class="hljs-string">f"Data saved to <span class="hljs-subst">{output_path}</span>"</span>)
</div></code></pre>
<h3 id="worldindataonlylinkpy">worldindata_onlylink.py</h3>
<pre class="hljs"><code><div><span class="hljs-comment"># Minimal OurWorldInData downloader (link only)</span>
<span class="hljs-keyword">import</span> pandas <span class="hljs-keyword">as</span> pd
df = pd.read_csv(<span class="hljs-string">"https://ourworldindata.org/grapher/labor-productivity-per-hour-pennworldtable.csv?v=1&amp;csvType=full&amp;useColumnShortNames=true"</span>)


</div></code></pre>
<h2 id="worldbank">WORLDBANK</h2>
<h3 id="gu%C3%ADa-r%C3%A1pida-banco-mundial-con-python">Guía rápida: Banco Mundial con Python</h3>
<p>Este documento explica cómo usar <code>python/worldbank/worldbank_function.py</code> para consultar indicadores del Banco Mundial y obtener un <code>pandas.DataFrame</code>.</p>
<h4 id="requisitos">Requisitos</h4>
<ul>
<li>Paquetes: <code>requests</code>, <code>pandas</code></li>
</ul>
<h4 id="codigos-ejemplo">Codigos ejemplo</h4>
<ul>
<li><code>worldbank_min.py</code> es un ejemplo mínimo para descargar datos del Banco Mundial sin usar la función <code>worldbank_api_function</code>.</li>
<li><code>worldbank_example.py</code> es un ejemplo de uso de la función <code>worldbank_api_function</code>.</li>
</ul>
<h4 id="inputs">Inputs</h4>
<ul>
<li>
<p><strong>Obligatorios</strong></p>
<ul>
<li><code>iso3</code>: código(s) de país ISO-3, separados por ';' si son múltiples.</li>
<li><code>indicator</code>: código(s) de indicador, separados por ';' si son múltiples.</li>
</ul>
</li>
<li>
<p><strong>Opcionales</strong></p>
<ul>
<li><code>date</code>: rango temporal, p. ej., <code>&quot;2020:2023&quot;</code>.</li>
<li><code>per_page</code>: tamaño de página.</li>
</ul>
</li>
</ul>
<h4 id="c%C3%B3mo-elegir-inputs">Cómo elegir inputs</h4>
<ol>
<li>Elija país(es) <code>iso3</code> (estándar ISO 3166-1 alpha-3). Puede listar países: https://api.worldbank.org/v2/country?format=json</li>
<li>Elegir indicador (<code>indicator</code>)
<ul>
<li>Buscar en la web del World Bank la serie de interés. Seleccionar las variables y pinchar en <code>Metadata</code> -&gt; <code>Series</code>. Copiar el código de la serie. Puede ser una lista de indicadores separados por <code>;</code>.</li>
<li>Busque indicadores en: https://api.worldbank.org/v2/indicator?format=json (listado paginado) o en el portal de datos del Banco Mundial.</li>
<li>También puede abrir un indicador concreto para ver su nombre/meta: https://api.worldbank.org/v2/indicator/NY.GDP.MKTP.KD.ZG?format=json.</li>
</ul>
</li>
<li>Rango temporal
<ul>
<li>La API soporta <code>date=YYYY:YYYY</code> para filtrar.</li>
<li>Si por ejemplo es mensual, sería <code>date=2012M01:2012M08</code>.</li>
</ul>
</li>
</ol>
<h4 id="sintaxis-de-la-api-world-bank">Sintaxis de la API (World Bank)</h4>
<ul>
<li>
<p><strong>Formato general:</strong></p>
<pre class="hljs"><code><div>https://api.worldbank.org/v2/country/{ISO3}/indicator/{INDICATOR}?format=json&amp;per_page={N}&amp;date={DATE}
</div></code></pre>
</li>
<li>
<p><strong>Ejemplo:</strong></p>
<pre class="hljs"><code><div>https://api.worldbank.org/v2/country/ESP;FRA/indicator/NY.GDP.MKTP.KD.ZG?format=json&amp;per_page=20000&amp;date=2020:2023
</div></code></pre>
</li>
</ul>
<h4 id="output">Output</h4>
<ul>
<li>Un <code>pandas.DataFrame</code> con el array de datos <code>[1]</code> de la respuesta JSON.</li>
</ul>
<h4 id="enlaces-%C3%BAtiles">Enlaces útiles</h4>
<ul>
<li>Indicadores (API): https://datahelpdesk.worldbank.org/knowledgebase/articles/889392-about-the-indicators-api-documentation</li>
<li>Estructura de llamadas: https://datahelpdesk.worldbank.org/knowledgebase/articles/898581-api-basic-call-structures</li>
<li>Países (JSON): https://api.worldbank.org/v2/country?format=json</li>
<li>Indicadores (JSON): https://api.worldbank.org/v2/indicator?format=json</li>
</ul>
<h3 id="worldbankexamplepy">worldbank_example.py</h3>
<pre class="hljs"><code><div><span class="hljs-keyword">import</span> os
<span class="hljs-comment"># Ejemplo de uso — Banco Mundial (JSON -&gt; DataFrame -&gt; CSV)</span>
<span class="hljs-comment"># ----------------------------------------------------------------------------</span>
<span class="hljs-comment"># 1) Cargar la función</span>
<span class="hljs-comment"># 2) Ejecutar la consulta indicando país(es) e indicador(es)</span>
<span class="hljs-comment"># 3) Guardar el resultado como CSV</span>
<span class="hljs-comment"># ----------------------------------------------------------------------------</span>
<span class="hljs-keyword">from</span> worldbank_function <span class="hljs-keyword">import</span> worldbank_api_function


<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> -&gt; <span class="hljs-keyword">None</span>:</span>
    os.chdir(os.path.dirname(os.path.abspath(__file__)))
    df = worldbank_api_function(
        iso3=<span class="hljs-string">"ESP"</span>,
        indicator=<span class="hljs-string">"NY.GDP.MKTP.KD.ZG"</span>,
        date=<span class="hljs-string">"2000:2023"</span>,
    )
    df.to_csv(<span class="hljs-string">"worldbank_example.csv"</span>, index=<span class="hljs-literal">False</span>)


<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">"__main__"</span>:
    main()



</div></code></pre>
<h3 id="worldbankfunctionpy">worldbank_function.py</h3>
<pre class="hljs"><code><div><span class="hljs-keyword">from</span> __future__ <span class="hljs-keyword">import</span> annotations

<span class="hljs-keyword">import</span> pandas <span class="hljs-keyword">as</span> pd
<span class="hljs-keyword">import</span> requests


<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">worldbank_api_function</span><span class="hljs-params">(
    iso3: str,
    indicator: str,
    date: str | None = None,
    per_page: int = <span class="hljs-number">20000</span>,
    base_url: str = <span class="hljs-string">"https://api.worldbank.org/v2"</span>,
)</span> -&gt; pd.DataFrame:</span>
    path = <span class="hljs-string">f"/country/<span class="hljs-subst">{iso3}</span>/indicator/<span class="hljs-subst">{indicator}</span>"</span>
    url = <span class="hljs-string">f"<span class="hljs-subst">{base_url}</span><span class="hljs-subst">{path}</span>"</span>
    q = {<span class="hljs-string">"format"</span>: <span class="hljs-string">"json"</span>, <span class="hljs-string">"per_page"</span>: per_page}
    <span class="hljs-keyword">if</span> date:
        q[<span class="hljs-string">"date"</span>] = date

    resp = requests.get(url, params=q, headers={<span class="hljs-string">"Accept"</span>: <span class="hljs-string">"application/json"</span>}, timeout=<span class="hljs-number">120</span>)
    resp.raise_for_status()
    obj = resp.json()
    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> isinstance(obj, list) <span class="hljs-keyword">or</span> len(obj) &lt; <span class="hljs-number">2</span> <span class="hljs-keyword">or</span> obj[<span class="hljs-number">1</span>] <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span>:
        <span class="hljs-keyword">raise</span> RuntimeError(<span class="hljs-string">"Unexpected World Bank response structure; no data array present."</span>)
    <span class="hljs-keyword">return</span> pd.DataFrame(obj[<span class="hljs-number">1</span>])



</div></code></pre>
<h3 id="worldbankminpy">worldbank_min.py</h3>
<pre class="hljs"><code><div><span class="hljs-comment"># Descargador mínimo Banco Mundial (JSON -&gt; CSV)</span>
<span class="hljs-comment"># ----------------------------------------------------------------------------</span>
<span class="hljs-comment"># Objetivo</span>
<span class="hljs-comment">#   Consulta indicadores del Banco Mundial y guarda un CSV</span>
<span class="hljs-comment"># ----------------------------------------------------------------------------</span>
<span class="hljs-keyword">import</span> os
<span class="hljs-keyword">import</span> pandas <span class="hljs-keyword">as</span> pd
<span class="hljs-keyword">import</span> requests


<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> -&gt; <span class="hljs-keyword">None</span>:</span>
    <span class="hljs-comment"># Cambiar directorio a la carpeta del script para rutas consistentes</span>
    os.chdir(os.path.dirname(os.path.abspath(__file__)))

    <span class="hljs-comment"># Construcción de URL y petición</span>
    base_url = <span class="hljs-string">"https://api.worldbank.org/v2"</span>
    path = <span class="hljs-string">"/country/ESP/indicator/NY.GDP.MKTP.KD.ZG"</span>
    url = <span class="hljs-string">f"<span class="hljs-subst">{base_url}</span><span class="hljs-subst">{path}</span>"</span>
    params = {<span class="hljs-string">"format"</span>: <span class="hljs-string">"json"</span>, <span class="hljs-string">"per_page"</span>: <span class="hljs-number">20000</span>, <span class="hljs-string">"date"</span>: <span class="hljs-string">"2000:2023"</span>}
    resp = requests.get(url, params=params, headers={<span class="hljs-string">"Accept"</span>: <span class="hljs-string">"application/json"</span>}, timeout=<span class="hljs-number">120</span>)
    resp.raise_for_status()
    obj = resp.json()
    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> isinstance(obj, list) <span class="hljs-keyword">or</span> len(obj) &lt; <span class="hljs-number">2</span> <span class="hljs-keyword">or</span> obj[<span class="hljs-number">1</span>] <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span>:
        <span class="hljs-keyword">raise</span> RuntimeError(<span class="hljs-string">"Unexpected World Bank response structure; no data array present."</span>)
    pd.DataFrame(obj[<span class="hljs-number">1</span>]).to_csv(<span class="hljs-string">"worldbank_min.csv"</span>, index=<span class="hljs-literal">False</span>)


<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">"__main__"</span>:
    main()



</div></code></pre>
<h1 id="r">R</h1>
<h2 id="comext">COMEXT</h2>
<h3 id="gu%C3%ADa-r%C3%A1pida-eurostat-comext-con-r">Guía rápida: Eurostat Comext con R</h3>
<p>Este documento explica cómo usar la función en <code>comext/comext_function.R</code> para descargar datos del endpoint Comext de Eurostat (SDMX‑JSON) y obtenerlos como un data frame etiquetado en R.</p>
<h4 id="requisitos">Requisitos</h4>
<ul>
<li>Paquetes <code>httr</code> y <code>jsonlite</code> instalados</li>
</ul>
<h4 id="codigos-ejemplo">Codigos ejemplo</h4>
<ul>
<li><code>comext_min.R</code> es un ejemplo mínimo para descargar datos de Comext y convertirlos a CSV sin usar la función <code>comext_api_function</code>.</li>
<li><code>comext_example.R</code> es un ejemplo de uso de la función <code>comext_api_function</code>.</li>
</ul>
<h4 id="inputs">Inputs</h4>
<ul>
<li><strong>Obligatorios</strong>
<ul>
<li><code>dataset_id</code>: identificador del dataset Comext (prefijo <code>&quot;DS-&quot;</code>, p. ej., <code>&quot;DS-059341&quot;</code>).</li>
<li><code>filters</code>: lista NOMBRADA de filtros (dimensión -&gt; valores). Los nombres deben ser las dimensiones válidas del dataset (p. ej., <code>reporter</code>, <code>partner</code>, <code>product</code>, <code>flow</code>, <code>freq</code>, <code>time</code>, <code>indicators</code>, ...). Los valores pueden ser <code>&quot;string&quot;</code> o vectores <code>c(&quot;...&quot;,&quot;...&quot;)</code>.</li>
</ul>
</li>
</ul>
<h4 id="c%C3%B3mo-elegir-inputs">Cómo elegir inputs</h4>
<ol>
<li>Identifique el dataset en la guía de Comext y el portal de Eurostat.</li>
<li>Consulte la estructura del dataset en la guía Comext para conocer las dimensiones válidas y sus valores.</li>
<li>Ajuste <code>filters</code> con nombres de dimensiones válidos. Para múltiples valores use vectores.</li>
</ol>
<h4 id="sintaxis-de-la-api-comext-statistics">Sintaxis de la API (Comext statistics)</h4>
<ul>
<li>
<p><strong>Formato general:</strong></p>
<pre class="hljs"><code><div>https://ec.europa.eu/eurostat/api/comext/dissemination/statistics/1.0/data/{dataset_id}?reporter=...&amp;partner=...&amp;product=...&amp;flow=...&amp;freq=...&amp;time=...
</div></code></pre>
</li>
<li>
<p><strong>Ejemplo:</strong></p>
<pre class="hljs"><code><div>https://ec.europa.eu/eurostat/api/comext/dissemination/statistics/1.0/data/DS-059341?reporter=ES&amp;partner=US&amp;product=1509&amp;product=8703&amp;flow=2&amp;freq=A&amp;time=2015&amp;time=2016&amp;...&amp;time=2020
</div></code></pre>
</li>
</ul>
<h4 id="output">Output</h4>
<ul>
<li>Un <code>data.frame</code> con columnas por dimensión (códigos y <code>*_label</code>) y la columna <code>value</code>.</li>
</ul>
<h4 id="funcion-auxiliar-para-convertir-json-a-data-frame">Funcion auxiliar para convertir JSON a data frame</h4>
<p>La funcion <code>comext_json_to_labeled_df</code> es una funcion auxiliar para convertir el JSON a un data frame con columnas por dimensión (códigos y <code>*_label</code>) y la columna <code>value</code>.</p>
<h4 id="enlaces-%C3%BAtiles">Enlaces útiles</h4>
<ul>
<li>Guía de Comext: https://ec.europa.eu/eurostat/web/user-guides/data-browser/api-data-access/api-getting-started/comext-database</li>
<li>Portal Eurostat: https://ec.europa.eu/eurostat/</li>
</ul>
<h3 id="comextexampler">comext_example.R</h3>
<pre class="hljs"><code><div><span class="hljs-comment"># Ejemplo de uso de la función comext_api_function</span>
<span class="hljs-keyword">library</span>(httr)
<span class="hljs-keyword">library</span>(jsonlite)

<span class="hljs-comment">#setwd("comext")</span>
<span class="hljs-keyword">source</span>(<span class="hljs-string">"comext_function.R"</span>)

<span class="hljs-comment"># Ejemplo de uso</span>
df &lt;- comext_api_function(
  dataset_id = <span class="hljs-string">"DS-059341"</span>,
  filters = list(
    reporter = c(<span class="hljs-string">"ES"</span>),
    partner  = c(<span class="hljs-string">"US"</span>),
    product  = c(<span class="hljs-string">"1509"</span>, <span class="hljs-string">"8703"</span>),
    flow     = c(<span class="hljs-string">"2"</span>),
    freq     = c(<span class="hljs-string">"A"</span>),
    time     = <span class="hljs-number">2015</span>:<span class="hljs-number">2020</span>
  )
)

write.csv(df, <span class="hljs-string">"comext_example.csv"</span>, row.names = <span class="hljs-literal">FALSE</span>)



</div></code></pre>
<h3 id="comextfunctionr">comext_function.R</h3>
<pre class="hljs"><code><div><span class="hljs-comment"># Función para descargar y etiquetar datos de Eurostat COMEXT (JSON -&gt; data.frame)</span>

<span class="hljs-comment"># Inputs obligatorios:</span>
<span class="hljs-comment"># - dataset_id: id del dataset Comext (p. ej., "DS-059341")</span>
<span class="hljs-comment"># - filters: lista nombrada (dimension -&gt; valores). Los nombres deben ser las</span>
<span class="hljs-comment">#            dimensiones válidas del dataset (p. ej., reporter, partner, product,</span>
<span class="hljs-comment">#            flow, freq, time, indicators, etc.). Los valores pueden ser string o</span>
<span class="hljs-comment">#            vector de strings. Para multiselección se envían parámetros repetidos.</span>
<span class="hljs-comment">#</span>
<span class="hljs-comment"># Output:</span>
<span class="hljs-comment"># - df: data.frame con códigos por dimensión, etiquetas *_label y la columna numeric 'value'</span>

comext_api_function &lt;- <span class="hljs-keyword">function</span>(
  dataset_id,
  filters
) {
  base &lt;- paste0(<span class="hljs-string">"https://ec.europa.eu/eurostat/api/comext/dissemination/statistics/1.0/data/"</span>, dataset_id)

  <span class="hljs-keyword">if</span> (missing(filters) || is.null(filters)) <span class="hljs-keyword">stop</span>(<span class="hljs-string">"'filters' debe ser una lista nombrada dimension -&gt; valores"</span>)
  <span class="hljs-keyword">if</span> (!is.list(filters) || is.null(names(filters)) || any(names(filters) == <span class="hljs-string">""</span>)) {
    <span class="hljs-keyword">stop</span>(<span class="hljs-string">"'filters' debe ser una lista NOMBRADA: names(filters) son las dimensiones"</span>)
  }

  <span class="hljs-comment"># Construye query string con parámetros repetidos para multiselección</span>
  q &lt;- list()
  <span class="hljs-keyword">for</span> (dim_name <span class="hljs-keyword">in</span> names(filters)) {
    values &lt;- filters[[dim_name]]
    <span class="hljs-keyword">if</span> (is.null(values)) <span class="hljs-keyword">next</span>
    values &lt;- as.character(values)
    <span class="hljs-keyword">for</span> (v <span class="hljs-keyword">in</span> values) {
      q &lt;- c(q, setNames(list(v), dim_name))
    }
  }

  res &lt;- httr::GET(base, query = q, httr::accept(<span class="hljs-string">"application/json"</span>))
  <span class="hljs-keyword">if</span> (httr::http_error(res)) <span class="hljs-keyword">stop</span>(sprintf(<span class="hljs-string">"COMEXT request failed [%s]"</span>, httr::status_code(res)))

  txt &lt;- httr::content(res, as = <span class="hljs-string">"text"</span>, encoding = <span class="hljs-string">"UTF-8"</span>)
  doc &lt;- jsonlite::fromJSON(txt, simplifyVector = <span class="hljs-literal">FALSE</span>)

  <span class="hljs-comment"># utilidades locales (o usar scripts/comext_utils.R según la organización)</span>
  <span class="hljs-keyword">if</span> (!exists(<span class="hljs-string">"comext_json_to_labeled_df"</span>)) <span class="hljs-keyword">source</span>(<span class="hljs-string">"comext_utils.R"</span>)
  df &lt;- comext_json_to_labeled_df(doc)
  <span class="hljs-keyword">return</span>(df)
}



</div></code></pre>
<h3 id="comextminr">comext_min.R</h3>
<pre class="hljs"><code><div><span class="hljs-comment"># Descargador Eurostat COMEXT (CSV con etiquetas por dimensión)</span>
<span class="hljs-comment"># ----------------------------------------------------------------------------</span>
<span class="hljs-comment"># Objetivo</span>
<span class="hljs-comment">#   Descarga datos del endpoint Comext (Eurostat) en formato JSON y los convierte a un CSV "largo" con columnas</span>
<span class="hljs-comment"># ----------------------------------------------------------------------------</span>

<span class="hljs-keyword">library</span>(httr)
<span class="hljs-keyword">library</span>(jsonlite)

<span class="hljs-comment"># Carga utilidades locales</span>
<span class="hljs-keyword">source</span>(<span class="hljs-string">"comext_utils.R"</span>)

<span class="hljs-comment"># --- Parámetros editables -----------------------------------------------------</span>
<span class="hljs-comment"># ID del dataset Comext (prefijo DS-)</span>
dataset_id &lt;- <span class="hljs-string">"DS-059341"</span>

<span class="hljs-comment"># Dimensiones (aceptan vectores). Se enviarán como parámetros repetidos.</span>
reporter &lt;- c(<span class="hljs-string">"ES"</span>)
partner  &lt;- c(<span class="hljs-string">"US"</span>)
product  &lt;- c(<span class="hljs-string">"1509"</span>, <span class="hljs-string">"8703"</span>)
flow     &lt;- c(<span class="hljs-string">"2"</span>)
freq     &lt;- c(<span class="hljs-string">"A"</span>)
time     &lt;- <span class="hljs-number">2015</span>:<span class="hljs-number">2020</span>

<span class="hljs-comment"># Salida</span>
output_name &lt;- <span class="hljs-string">"comext_ejemplo"</span>
out_file &lt;- paste0(<span class="hljs-string">"data/"</span>, output_name, <span class="hljs-string">".csv"</span>)

<span class="hljs-comment"># --- Construcción de la query-string ----------------------------------------</span>
add_multi &lt;- <span class="hljs-keyword">function</span>(q, name, values) {
  <span class="hljs-keyword">if</span> (length(values) == <span class="hljs-number">0</span>) <span class="hljs-keyword">return</span>(q)
  <span class="hljs-keyword">for</span> (v <span class="hljs-keyword">in</span> as.character(values)) q &lt;- c(q, setNames(list(v), name))
  q
}

q &lt;- list()
q &lt;- add_multi(q, <span class="hljs-string">"reporter"</span>, reporter)
q &lt;- add_multi(q, <span class="hljs-string">"partner"</span>,  partner)
q &lt;- add_multi(q, <span class="hljs-string">"product"</span>,  product)
q &lt;- add_multi(q, <span class="hljs-string">"flow"</span>,     flow)
q &lt;- add_multi(q, <span class="hljs-string">"freq"</span>,     freq)
q &lt;- add_multi(q, <span class="hljs-string">"time"</span>,     time)

<span class="hljs-keyword">if</span> (!dir.exists(<span class="hljs-string">"data"</span>)) dir.create(<span class="hljs-string">"data"</span>, recursive = <span class="hljs-literal">TRUE</span>, showWarnings = <span class="hljs-literal">FALSE</span>)

<span class="hljs-comment"># --- Construcción de URL y parámetros ----------------------------------------</span>
base &lt;- paste0(<span class="hljs-string">"https://ec.europa.eu/eurostat/api/comext/dissemination/statistics/1.0/data/"</span>, dataset_id)

<span class="hljs-comment"># --- Petición HTTP y parseo --------------------------------------------------</span>
res &lt;- httr::GET(base, query = q, httr::accept(<span class="hljs-string">"application/json"</span>))
<span class="hljs-keyword">if</span> (httr::http_error(res)) <span class="hljs-keyword">stop</span>(sprintf(<span class="hljs-string">"COMEXT request failed [%s]"</span>, httr::status_code(res)))

txt &lt;- httr::content(res, as = <span class="hljs-string">"text"</span>, encoding = <span class="hljs-string">"UTF-8"</span>)
doc &lt;- jsonlite::fromJSON(txt, simplifyVector = <span class="hljs-literal">FALSE</span>)

df &lt;- comext_json_to_labeled_df(doc)

utils::write.csv(df, out_file, row.names = <span class="hljs-literal">FALSE</span>, na = <span class="hljs-string">""</span>)



</div></code></pre>
<h3 id="comextutilsr">comext_utils.R</h3>
<pre class="hljs"><code><div><span class="hljs-comment"># Utilidades COMEXT: conversión de JSON (SDMX-like) a data.frame etiquetado</span>
<span class="hljs-comment"># Copiado desde `scripts/comext_utils.R` para uso local en la carpeta `comext/`.</span>

comext_json_to_labeled_df &lt;- <span class="hljs-keyword">function</span>(doc) {
  vals &lt;- doc$value
  <span class="hljs-keyword">if</span> (is.null(vals) || length(vals) == <span class="hljs-number">0</span>) <span class="hljs-keyword">return</span>(data.frame())

  ids &lt;- doc$id
  sizes &lt;- as.integer(unlist(doc$size))
  dims &lt;- doc$dimension
  n_dims &lt;- length(ids)

  get_strides &lt;- <span class="hljs-keyword">function</span>(sz) {
    n &lt;- length(sz)
    s &lt;- integer(n)
    <span class="hljs-keyword">for</span> (k <span class="hljs-keyword">in</span> seq_len(n)) s[k] &lt;- <span class="hljs-keyword">if</span> (k == n) <span class="hljs-number">1</span> <span class="hljs-keyword">else</span> prod(sz[(k + <span class="hljs-number">1</span>):n])
    s
  }
  strides &lt;- get_strides(sizes)

  pos_to_code &lt;- <span class="hljs-keyword">function</span>(index_map, pos) {
    codes &lt;- names(index_map)[which(unname(index_map) == pos)]
    <span class="hljs-keyword">if</span> (length(codes) == <span class="hljs-number">0</span>) <span class="hljs-keyword">return</span>(<span class="hljs-literal">NA_character_</span>)
    codes[[<span class="hljs-number">1</span>]]
  }

  value_keys &lt;- as.integer(names(vals))
  value_vals &lt;- as.numeric(unlist(vals, use.names = <span class="hljs-literal">FALSE</span>))

  make_row &lt;- <span class="hljs-keyword">function</span>(i) {
    idx &lt;- value_keys[[i]]
    r &lt;- idx
    pos &lt;- integer(n_dims)
    <span class="hljs-keyword">for</span> (k <span class="hljs-keyword">in</span> seq_len(n_dims)) { pos[k] &lt;- r %/% strides[k]; r &lt;- r %% strides[k] }

    rec &lt;- list(value = value_vals[[i]])
    <span class="hljs-keyword">for</span> (k <span class="hljs-keyword">in</span> seq_along(ids)) {
      dn &lt;- ids[[k]]
      d &lt;- dims[[dn]]; <span class="hljs-keyword">if</span> (is.null(d)) <span class="hljs-keyword">next</span>
      imap &lt;- unlist(d$category$index)
      lbl  &lt;- d$category$label
      code_k &lt;- pos_to_code(imap, pos[k])
      rec[[dn]] &lt;- code_k
      rec[[paste0(dn, <span class="hljs-string">"_label"</span>)]] &lt;- <span class="hljs-keyword">if</span> (!is.null(lbl) &amp;&amp; !is.null(code_k)) lbl[[code_k]] <span class="hljs-keyword">else</span> <span class="hljs-literal">NA_character_</span>
    }
    as.data.frame(rec, stringsAsFactors = <span class="hljs-literal">FALSE</span>)
  }

  rows &lt;- lapply(seq_along(value_keys), make_row)
  df &lt;- do.call(rbind, rows)
  <span class="hljs-keyword">if</span> (<span class="hljs-string">"value"</span> %<span class="hljs-keyword">in</span>% names(df)) df$value &lt;- as.numeric(df$value)
  df
}



</div></code></pre>
<h2 id="ecb">ECB</h2>
<h3 id="gu%C3%ADa-r%C3%A1pida-bce-con-r">Guía rápida: BCE con R</h3>
<p>Este documento explica cómo usar la función en <code>ecb/ecb_function.R</code> para descargar una serie del BCE (dataset SDMX) en formato CSV y obtenerla como un data frame en R.</p>
<h4 id="requisitos">Requisitos</h4>
<ul>
<li>Paquete <code>httr</code> instalado (<code>install.packages(&quot;httr&quot;)</code> si fuera necesario)</li>
</ul>
<h4 id="codigos-ejemplo">Codigos ejemplo</h4>
<ul>
<li><code>ecb_onlylink.R</code> es un ejemplo que descarga y lee el csv directamente del link de la API en una linea.</li>
<li><code>ecb_min.R</code> es un ejemplo mínimo para descargar datos del BCE sin usar la función <code>ecb_api_function</code>.</li>
<li><code>ecb_example.R</code> es un ejemplo de uso de la función <code>ecb_api_function</code>.</li>
</ul>
<h4 id="inputs">Inputs</h4>
<ul>
<li><code>dataset</code>: identificador del dataset del BCE (p. ej., <code>&quot;BSI&quot;</code>). Vease los datasets disponibles en https://data.ecb.europa.eu/data/datasets/</li>
<li><code>seriesKey</code>: clave completa de la serie (dimensiones concatenadas con <code>.</code>).</li>
</ul>
<h4 id="c%C3%B3mo-elegir-inputs">Cómo elegir inputs</h4>
<ol>
<li>Abra el dataset en el portal BCE (p. ej., BSI): https://data.ecb.europa.eu/data/datasets/BSI</li>
<li>Use los filtros hasta ver la serie concreta; la clave <code>seriesKey</code> aparece en el recuadro de la serie.</li>
<li>Cada elemento de <code>seriesKey</code> es una dimensión del dataset; puede cambiar <code>U2</code> (Área del euro) por <code>ES</code> (España), etc. Pinchando en <code>view all</code> se pueden ver todas las dimensiones del dataset y sus codigos. Para conocer que valores puede tomar una dimensión, vease https://data.ecb.europa.eu/data/datasets/PAY/structure.</li>
</ol>
<h4 id="sintaxis-de-la-url-de-la-api-bce">Sintaxis de la URL de la API (BCE)</h4>
<ul>
<li>
<p><strong>Formato general:</strong></p>
<pre class="hljs"><code><div>https://data-api.ecb.europa.eu/service/data/{dataset}/{seriesKey}?format=csvdata
</div></code></pre>
</li>
<li>
<p><strong>Ejemplo:</strong></p>
<pre class="hljs"><code><div>https://data-api.ecb.europa.eu/service/data/BSI/M.U2.Y.V.M30.X.I.U2.2300.Z01.A?format=csvdata
</div></code></pre>
</li>
</ul>
<h4 id="output">Output</h4>
<ul>
<li>Un <code>data.frame</code> con los datos descargados desde el BCE.</li>
</ul>
<h4 id="enlaces-%C3%BAtiles">Enlaces útiles</h4>
<ul>
<li>Portal de datos del BCE (datasets): https://data.ecb.europa.eu/data/datasets/</li>
<li>Documentación de la API de datos del BCE: https://data.ecb.europa.eu/help/api/overview</li>
<li>Estructura de los codigos de las dimensiones: https://data.ecb.europa.eu/data/datasets/PAY/structure</li>
<li>API de datos (servicio): https://data-api.ecb.europa.eu/service/</li>
</ul>
<h3 id="ecbexampler">ecb_example.R</h3>
<pre class="hljs"><code><div><span class="hljs-comment"># Ejemplo de uso de la función ecb_api_function</span>
<span class="hljs-keyword">library</span>(httr)

<span class="hljs-comment">#setwd("ecb")</span>
<span class="hljs-keyword">source</span>(<span class="hljs-string">"ecb_function.R"</span>)

<span class="hljs-comment"># Ejemplo de uso</span>
df &lt;- ecb_api_function(
  dataset = <span class="hljs-string">"BSI"</span>,
  seriesKey = <span class="hljs-string">"M.U2.Y.V.M30.X.I.U2.2300.Z01.A"</span>
)

write.csv(df, <span class="hljs-string">"ecb_example.csv"</span>, row.names = <span class="hljs-literal">FALSE</span>)



</div></code></pre>
<h3 id="ecbfunctionr">ecb_function.R</h3>
<pre class="hljs"><code><div><span class="hljs-comment"># Función mínima BCE Data API (CSV)</span>

<span class="hljs-comment"># Inputs obligatorios:</span>
<span class="hljs-comment"># - dataset: identificador del dataset (p. ej., "BSI")</span>
<span class="hljs-comment"># - seriesKey: clave completa de la serie (dimensiones concatenadas con '.')</span>
<span class="hljs-comment">#</span>
<span class="hljs-comment"># Inputs opcionales:</span>
<span class="hljs-comment"># - base_url: host del servicio de datos del BCE</span>
<span class="hljs-comment">#</span>
<span class="hljs-comment"># Output:</span>
<span class="hljs-comment"># - df: data.frame con los datos descargados</span>

ecb_api_function &lt;- <span class="hljs-keyword">function</span>(
  dataset,
  seriesKey,
  base_url = <span class="hljs-string">"https://data-api.ecb.europa.eu/service/data"</span>
) {
  url &lt;- paste0(base_url, <span class="hljs-string">"/"</span>, dataset, <span class="hljs-string">"/"</span>, seriesKey)
  res &lt;- httr::GET(url, query = list(format = <span class="hljs-string">"csvdata"</span>), httr::accept(<span class="hljs-string">"text/csv"</span>))
  <span class="hljs-keyword">if</span> (httr::http_error(res)) <span class="hljs-keyword">stop</span>(sprintf(<span class="hljs-string">"ECB request failed [%s]"</span>, httr::status_code(res)))

  txt &lt;- httr::content(res, as = <span class="hljs-string">"text"</span>, encoding = <span class="hljs-string">"UTF-8"</span>)
  df &lt;- utils::read.csv(text = txt, stringsAsFactors = <span class="hljs-literal">FALSE</span>)
  <span class="hljs-keyword">return</span>(df)
}



</div></code></pre>
<h3 id="ecbminr">ecb_min.R</h3>
<pre class="hljs"><code><div><span class="hljs-comment"># Minimal ECB Data API downloader (CSV)</span>
<span class="hljs-comment">#</span>
<span class="hljs-comment"># How to customize:</span>
<span class="hljs-comment"># - Change dataset (BSI) and seriesKey for the specific series</span>
<span class="hljs-comment"># - Change out_file to control the output file name</span>

<span class="hljs-keyword">library</span>(httr)

<span class="hljs-comment"># --- Editable parameters ---</span>
dataset &lt;- <span class="hljs-string">"BSI"</span>  <span class="hljs-comment"># ECB dataset id</span>
seriesKey &lt;- <span class="hljs-string">"M.U2.Y.V.M30.X.I.U2.2300.Z01.A"</span>
output_name &lt;- <span class="hljs-string">"ecb_ejemplo"</span>
out_file &lt;- paste0(<span class="hljs-string">"data/ecb_"</span>, gsub(<span class="hljs-string">"[./]"</span>, <span class="hljs-string">"_"</span>, output_name), <span class="hljs-string">".csv"</span>)

<span class="hljs-comment"># --- Crear directorio de datos si no existe ---</span>
<span class="hljs-keyword">if</span> (!dir.exists(<span class="hljs-string">"data"</span>)) dir.create(<span class="hljs-string">"data"</span>, recursive = <span class="hljs-literal">TRUE</span>, showWarnings = <span class="hljs-literal">FALSE</span>)

<span class="hljs-comment"># --- Descargar archivo CSV ---</span>
url &lt;- paste0(<span class="hljs-string">"https://data-api.ecb.europa.eu/service/data/"</span>, dataset, <span class="hljs-string">"/"</span>, seriesKey)
res &lt;- httr::GET(url, query = list(format = <span class="hljs-string">"csvdata"</span>), httr::accept(<span class="hljs-string">"text/csv"</span>))
<span class="hljs-keyword">if</span> (httr::http_error(res)) <span class="hljs-keyword">stop</span>(sprintf(<span class="hljs-string">"ECB request failed [%s]"</span>, httr::status_code(res)))
writeBin(httr::content(res, as = <span class="hljs-string">"raw"</span>), out_file)



</div></code></pre>
<h3 id="ecbonlylinkr">ecb_onlylink.R</h3>
<pre class="hljs"><code><div><span class="hljs-comment"># Minimal ECB Data API downloader (link only)</span>
df &lt;- read.csv(<span class="hljs-string">"https://data-api.ecb.europa.eu/service/data/BSI/M.U2.Y.V.M30.X.I.U2.2300.Z01.A?format=csvdata"</span>)


</div></code></pre>
<h2 id="esios">ESIOS</h2>
<h3 id="gu%C3%ADa-r%C3%A1pida-ree-esios-con-r">Guía rápida: REE e·sios con R</h3>
<p>Este documento explica cómo usar la función en <code>esios/esios_function.R</code> para descargar valores de indicadores del portal e·sios de Red Eléctrica (REE) y obtenerlos como un data frame en R.</p>
<h4 id="requisitos">Requisitos</h4>
<ul>
<li>Paquetes <code>httr</code> y <code>jsonlite</code> instalados</li>
<li>Token personal de e·sios en la variable de entorno <code>ESIOS_TOKEN</code></li>
</ul>
<h4 id="codigos-ejemplo">Codigos ejemplo</h4>
<ul>
<li><code>esios_min.R</code>: script mínimo que guarda CSV usando parámetros básicos.</li>
<li><code>esios_example.R</code>: ejemplo práctico con promedio diario nacional del último mes.</li>
<li><code>esios_list_indicators.R</code>: listado completo de indicadores y metadatos.</li>
</ul>
<h4 id="inputs">Inputs</h4>
<ul>
<li>
<p><strong>Obligatorios</strong></p>
<ul>
<li><code>indicator_id</code>: id numérico del indicador (p. ej., <code>10211</code>).</li>
<li><code>start_date</code>, <code>end_date</code>: fechas en ISO8601 con zona Z (ej.: <code>2025-01-01T00:00:00Z</code>).</li>
</ul>
</li>
<li>
<p><strong>Opcionales</strong></p>
<ul>
<li><code>time_agg</code>: agregación temporal (&quot;sum&quot; o &quot;avg&quot;).</li>
<li><code>time_trunc</code>: recorte temporal (&quot;five_minutes&quot;, &quot;ten_minutes&quot;, &quot;fifteen_minutes&quot;, &quot;hour&quot;, &quot;day&quot;, &quot;month&quot;, &quot;year&quot;).</li>
<li><code>geo_agg</code>: agregación por geografía (&quot;sum&quot; o &quot;avg&quot;).</li>
<li><code>geo_trunc</code>: nivel geográfico (&quot;country&quot;, &quot;electric_system&quot;, &quot;autonomous_community&quot;, &quot;province&quot;, &quot;electric_subsystem&quot;, &quot;town&quot;, &quot;drainage_basin&quot;).</li>
<li><code>geo_ids</code>: vector de ids geográficos (se envía como parámetros repetidos <code>geo_ids[]</code>).</li>
<li><code>locale</code>: idioma de respuesta (&quot;es&quot; o &quot;en&quot;).</li>
<li><code>token</code>: API key (por defecto lee <code>Sys.getenv(&quot;ESIOS_TOKEN&quot;)</code>).</li>
</ul>
</li>
</ul>
<h4 id="c%C3%B3mo-elegir-inputs">Cómo elegir inputs</h4>
<ol>
<li>Hay dos opciones para el <code>indicator_id</code>:
<ul>
<li>Descargandose el listado de indicadores y metadatos con <code>esios_list_indicators.R</code>.</li>
<li>Buscando en la web con la herramienta interactiva. Una vez seleccionada la serie, puedes descargar el CSV y el id está en la primera columna.</li>
</ul>
</li>
<li>Para los otros parámetros, consulte la documentación oficial si tiene dudas.</li>
</ol>
<h4 id="output">Output</h4>
<ul>
<li>Un <code>data.frame</code> con los valores del indicador. La función normaliza la respuesta leyendo <code>indicator$values</code> (o <code>values</code>) y convierte la columna <code>value</code> a numérica cuando procede.</li>
</ul>
<h4 id="clave-api">Clave API</h4>
<ul>
<li>Para conseguir la API hay que escribir un mail a consultasios@ree.es solicitando un token.</li>
<li>Una vez obtenida la clave, debes establecerla como variable de entorno <code>ESIOS_TOKEN</code> antes de ejecutar. Ejemplo en R:<pre class="hljs"><code><div>Sys.setenv(ESIOS_TOKEN = <span class="hljs-string">"SU_TOKEN_AQUI"</span>)
</div></code></pre>
</li>
</ul>
<h4 id="enlaces-%C3%BAtiles">Enlaces útiles</h4>
<ul>
<li>Portal y catálogo de endpoints: https://api.esios.ree.es/</li>
<li>Ejemplo de parámetros/aggregaciones de indicadores: https://api.esios.ree.es/doc/indicator/getting_a_disaggregated_indicator_filtering_values_by_a_date_range_and_geo_ids,_grouped_by_geo_id_and_month,_using_avg_aggregation_for_geo_and_avg_for_time_without_time_trunc.html</li>
</ul>
<h3 id="esiosexampler">esios_example.R</h3>
<pre class="hljs"><code><div><span class="hljs-comment"># Ejemplo de uso de la función esios_api_function</span>
<span class="hljs-keyword">library</span>(httr)
<span class="hljs-keyword">library</span>(jsonlite)

<span class="hljs-comment">#setwd("R/esios")</span>
<span class="hljs-keyword">source</span>(<span class="hljs-string">"esios_function.R"</span>)

<span class="hljs-comment"># Ejemplo: precio medio horario final (suma de componentes) id=10211</span>
<span class="hljs-comment"># Objetivo: promedio nacional por día del último mes</span>

<span class="hljs-comment"># Clave API</span>
token &lt;- Sys.getenv(<span class="hljs-string">"ESIOS_TOKEN"</span>)

<span class="hljs-comment"># Fechas ISO8601 (UTC)</span>
end_date_date &lt;- Sys.Date()
start_date_date &lt;- end_date_date - <span class="hljs-number">30</span>
start_date &lt;- paste0(format(start_date_date, <span class="hljs-string">"%Y-%m-%d"</span>), <span class="hljs-string">"T00:00:00Z"</span>)
end_date   &lt;- paste0(format(end_date_date, <span class="hljs-string">"%Y-%m-%d"</span>), <span class="hljs-string">"T23:59:59Z"</span>)

df &lt;- esios_api_function(
  indicator_id = <span class="hljs-number">10211</span>,
  start_date = start_date,
  end_date = end_date,
  time_agg = <span class="hljs-string">"avg"</span>,
  time_trunc = <span class="hljs-string">"day"</span>,
  geo_agg = <span class="hljs-string">"avg"</span>,
  geo_trunc = <span class="hljs-string">"country"</span>,
  locale = <span class="hljs-string">"es"</span>
)

write.csv(df, <span class="hljs-string">"esios_example.csv"</span>, row.names = <span class="hljs-literal">FALSE</span>)





</div></code></pre>
<h3 id="esiosfunctionr">esios_function.R</h3>
<pre class="hljs"><code><div><span class="hljs-comment"># Función mínima para descargar indicadores de REE e·sios (JSON -&gt; data.frame)</span>

<span class="hljs-keyword">library</span>(httr)
<span class="hljs-keyword">library</span>(jsonlite)

<span class="hljs-comment"># esios_api_function: descarga valores de un indicador con filtros comunes</span>
<span class="hljs-comment"># - indicator_id: id numérico del indicador (p. ej., 1001, 10211)</span>
<span class="hljs-comment"># - start_date, end_date: ISO8601 ("YYYY-MM-DDTHH:MM:SSZ")</span>
<span class="hljs-comment"># - time_agg: "sum"|"avg"</span>
<span class="hljs-comment"># - time_trunc: "five_minutes"|"ten_minutes"|"fifteen_minutes"|"hour"|"day"|"month"|"year"</span>
<span class="hljs-comment"># - geo_agg: "sum"|"avg"</span>
<span class="hljs-comment"># - geo_trunc: "country"|"electric_system"|"autonomous_community"|"province"|"electric_subsystem"|"town"|"drainage_basin"</span>
<span class="hljs-comment"># - geo_ids: vector opcional de ids geográficos (num/char)</span>
<span class="hljs-comment"># - locale: "es"|"en"</span>
<span class="hljs-comment"># - token: por defecto toma Sys.getenv("ESIOS_TOKEN")</span>

esios_api_function &lt;- <span class="hljs-keyword">function</span>(
  indicator_id,
  start_date,
  end_date,
  time_agg = <span class="hljs-literal">NULL</span>,
  time_trunc = <span class="hljs-literal">NULL</span>,
  geo_agg = <span class="hljs-literal">NULL</span>,
  geo_trunc = <span class="hljs-literal">NULL</span>,
  geo_ids = <span class="hljs-literal">NULL</span>,
  locale = <span class="hljs-string">"es"</span>,
  token = Sys.getenv(<span class="hljs-string">"ESIOS_TOKEN"</span>)
) {
  <span class="hljs-keyword">if</span> (missing(indicator_id)) <span class="hljs-keyword">stop</span>(<span class="hljs-string">"'indicator_id' es obligatorio"</span>)
  <span class="hljs-keyword">if</span> (missing(start_date) || missing(end_date)) <span class="hljs-keyword">stop</span>(<span class="hljs-string">"'start_date' y 'end_date' son obligatorios (ISO8601)"</span>)
  <span class="hljs-keyword">if</span> (!nzchar(token)) <span class="hljs-keyword">stop</span>(<span class="hljs-string">"Defina su token en la variable de entorno ESIOS_TOKEN o páselo en 'token'"</span>)

  base_url &lt;- paste0(<span class="hljs-string">"https://api.esios.ree.es/indicators/"</span>, indicator_id)

  <span class="hljs-comment"># Construcción de parámetros</span>
  q &lt;- list(start_date = start_date, end_date = end_date)
  <span class="hljs-keyword">if</span> (!is.null(time_agg))   q$time_agg &lt;- match.arg(tolower(time_agg), c(<span class="hljs-string">"sum"</span>,<span class="hljs-string">"avg"</span>,<span class="hljs-string">"average"</span>))
  <span class="hljs-keyword">if</span> (!is.null(time_trunc)) q$time_trunc &lt;- match.arg(tolower(time_trunc), c(<span class="hljs-string">"five_minutes"</span>,<span class="hljs-string">"ten_minutes"</span>,<span class="hljs-string">"fifteen_minutes"</span>,<span class="hljs-string">"hour"</span>,<span class="hljs-string">"day"</span>,<span class="hljs-string">"month"</span>,<span class="hljs-string">"year"</span>))
  <span class="hljs-keyword">if</span> (!is.null(geo_agg))    q$geo_agg &lt;- match.arg(tolower(geo_agg), c(<span class="hljs-string">"sum"</span>,<span class="hljs-string">"avg"</span>,<span class="hljs-string">"average"</span>))
  <span class="hljs-keyword">if</span> (!is.null(geo_trunc))  q$geo_trunc &lt;- match.arg(tolower(geo_trunc), c(<span class="hljs-string">"country"</span>,<span class="hljs-string">"electric_system"</span>,<span class="hljs-string">"autonomous_community"</span>,<span class="hljs-string">"province"</span>,<span class="hljs-string">"electric_subsystem"</span>,<span class="hljs-string">"town"</span>,<span class="hljs-string">"drainage_basin"</span>))
  <span class="hljs-keyword">if</span> (!is.null(geo_ids) &amp;&amp; length(geo_ids)) {
    <span class="hljs-comment"># Repetir parámetro geo_ids[] por cada valor</span>
    <span class="hljs-keyword">for</span> (g <span class="hljs-keyword">in</span> as.character(geo_ids)) q &lt;- c(q, setNames(list(g), <span class="hljs-string">"geo_ids[]"</span>))
  }

  hdrs &lt;- httr::add_headers(
    <span class="hljs-string">"x-api-key"</span> = token,
    <span class="hljs-string">"Accept"</span> = <span class="hljs-string">"application/json; application/vnd.esios-api-v1+json"</span>,
    <span class="hljs-string">"Accept-Language"</span> = locale,
    <span class="hljs-string">"Content-Type"</span> = <span class="hljs-string">"application/json"</span>
  )

  res &lt;- httr::GET(base_url, query = q, hdrs)
  <span class="hljs-keyword">if</span> (httr::http_error(res)) <span class="hljs-keyword">stop</span>(sprintf(<span class="hljs-string">"ESIOS request failed [%s]"</span>, httr::status_code(res)))

  txt &lt;- httr::content(res, as = <span class="hljs-string">"text"</span>, encoding = <span class="hljs-string">"UTF-8"</span>)
  obj &lt;- jsonlite::fromJSON(txt, flatten = <span class="hljs-literal">TRUE</span>)

  <span class="hljs-comment"># Normalizar: valores suelen venir en indicator$values</span>
  values_df &lt;- <span class="hljs-literal">NULL</span>
  <span class="hljs-keyword">if</span> (!is.null(obj$indicator$values)) {
    values_df &lt;- obj$indicator$values
  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (!is.null(obj$values)) {
    values_df &lt;- obj$values
  } <span class="hljs-keyword">else</span> {
    <span class="hljs-keyword">stop</span>(<span class="hljs-string">"Estructura de respuesta inesperada; no se encontró 'indicator.values'."</span>)
  }
  <span class="hljs-keyword">if</span> (<span class="hljs-string">"value"</span> %<span class="hljs-keyword">in</span>% names(values_df)) values_df$value &lt;- suppressWarnings(as.numeric(values_df$value))
  <span class="hljs-keyword">return</span>(values_df)
}



</div></code></pre>
<h3 id="esioslistindicatorsr">esios_list_indicators.R</h3>
<pre class="hljs"><code><div><span class="hljs-comment"># Listado de indicadores ESIOS (JSON -&gt; CSV)</span>

<span class="hljs-keyword">library</span>(httr)
<span class="hljs-keyword">library</span>(jsonlite)

<span class="hljs-comment"># --- Parámetros ---</span>
output_name &lt;- <span class="hljs-string">"esios_indicators"</span>
out_file &lt;- paste0( output_name, <span class="hljs-string">".csv"</span>)

<span class="hljs-comment"># Requiere token en variable de entorno ESIOS_TOKEN</span>
Sys.setenv(ESIOS_TOKEN = <span class="hljs-string">"c9957840f6e4bbdc76f4958cd33676cc1f97665758a55b21ea006a5fbbd660b3"</span>)
token &lt;- Sys.getenv(<span class="hljs-string">"ESIOS_TOKEN"</span>)
<span class="hljs-keyword">if</span> (!nzchar(token)) <span class="hljs-keyword">stop</span>(<span class="hljs-string">"Defina su token en la variable de entorno ESIOS_TOKEN"</span>)

<span class="hljs-comment"># --- Llamada a API: listado de indicadores ---</span>
base_url &lt;- <span class="hljs-string">"https://api.esios.ree.es/indicators"</span>
hdrs &lt;- httr::add_headers(
  <span class="hljs-string">"x-api-key"</span> = token,
  <span class="hljs-string">"Accept"</span> = <span class="hljs-string">"application/json"</span>,
  <span class="hljs-string">"Accept-Language"</span> = <span class="hljs-string">"es"</span>,
  <span class="hljs-string">"Content-Type"</span> = <span class="hljs-string">"application/json"</span>
)

res &lt;- httr::GET(base_url, query = list(locale = <span class="hljs-string">"es"</span>), hdrs)
<span class="hljs-keyword">if</span> (httr::http_error(res)) <span class="hljs-keyword">stop</span>(sprintf(<span class="hljs-string">"ESIOS request failed [%s]"</span>, httr::status_code(res)))

txt &lt;- httr::content(res, as = <span class="hljs-string">"text"</span>, encoding = <span class="hljs-string">"UTF-8"</span>)
obj &lt;- jsonlite::fromJSON(txt, flatten = <span class="hljs-literal">TRUE</span>)

indicators_df &lt;- <span class="hljs-literal">NULL</span>
<span class="hljs-keyword">if</span> (!is.null(obj$indicators)) {
  indicators_df &lt;- obj$indicators
} <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (!is.null(obj$data$indicators)) {
  indicators_df &lt;- obj$data$indicators
} <span class="hljs-keyword">else</span> {
  <span class="hljs-keyword">stop</span>(<span class="hljs-string">"Estructura de respuesta inesperada; no se encontró 'indicators'."</span>)
}

utils::write.csv(indicators_df, out_file, row.names = <span class="hljs-literal">FALSE</span>, na = <span class="hljs-string">""</span>)



</div></code></pre>
<h3 id="esiosminr">esios_min.R</h3>
<pre class="hljs"><code><div><span class="hljs-comment"># Descargador mínimo REE e·sios (JSON -&gt; CSV)</span>
<span class="hljs-comment">#</span>
<span class="hljs-comment"># Cómo personalizar:</span>
<span class="hljs-comment"># - Defina el ID del indicador en 'indicator_id' (por defecto: precio spot OMIE)</span>
<span class="hljs-comment"># - Cambie 'output_name' para definir el nombre del archivo de salida (CSV)</span>
<span class="hljs-comment"># - Exporte su token personal en la variable de entorno ESIOS_TOKEN</span>
<span class="hljs-comment">#</span>
<span class="hljs-comment"># Referencia API:</span>
<span class="hljs-comment"># - Documentación general: https://www.esios.ree.es/es/pagina/api</span>
<span class="hljs-comment"># - Endpoints v2: https://api.esios.ree.es/</span>

<span class="hljs-keyword">library</span>(httr)
<span class="hljs-keyword">library</span>(jsonlite)

<span class="hljs-comment"># --- Parámetros editables ---</span>
<span class="hljs-comment"># Indicador de precio Precio medio horario final suma de componentes</span>
indicator_id &lt;- <span class="hljs-number">10211</span>
output_name &lt;- <span class="hljs-string">"esios_precio_hoy"</span>
out_file &lt;- paste0(<span class="hljs-string">"data/"</span>, output_name, <span class="hljs-string">".csv"</span>)
token &lt;- Sys.getenv(<span class="hljs-string">"ESIOS_TOKEN"</span>)
<span class="hljs-comment"># --- Crear directorio de datos si no existe ---</span>
<span class="hljs-keyword">if</span> (!dir.exists(<span class="hljs-string">"data"</span>)) dir.create(<span class="hljs-string">"data"</span>, recursive = <span class="hljs-literal">TRUE</span>, showWarnings = <span class="hljs-literal">FALSE</span>)

<span class="hljs-comment"># --- Fechas: último mes (UTC) ---</span>
end_date_date &lt;- Sys.Date()
start_date_date &lt;- end_date_date - <span class="hljs-number">30</span>
start_date &lt;- paste0(format(start_date_date, <span class="hljs-string">"%Y-%m-%d"</span>), <span class="hljs-string">"T00:00:00Z"</span>)
end_date   &lt;- paste0(format(end_date_date, <span class="hljs-string">"%Y-%m-%d"</span>), <span class="hljs-string">"T23:59:59Z"</span>)

<span class="hljs-comment"># --- Descargar JSON ---</span>
base_url &lt;- paste0(<span class="hljs-string">"https://api.esios.ree.es/indicators/"</span>, indicator_id)
hdrs &lt;- httr::add_headers(
  <span class="hljs-string">"x-api-key"</span> = token,
  <span class="hljs-string">"Accept"</span> = <span class="hljs-string">"application/json"</span>,
  <span class="hljs-string">"Accept-Language"</span> = <span class="hljs-string">"es"</span>,
  <span class="hljs-string">"Content-Type"</span> = <span class="hljs-string">"application/json"</span>
)

res &lt;- httr::GET(
  base_url,
  query = list(
    start_date = start_date,
    end_date = end_date,
    time_agg = <span class="hljs-string">"avg"</span>,
    time_trunc = <span class="hljs-string">"day"</span>,
    geo_agg = <span class="hljs-string">"avg"</span>,
    geo_trunc = <span class="hljs-string">"country"</span>
  ),
  hdrs
)
<span class="hljs-keyword">if</span> (httr::http_error(res)) <span class="hljs-keyword">stop</span>(sprintf(<span class="hljs-string">"ESIOS request failed [%s]"</span>, httr::status_code(res)))

txt &lt;- httr::content(res, as = <span class="hljs-string">"text"</span>, encoding = <span class="hljs-string">"UTF-8"</span>)
obj &lt;- jsonlite::fromJSON(txt, flatten = <span class="hljs-literal">TRUE</span>)

<span class="hljs-comment"># La estructura típica es obj$indicator$values</span>
values_df &lt;- <span class="hljs-literal">NULL</span>
<span class="hljs-keyword">if</span> (!is.null(obj$indicator$values)) {
  values_df &lt;- obj$indicator$values
} <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (!is.null(obj$values)) {
  values_df &lt;- obj$values
} <span class="hljs-keyword">else</span> {
  <span class="hljs-keyword">stop</span>(<span class="hljs-string">"Estructura de respuesta inesperada; no se encontró 'indicator.values'."</span>)
}

<span class="hljs-comment"># Coaccionar 'value' a numérico si existe</span>
<span class="hljs-keyword">if</span> (<span class="hljs-string">"value"</span> %<span class="hljs-keyword">in</span>% names(values_df)) values_df$value &lt;- suppressWarnings(as.numeric(values_df$value))

utils::write.csv(values_df, out_file, row.names = <span class="hljs-literal">FALSE</span>, na = <span class="hljs-string">""</span>)



</div></code></pre>
<h2 id="eurostat">EUROSTAT</h2>
<h3 id="gu%C3%ADa-r%C3%A1pida-eurostat-con-r">Guía rápida: Eurostat con R</h3>
<p>Este documento explica cómo usar la función en <code>eurostat/eurostat_function.R</code> para descargar datos de la API SDMX 3.0 de Eurostat en formato CSV (SDMX-CSV 2.0) y obtenerlos como un data frame en R.</p>
<h4 id="requisitos">Requisitos</h4>
<ul>
<li>Paquete <code>httr</code> instalado (<code>install.packages(&quot;httr&quot;)</code> si fuera necesario)</li>
</ul>
<h4 id="codigos-ejemplo">Codigos ejemplo</h4>
<ul>
<li><code>eurostat_onlylink.R</code> es un ejemplo que descarga y lee el csv directamente del link de la API en una linea.</li>
<li><code>eurostat_min.R</code> es un ejemplo minimo para descargar datos de Eurostat sin usar la función <code>eurostat_api_function</code>.</li>
<li><code>eurostat_example.R</code> es un ejemplo de uso de la función <code>eurostat_api_function</code>.</li>
</ul>
<h4 id="inputs">Inputs</h4>
<ul>
<li>
<p><strong>Obligatorios</strong></p>
<ul>
<li><code>dataset_identifier</code>: identificador del dataset (p. ej., <code>&quot;nama_10_a64&quot;</code>).</li>
<li><code>filters</code>: lista nombrada de filtros SDMX. Tiene que tener formato <code>list(dim1 = c(&quot;val1&quot;, &quot;val2&quot;), dim2 = &quot;val3&quot;, ...)</code>.</li>
</ul>
</li>
<li>
<p><strong>Opcionales</strong></p>
<ul>
<li><code>agency_identifier</code>: agencia mantenedora (por defecto <code>&quot;ESTAT&quot;</code>).</li>
<li><code>dataset_version</code>: versión del dataset (por defecto <code>&quot;1.0&quot;</code>).</li>
<li><code>compress</code>: <code>&quot;false&quot;</code> para CSV legible.</li>
<li><code>format</code>/<code>formatVersion</code>: para SDMX-CSV 2.0 use <code>&quot;csvdata&quot;</code> + <code>&quot;2.0&quot;</code>.</li>
<li><code>lang</code>: idioma de etiquetas (<code>&quot;en&quot;</code>, etc.).</li>
<li><code>labels</code>: <code>&quot;id&quot;</code> (solo codigos), <code>&quot;name&quot;</code> (descripciones y codigos), <code>&quot;both&quot;</code> (ambos).</li>
</ul>
</li>
</ul>
<h4 id="c%C3%B3mo-elegir-inputs">Cómo elegir inputs</h4>
<ol>
<li>Lo más sencillo es ir a Eurostat, buscar la serie de interés y copiar el codigo de la serie. Mirar el codigo de las variables que nos interesan y los codigos de los valores que queremos filtrar.</li>
<li>Usar el codigo de la serie como <code>dataset_identifier</code>.</li>
<li>Ajustar filtros (<code>filters</code>).
<ul>
<li>Añada o cambie dimensiones válidas del dataset (p. ej., <code>geo</code>, <code>na_item</code>, <code>unit</code>, <code>freq</code>, <code>TIME_PERIOD</code>).</li>
<li>Para valores múltiples use vectores en R: <code>c(&quot;ES&quot;, &quot;FR&quot;)</code>.</li>
<li>En <code>TIME_PERIOD</code> puede usar operadores SDMX: <code>ge:YYYY</code>, <code>le:YYYY</code>, <code>YYYY:YYYY</code>, <code>ge:200Q1</code>, etc.</li>
</ul>
</li>
<li>Cambiar parametros opcionales si es necesario.</li>
</ol>
<h4 id="sintaxis-de-la-api-sdmx-30">Sintaxis de la API (SDMX 3.0)</h4>
<ul>
<li>
<p><strong>Formato general:</strong></p>
<pre class="hljs"><code><div>{base_url}/{agency_identifier}/{dataset_identifier}/{dataset_version}/?{filters_params}&amp;{common_params}
</div></code></pre>
<p>Donde <code>base_url</code> es <code>https://ec.europa.eu/eurostat/api/dissemination/sdmx/3.0/data/dataflow</code>.</p>
</li>
<li>
<p><strong>Ejemplo:</strong></p>
<pre class="hljs"><code><div>https://ec.europa.eu/eurostat/api/dissemination/sdmx/3.0/data/dataflow/ESTAT/nama_10_a64/1.0/?c[geo]=ES,FR&amp;c[na_item]=B1G,P1&amp;c[freq]=A&amp;c[unit]=CLV20_MEUR&amp;c[TIME_PERIOD]=ge:1995&amp;compress=false&amp;format=csvdata&amp;formatVersion=2.0&amp;lang=en&amp;labels=name
</div></code></pre>
</li>
</ul>
<h4 id="output">Output</h4>
<ul>
<li>Un <code>data.frame</code> con los datos descargados desde Eurostat.</li>
</ul>
<h4 id="notas">Notas</h4>
<ul>
<li>Si la API devuelve error, verifique que los códigos de dimensiones/valores sean válidos para el dataset escogido.</li>
<li><code>labels = &quot;id&quot;</code> devuelve códigos; <code>labels = &quot;name&quot;</code> devuelve descripciones legibles; <code>&quot;both&quot;</code> incluye ambos.</li>
</ul>
<h4 id="enlaces-%C3%BAtiles">Enlaces útiles</h4>
<ul>
<li>Guía de consultas de datos (SDMX 3.0, Eurostat): <a href="https://ec.europa.eu/eurostat/web/user-guides/data-browser/api-data-access/api-detailed-guidelines/sdmx3-0/data-query">API - Detailed guidelines - SDMX3.0 API - data query</a></li>
<li><a href="https://ec.europa.eu/eurostat/web/user-guides/data-browser/api-data-access/api-getting-started/api#APIGettingstartedwithstatisticsAPI-Retrievingyourfirstcontent">API - Getting started with statistics API - Retrieving your first content</a></li>
<li>https://ec.europa.eu/eurostat/web/query-builder/tool</li>
</ul>
<h3 id="eurostatexampler">eurostat_example.R</h3>
<pre class="hljs"><code><div><span class="hljs-comment"># Ejemplo de uso de la función eurostat_api_function</span>
<span class="hljs-keyword">library</span>(httr)

<span class="hljs-comment">#setwd("R/eurostat")</span>
<span class="hljs-keyword">source</span>(<span class="hljs-string">"eurostat_function_check.R"</span>)

<span class="hljs-comment"># Ejemplo de uso with check function</span>
df &lt;- eurostat_api_function_check(
  dataset_identifier = <span class="hljs-string">"nama_10_a64"</span>,
  filters = list(
    geo = c(<span class="hljs-string">"IT"</span>),
    na_item = c(<span class="hljs-string">"B1G"</span>),
    unit = <span class="hljs-string">"CLV20_MEUR"</span>,
    TIME_PERIOD = <span class="hljs-string">"ge:1995"</span>
  ),
  toc_path = <span class="hljs-string">"table_of_contents_en.txt"</span>
)

<span class="hljs-comment"># Ejemplo de uso</span>
<span class="hljs-comment">#df &lt;- eurostat_api_function(</span>
<span class="hljs-comment">#  dataset_identifier = "nama_10_a64",</span>
<span class="hljs-comment">#  filters = list(</span>
<span class="hljs-comment">#    geo = c("IT"),</span>
<span class="hljs-comment">#    na_item = c("B1G"),</span>
<span class="hljs-comment">#    unit = "CLV20_MEUR",</span>
<span class="hljs-comment">#    TIME_PERIOD = "ge:1995"</span>
<span class="hljs-comment">#  )</span>
<span class="hljs-comment">#)</span>
<span class="hljs-comment">#write.csv(df, "eurostat_example.csv", row.names = FALSE)</span>
</div></code></pre>
<h3 id="eurostatfunctionr">eurostat_function.R</h3>
<pre class="hljs"><code><div><span class="hljs-comment"># Función mínima para descargar datos de Eurostat (SDMX-CSV 2.0)</span>

<span class="hljs-comment"># Inputs obligatorios:</span>
<span class="hljs-comment"># - dataset_identifier: identificador del dataset</span>
<span class="hljs-comment"># - filters: lista de filtros</span>
<span class="hljs-comment">#</span>
<span class="hljs-comment"># Inputs opcionales:</span>
<span class="hljs-comment"># - agency_identifier: identificador de la agencia</span>
<span class="hljs-comment"># - dataset_version: versión del dataset</span>
<span class="hljs-comment"># - compress: compresión</span>
<span class="hljs-comment"># - format: formato</span>
<span class="hljs-comment"># - formatVersion: versión del formato</span>
<span class="hljs-comment"># - lang: idioma</span>
<span class="hljs-comment"># - labels: etiquetas</span>
<span class="hljs-comment">#</span>
<span class="hljs-comment"># Outputs:</span>
<span class="hljs-comment"># - df: data frame con los datos</span>
<span class="hljs-comment">#</span>
<span class="hljs-comment"># Example:</span>
<span class="hljs-comment"># df &lt;- eurostat_api_function(</span>
<span class="hljs-comment">#   dataset_identifier = "nama_10_a64",</span>
<span class="hljs-comment">#   filters = list(geo = c("IT"), na_item = c("B1G"), unit = "CLV20_MEUR", TIME_PERIOD = "ge:1995")</span>
<span class="hljs-comment"># )</span>

eurostat_api_function &lt;- <span class="hljs-keyword">function</span>(
  dataset_identifier,
  filters,
  agency_identifier = <span class="hljs-string">"ESTAT"</span>,
  dataset_version = <span class="hljs-string">"1.0"</span>,
  compress = <span class="hljs-string">"false"</span>,
  format = <span class="hljs-string">"csvdata"</span>,
  formatVersion = <span class="hljs-string">"2.0"</span>,
  lang = <span class="hljs-string">"en"</span>,
  labels = <span class="hljs-string">"name"</span>
) {
  base_url &lt;- <span class="hljs-string">"https://ec.europa.eu/eurostat/api/dissemination/sdmx/3.0/data/dataflow"</span>

  <span class="hljs-comment"># Construir identificador completo: context/agency/dataset/version</span>
  data_identifier &lt;- paste(agency_identifier, dataset_identifier, dataset_version, sep = <span class="hljs-string">"/"</span>)
  url &lt;- paste0(base_url, <span class="hljs-string">"/"</span>, data_identifier, <span class="hljs-string">"/"</span>)

  <span class="hljs-comment"># Convertir filtros a parámetros tipo c[dimension]=valor1,valor2</span>
  <span class="hljs-keyword">if</span> (!is.list(filters)) <span class="hljs-keyword">stop</span>(<span class="hljs-string">"'filters' debe ser una lista nombrada de dimensiones -&gt; valores"</span>)
  filters_params &lt;- stats::setNames(
    lapply(filters, <span class="hljs-keyword">function</span>(v) <span class="hljs-keyword">if</span> (length(v) &gt; <span class="hljs-number">1</span>) paste(v, collapse = <span class="hljs-string">","</span>) <span class="hljs-keyword">else</span> v),
    paste0(<span class="hljs-string">"c["</span>, names(filters), <span class="hljs-string">"]"</span>)
  )

  common_params &lt;- list(
    compress = compress,
    format = format,
    formatVersion = formatVersion,
    lang = lang,
    labels = labels
  )

  params &lt;- c(filters_params, common_params)

  res &lt;- httr::GET(url, query = params, httr::accept(<span class="hljs-string">"application/vnd.sdmx.data+csv; version=2.0.0"</span>))
  <span class="hljs-keyword">if</span> (httr::http_error(res)) <span class="hljs-keyword">stop</span>(sprintf(<span class="hljs-string">"Eurostat request failed [%s]"</span>, httr::status_code(res)))

  txt &lt;- httr::content(res, as = <span class="hljs-string">"text"</span>, encoding = <span class="hljs-string">"UTF-8"</span>)
  df &lt;- utils::read.csv(text = txt, stringsAsFactors = <span class="hljs-literal">FALSE</span>)

  <span class="hljs-keyword">return</span>(df)
}

</div></code></pre>
<h3 id="eurostatfunctioncheckr">eurostat_function_check.R</h3>
<pre class="hljs"><code><div><span class="hljs-comment"># Función mínima para descargar datos de Eurostat (SDMX-CSV 2.0)</span>

<span class="hljs-comment"># Inputs obligatorios:</span>
<span class="hljs-comment"># - dataset_identifier: identificador del dataset</span>
<span class="hljs-comment"># - filters: lista de filtros</span>
<span class="hljs-comment">#</span>
<span class="hljs-comment"># Inputs opcionales:</span>
<span class="hljs-comment"># - agency_identifier: identificador de la agencia</span>
<span class="hljs-comment"># - dataset_version: versión del dataset</span>
<span class="hljs-comment"># - compress: compresión</span>
<span class="hljs-comment"># - format: formato</span>
<span class="hljs-comment"># - formatVersion: versión del formato</span>
<span class="hljs-comment"># - lang: idioma</span>
<span class="hljs-comment"># - labels: etiquetas</span>
<span class="hljs-comment">#</span>
<span class="hljs-comment"># Outputs:</span>
<span class="hljs-comment"># - df: data frame con los datos</span>
<span class="hljs-comment">#</span>
<span class="hljs-comment"># Example:</span>
<span class="hljs-comment"># df &lt;- eurostat_api_function(</span>
<span class="hljs-comment">#   dataset_identifier = "nama_10_a64",</span>
<span class="hljs-comment">#   filters = list(geo = c("IT"), na_item = c("B1G"), unit = "CLV20_MEUR", TIME_PERIOD = "ge:1995")</span>
<span class="hljs-comment"># )</span>

eurostat_api_function_check &lt;- <span class="hljs-keyword">function</span>(
  dataset_identifier,
  filters,
  agency_identifier = <span class="hljs-string">"ESTAT"</span>,
  dataset_version = <span class="hljs-string">"1.0"</span>,
  compress = <span class="hljs-string">"false"</span>,
  format = <span class="hljs-string">"csvdata"</span>,
  formatVersion = <span class="hljs-string">"2.0"</span>,
  lang = <span class="hljs-string">"en"</span>,
  labels = <span class="hljs-string">"name"</span>,
  toc_path = <span class="hljs-literal">NULL</span>
) {
  <span class="hljs-comment"># Endpoints (SDMX 3.0)</span>
  <span class="hljs-comment"># Eurostat CSV 2.0 data endpoint (works with path including 'dataflow')</span>
  data_endpoint_base &lt;- <span class="hljs-string">"https://ec.europa.eu/eurostat/api/dissemination/sdmx/3.0/data/dataflow"</span>
  <span class="hljs-comment"># Nota: validación por metadatos deshabilitada en modo local; mantener solo endpoint de datos</span>

  <span class="hljs-comment"># -----------------------</span>
  <span class="hljs-comment"># Validaciones de entrada</span>
  <span class="hljs-comment"># -----------------------</span>
  <span class="hljs-keyword">if</span> (!is.character(dataset_identifier) || length(dataset_identifier) != <span class="hljs-number">1</span> || nchar(dataset_identifier) == <span class="hljs-number">0</span>) {
    <span class="hljs-keyword">stop</span>(<span class="hljs-string">"'dataset_identifier' debe ser un string no vacío"</span>, call. = <span class="hljs-literal">FALSE</span>)
  }
  <span class="hljs-keyword">if</span> (!is.list(filters) || is.null(names(filters)) || any(names(filters) == <span class="hljs-string">""</span>)) {
    <span class="hljs-keyword">stop</span>(<span class="hljs-string">"'filters' debe ser una lista NOMBRADA: lista(dimension = valores)"</span>, call. = <span class="hljs-literal">FALSE</span>)
  }
  <span class="hljs-comment"># Validar tipos de valores de filtros y que no haya NA/NULL</span>
  bad_filter_values &lt;- names(Filter(<span class="hljs-keyword">function</span>(v) {
    is.null(v) || length(v) == <span class="hljs-number">0</span> || any(is.na(v)) || !(is.character(v) || is.numeric(v) || is.logical(v))
  }, filters))
  <span class="hljs-keyword">if</span> (length(bad_filter_values) &gt; <span class="hljs-number">0</span>) {
    <span class="hljs-keyword">stop</span>(sprintf(
      <span class="hljs-string">"Los siguientes filtros tienen valores inválidos: %s. Use vectores de character/numeric/logical sin NA."</span>,
      paste(bad_filter_values, collapse = <span class="hljs-string">", "</span>)
    ), call. = <span class="hljs-literal">FALSE</span>)
  }

  <span class="hljs-comment"># -----------------------------------------</span>
  <span class="hljs-comment"># Verificar existencia del dataset (local TOC solamente)</span>
  <span class="hljs-comment"># -----------------------------------------</span>
  <span class="hljs-comment"># Validación local usando ÚNICAMENTE table_of_contents_en.txt (TSV)</span>
  <span class="hljs-keyword">if</span> (is.null(toc_path)) {
    toc_candidates &lt;- c(
      <span class="hljs-string">"table_of_contents_en.txt"</span>,
      file.path(getwd(), <span class="hljs-string">"table_of_contents_en.txt"</span>)
    )
    toc_candidates &lt;- unique(toc_candidates)
    <span class="hljs-keyword">for</span> (cand <span class="hljs-keyword">in</span> toc_candidates) {
      <span class="hljs-keyword">if</span> (file.exists(cand)) { toc_path &lt;- cand; <span class="hljs-keyword">break</span> }
    }
  }
  <span class="hljs-keyword">if</span> (is.null(toc_path) || !file.exists(toc_path)) {
    <span class="hljs-keyword">stop</span>(<span class="hljs-string">"No se encontró 'table_of_contents_en.txt'. Especifique 'toc_path' apuntando a ese archivo."</span>, call. = <span class="hljs-literal">FALSE</span>)
  }
  <span class="hljs-comment"># Archivo TSV: columnas incluyen "code"</span>
  toc_df &lt;- <span class="hljs-keyword">try</span>(utils::read.delim(toc_path, sep = <span class="hljs-string">"\t"</span>, header = <span class="hljs-literal">TRUE</span>, quote = <span class="hljs-string">'"'</span>, stringsAsFactors = <span class="hljs-literal">FALSE</span>, check.names = <span class="hljs-literal">FALSE</span>), silent = <span class="hljs-literal">TRUE</span>)
  <span class="hljs-keyword">if</span> (!inherits(toc_df, <span class="hljs-string">"try-error"</span>) &amp;&amp; is.data.frame(toc_df) &amp;&amp; <span class="hljs-string">"code"</span> %<span class="hljs-keyword">in</span>% names(toc_df)) {
    <span class="hljs-keyword">if</span> (!any(toc_df$code == dataset_identifier, na.rm = <span class="hljs-literal">TRUE</span>)) {
      <span class="hljs-keyword">stop</span>(sprintf(
        <span class="hljs-string">"Dataset no encontrado en table_of_contents_en.txt: id='%s'. Verifique el identificador localmente o actualice el TOC."</span>,
        dataset_identifier
      ), call. = <span class="hljs-literal">FALSE</span>)
    }
  } <span class="hljs-keyword">else</span> {
    <span class="hljs-comment"># Fallback simple: búsqueda de la cadena con comillas</span>
    toc_txt &lt;- <span class="hljs-keyword">try</span>(readLines(toc_path, warn = <span class="hljs-literal">FALSE</span>), silent = <span class="hljs-literal">TRUE</span>)
    <span class="hljs-keyword">if</span> (!inherits(toc_txt, <span class="hljs-string">"try-error"</span>) &amp;&amp; length(toc_txt) &gt; <span class="hljs-number">0</span>) {
      needle &lt;- paste0(<span class="hljs-string">'"'</span>, dataset_identifier, <span class="hljs-string">'"'</span>)
      <span class="hljs-keyword">if</span> (!any(grepl(needle, toc_txt, fixed = <span class="hljs-literal">TRUE</span>))) {
        <span class="hljs-keyword">stop</span>(sprintf(
          <span class="hljs-string">"Dataset no encontrado en table_of_contents_en.txt: id='%s'."</span>,
          dataset_identifier
        ), call. = <span class="hljs-literal">FALSE</span>)
      }
    }
  }

  <span class="hljs-comment"># No usar validación por metadatos ni DSD cuando se solicita local-only: elegimos versión suministrada</span>
  chosen_version &lt;- dataset_version

  <span class="hljs-comment"># -----------------------------------------</span>
  <span class="hljs-comment"># Construcción de la petición de datos (CSV 2.0)</span>
  <span class="hljs-comment"># Nota: mantenemos el endpoint actual usado en la función original</span>
  <span class="hljs-comment"># -----------------------------------------</span>
  data_identifier &lt;- paste(agency_identifier, dataset_identifier, chosen_version, sep = <span class="hljs-string">"/"</span>)
  url &lt;- paste0(data_endpoint_base, <span class="hljs-string">"/"</span>, data_identifier, <span class="hljs-string">"/"</span>)

  <span class="hljs-comment"># Convertir filtros a parámetros tipo c[dimension]=valor1,valor2</span>
  filters_params &lt;- stats::setNames(
    lapply(filters, <span class="hljs-keyword">function</span>(v) <span class="hljs-keyword">if</span> (length(v) &gt; <span class="hljs-number">1</span>) paste(v, collapse = <span class="hljs-string">","</span>) <span class="hljs-keyword">else</span> v),
    paste0(<span class="hljs-string">"c["</span>, names(filters), <span class="hljs-string">"]"</span>)
  )

  common_params &lt;- list(
    compress = compress,
    format = format,
    formatVersion = formatVersion,
    lang = lang,
    labels = labels
  )

  params &lt;- c(filters_params, common_params)

  res &lt;- <span class="hljs-keyword">try</span>(httr::GET(url, query = params, httr::accept(<span class="hljs-string">"application/vnd.sdmx.data+csv; version=2.0.0"</span>), httr::timeout(<span class="hljs-number">30</span>)), silent = <span class="hljs-literal">TRUE</span>)
  <span class="hljs-keyword">if</span> (inherits(res, <span class="hljs-string">"try-error"</span>) || is.null(res)) {
    <span class="hljs-keyword">stop</span>(<span class="hljs-string">"No se pudo conectar al endpoint de datos de Eurostat. Revise su conexión."</span>, call. = <span class="hljs-literal">FALSE</span>)
  }
  <span class="hljs-keyword">if</span> (httr::http_error(res)) {
    status_code &lt;- httr::status_code(res)
    body_txt &lt;- <span class="hljs-keyword">try</span>(httr::content(res, as = <span class="hljs-string">"text"</span>, encoding = <span class="hljs-string">"UTF-8"</span>), silent = <span class="hljs-literal">TRUE</span>)
    body_snippet &lt;- <span class="hljs-keyword">if</span> (!inherits(body_txt, <span class="hljs-string">"try-error"</span>) &amp;&amp; nzchar(body_txt)) substr(body_txt, <span class="hljs-number">1</span>, <span class="hljs-number">500</span>) <span class="hljs-keyword">else</span> <span class="hljs-string">""</span>

    hint &lt;- <span class="hljs-keyword">switch</span>(as.character(status_code),
      <span class="hljs-string">"400"</span> = <span class="hljs-string">"Solicitud inválida: verifique nombres de dimensiones y formato de filtros."</span>,
      <span class="hljs-string">"404"</span> = <span class="hljs-string">"No se encontraron datos: verifique 'dataset_identifier' o que los filtros no sean contradictorios."</span>,
      <span class="hljs-string">"406"</span> = <span class="hljs-string">"No aceptable: verifique el encabezado Accept (CSV 2.0) o parámetros 'format/formatVersion'."</span>,
      <span class="hljs-string">"413"</span> = <span class="hljs-string">"Respuesta demasiado grande: refine los filtros para limitar el volumen."</span>,
      <span class="hljs-literal">NULL</span>
    )

    base_msg &lt;- sprintf(<span class="hljs-string">"Eurostat devolvió error [HTTP %s]"</span>, status_code)
    <span class="hljs-keyword">if</span> (!is.null(hint)) base_msg &lt;- paste(base_msg, <span class="hljs-string">"-"</span>, hint)
    <span class="hljs-keyword">if</span> (nzchar(body_snippet)) base_msg &lt;- paste0(base_msg, <span class="hljs-string">". Detalle: "</span>, body_snippet)
    <span class="hljs-keyword">stop</span>(base_msg, call. = <span class="hljs-literal">FALSE</span>)
  }

  txt &lt;- httr::content(res, as = <span class="hljs-string">"text"</span>, encoding = <span class="hljs-string">"UTF-8"</span>)
  <span class="hljs-keyword">if</span> (!nzchar(txt)) {
    <span class="hljs-keyword">stop</span>(<span class="hljs-string">"Respuesta vacía recibida del servicio de datos de Eurostat."</span>, call. = <span class="hljs-literal">FALSE</span>)
  }
  df &lt;- utils::read.csv(text = txt, stringsAsFactors = <span class="hljs-literal">FALSE</span>)

  <span class="hljs-keyword">if</span> (nrow(df) == <span class="hljs-number">0</span>) {
    <span class="hljs-keyword">stop</span>(
      <span class="hljs-string">"La respuesta no contiene filas. Es probable que los filtros sean demasiado restrictivos o no coincidan con códigos válidos."</span>,
      call. = <span class="hljs-literal">FALSE</span>
    )
  }

  <span class="hljs-keyword">return</span>(df)
}

</div></code></pre>
<h3 id="eurostatminr">eurostat_min.R</h3>
<pre class="hljs"><code><div><span class="hljs-comment"># Descargador mínimo de Eurostat (CSV)</span>
<span class="hljs-comment">#</span>
<span class="hljs-comment"># Cómo personalizar:</span>
<span class="hljs-comment"># - Cambiar dataset_identifier por el codigo de la serie de interés.</span>
<span class="hljs-comment"># - Cambiar filters para seleccionar las dimensiones de la serie de interés. Si no queremos filtrar, no incluimos la variable en la lista.</span>

<span class="hljs-keyword">library</span>(httr)

<span class="hljs-comment"># --- Parámetros editables ---</span>
<span class="hljs-comment"># Identificadores de dataset</span>
  base_url &lt;- <span class="hljs-string">"https://ec.europa.eu/eurostat/api/dissemination/sdmx/3.0/data/dataflow"</span> <span class="hljs-comment"># Endpoint SDMX 3.0 de Eurostat</span>
  agency_identifier &lt;- <span class="hljs-string">"ESTAT"</span>
  dataset_identifier &lt;- <span class="hljs-string">"nama_10_a64"</span>
  dataset_version &lt;- <span class="hljs-string">"1.0"</span>

<span class="hljs-comment"># Filtros (modificar libremente)</span>
  filters &lt;- list(
    geo = c(<span class="hljs-string">"ES"</span>, <span class="hljs-string">"FR"</span>),
    na_item = c(<span class="hljs-string">"B1G"</span>, <span class="hljs-string">"P1"</span>),
    unit = <span class="hljs-string">"CLV20_MEUR"</span>,
    TIME_PERIOD = <span class="hljs-string">"ge:1995"</span>
  )

<span class="hljs-comment"># Parámetros comunes de salida (SDMX-CSV 2.0)</span>
  common_params &lt;- list(
    compress = <span class="hljs-string">"false"</span>,
    format = <span class="hljs-string">"csvdata"</span>,
    formatVersion = <span class="hljs-string">"2.0"</span>,
    lang = <span class="hljs-string">"en"</span>,
    labels = <span class="hljs-string">"name"</span>
  )

<span class="hljs-comment"># Nombre del archivo de salida</span>
  output_name &lt;- <span class="hljs-string">"eurostat_ejemplo"</span>
  out_file &lt;- paste0(<span class="hljs-string">"data/"</span>, output_name, <span class="hljs-string">".csv"</span>)


<span class="hljs-comment"># -- Construir la URL ---</span>
<span class="hljs-comment"># Construir ruta completa (context/agency/dataset/version)</span>
  data_identifier &lt;- paste(agency_identifier, dataset_identifier, dataset_version, sep = <span class="hljs-string">"/"</span>)
  url &lt;- paste0(base_url, <span class="hljs-string">"/"</span>, data_identifier, <span class="hljs-string">"/"</span>)
<span class="hljs-comment"># Convertir filtros a parámetros tipo c[...]=</span>
  filters_params &lt;- setNames(
    lapply(filters, <span class="hljs-keyword">function</span>(v) <span class="hljs-keyword">if</span> (length(v) &gt; <span class="hljs-number">1</span>) paste(v, collapse = <span class="hljs-string">","</span>) <span class="hljs-keyword">else</span> v),
    paste0(<span class="hljs-string">"c["</span>, names(filters), <span class="hljs-string">"]"</span>)
  )
  params &lt;- c(filters_params, common_params)

<span class="hljs-comment"># --- Crear directorio de datos si no existe ---</span>
<span class="hljs-keyword">if</span> (!dir.exists(<span class="hljs-string">"data"</span>)) dir.create(<span class="hljs-string">"data"</span>, recursive = <span class="hljs-literal">TRUE</span>, showWarnings = <span class="hljs-literal">FALSE</span>)

<span class="hljs-comment"># --- Descargar archivo CSV and store in a data frame---</span>
res &lt;- httr::GET(url, query = params, httr::accept(<span class="hljs-string">"application/vnd.sdmx.data+csv; version=2.0.0"</span>))
<span class="hljs-keyword">if</span> (httr::http_error(res)) <span class="hljs-keyword">stop</span>(sprintf(<span class="hljs-string">"Eurostat request failed [%s]"</span>, httr::status_code(res)))
txt &lt;- httr::content(res, as = <span class="hljs-string">"text"</span>, encoding = <span class="hljs-string">"UTF-8"</span>)
df &lt;- read.csv(text = txt, stringsAsFactors = <span class="hljs-literal">FALSE</span>)
utils::write.csv(df, out_file, row.names = <span class="hljs-literal">FALSE</span>, na = <span class="hljs-string">""</span>)

</div></code></pre>
<h3 id="eurostatonlylinkr">eurostat_onlylink.R</h3>
<pre class="hljs"><code><div><span class="hljs-comment"># Minimal Eurostat API downloader (link only)</span>
df &lt;- read.csv(<span class="hljs-string">"https://ec.europa.eu/eurostat/api/dissemination/sdmx/3.0/data/dataflow/ESTAT/nama_10_a64/1.0/?c[geo]=ES,FR&amp;c[na_item]=B1G,P1&amp;c[unit]=CLV20_MEUR&amp;c[TIME_PERIOD]=ge:1995&amp;compress=false&amp;format=csvdata&amp;formatVersion=2.0&amp;lang=en&amp;labels=name"</span>)


</div></code></pre>
<h2 id="fred">FRED</h2>
<h3 id="gu%C3%ADa-r%C3%A1pida-fred-con-r">Guía rápida: FRED con R</h3>
<p>Este documento explica cómo usar las funciones en <code>fred_function.R</code> para descargar datos desde FRED.</p>
<h4 id="requisitos">Requisitos</h4>
<ul>
<li>Paquetes <code>httr</code> y <code>jsonlite</code> instalados</li>
</ul>
<h4 id="codigos-ejemplo">Codigos ejemplo</h4>
<ul>
<li><code>fred_onlylink.R</code> es un ejemplo que descarga y lee el csv directamente del link de la API en una linea.</li>
<li><code>fred_min.R</code> es un ejemplo mínimo que descarga un CSV de fredgraph sin usar la función.</li>
<li><code>fred_example.R</code> es un ejemplo de uso de ambas funciones (<code>fredgraph_api_function</code> y <code>fred_api_function</code>).</li>
</ul>
<h4 id="inputs">Inputs</h4>
<ul>
<li>
<p><strong>fredgraph_api_function</strong></p>
<ul>
<li><code>graphId</code> (Obligatorio): identificador del gráfico compartido en FRED.</li>
</ul>
</li>
<li>
<p><strong>fred_api_function</strong></p>
<ul>
<li><code>series_id</code> (Obligatorio): identificador de la serie (p. ej., <code>&quot;GDP&quot;</code>).</li>
<li>Opcionales: <code>observation_start</code>, <code>observation_end</code>, <code>realtime_start</code>, <code>realtime_end</code>, <code>limit</code>, <code>offset</code>, <code>sort_order</code>, <code>units</code>, <code>frequency</code>, <code>aggregation_method</code>, <code>output_type</code>, <code>vintage_dates</code>, <code>api_key</code>.</li>
</ul>
</li>
</ul>
<h4 id="c%C3%B3mo-elegir-inputs">Cómo elegir inputs</h4>
<ul>
<li>
<p>Para <code>fredgraph_api_function</code>:</p>
<ul>
<li>Obtenga <code>graphId</code> desde el enlace compartido del gráfico (parámetro <code>?g=</code> en la URL).</li>
</ul>
</li>
<li>
<p>Para <code>fred_api_function</code>:</p>
<ol>
<li>Elija <code>series_id</code> (p. ej., <code>GDP</code>, esto suele estar al lado del nombre de la serie en FRED entre paréntesis).</li>
<li>Defina <code>FRED_API_KEY</code> como variable de entorno o pásela como argumento.</li>
<li>Si es necesario, cambie los otros parámetros opcionales.</li>
</ol>
</li>
</ul>
<h4 id="sintaxis-de-la-api">Sintaxis de la API</h4>
<ul>
<li><strong>fredgraph CSV:</strong><pre class="hljs"><code><div>https://fred.stlouisfed.org/graph/fredgraph.csv?g={graphId}
</div></code></pre>
</li>
<li><strong>API v1 observaciones:</strong><pre class="hljs"><code><div>https://api.stlouisfed.org/fred/series/observations?series_id={id}&amp;api_key=...&amp;file_type=json
</div></code></pre>
</li>
</ul>
<h4 id="output">Output</h4>
<ul>
<li><code>data.frame</code> con las observaciones devueltas por cada método.</li>
</ul>
<h4 id="par%C3%A1metros-detallados-fredapifunction">Parámetros detallados (fred_api_function)</h4>
<ul>
<li><code>series_id</code>: p. ej., <code>GDP</code>, <code>CPIAUCSL</code>.</li>
<li><code>observation_start / observation_end</code>: formato <code>YYYY-MM-DD</code>.</li>
<li><code>realtime_start / realtime_end</code>: ventana de tiempo real.</li>
<li><code>limit</code>, <code>offset</code>: para paginación.</li>
<li><code>sort_order</code>: <code>&quot;asc&quot;</code> o <code>&quot;desc&quot;</code>.</li>
<li><code>units</code>: <code>&quot;lin&quot;</code>, <code>&quot;chg&quot;</code>, <code>&quot;ch1&quot;</code>, <code>&quot;pch&quot;</code>, <code>&quot;pc1&quot;</code>, <code>&quot;pca&quot;</code>, <code>&quot;cch&quot;</code>, <code>&quot;cca&quot;</code>, <code>&quot;log&quot;</code>.</li>
<li><code>frequency</code>: <code>&quot;d&quot;</code>, <code>&quot;w&quot;</code>, <code>&quot;bw&quot;</code>, <code>&quot;m&quot;</code>, <code>&quot;q&quot;</code>, <code>&quot;sa&quot;</code>, <code>&quot;a&quot;</code>, etc.</li>
<li><code>aggregation_method</code>: <code>&quot;avg&quot;</code>, <code>&quot;sum&quot;</code>, <code>&quot;eop&quot;</code>.</li>
<li><code>output_type</code>: <code>1</code> (realtime), <code>2</code> (vintages), <code>3</code> (new/revised), <code>4</code> (initial).</li>
<li><code>vintage_dates</code>: fechas separadas por comas.</li>
</ul>
<h4 id="como-conseguir-una-api-key">Como conseguir una API key</h4>
<ul>
<li>Regístrese en FRED, vaya a &quot;API keys&quot; y solicite una key.</li>
<li>Alternativa: use <code>fredgraph_api_function</code> que no requiere key.</li>
</ul>
<h4 id="enlaces-%C3%BAtiles">Enlaces útiles</h4>
<ul>
<li>Referencia oficial: <a href="https://fred.stlouisfed.org/docs/api/fred/series_observations.html">FRED observations API docs</a></li>
</ul>
<h3 id="fredexampler">fred_example.R</h3>
<pre class="hljs"><code><div><span class="hljs-comment"># Ejemplos de uso de funciones FRED</span>
<span class="hljs-keyword">library</span>(httr)
<span class="hljs-keyword">library</span>(jsonlite)

<span class="hljs-comment">#setwd("fred")</span>
<span class="hljs-keyword">source</span>(<span class="hljs-string">"fred_function.R"</span>)

<span class="hljs-comment"># 1) fredgraph (no API key)</span>
df_graph &lt;- fredgraph_api_function(graphId = <span class="hljs-string">"1wmdD"</span>)
write.csv(df_graph, <span class="hljs-string">"fred_graph_example.csv"</span>, row.names = <span class="hljs-literal">FALSE</span>)

<span class="hljs-comment"># 2) API v1 (requiere FRED_API_KEY)</span>
 Sys.setenv(FRED_API_KEY = <span class="hljs-string">"28ee932ab037f5486dae766aebf0bec3"</span>)
df_api &lt;- fred_api_function(series_id = <span class="hljs-string">"GDP"</span>, observation_start = <span class="hljs-literal">NULL</span>, observation_end = <span class="hljs-literal">NULL</span>)
write.csv(df_api, <span class="hljs-string">"fred_api_example.csv"</span>, row.names = <span class="hljs-literal">FALSE</span>)

<span class="hljs-comment"># 2a) API v1 con parametros</span>
df_parameters &lt;- fred_api_function(series_id=<span class="hljs-string">'CPIAUCSL'</span>, observation_start=<span class="hljs-string">'2015-01-01'</span>, units=<span class="hljs-string">'pc1'</span>, frequency=<span class="hljs-string">'m'</span>, aggregation_method=<span class="hljs-string">'avg'</span>, sort_order=<span class="hljs-string">'desc'</span>, limit=<span class="hljs-number">5</span>)

write.csv(df_parameters, <span class="hljs-string">'fred_api_example_params.csv'</span>, row.names=<span class="hljs-literal">FALSE</span>)
</div></code></pre>
<h3 id="fredfunctionr">fred_function.R</h3>
<pre class="hljs"><code><div><span class="hljs-comment"># Funciones para descargar datos de FRED</span>

<span class="hljs-comment"># 1) Método fredgraph (no requiere API key) -&gt; CSV directo de un gráfico compartido</span>
fredgraph_api_function &lt;- <span class="hljs-keyword">function</span>(graphId) {
  url &lt;- <span class="hljs-string">"https://fred.stlouisfed.org/graph/fredgraph.csv"</span>
  res &lt;- httr::GET(url, query = list(g = graphId), httr::accept(<span class="hljs-string">"text/csv"</span>))
  <span class="hljs-keyword">if</span> (httr::http_error(res)) <span class="hljs-keyword">stop</span>(sprintf(<span class="hljs-string">"FRED fredgraph request failed [%s]"</span>, httr::status_code(res)))
  txt &lt;- httr::content(res, as = <span class="hljs-string">"text"</span>, encoding = <span class="hljs-string">"UTF-8"</span>)
  df &lt;- utils::read.csv(text = txt, stringsAsFactors = <span class="hljs-literal">FALSE</span>)
  <span class="hljs-keyword">return</span>(df)
}

<span class="hljs-comment"># 2) Método API v1 (requiere variable de entorno FRED_API_KEY) -&gt; JSON con observaciones</span>
fred_api_function &lt;- <span class="hljs-keyword">function</span>(
  series_id,
  observation_start = <span class="hljs-literal">NULL</span>,
  observation_end = <span class="hljs-literal">NULL</span>,
  realtime_start = <span class="hljs-literal">NULL</span>,
  realtime_end = <span class="hljs-literal">NULL</span>,
  limit = <span class="hljs-literal">NULL</span>,
  offset = <span class="hljs-literal">NULL</span>,
  sort_order = c(<span class="hljs-string">"asc"</span>, <span class="hljs-string">"desc"</span>),
  units = <span class="hljs-literal">NULL</span>,
  frequency = <span class="hljs-literal">NULL</span>,
  aggregation_method = <span class="hljs-literal">NULL</span>,
  output_type = <span class="hljs-literal">NULL</span>,
  vintage_dates = <span class="hljs-literal">NULL</span>,
  api_key = Sys.getenv(<span class="hljs-string">"FRED_API_KEY"</span>, unset = <span class="hljs-literal">NA_character_</span>)
) {
  <span class="hljs-keyword">if</span> (is.na(api_key) || api_key == <span class="hljs-string">""</span>) <span class="hljs-keyword">stop</span>(<span class="hljs-string">"Defina la variable de entorno FRED_API_KEY para usar fred_api_function."</span>)

  <span class="hljs-comment"># Validaciones ligeras según documentación oficial</span>
  <span class="hljs-keyword">if</span> (!is.null(units)) {
    allowed_units &lt;- c(<span class="hljs-string">"lin"</span>, <span class="hljs-string">"chg"</span>, <span class="hljs-string">"ch1"</span>, <span class="hljs-string">"pch"</span>, <span class="hljs-string">"pc1"</span>, <span class="hljs-string">"pca"</span>, <span class="hljs-string">"cch"</span>, <span class="hljs-string">"cca"</span>, <span class="hljs-string">"log"</span>)
    <span class="hljs-keyword">if</span> (!units %<span class="hljs-keyword">in</span>% allowed_units) <span class="hljs-keyword">stop</span>(sprintf(<span class="hljs-string">"Valor de 'units' no válido: %s"</span>, units))
  }
  <span class="hljs-keyword">if</span> (!is.null(frequency)) {
    allowed_freq &lt;- c(<span class="hljs-string">"d"</span>,<span class="hljs-string">"w"</span>,<span class="hljs-string">"bw"</span>,<span class="hljs-string">"m"</span>,<span class="hljs-string">"q"</span>,<span class="hljs-string">"sa"</span>,<span class="hljs-string">"a"</span>,<span class="hljs-string">"wef"</span>,<span class="hljs-string">"weth"</span>,<span class="hljs-string">"wew"</span>,<span class="hljs-string">"wetu"</span>,<span class="hljs-string">"wem"</span>,<span class="hljs-string">"wesu"</span>,<span class="hljs-string">"wesa"</span>,<span class="hljs-string">"bwew"</span>,<span class="hljs-string">"bwem"</span>)
    <span class="hljs-keyword">if</span> (!frequency %<span class="hljs-keyword">in</span>% allowed_freq) <span class="hljs-keyword">stop</span>(sprintf(<span class="hljs-string">"Valor de 'frequency' no válido: %s"</span>, frequency))
  }
  <span class="hljs-keyword">if</span> (!is.null(aggregation_method)) {
    allowed_agg &lt;- c(<span class="hljs-string">"avg"</span>,<span class="hljs-string">"sum"</span>,<span class="hljs-string">"eop"</span>)
    <span class="hljs-keyword">if</span> (!aggregation_method %<span class="hljs-keyword">in</span>% allowed_agg) <span class="hljs-keyword">stop</span>(sprintf(<span class="hljs-string">"Valor de 'aggregation_method' no válido: %s"</span>, aggregation_method))
  }
  <span class="hljs-keyword">if</span> (!is.null(output_type)) {
    output_type &lt;- as.integer(output_type)
    <span class="hljs-keyword">if</span> (!output_type %<span class="hljs-keyword">in</span>% c(<span class="hljs-number">1L</span>,<span class="hljs-number">2L</span>,<span class="hljs-number">3L</span>,<span class="hljs-number">4L</span>)) <span class="hljs-keyword">stop</span>(sprintf(<span class="hljs-string">"Valor de 'output_type' no válido: %s"</span>, output_type))
  }
  sort_order &lt;- match.arg(sort_order)

  url &lt;- <span class="hljs-string">"https://api.stlouisfed.org/fred/series/observations"</span>
  q &lt;- list(
    series_id = series_id,
    api_key = api_key,
    file_type = <span class="hljs-string">"json"</span>
  )
  <span class="hljs-keyword">if</span> (!is.null(observation_start)) q$observation_start &lt;- observation_start
  <span class="hljs-keyword">if</span> (!is.null(observation_end)) q$observation_end &lt;- observation_end
  <span class="hljs-keyword">if</span> (!is.null(realtime_start)) q$realtime_start &lt;- realtime_start
  <span class="hljs-keyword">if</span> (!is.null(realtime_end)) q$realtime_end &lt;- realtime_end
  <span class="hljs-keyword">if</span> (!is.null(limit)) q$limit &lt;- limit
  <span class="hljs-keyword">if</span> (!is.null(offset)) q$offset &lt;- offset
  <span class="hljs-keyword">if</span> (!is.null(sort_order)) q$sort_order &lt;- sort_order
  <span class="hljs-keyword">if</span> (!is.null(units)) q$units &lt;- units
  <span class="hljs-keyword">if</span> (!is.null(frequency)) q$frequency &lt;- frequency
  <span class="hljs-keyword">if</span> (!is.null(aggregation_method)) q$aggregation_method &lt;- aggregation_method
  <span class="hljs-keyword">if</span> (!is.null(output_type)) q$output_type &lt;- output_type
  <span class="hljs-keyword">if</span> (!is.null(vintage_dates)) q$vintage_dates &lt;- vintage_dates

  res &lt;- httr::GET(url, query = q, httr::accept(<span class="hljs-string">"application/json"</span>))
  <span class="hljs-keyword">if</span> (httr::http_error(res)) <span class="hljs-keyword">stop</span>(sprintf(<span class="hljs-string">"FRED API request failed [%s]"</span>, httr::status_code(res)))
  txt &lt;- httr::content(res, as = <span class="hljs-string">"text"</span>, encoding = <span class="hljs-string">"UTF-8"</span>)
  obj &lt;- jsonlite::fromJSON(txt, flatten = <span class="hljs-literal">TRUE</span>)
  <span class="hljs-keyword">if</span> (is.null(obj$observations)) <span class="hljs-keyword">stop</span>(<span class="hljs-string">"Estructura inesperada de la API de FRED; falta 'observations'."</span>)
  <span class="hljs-keyword">return</span>(obj$observations)
}



</div></code></pre>
<h3 id="fredminr">fred_min.R</h3>
<pre class="hljs"><code><div><span class="hljs-comment"># Descargador mínimo FRED (fredgraph CSV)</span>
<span class="hljs-comment">#</span>
<span class="hljs-comment"># Cómo personalizar:</span>
<span class="hljs-comment"># - Cambie 'graphId' por el identificador del gráfico compartido en FRED</span>
<span class="hljs-comment"># - Cambie 'out_file' para definir el nombre del archivo de salida (CSV)</span>

<span class="hljs-keyword">library</span>(httr)

<span class="hljs-comment"># --- Parámetros editables ---</span>
graphId &lt;- <span class="hljs-string">"1wmdD"</span>
output_name &lt;- <span class="hljs-string">"fred_graph_ejemplo"</span>
out_file &lt;- paste0(<span class="hljs-string">"data/"</span>, output_name, <span class="hljs-string">".csv"</span>)

<span class="hljs-comment"># --- Crear directorio de datos si no existe ---</span>
<span class="hljs-keyword">if</span> (!dir.exists(<span class="hljs-string">"data"</span>)) dir.create(<span class="hljs-string">"data"</span>, recursive = <span class="hljs-literal">TRUE</span>, showWarnings = <span class="hljs-literal">FALSE</span>)

<span class="hljs-comment"># --- Descargar archivo CSV ---</span>
url &lt;- <span class="hljs-string">"https://fred.stlouisfed.org/graph/fredgraph.csv"</span>
res &lt;- httr::GET(url, query = list(g = graphId), httr::accept(<span class="hljs-string">"text/csv"</span>))
<span class="hljs-keyword">if</span> (httr::http_error(res)) <span class="hljs-keyword">stop</span>(sprintf(<span class="hljs-string">"FRED fredgraph request failed [%s]"</span>, httr::status_code(res)))
writeBin(httr::content(res, as = <span class="hljs-string">"raw"</span>), out_file)



</div></code></pre>
<h3 id="fredonlylinkr">fred_onlylink.R</h3>
<pre class="hljs"><code><div><span class="hljs-comment"># Minimal FRED API downloader (link only)</span>
df &lt;- read.csv(<span class="hljs-string">"https://fred.stlouisfed.org/graph/fredgraph.csv?g=1wmdD"</span>)


</div></code></pre>
<h2 id="imf">IMF</h2>
<h3 id="gu%C3%ADa-r%C3%A1pida-fmi-con-r">Guía rápida: FMI con R</h3>
<p>Este documento explica cómo usar la función en <code>imf/imf_function.R</code> para descargar datos del FMI (servicio SDMX-JSON CompactData) y obtenerlos como un data frame en R.</p>
<h4 id="requisitos">Requisitos</h4>
<ul>
<li>Paquetes <code>httr</code> y <code>jsonlite</code> instalados</li>
</ul>
<h4 id="codigos-ejemplo">Codigos ejemplo</h4>
<ul>
<li><code>imf_onlylink.R</code>: ejemplo que descarga y lee el csv directamente del link de la API en una linea (usando <code>rsdmx</code>).</li>
<li><code>imf_min.R</code>: ejemplo mínimo que descarga y guarda CSV sin usar la función <code>imf_api_function</code>.</li>
<li><code>imf_example.R</code>: ejemplo de uso de la función <code>imf_api_function</code> y guardado de CSV.</li>
</ul>
<h4 id="inputs">Inputs</h4>
<ul>
<li>
<p><strong>Obligatorios</strong></p>
<ul>
<li><code>dataset</code>: identificador del dataset SDMX del FMI, p. ej., &quot;IFS&quot; (International Financial Statistics).</li>
<li><code>key</code>: clave SDMX con dimensiones concatenadas por punto <code>.</code>. El patrón típico en IFS es <code>Frecuencia.País.Indicador</code> (p. ej., &quot;M.ES.PCPI_IX&quot;).</li>
</ul>
</li>
<li>
<p><strong>Opcionales</strong></p>
<ul>
<li><code>startPeriod</code>, <code>endPeriod</code>: límites de periodo (p. ej., &quot;2018&quot;, &quot;2023&quot;).</li>
</ul>
</li>
</ul>
<h4 id="c%C3%B3mo-elegir-inputs">Cómo elegir inputs</h4>
<ol>
<li>Localice el dataset y el indicador en el portal del FMI o en la documentación de SDMX.</li>
<li>Construya la <code>key</code> con las dimensiones requeridas por el dataset. En IFS suele ser <code>FREQ.REF_AREA.INDICATOR</code>.</li>
<li>Use <code>startPeriod</code> y <code>endPeriod</code> para acotar el periodo temporal si lo necesita.</li>
</ol>
<h4 id="sintaxis-de-la-api-fmi-sdmx-compactdata">Sintaxis de la API (FMI SDMX CompactData)</h4>
<ul>
<li><strong>Formato general:</strong><pre class="hljs"><code><div>https://api.imf.org/external/sdmx/3.0/data/{context}/{agencyID}/{resourceID}/{version}/{key}[?c][&amp;updatedAfter][&amp;firstNObservations][&amp;lastNObservations][&amp;dimensionAtObservation][&amp;attributes][&amp;measures][&amp;includeHistory][&amp;asOf]
</div></code></pre>
Referencia al servicio SDMX JSON del FMI: <code>https://dataservices.imf.org/REST/SDMX_JSON.svc</code></li>
</ul>
<h4 id="output">Output</h4>
<ul>
<li>Un <code>data.frame</code> con columnas de dimensiones devueltas por la serie (por ejemplo <code>FREQ</code>, <code>REF_AREA</code>, <code>INDICATOR</code> si están presentes en la respuesta), más <code>TIME_PERIOD</code> y <code>OBS_VALUE</code>.</li>
</ul>
<h4 id="enlaces-%C3%BAtiles">Enlaces útiles</h4>
<ul>
<li>Conocimiento/soporte del FMI (categoría API/SDMX): https://datasupport.imf.org/knowledge?id=knowledge_category&amp;sys_kb_id=d41858e747294ad8805d07c4f16d43e0&amp;category_id=9959b2bc1b6391903dba646fbd4bcb6a</li>
</ul>
<h3 id="imfexampler">imf_example.R</h3>
<pre class="hljs"><code><div><span class="hljs-comment"># Ejemplo de uso de la función imf_sdmx3_api_function</span>
<span class="hljs-comment"># Cómo personalizar:</span>
<span class="hljs-comment"># - Cambiar agency_identifier, dataset_identifier y dataset_version para seleccionar el dataset.</span>
<span class="hljs-comment"># - Cambiar data_selection para seleccionar las dimensiones del dataset. Buscar los datos en la web de IMF. Pinchar en ver el id de los valores y remplazar en el orden que aparecen las variables.</span>
<span class="hljs-comment"># - Cambiar filter_date para seleccionar las fechas del dataset.</span>
<span class="hljs-comment"># - Cambiar params para seleccionar los parámetros de la consulta.</span>
<span class="hljs-comment"># - Cambiar output_name para definir el nombre del archivo de salida.</span>

setwd(<span class="hljs-string">"R/imf"</span>)
<span class="hljs-keyword">library</span>(httr)

<span class="hljs-comment"># Asegurar ruta correcta al ejecutar desde la raíz del repo</span>
<span class="hljs-keyword">source</span>(<span class="hljs-string">"imf_function.R"</span>)

<span class="hljs-comment"># Ejemplo: PIB trimestral SA, precios corrientes (XDC) para España y Francia desde 2020-Q1 a 2020-Q4</span>
df &lt;- imf_api_function(
  dataset_identifier = <span class="hljs-string">"QNEA"</span>,
  data_selection = <span class="hljs-string">"ESP+FRA.B1GQ.Q.SA.XDC.Q"</span>,
  filters = list(
    TIME_PERIOD = c(<span class="hljs-string">"ge:2020-Q1"</span>, <span class="hljs-string">"le:2020-Q4"</span>)
  )
)

utils::write.csv(df, <span class="hljs-string">"imf_example.csv"</span>, row.names = <span class="hljs-literal">FALSE</span>)



</div></code></pre>
<h3 id="imffunctionr">imf_function.R</h3>
<pre class="hljs"><code><div><span class="hljs-comment"># Función mínima para descargar datos del FMI (SDMX 3.0 → SDMX-CSV 1.0)</span>
<span class="hljs-comment"># Inspirada en eurostat_function.R, usando el flujo de imf_min.R</span>
<span class="hljs-comment">#</span>
<span class="hljs-comment"># Inputs obligatorios:</span>
<span class="hljs-comment"># - dataset_identifier: identificador del dataset (p. ej., "QNEA")</span>
<span class="hljs-comment"># - data_selection: clave SDMX (orden y códigos según el dataset), p. ej.,</span>
<span class="hljs-comment">#   "ESP.B1GQ.Q.SA.XDC.Q" o con múltiples países "ESP+FRA.B1GQ.Q.SA.XDC.Q".</span>
<span class="hljs-comment">#</span>
<span class="hljs-comment"># Inputs opcionales:</span>
<span class="hljs-comment"># - agency_identifier: p. ej., "IMF.STA"</span>
<span class="hljs-comment"># - dataset_version: p. ej., "+" (última versión)</span>
<span class="hljs-comment"># - filters: lista de filtros SDMX como c[TIME_PERIOD] = "ge:2020-Q1+le:2020-Q4".</span>
<span class="hljs-comment">#            Páselos como list(TIME_PERIOD = c("ge:2020-Q1","le:2020-Q4"))</span>
<span class="hljs-comment">#            Se convertirán a query params tipo c[TIME_PERIOD]="ge:...+le:...".</span>
<span class="hljs-comment"># - accept_csv_version: versión del formato SDMX-CSV (por defecto "1.0.0")</span>
<span class="hljs-comment">#</span>
<span class="hljs-comment"># Output:</span>
<span class="hljs-comment"># - data.frame leído de la respuesta CSV</span>

imf_api_function &lt;- <span class="hljs-keyword">function</span>(
  dataset_identifier,
  data_selection,
  filters = list(),
  agency_identifier = <span class="hljs-string">"IMF.STA"</span>,
  dataset_version = <span class="hljs-string">"+"</span>,
  accept_csv_version = <span class="hljs-string">"1.0.0"</span>
) {
  base_url &lt;- <span class="hljs-string">"https://api.imf.org/external/sdmx/3.0/data/dataflow"</span>

  <span class="hljs-comment"># Construir ruta completa: {base}/{agency}/{dataset}/{version}/{key}</span>
  <span class="hljs-comment"># Codificamos cuidadosamente la versión ('+' -&gt; %2B) y la clave</span>
  url &lt;- paste0(
    base_url, <span class="hljs-string">"/"</span>,
    agency_identifier, <span class="hljs-string">"/"</span>,
    dataset_identifier, <span class="hljs-string">"/"</span>,
    utils::URLencode(dataset_version, reserved = <span class="hljs-literal">TRUE</span>), <span class="hljs-string">"/"</span>,
    utils::URLencode(data_selection, reserved = <span class="hljs-literal">TRUE</span>)
  )

  <span class="hljs-comment"># Construir filtros como c[DIM]=v1+v2 (TIME_PERIOD ge/le, etc.)</span>
  <span class="hljs-keyword">if</span> (!is.list(filters)) <span class="hljs-keyword">stop</span>(<span class="hljs-string">"'filters' debe ser una lista nombrada de dimensiones -&gt; valores"</span>)
  filter_params &lt;- list()
  <span class="hljs-keyword">if</span> (length(filters)) {
    <span class="hljs-keyword">for</span> (nm <span class="hljs-keyword">in</span> names(filters)) {
      vals &lt;- filters[[nm]]
      <span class="hljs-keyword">if</span> (is.null(vals) || length(vals) == <span class="hljs-number">0</span>) <span class="hljs-keyword">next</span>
      <span class="hljs-comment"># Join con '+' (IMF acepta ge:...+le:... y múltiples valores con '+')</span>
      filter_params[[paste0(<span class="hljs-string">"c["</span>, nm, <span class="hljs-string">"]"</span>)]] &lt;- paste(vals, collapse = <span class="hljs-string">"+"</span>)
    }
  }

  headers &lt;- httr::add_headers(
    `Cache-Control` = <span class="hljs-string">"no-cache"</span>,
    Accept = paste0(<span class="hljs-string">"application/vnd.sdmx.data+csv;version="</span>, accept_csv_version)
  )

  res &lt;- httr::GET(url, query = filter_params, headers, httr::config(ssl_verifypeer = <span class="hljs-number">0L</span>, ssl_verifyhost = <span class="hljs-number">0L</span>))
  <span class="hljs-keyword">if</span> (httr::http_error(res)) <span class="hljs-keyword">stop</span>(sprintf(<span class="hljs-string">"IMF request failed [%s]"</span>, httr::status_code(res)))

  txt &lt;- httr::content(res, as = <span class="hljs-string">"text"</span>, encoding = <span class="hljs-string">"UTF-8"</span>)
  df &lt;- utils::read.csv(text = txt, stringsAsFactors = <span class="hljs-literal">FALSE</span>)
  <span class="hljs-keyword">return</span>(df)
}



</div></code></pre>
<h3 id="imfminr">imf_min.R</h3>
<pre class="hljs"><code><div><span class="hljs-comment">## Descargador mínimo de IMF SDMX 3.0 (CSV)</span>
<span class="hljs-comment"># Cómo personalizar:</span>
<span class="hljs-comment"># - Cambiar agency_identifier, dataset_identifier y dataset_version para seleccionar el dataset.</span>
<span class="hljs-comment"># - Cambiar data_selection para seleccionar las dimensiones del dataset. Buscar los datos en la web de IMF. Pinchar en ver el id de los valores y remplazar en el orden que aparecen las variables.</span>
<span class="hljs-comment"># - Cambiar filter_date para seleccionar las fechas del dataset.</span>
<span class="hljs-comment"># - Cambiar params para seleccionar los parámetros de la consulta.</span>
<span class="hljs-comment"># - Cambiar output_name para definir el nombre del archivo de salida.</span>

<span class="hljs-keyword">library</span>(httr)

<span class="hljs-comment">#setwd("R/imf")</span>
<span class="hljs-comment">#Request</span>
<span class="hljs-comment">#https://api.imf.org/external/sdmx/3.0/data/{context}/{agencyID}/{resourceID}/{version}/{key}[?c][&amp;updatedAfter][&amp;firstNObservations][&amp;lastNObservations][&amp;dimensionAtObservation][&amp;attributes][&amp;measures][&amp;includeHistory][&amp;asOf]</span>

<span class="hljs-comment">########################################################</span>
<span class="hljs-comment"># --- Parámetros editables ---</span>
<span class="hljs-comment">########################################################</span>
<span class="hljs-comment"># URL base de la API</span>
base_url &lt;- <span class="hljs-string">"https://api.imf.org/external/sdmx/3.0/data/dataflow/"</span>

<span class="hljs-comment"># Identificadores de dataset</span>
agency_identifier &lt;- <span class="hljs-string">"IMF.STA"</span>
dataset_identifier &lt;- <span class="hljs-string">"QNEA"</span>
dataset_version &lt;- <span class="hljs-string">"+"</span>                       <span class="hljs-comment"># '+' for latest version</span>

<span class="hljs-comment"># Variables de la consulta (separar por + varios valores o usar '*')</span>
<span class="hljs-comment"># Use el key para filtrar país(es) y evite c[COUNTRY] si el servidor lo ignora</span>
data_selection &lt;- <span class="hljs-string">"ESP+FRA.B1GQ.Q.SA.XDC.Q"</span>      <span class="hljs-comment"># COUNTRY.INDICATOR.PRICE_TYPE.S_ADJUSTMENT.TYPE_OF_TRANSFORMATION.FREQUENCY</span>

<span class="hljs-comment"># Filtro de fecha (puede contener múltiples condiciones unidas con '+')</span>
<span class="hljs-comment"># Ejemplo mensual: ge:2020-01+le:2020-12</span>
<span class="hljs-comment"># Ejemplo trimestral: ge:2020-Q1+le:2020-Q4</span>
filter_date &lt;- list(
  TIME_PERIOD = c(<span class="hljs-string">"ge:2020-Q1"</span>, <span class="hljs-string">"le:2020-Q4"</span>))

<span class="hljs-comment"># Parametros de la consulta</span>
params &lt;- list(
  dimensionAtObservation = <span class="hljs-string">"TIME_PERIOD"</span>,  <span class="hljs-comment"># At the observation level</span>
  attributes = <span class="hljs-string">"dsd"</span>,                      <span class="hljs-comment"># Data Structure Definition</span>
  measures = <span class="hljs-string">"all"</span>,                        <span class="hljs-comment"># All measures</span>
  includeHistory = <span class="hljs-string">"false"</span>                 <span class="hljs-comment"># No history</span>
)

<span class="hljs-comment"># Nombre del archivo de salida</span>
output_name &lt;- <span class="hljs-string">"imf_min.csv"</span>

<span class="hljs-comment">########################################################</span>
<span class="hljs-comment"># -- Construir la URL y query ---</span>
<span class="hljs-comment">########################################################</span>
<span class="hljs-comment"># -- Construir la URL ---</span>
full_url &lt;- paste0(
  base_url,
  agency_identifier, <span class="hljs-string">"/"</span>,
  dataset_identifier, <span class="hljs-string">"/"</span>,
  utils::URLencode(dataset_version, reserved = <span class="hljs-literal">TRUE</span>), <span class="hljs-string">"/"</span>,
  utils::URLencode(data_selection, reserved = <span class="hljs-literal">TRUE</span>)
)

<span class="hljs-comment"># -- Construir la query ---</span>
query &lt;- params
<span class="hljs-keyword">if</span> (length(filter_date)) {
  <span class="hljs-keyword">for</span> (nm <span class="hljs-keyword">in</span> names(filter_date)) {
    vals &lt;- filter_date[[nm]]
    <span class="hljs-keyword">if</span> (is.null(vals) || length(vals) == <span class="hljs-number">0</span>) <span class="hljs-keyword">next</span>
    query[[sprintf(<span class="hljs-string">"c[%s]"</span>, nm)]] &lt;- paste(vals, collapse = <span class="hljs-string">"+"</span>)
  }
}

<span class="hljs-comment"># -- Construir los headers ---</span>
headers &lt;- httr::add_headers(
  `Cache-Control` = <span class="hljs-string">"no-cache"</span>,
  Accept = <span class="hljs-string">"application/vnd.sdmx.data+csv;version=1.0.0, text/csv"</span>
)

<span class="hljs-comment">########################################################</span>
<span class="hljs-comment"># -- Hacer la petición ---</span>
<span class="hljs-comment">########################################################</span>
res &lt;- httr::GET(full_url, query = query, headers, httr::config(ssl_verifypeer = <span class="hljs-number">0L</span>, ssl_verifyhost = <span class="hljs-number">0L</span>))
httr::stop_for_status(res)

<span class="hljs-comment">########################################################</span>
<span class="hljs-comment"># -- Guardar el resultado ---</span>
<span class="hljs-comment">########################################################</span>
txt &lt;- httr::content(res, as = <span class="hljs-string">"text"</span>, encoding = <span class="hljs-string">"UTF-8"</span>)
df &lt;- read.csv(text = txt, stringsAsFactors = <span class="hljs-literal">FALSE</span>)
utils::write.csv(df, output_name, row.names = <span class="hljs-literal">FALSE</span>, na = <span class="hljs-string">""</span>)




</div></code></pre>
<h3 id="imfonlylinkr">imf_onlylink.R</h3>
<pre class="hljs"><code><div><span class="hljs-comment"># Minimal IMF API downloader (link only). Notice is a xml file, not a csv file.</span>
<span class="hljs-comment"># Requires: install.packages("rsdmx")</span>
<span class="hljs-keyword">library</span>(rsdmx)
<span class="hljs-comment"># Disable SSL verification for this session if you encounter certificate errors</span>
httr::set_config(httr::config(ssl_verifypeer = <span class="hljs-number">0L</span>, ssl_verifyhost = <span class="hljs-number">0L</span>))
df &lt;- as.data.frame(readSDMX(<span class="hljs-string">"https://api.imf.org/external/sdmx/3.0/data/dataflow/IMF.STA/QNEA/%2B/ESP%2BFRA.B1GQ.Q.SA.XDC.Q"</span>))



</div></code></pre>
<h2 id="ine">INE</h2>
<h3 id="gu%C3%ADa-r%C3%A1pida-ine-jaxit3-con-r">Guía rápida: INE JAXIT3 con R</h3>
<p>Este documento explica cómo usar la función en <code>ine/ine_jaxi_function.R</code> para descargar datos desde la API de INE JAXIT3 en formato CSV y obtenerlos como un data frame en R.</p>
<h4 id="requisitos">Requisitos</h4>
<ul>
<li>Paquete <code>httr</code> instalado (<code>install.packages(&quot;httr&quot;)</code> si fuera necesario)</li>
</ul>
<h4 id="codigos-ejemplo">Codigos ejemplo</h4>
<ul>
<li><code>ine_jaxi_onlylink.R</code> es un ejemplo que descarga y lee el csv directamente del link de la API en una linea.</li>
<li><code>ine_jaxi_min.R</code> es un ejemplo mínimo para descargar datos del INE sin usar la función <code>ine_jaxi_api_function</code>.</li>
<li><code>ine_jaxi_example.R</code> es un ejemplo de uso de la función <code>ine_jaxi_api_function</code>.</li>
</ul>
<h4 id="inputs">Inputs</h4>
<ul>
<li>
<p><strong>Obligatorios</strong></p>
<ul>
<li><code>tableId</code>: identificador de la tabla INE (p. ej., <code>&quot;67821&quot;</code>).</li>
</ul>
</li>
<li>
<p><strong>Opcionales</strong></p>
<ul>
<li><code>nocab</code>: <code>&quot;1&quot;</code> para evitar cabeceras adicionales (recomendado).</li>
<li><code>directory</code>: segmento de directorio (por defecto <code>&quot;t&quot;</code>).</li>
<li><code>locale</code>: idioma del recurso (por defecto <code>&quot;es&quot;</code>).</li>
<li><code>variant</code>: variante del CSV (por defecto <code>&quot;csv_bdsc&quot;</code>).</li>
</ul>
</li>
</ul>
<h4 id="c%C3%B3mo-elegir-inputs">Cómo elegir inputs</h4>
<ol>
<li>Vaya a la página de la tabla en INE y copie el identificador (número al final de la URL).</li>
<li>Use ese identificador como <code>tableId</code>.</li>
<li>Ajuste parámetros opcionales (<code>nocab</code>, <code>locale</code>, <code>variant</code>, <code>directory</code>) si es necesario.</li>
<li>Si necesita cabeceras compactas para procesamiento, mantenga <code>nocab = &quot;1&quot;</code>.</li>
</ol>
<h4 id="sintaxis-de-la-api-ine-jaxit3">Sintaxis de la API (INE JAXIT3)</h4>
<ul>
<li>
<p><strong>Formato general:</strong></p>
<pre class="hljs"><code><div>https://www.ine.es/jaxiT3/files/{directory}/{locale}/{variant}/{tableId}.csv?nocab={nocab}
</div></code></pre>
<p>Donde el Host URL es <code>https://www.ine.es/jaxiT3/files</code>.</p>
</li>
<li>
<p><strong>Ejemplo:</strong></p>
<pre class="hljs"><code><div>https://www.ine.es/jaxiT3/files/t/es/csv_bdsc/67821.csv?nocab=1
</div></code></pre>
</li>
</ul>
<h4 id="output">Output</h4>
<ul>
<li>Un <code>data.frame</code> con los datos descargados desde INE JAXIT3.</li>
</ul>
<h4 id="notas">Notas</h4>
<ul>
<li>Si la API devuelve error, verifique que el <code>tableId</code> exista y sea accesible.</li>
</ul>
<h4 id="enlaces-%C3%BAtiles">Enlaces útiles</h4>
<ul>
<li>INE (Banco de datos JAXIT3): https://www.ine.es/</li>
</ul>
<h3 id="inejaxiexampler">ine_jaxi_example.R</h3>
<pre class="hljs"><code><div><span class="hljs-comment"># Ejemplo de uso de la función ine_jaxi_api_function</span>
<span class="hljs-keyword">library</span>(httr)

<span class="hljs-comment">#setwd("ine")</span>
<span class="hljs-keyword">source</span>(<span class="hljs-string">"ine_jaxi_function.R"</span>)

<span class="hljs-comment"># Ejemplo de uso</span>
df &lt;- ine_jaxi_api_function(
  tableId = <span class="hljs-string">"67821"</span>,
  nocab = <span class="hljs-string">"1"</span>
)

write.csv(df, <span class="hljs-string">"ine_jaxi_example.csv"</span>, row.names = <span class="hljs-literal">FALSE</span>)



</div></code></pre>
<h3 id="inejaxifunctionr">ine_jaxi_function.R</h3>
<pre class="hljs"><code><div><span class="hljs-comment"># Función mínima para descargar datos INE JAXIT3 (CSV)</span>

<span class="hljs-comment"># Inputs obligatorios:</span>
<span class="hljs-comment"># - tableId: identificador de la tabla INE (p.ej., "67821")</span>
<span class="hljs-comment">#</span>
<span class="hljs-comment"># Inputs opcionales:</span>
<span class="hljs-comment"># - nocab: controla cabecera ("1" evita cabeceras adicionales)</span>
<span class="hljs-comment"># - directory: segmento de directorio (por defecto "t")</span>
<span class="hljs-comment"># - locale: idioma (por defecto "es")</span>
<span class="hljs-comment"># - variant: variante de CSV (por defecto "csv_bdsc")</span>
<span class="hljs-comment">#</span>
<span class="hljs-comment"># Output:</span>
<span class="hljs-comment"># - df: data.frame con los datos descargados</span>

ine_jaxi_api_function &lt;- <span class="hljs-keyword">function</span>(
  tableId,
  nocab = <span class="hljs-string">"1"</span>,
  directory = <span class="hljs-string">"t"</span>,
  locale = <span class="hljs-string">"es"</span>,
  variant = <span class="hljs-string">"csv_bdsc"</span>
) {
  base_url &lt;- <span class="hljs-string">"https://www.ine.es/jaxiT3/files"</span>
  url &lt;- paste0(base_url, <span class="hljs-string">"/"</span>, directory, <span class="hljs-string">"/"</span>, locale, <span class="hljs-string">"/"</span>, variant, <span class="hljs-string">"/"</span>, tableId, <span class="hljs-string">".csv"</span>)

  res &lt;- httr::GET(url, query = list(nocab = nocab), httr::accept(<span class="hljs-string">"text/csv"</span>))
  <span class="hljs-keyword">if</span> (httr::http_error(res)) <span class="hljs-keyword">stop</span>(sprintf(<span class="hljs-string">"INE JAXIT3 request failed [%s]"</span>, httr::status_code(res)))

  txt &lt;- httr::content(res, as = <span class="hljs-string">"text"</span>, encoding = <span class="hljs-string">"UTF-8"</span>)
  df &lt;- utils::read.csv(text = txt, stringsAsFactors = <span class="hljs-literal">FALSE</span>, sep = <span class="hljs-string">";"</span>)
  <span class="hljs-keyword">return</span>(df)
}



</div></code></pre>
<h3 id="inejaximinr">ine_jaxi_min.R</h3>
<pre class="hljs"><code><div><span class="hljs-comment"># Descargador mínimo INE JAXIT3 (CSV)</span>
<span class="hljs-comment">#</span>
<span class="hljs-comment"># Cómo personalizar:</span>
<span class="hljs-comment"># - Cambie 'tableId' por la tabla objetivo. </span>
<span class="hljs-comment"># - Mantenga o quite 'nocab=1' según si desea cabeceras sin etiquetas</span>
<span class="hljs-comment"># - Cambie 'out_file' para definir el nombre del archivo de salida</span>

<span class="hljs-keyword">library</span>(httr)

<span class="hljs-comment"># --- Parámetros editables ---</span>
tableId &lt;- <span class="hljs-string">"67821"</span>      <span class="hljs-comment"># Ejemplo de ID de tabla (el numero al final de la url en ine.es)</span>
nocab &lt;- <span class="hljs-string">"1"</span>            <span class="hljs-comment"># "1" para evitar cabeceras adicionales</span>
output_name &lt;- <span class="hljs-string">"ine_ejemplo"</span>

<span class="hljs-comment"># --- Crear directorio de datos si no existe ---</span>
out_file &lt;- paste0(<span class="hljs-string">"data/"</span>, output_name, <span class="hljs-string">".csv"</span>)
<span class="hljs-keyword">if</span> (!dir.exists(<span class="hljs-string">"data"</span>)) dir.create(<span class="hljs-string">"data"</span>, recursive = <span class="hljs-literal">TRUE</span>, showWarnings = <span class="hljs-literal">FALSE</span>)

<span class="hljs-comment"># --- Descargar archivo CSV ---</span>
url &lt;- paste0(<span class="hljs-string">"https://www.ine.es/jaxiT3/files/t/es/csv_bdsc/"</span>, tableId, <span class="hljs-string">".csv"</span>)
res &lt;- httr::GET(url, query = list(nocab = nocab), httr::accept(<span class="hljs-string">"text/csv"</span>))
<span class="hljs-keyword">if</span> (httr::http_error(res)) <span class="hljs-keyword">stop</span>(sprintf(<span class="hljs-string">"INE JAXIT3 request failed [%s]"</span>, httr::status_code(res)))
writeBin(httr::content(res, as = <span class="hljs-string">"raw"</span>), out_file)



</div></code></pre>
<h3 id="inejaxionlylinkr">ine_jaxi_onlylink.R</h3>
<pre class="hljs"><code><div><span class="hljs-comment"># Minimal INE JAXIT3 API downloader (link only)</span>
df &lt;- read.csv(<span class="hljs-string">"https://www.ine.es/jaxiT3/files/t/es/csv_bdsc/67821.csv?nocab=1"</span>, encoding = <span class="hljs-string">"UTF-8"</span>)


</div></code></pre>
<h2 id="ineapir">INEAPIR</h2>
<!-- README.md is generated from README.Rmd. Please edit that file -->
<h3 id="ineapir-img-src%22manfigureshexlogopng%22-align%22right%22-width--%22120%22-alt--%22ineapir-logo%22">ineapir <img src="man/figures/hex_logo.png" align="right" width = "120" alt = "ineapir logo"/></h3>
<!-- badges: start -->
<p><a href="https://github.com/es-ine/ineapir/actions/workflows/R-CMD-check.yaml"><img src="https://github.com/es-ine/ineapir/actions/workflows/R-CMD-check.yaml/badge.svg" alt="R-CMD-check"></a></p>
<!-- badges: end -->
<h4 id="overview">Overview</h4>
<p>ineapir provides a set of functions to obtain open data and metadata
published by the National Statistics Institute of Spain
(<a href="https://www.ine.es/en/index.htm">INE</a>). The data is obtained thanks to
calls to the INE API service which allows access via URL requests to the
available statistical information published by INE.</p>
<h4 id="installation">Installation</h4>
<p>Install the released version of <strong>ineapir</strong> from CRAN:</p>
<pre class="hljs"><code><div>install.packages(<span class="hljs-string">"ineapir"</span>)
</div></code></pre>
<p>To install the development version of <strong>ineapir</strong> from GitHub:</p>
<pre class="hljs"><code><div>remotes::install_github(<span class="hljs-string">"es-ine/ineapir"</span>)
</div></code></pre>
<p>Alternatively, you can download the source code as a zip file and then
install it as follows:</p>
<pre class="hljs"><code><div>remotes::install_local(path = <span class="hljs-string">"path/to/file.zip"</span>)
</div></code></pre>
<h4 id="cheatsheet">Cheatsheet</h4>
<p><a href="https://raw.githubusercontent.com/es-ine/ineapir/main/man/figures/ineapir.pdf"><img src="man/figures/ineapir_thumbnail.png" width="315" alt = "Cheatsheet"/></a></p>
<h4 id="data-request-examples">Data request examples</h4>
<p>The data is only associated with the series object and these can be
grouped together into statistical tables. The field named ‘<em>Valor</em>’ is
the only one that contains data. The rest of the fields are necessary
for the data to be well defined.</p>
<h5 id="obtaining-data-from-a-table">Obtaining data from a table</h5>
<p>To get all the data of a table it is necessary to pass the <code>idTable</code>
argument, which is the identification code of the table, to the function
<code>get_data_table()</code>.</p>
<pre class="hljs"><code><div><span class="hljs-keyword">library</span>(ineapir)

<span class="hljs-comment"># We use the function get_data_table with the argument idTable</span>
<span class="hljs-comment"># and the argument tip = 'A' for a more friendly output</span>
table &lt;- get_data_table(idTable = <span class="hljs-number">50902</span>, tip = <span class="hljs-string">"A"</span>)

<span class="hljs-comment"># Each row represents a series</span>
table[<span class="hljs-number">1</span>,c(<span class="hljs-string">"COD"</span>, <span class="hljs-string">"Nombre"</span>)]
<span class="hljs-comment">#&gt;         COD                                   Nombre</span>
<span class="hljs-comment">#&gt; 1 IPC251852 Total Nacional. Índice general. Índice.</span>

<span class="hljs-comment"># The Data column contains a data frame for each row with the values </span>
<span class="hljs-comment"># of the different periods of each series</span>
head(table$Data[[<span class="hljs-number">1</span>]])
<span class="hljs-comment">#&gt;                           Fecha T3_TipoDato T3_Periodo Anyo   Valor</span>
<span class="hljs-comment">#&gt; 1 2025-07-01T00:00:00.000+02:00  Definitivo        M07 2025 118.777</span>
<span class="hljs-comment">#&gt; 2 2025-06-01T00:00:00.000+02:00  Definitivo        M06 2025 118.867</span>
<span class="hljs-comment">#&gt; 3 2025-05-01T00:00:00.000+02:00  Definitivo        M05 2025 118.077</span>
<span class="hljs-comment">#&gt; 4 2025-04-01T00:00:00.000+02:00  Definitivo        M04 2025 117.997</span>
<span class="hljs-comment">#&gt; 5 2025-03-01T00:00:00.000+01:00  Definitivo        M03 2025 117.260</span>
<span class="hljs-comment">#&gt; 6 2025-02-01T00:00:00.000+01:00  Definitivo        M02 2025 117.191</span>

<span class="hljs-comment"># We can concatenate all data frames into one using unnest = TRUE</span>
table &lt;- get_data_table(idTable = <span class="hljs-number">50902</span>, tip = <span class="hljs-string">"A"</span>, unnest = <span class="hljs-literal">TRUE</span>)
head(table[,c(<span class="hljs-string">"COD"</span>, <span class="hljs-string">"Nombre"</span>, <span class="hljs-string">"Fecha"</span>, <span class="hljs-string">"Valor"</span>)])
<span class="hljs-comment">#&gt;           COD                                   Nombre</span>
<span class="hljs-comment">#&gt; 1   IPC251852 Total Nacional. Índice general. Índice. </span>
<span class="hljs-comment">#&gt; 1.1 IPC251852 Total Nacional. Índice general. Índice. </span>
<span class="hljs-comment">#&gt; 1.2 IPC251852 Total Nacional. Índice general. Índice. </span>
<span class="hljs-comment">#&gt; 1.3 IPC251852 Total Nacional. Índice general. Índice. </span>
<span class="hljs-comment">#&gt; 1.4 IPC251852 Total Nacional. Índice general. Índice. </span>
<span class="hljs-comment">#&gt; 1.5 IPC251852 Total Nacional. Índice general. Índice. </span>
<span class="hljs-comment">#&gt;                             Fecha   Valor</span>
<span class="hljs-comment">#&gt; 1   2025-07-01T00:00:00.000+02:00 118.777</span>
<span class="hljs-comment">#&gt; 1.1 2025-06-01T00:00:00.000+02:00 118.867</span>
<span class="hljs-comment">#&gt; 1.2 2025-05-01T00:00:00.000+02:00 118.077</span>
<span class="hljs-comment">#&gt; 1.3 2025-04-01T00:00:00.000+02:00 117.997</span>
<span class="hljs-comment">#&gt; 1.4 2025-03-01T00:00:00.000+01:00 117.260</span>
<span class="hljs-comment">#&gt; 1.5 2025-02-01T00:00:00.000+01:00 117.191</span>
</div></code></pre>
<p>To get the last n data from a table it is necessary to pass the <code>nlast</code>
argument as well.</p>
<pre class="hljs"><code><div><span class="hljs-comment"># We use the function get_data_table with arguments idTable and nlast</span>
table &lt;- get_data_table(idTable = <span class="hljs-number">50902</span>, nlast = <span class="hljs-number">2</span>)
table[<span class="hljs-number">1</span>,c(<span class="hljs-string">"COD"</span>, <span class="hljs-string">"Nombre"</span>)]
<span class="hljs-comment">#&gt;         COD                                   Nombre</span>
<span class="hljs-comment">#&gt; 1 IPC251852 Total Nacional. Índice general. Índice.</span>
head(table$Data[[<span class="hljs-number">1</span>]])
<span class="hljs-comment">#&gt;          Fecha FK_TipoDato FK_Periodo Anyo   Valor Secreto</span>
<span class="hljs-comment">#&gt; 1 1.751321e+12           1          7 2025 118.777   FALSE</span>
</div></code></pre>
<h5 id="obtaining-data-from-a-series">Obtaining data from a series</h5>
<p>To get the last data of a series it is necessary to pass the <code>codSeries</code>
argument, which is the identification code of the series, to the
function <code>get_data_series()</code>.</p>
<pre class="hljs"><code><div><span class="hljs-comment"># We use the function get_data_series with the argument codSeries</span>
series &lt;- get_data_series(codSeries = <span class="hljs-string">"IPC251856"</span>, tip = <span class="hljs-string">"A"</span>)
series$Data
<span class="hljs-comment">#&gt;                           Fecha T3_TipoDato T3_Periodo Anyo Valor</span>
<span class="hljs-comment">#&gt; 1 2025-08-01T00:00:00.000+02:00      Avance        M08 2025   2.7</span>
</div></code></pre>
<p>To get the last n data from a series it is necessary to pass the <code>nlast</code>
argument as well.</p>
<pre class="hljs"><code><div><span class="hljs-comment"># We use the function get_data_series with arguments codSeries and nlast</span>
series &lt;- get_data_series(codSeries = <span class="hljs-string">"IPC251856"</span>, tip = <span class="hljs-string">"A"</span>, nlast = <span class="hljs-number">5</span>)
series$Data
<span class="hljs-comment">#&gt;                           Fecha T3_TipoDato T3_Periodo Anyo Valor</span>
<span class="hljs-comment">#&gt; 1 2025-04-01T00:00:00.000+02:00  Definitivo        M04 2025   2.2</span>
<span class="hljs-comment">#&gt; 2 2025-05-01T00:00:00.000+02:00  Definitivo        M05 2025   2.0</span>
<span class="hljs-comment">#&gt; 3 2025-06-01T00:00:00.000+02:00  Definitivo        M06 2025   2.3</span>
<span class="hljs-comment">#&gt; 4 2025-07-01T00:00:00.000+02:00  Definitivo        M07 2025   2.7</span>
<span class="hljs-comment">#&gt; 5 2025-08-01T00:00:00.000+02:00      Avance        M08 2025   2.7</span>

<span class="hljs-comment"># Using unnest = TRUE</span>
series &lt;- get_data_series(codSeries = <span class="hljs-string">"IPC251856"</span>, tip = <span class="hljs-string">"A"</span>, nlast = <span class="hljs-number">5</span>,
                          unnest = <span class="hljs-literal">TRUE</span>)
head(series[,c(<span class="hljs-string">"COD"</span>, <span class="hljs-string">"Nombre"</span>, <span class="hljs-string">"Fecha"</span>, <span class="hljs-string">"Valor"</span>)])
<span class="hljs-comment">#&gt;           COD                                            Nombre</span>
<span class="hljs-comment">#&gt; 1   IPC251856 Total Nacional. Índice general. Variación anual. </span>
<span class="hljs-comment">#&gt; 1.1 IPC251856 Total Nacional. Índice general. Variación anual. </span>
<span class="hljs-comment">#&gt; 1.2 IPC251856 Total Nacional. Índice general. Variación anual. </span>
<span class="hljs-comment">#&gt; 1.3 IPC251856 Total Nacional. Índice general. Variación anual. </span>
<span class="hljs-comment">#&gt; 1.4 IPC251856 Total Nacional. Índice general. Variación anual. </span>
<span class="hljs-comment">#&gt;                             Fecha Valor</span>
<span class="hljs-comment">#&gt; 1   2025-04-01T00:00:00.000+02:00   2.2</span>
<span class="hljs-comment">#&gt; 1.1 2025-05-01T00:00:00.000+02:00   2.0</span>
<span class="hljs-comment">#&gt; 1.2 2025-06-01T00:00:00.000+02:00   2.3</span>
<span class="hljs-comment">#&gt; 1.3 2025-07-01T00:00:00.000+02:00   2.7</span>
<span class="hljs-comment">#&gt; 1.4 2025-08-01T00:00:00.000+02:00   2.7</span>
</div></code></pre>
<p>Additionally, it is possible to obtain data from a series between two
dates. The date must have and specific format (<em>yyyy/mm/dd</em>). If the end
date is not specified we obtain all the data from the start date.</p>
<pre class="hljs"><code><div><span class="hljs-comment"># We use the function get_data_series with arguments codSeries, dateStart and dataEnd</span>
series &lt;- get_data_series(codSeries = <span class="hljs-string">"IPC251856"</span>, dateStart = <span class="hljs-string">"2023/01/01"</span>, 
                          dateEnd = <span class="hljs-string">"2023/04/01"</span>)
series$Data
<span class="hljs-comment">#&gt;          Fecha FK_TipoDato FK_Periodo Anyo Valor Secreto</span>
<span class="hljs-comment">#&gt; 1 1.672528e+12           1          1 2023   5.9   FALSE</span>
<span class="hljs-comment">#&gt; 2 1.675206e+12           1          2 2023   6.0   FALSE</span>
<span class="hljs-comment">#&gt; 3 1.677625e+12           1          3 2023   3.3   FALSE</span>
<span class="hljs-comment">#&gt; 4 1.680300e+12           1          4 2023   4.1   FALSE</span>
</div></code></pre>
<h4 id="metadata-request-examples">Metadata request examples</h4>
<p>Structural metadata are objects that describe both time series and
statistical tables and allow their definition. All these database
objects have an associated identifier that is essential for the correct
use of the service.</p>
<h5 id="obtaining-statistical-operations">Obtaining statistical operations</h5>
<p>The database contains information about all short-term statistical
operations, those with a periodicity for disseminating results of less
than a year, as well as some structural statistical operations. We can
get all the operations using the function <code>get_metadata_operations()</code>.</p>
<pre class="hljs"><code><div><span class="hljs-comment"># We use the function get_metadata_operations</span>
operations &lt;- get_metadata_operations()
head(operations)
<span class="hljs-comment">#&gt;   Id Cod_IOE                                                 Nombre Codigo</span>
<span class="hljs-comment">#&gt; 1  4   30147           Estadística de Efectos de Comercio Impagados     EI</span>
<span class="hljs-comment">#&gt; 2  6   30211                     Índice de Coste Laboral Armonizado   ICLA</span>
<span class="hljs-comment">#&gt; 3  7   30168 Estadística de Transmisión de Derechos de la Propiedad   ETDP</span>
<span class="hljs-comment">#&gt; 4 10   30256                                    Indicadores Urbanos     UA</span>
<span class="hljs-comment">#&gt; 5 13   30219                Estadística del Procedimiento Concursal    EPC</span>
<span class="hljs-comment">#&gt; 6 14   30182                Índices de Precios del Sector Servicios    IPS</span>
<span class="hljs-comment">#&gt;                                                                                                     Url</span>
<span class="hljs-comment">#&gt; 1                                                                                                  &lt;NA&gt;</span>
<span class="hljs-comment">#&gt; 2                                                                                                  &lt;NA&gt;</span>
<span class="hljs-comment">#&gt; 3                                                                                                  &lt;NA&gt;</span>
<span class="hljs-comment">#&gt; 4 https://www.ine.es/dyngs/INEbase/es/operacion.htm?c=Estadistica_C&amp;cid=1254736176957&amp;idp=1254735976608</span>
<span class="hljs-comment">#&gt; 5                                                                                                  &lt;NA&gt;</span>
<span class="hljs-comment">#&gt; 6                                                                                                  &lt;NA&gt;</span>
</div></code></pre>
<p>An operation can be identify by a numerical code (‘<em>Id</em>’), an alphabetic
code (‘<em>Codigo</em>’) or by the code of the statistical operation in the
Inventory of Statistical Operations (IOE + ‘<em>Cod_IOE</em>’). To obtain
information about only one operation we have to pass the <code>operation</code>
argument with one of these codes.</p>
<pre class="hljs"><code><div><span class="hljs-comment"># We use the function get_metadata_operations with argument operation</span>
operation &lt;- get_metadata_operations(operation = <span class="hljs-string">"IPC"</span>)
as.data.frame(operation)
<span class="hljs-comment">#&gt;   Id Cod_IOE                             Nombre Codigo</span>
<span class="hljs-comment">#&gt; 1 25   30138 Índice de Precios de Consumo (IPC)    IPC</span>
</div></code></pre>
<h5 id="obtaining-variables">Obtaining variables</h5>
<p>We can get all the variables of the system using the function
<code>get_metadata_variables()</code>.</p>
<pre class="hljs"><code><div><span class="hljs-comment"># We use the function get_metadata_variables</span>
variables &lt;- get_metadata_variables()
head(variables)
<span class="hljs-comment">#&gt;    Id                           Nombre Codigo</span>
<span class="hljs-comment">#&gt; 1 349            Totales Territoriales    NAC</span>
<span class="hljs-comment">#&gt; 2 954                            Total       </span>
<span class="hljs-comment">#&gt; 3  70 Comunidades y Ciudades Autónomas   CCAA</span>
<span class="hljs-comment">#&gt; 4 516                     Nacionalidad      1</span>
<span class="hljs-comment">#&gt; 5 955       Cultivos, pastos y huertos       </span>
<span class="hljs-comment">#&gt; 6 956              SAU y Otras tierras</span>
</div></code></pre>
<p>A variable can be identify by a numerical code (‘<em>Id</em>’). In addition, if
we pass the <code>operation</code> argument we obtain the variables used in an
operation.</p>
<pre class="hljs"><code><div><span class="hljs-comment"># We use the function get_metadata_variables with argument operation,</span>
<span class="hljs-comment"># e.g., operation code = 'IPC'</span>
variables &lt;- get_metadata_variables(operation = <span class="hljs-string">"IPC"</span>)
head(variables)
<span class="hljs-comment">#&gt;    Id                           Nombre Codigo</span>
<span class="hljs-comment">#&gt; 1   3                     Tipo de dato       </span>
<span class="hljs-comment">#&gt; 2  70 Comunidades y Ciudades Autónomas   CCAA</span>
<span class="hljs-comment">#&gt; 3 115                       Provincias   PROV</span>
<span class="hljs-comment">#&gt; 4 269           Grupos especiales 2001       </span>
<span class="hljs-comment">#&gt; 5 270                    Rúbricas 2001       </span>
<span class="hljs-comment">#&gt; 6 349            Totales Territoriales    NAC</span>
</div></code></pre>
<h5 id="obtaining-values">Obtaining values</h5>
<p>To get all the values that a variable can take it is necessary to pass
the <code>variable</code> argument, which is the identifier of the variable, to the
function <code>get_metadata_values()</code>.</p>
<pre class="hljs"><code><div><span class="hljs-comment"># We use the function get_metadata_values with argument variable,</span>
<span class="hljs-comment"># e.g., id = 3 (variable 'Tipo de dato')</span>
values &lt;- get_metadata_values(variable = <span class="hljs-number">3</span>)
head(values)
<span class="hljs-comment">#&gt;   Id Fk_Variable                                                   Nombre</span>
<span class="hljs-comment">#&gt; 1 70           3                                             Datos brutos</span>
<span class="hljs-comment">#&gt; 2 71           3 Datos corregidos de efectos estacionales y de calendario</span>
<span class="hljs-comment">#&gt; 3 72           3                                                Dato base</span>
<span class="hljs-comment">#&gt; 4 73           3                                     Variación trimestral</span>
<span class="hljs-comment">#&gt; 5 74           3                                          Variación anual</span>
<span class="hljs-comment">#&gt; 6 75           3                                                    Euros</span>
<span class="hljs-comment">#&gt;   Codigo</span>
<span class="hljs-comment">#&gt; 1       </span>
<span class="hljs-comment">#&gt; 2       </span>
<span class="hljs-comment">#&gt; 3       </span>
<span class="hljs-comment">#&gt; 4       </span>
<span class="hljs-comment">#&gt; 5       </span>
<span class="hljs-comment">#&gt; 6</span>
</div></code></pre>
<p>A value can be identify by a numerical code (‘<em>Id</em>’). In addition, if we
pass the <code>operation</code> argument as well we obtain the values that the
variable takes in that particular operation.</p>
<pre class="hljs"><code><div><span class="hljs-comment"># We use the function get_metadata_values with arguments operation and variable,</span>
<span class="hljs-comment"># e.g., operation code = 'IPC'</span>
values &lt;- get_metadata_values(operation = <span class="hljs-string">"IPC"</span>, variable = <span class="hljs-number">3</span>)
head(values)
<span class="hljs-comment">#&gt;   Id Fk_Variable            Nombre Codigo</span>
<span class="hljs-comment">#&gt; 1 72           3         Dato base       </span>
<span class="hljs-comment">#&gt; 2 74           3   Variación anual       </span>
<span class="hljs-comment">#&gt; 3 83           3            Índice       </span>
<span class="hljs-comment">#&gt; 4 84           3 Variación mensual       </span>
<span class="hljs-comment">#&gt; 5 85           3       Media anual      M</span>
<span class="hljs-comment">#&gt; 6 86           3   Variación anual</span>
</div></code></pre>
<h5 id="obtaining-tables">Obtaining tables</h5>
<p>We can get the tables associated with an statistical operation using the
function <code>get_metadata_tables_operation()</code>.</p>
<pre class="hljs"><code><div><span class="hljs-comment"># We use the function get_metadata_tables with argument operation</span>
tables &lt;- get_metadata_tables_operation(operation = <span class="hljs-string">"IPC"</span>)
head(tables[,c(<span class="hljs-string">"Id"</span>,<span class="hljs-string">"Nombre"</span>)])
<span class="hljs-comment">#&gt;      Id</span>
<span class="hljs-comment">#&gt; 1 24077</span>
<span class="hljs-comment">#&gt; 2 25331</span>
<span class="hljs-comment">#&gt; 3 35083</span>
<span class="hljs-comment">#&gt; 4 50902</span>
<span class="hljs-comment">#&gt; 5 50908</span>
<span class="hljs-comment">#&gt; 6 50911</span>
<span class="hljs-comment">#&gt;                                                                      Nombre</span>
<span class="hljs-comment">#&gt; 1                       Índice general nacional. Series desde enero de 1961</span>
<span class="hljs-comment">#&gt; 2                                Ponderaciones: general y de grupos ECOICOP</span>
<span class="hljs-comment">#&gt; 3           Índices nacionales: Componentes para el análisis de la COVID-19</span>
<span class="hljs-comment">#&gt; 4                           Índices nacionales: general y de grupos ECOICOP</span>
<span class="hljs-comment">#&gt; 5    Índices nacionales a impuestos constantes: general y de grupos ECOICOP</span>
<span class="hljs-comment">#&gt; 6 Tasa de variacion del índice general nacional. Series desde enero de 1961</span>
</div></code></pre>
<p>A table is defined by different groups or selection combo boxes and each
of them by the values that one or several variables take. To obtain the
variables and values present in a table first we have to query the
groups that define the table using the function
<code>get_metadata_table_groups()</code>.</p>
<pre class="hljs"><code><div><span class="hljs-comment"># We use the function get_metadata_table_groups with argument idTable</span>
groups &lt;- get_metadata_table_groups(idTable = <span class="hljs-number">50902</span>)
head(groups)
<span class="hljs-comment">#&gt;       Id         Nombre</span>
<span class="hljs-comment">#&gt; 1 110889 Grupos ECOICOP</span>
<span class="hljs-comment">#&gt; 2 110890   Tipo de dato</span>
</div></code></pre>
<p>Once we have the identification codes of the groups, we can query the
values for an specific group using the function
<code>get_metadata_table_values()</code>.</p>
<pre class="hljs"><code><div><span class="hljs-comment"># We use the function get_metadata_table_values with arguments idTable and idGroup</span>
values &lt;- get_metadata_table_values(idTable = <span class="hljs-number">50902</span>, idGroup = <span class="hljs-number">110889</span>)
head(values, <span class="hljs-number">4</span>)
<span class="hljs-comment">#&gt;       Id Fk_Variable                             Nombre Codigo</span>
<span class="hljs-comment">#&gt; 1 304092         762                     Índice general     00</span>
<span class="hljs-comment">#&gt; 2 304093         762 Alimentos y bebidas no alcohólicas     01</span>
<span class="hljs-comment">#&gt; 3 304094         762       Bebidas alcohólicas y tabaco     02</span>
<span class="hljs-comment">#&gt; 4 304095         762                  Vestido y calzado     03</span>
<span class="hljs-comment">#&gt;   FK_JerarquiaPadres</span>
<span class="hljs-comment">#&gt; 1               NULL</span>
<span class="hljs-comment">#&gt; 2             304092</span>
<span class="hljs-comment">#&gt; 3             304092</span>
<span class="hljs-comment">#&gt; 4             304092</span>
</div></code></pre>
<p>Alternatively, we can use the <code>get_metadata_table_varval()</code> function to
get the variables and values present in a table.</p>
<pre class="hljs"><code><div><span class="hljs-comment"># Using the function get_metadata_table_varval</span>
values &lt;- get_metadata_table_varval(idTable = <span class="hljs-number">50902</span>)
head(values, <span class="hljs-number">4</span>)
<span class="hljs-comment">#&gt;       Id Fk_Variable                             Nombre Codigo</span>
<span class="hljs-comment">#&gt; 1 304092         762                     Índice general     00</span>
<span class="hljs-comment">#&gt; 2 304093         762 Alimentos y bebidas no alcohólicas     01</span>
<span class="hljs-comment">#&gt; 3 304094         762       Bebidas alcohólicas y tabaco     02</span>
<span class="hljs-comment">#&gt; 4 304095         762                  Vestido y calzado     03</span>
</div></code></pre>
<h5 id="obtaining-series">Obtaining series</h5>
<p>The data is only associated with the series object. To obtain
information about a particular series it is necessary to pass the
<code>codSeries</code> argument, which is the identification code of the series, to
the function <code>get_metadata_series()</code>.</p>
<pre class="hljs"><code><div><span class="hljs-comment"># We use the function get_metadata_series with argument codSeries</span>
series &lt;- get_metadata_series(codSeries = <span class="hljs-string">"IPC251856"</span>)
as.data.frame(series)
<span class="hljs-comment">#&gt;       Id       COD FK_Operacion</span>
<span class="hljs-comment">#&gt; 1 251856 IPC251856           25</span>
<span class="hljs-comment">#&gt;                                              Nombre Decimales FK_Periodicidad</span>
<span class="hljs-comment">#&gt; 1 Total Nacional. Índice general. Variación anual.          1               1</span>
<span class="hljs-comment">#&gt;   FK_Publicacion FK_Clasificacion FK_Escala FK_Unidad</span>
<span class="hljs-comment">#&gt; 1              8               90         1       135</span>
</div></code></pre>
<p>To get the values and variables that define a series it is necessary to
pass the <code>codSeries</code> argument as well.</p>
<pre class="hljs"><code><div><span class="hljs-comment"># We use the function get_metadata_series_values with argument codSeries</span>
values &lt;- get_metadata_series_values(codSeries = <span class="hljs-string">"IPC251856"</span>)
head(values)
<span class="hljs-comment">#&gt;       Id Fk_Variable          Nombre Codigo</span>
<span class="hljs-comment">#&gt; 1  16473         349  Total Nacional     00</span>
<span class="hljs-comment">#&gt; 2 304092         762  Índice general     00</span>
<span class="hljs-comment">#&gt; 3     74           3 Variación anual</span>
</div></code></pre>
<p>To get all the series that define a table it is necessary to pass the
<code>idTable</code> argument, which is the identification code of the table, to
the function <code>get_metadata_series_table()</code>.</p>
<pre class="hljs"><code><div><span class="hljs-comment"># We use the function get_metadata_series_table with argument idTable</span>
series &lt;- get_metadata_series_table(idTable = <span class="hljs-number">50902</span>)
head(series[,c(<span class="hljs-string">"COD"</span>, <span class="hljs-string">"Nombre"</span>)], <span class="hljs-number">4</span>)
<span class="hljs-comment">#&gt;         COD                                                          Nombre</span>
<span class="hljs-comment">#&gt; 1 IPC251852                        Total Nacional. Índice general. Índice. </span>
<span class="hljs-comment">#&gt; 2 IPC251855             Total Nacional. Índice general. Variación mensual. </span>
<span class="hljs-comment">#&gt; 3 IPC251856               Total Nacional. Índice general. Variación anual. </span>
<span class="hljs-comment">#&gt; 4 IPC251858 Total Nacional. Índice general. Variación en lo que va de año.</span>
</div></code></pre>
<h3 id="ineapirexampler">ineapir_example.R</h3>
<pre class="hljs"><code><div><span class="hljs-comment"># Ejemplo de uso del paquete ineapir</span>
<span class="hljs-comment">#install.packages("ineapir")</span>
<span class="hljs-keyword">library</span>(ineapir)

<span class="hljs-comment"># Definir la tabla a descargar</span>
<span class="hljs-comment">## Tipo tempus</span>
tableId &lt;- <span class="hljs-number">67824</span>

<span class="hljs-comment">########################################################</span>
<span class="hljs-comment"># Definir parametros generales</span>
<span class="hljs-comment">########################################################</span>
<span class="hljs-comment">## Unnest: TRUE para desanidar el dataframe, se recomienda TRUE para evitar errores</span>
unnest &lt;- <span class="hljs-literal">TRUE</span>

<span class="hljs-comment">## Validate: FALSE para evitar validaciones, Por defecto es TRUE, pero se puede poner FALSE para reducir las llamadas a la API</span>
validate &lt;- <span class="hljs-literal">FALSE</span>

<span class="hljs-comment">## Tip: </span>
<span class="hljs-comment">### =NULL sin fechas legibles ni metadados</span>
<span class="hljs-comment">### "A" Fechas en formato YYYY/MM/DD sin metadatos</span>
<span class="hljs-comment">### "M" Metadados como columna en el dataframe</span>
<span class="hljs-comment">### "AM" Fechas en formato YYYY/MM/DD con metadatos en el dataframe</span>

tip &lt;- <span class="hljs-string">"A"</span>

<span class="hljs-comment">## Extrae metadatos y lo añade como columna para cada variable. Se recomienda TRUE. TIP tiene que ser "AM" o "M" para poder ser TRUE</span>
metanames &lt;- <span class="hljs-literal">FALSE</span>
metacodes &lt;- <span class="hljs-literal">FALSE</span>

<span class="hljs-comment">## Lenguaje</span>
lang= <span class="hljs-string">"ES"</span> <span class="hljs-comment"># "ES" para español, "EN" para inglés</span>

<span class="hljs-comment">########################################################</span>
<span class="hljs-comment"># Definir los filtros</span>
<span class="hljs-comment">########################################################</span>
<span class="hljs-comment"># Obtener los grupos de una tabla con su id</span>
get_metadata_table_groups(idTable = idTable)

<span class="hljs-comment"># Obtener los valores de una de una tabla con su id</span>
get_metadata_table_values(idTable = idTable, idGroup = <span class="hljs-number">141147</span>)
get_metadata_table_values(idTable = idTable, idGroup = <span class="hljs-number">141148</span>)
get_metadata_table_values(idTable = idTable, idGroup = <span class="hljs-number">141149</span>)

<span class="hljs-comment"># En base a las listas de los compandos anteriores elegimos los filtros que nos interesan </span>

filter &lt;- list(`544`=<span class="hljs-string">"283877"</span>,`482`=<span class="hljs-string">"17134"</span>, `480`=c(<span class="hljs-string">"141"</span>,<span class="hljs-string">"17132"</span>), `3`=<span class="hljs-string">"72"</span> )

<span class="hljs-comment">########################################################</span>
<span class="hljs-comment"># Definir fechas</span>
<span class="hljs-comment">########################################################</span>
dateStart &lt;- <span class="hljs-string">"2019/01/01"</span>
dateEnd &lt;- <span class="hljs-string">"2026/01/01"</span>

<span class="hljs-comment">########################################################</span>
<span class="hljs-comment"># Descargar los datos y guardarlos en un archivo CSV</span>
<span class="hljs-comment">########################################################</span>

df &lt;- get_data_table(idTable = tableId, unnest = unnest, validate = validate, tip = tip, metanames = metanames, metacodes = metacodes, lang = lang, filter = filter, dateStart = dateStart, dateEnd = dateEnd)

write.csv(df, <span class="hljs-string">"ineapir_example.csv"</span>, row.names = <span class="hljs-literal">FALSE</span>)





</div></code></pre>
<h3 id="ineapirexamploinfodatasetr">ineapir_examplo_infodataset.R</h3>
<pre class="hljs"><code><div><span class="hljs-comment"># Ejemplo de uso del paquete ineapir</span>
<span class="hljs-comment">#install.packages("ineapir")</span>
<span class="hljs-keyword">library</span>(ineapir)

<span class="hljs-comment"># Definir la tabla a descargar</span>

<span class="hljs-comment">## Tipo tempus</span>

tip &lt;- <span class="hljs-string">"AM"</span>

<span class="hljs-comment">## Funciones para las operacinoes (las bases de datos del INE)</span>
<span class="hljs-comment"># Obtener las bases de datos disponibles con su Cod_IOE</span>
get_metadata_operations()

<span class="hljs-comment"># Obtener la periodicidad de las operaciones con su id</span>
get_metadata_periodicity()

<span class="hljs-comment"># Obtener las publicaciones de una operación con su FK_PubFechaAct</span>
get_metadata_publications(operation = <span class="hljs-number">237</span>)

<span class="hljs-comment"># Obtener las variables de una operación con su id</span>
get_metadata_variables(operation = <span class="hljs-number">237</span>)

<span class="hljs-comment"># Obtener los valores de una variable de una operación con su id</span>
get_metadata_values(operation = <span class="hljs-number">237</span>, variable = <span class="hljs-number">3</span>)

<span class="hljs-comment"># Obtener las tablas de una operación con su id</span>
get_metadata_tables_operation(operation = <span class="hljs-number">237</span>)

<span class="hljs-comment">## Funciones para las tablas de datos del INE</span>
idTable &lt;- <span class="hljs-number">67824</span>

<span class="hljs-comment"># Obtener los grupos de una tabla con su id</span>
get_metadata_table_groups(idTable = idTable)

<span class="hljs-comment"># Obtener los valores de una de una tabla con su id</span>
get_metadata_table_values(idTable = idTable, idGroup = <span class="hljs-number">141148</span>)

<span class="hljs-comment"># Obtener los metadatos de una tabla con su id</span>
get_metadata_table_varval(idTable = idTable)

<span class="hljs-comment"># Obtener las series de una tabla con su id</span>
get_metadata_series_table(idTable = idTable)

<span class="hljs-comment"># Obtener la operacion a la que pertenece una tabla con su id</span>
get_metadata_operation_table(idTable = idTable)

<span class="hljs-comment">## Funciones para las series de datos del INE</span>

<span class="hljs-comment"># Obtener los metadatos de una serie con su id</span>
get_metadata_series(codSeries = <span class="hljs-string">"CNTR7300"</span>)

<span class="hljs-comment"># Obtener los valores de una serie con su id</span>
get_metadata_series_values(codSeries = <span class="hljs-string">"CNTR7300"</span>)


<span class="hljs-comment"># Obtener las series de una operación con su id</span>
get_metadata_series_operation(operation = <span class="hljs-number">30024</span>, det=<span class="hljs-number">1</span>, tip=<span class="hljs-literal">NULL</span>, lang=<span class="hljs-string">"ES"</span>, page=<span class="hljs-number">1</span>, validate=<span class="hljs-literal">TRUE</span>, verbose=<span class="hljs-literal">FALSE</span>)
</div></code></pre>
<h2 id="oecd">OECD</h2>
<h3 id="gu%C3%ADa-r%C3%A1pida-oecd-con-r">Guía rápida: OECD con R</h3>
<p>Este documento explica cómo usar la función en <code>oecd/oecd_function.R</code> para descargar datos de la API SDMX de la OCDE en formato CSV y obtenerlos como un data frame en R.</p>
<h4 id="requisitos">Requisitos</h4>
<ul>
<li>Paquete <code>httr</code> instalado (<code>install.packages(&quot;httr&quot;)</code> si fuera necesario)</li>
</ul>
<h4 id="codigos-ejemplo">Codigos ejemplo</h4>
<ul>
<li><code>oecd_onlylink.R</code> es un ejemplo que descarga y lee el csv directamente del link de la API en una linea.</li>
<li><code>oecd_min.R</code> es un ejemplo mínimo para descargar datos de la OCDE sin usar la función <code>oecd_api_function</code>.</li>
<li><code>oecd_example.R</code> es un ejemplo de uso de la función <code>oecd_api_function</code>.</li>
</ul>
<h4 id="inputs">Inputs</h4>
<ul>
<li>
<p><strong>Obligatorios</strong></p>
<ul>
<li><code>agency_identifier</code>: identificador de la agencia (p. ej., <code>&quot;OECD.ECO.MAD&quot;</code>).</li>
<li><code>dataset_identifier</code>: identificador del dataset (p. ej., <code>&quot;DSD_EO@DF_EO&quot;</code>).</li>
<li><code>data_selection</code>: clave SDMX (dimensiones) tras la <code>/</code> (p. ej., <code>&quot;FRA+DEU.PDTY.A&quot;</code>).</li>
</ul>
</li>
<li>
<p><strong>Opcionales</strong></p>
<ul>
<li><code>dataset_version</code>: versión del dataset (p. ej., <code>&quot;&quot;</code>).</li>
<li><code>startPeriod</code>, <code>endPeriod</code>, <code>dimensionAtObservation</code>: parámetros comunes de consulta.</li>
</ul>
</li>
</ul>
<h4 id="c%C3%B3mo-elegir-inputs">Cómo elegir inputs</h4>
<ol>
<li>Buscar el dataset en el explorador OCDE: https://data-explorer.oecd.org/</li>
<li>Seleccionar las dimensiones que se quieren descargar y consultar la sección &quot;Developer API&quot; para obtener <code>Agency identifier</code>, <code>Dataset identifier</code> y <code>Dataset version</code>.</li>
<li>Construir <code>data_selection</code> con las dimensiones requeridas por el dataset (p. ej., <code>PAISES.VARIABLE.FRECUENCIA</code>).</li>
<li>Ajustar parámetros opcionales (<code>startPeriod</code>, <code>endPeriod</code>, <code>dimensionAtObservation</code>).</li>
</ol>
<h4 id="sintaxis-de-la-api-ocde">Sintaxis de la API (OCDE)</h4>
<ul>
<li>
<p><strong>Formato general:</strong></p>
<pre class="hljs"><code><div>{Host URL}/{Agency identifier},{Dataset identifier},{Dataset version}/{Data selection}?{otros parámetros}
</div></code></pre>
<p>Donde el Host URL por defecto es <code>https://sdmx.oecd.org/public/rest/data</code>.</p>
</li>
<li>
<p><strong>Ejemplo:</strong></p>
<pre class="hljs"><code><div>https://sdmx.oecd.org/public/rest/data/OECD.ECO.MAD,DSD_EO@DF_EO, /FRA+DEU.PDTY.A?startPeriod=1965&amp;endPeriod=2023&amp;dimensionAtObservation=AllDimensions
</div></code></pre>
</li>
</ul>
<h4 id="output">Output</h4>
<ul>
<li>Un <code>data.frame</code> con los datos descargados desde la OCDE.</li>
</ul>
<h4 id="notas">Notas</h4>
<ul>
<li>Si la API devuelve error, verifique que <code>agency_identifier</code>, <code>dataset_identifier</code> y <code>data_selection</code> sean válidos.</li>
<li>Revise la documentación del dataset para conocer las dimensiones y códigos disponibles.</li>
</ul>
<h4 id="enlaces-%C3%BAtiles">Enlaces útiles</h4>
<ul>
<li>Explorador OCDE: https://data-explorer.oecd.org/</li>
<li>Documentación de la API: https://www.oecd.org/en/data/insights/data-explainers/2024/09/api.html</li>
</ul>
<h3 id="oecdexampler">oecd_example.R</h3>
<pre class="hljs"><code><div><span class="hljs-comment"># Ejemplo de uso de la función oecd_api_function</span>
<span class="hljs-keyword">library</span>(httr)

<span class="hljs-comment">#setwd("oecd")</span>
<span class="hljs-keyword">source</span>(<span class="hljs-string">"oecd_function.R"</span>)

<span class="hljs-comment"># Ejemplo de uso</span>
df &lt;- oecd_api_function(
  agency_identifier = <span class="hljs-string">"OECD.ECO.MAD"</span>,
  dataset_identifier = <span class="hljs-string">"DSD_EO@DF_EO"</span>,
  data_selection = <span class="hljs-string">"FRA+DEU.PDTY.A"</span>,
  startPeriod = <span class="hljs-string">"1965"</span>,
  endPeriod = <span class="hljs-string">"2023"</span>,
  dimensionAtObservation = <span class="hljs-string">"AllDimensions"</span>
)

write.csv(df, <span class="hljs-string">"oecd_example.csv"</span>, row.names = <span class="hljs-literal">FALSE</span>)



</div></code></pre>
<h3 id="oecdfunctionr">oecd_function.R</h3>
<pre class="hljs"><code><div><span class="hljs-comment"># Función mínima para descargar datos de OECD SDMX (CSV)</span>

<span class="hljs-comment"># Inputs obligatorios:</span>
<span class="hljs-comment"># - agency_identifier: identificador de la agencia, p. ej. "OECD.ECO.MAD"</span>
<span class="hljs-comment"># - dataset_identifier: identificador del dataset, p. ej. "DSD_EO@DF_EO"</span>
<span class="hljs-comment"># - data_selection: clave SDMX (dimensiones) tras la '/'</span>
<span class="hljs-comment">#</span>
<span class="hljs-comment"># Inputs opcionales:</span>
<span class="hljs-comment"># - base_url: host de la API SDMX</span>
<span class="hljs-comment"># - dataset_version: versión del dataset</span>
<span class="hljs-comment"># - startPeriod, endPeriod, dimensionAtObservation: parámetros comunes de consulta</span>
<span class="hljs-comment">#</span>
<span class="hljs-comment"># Output:</span>
<span class="hljs-comment"># - df: data.frame con los datos descargados</span>

oecd_api_function &lt;- <span class="hljs-keyword">function</span>(
  agency_identifier,
  dataset_identifier,
  data_selection,
  base_url = <span class="hljs-string">"https://sdmx.oecd.org/public/rest/data"</span>,
  dataset_version = <span class="hljs-string">""</span>,
  startPeriod = <span class="hljs-literal">NULL</span>,
  endPeriod = <span class="hljs-literal">NULL</span>,
  dimensionAtObservation = <span class="hljs-literal">NULL</span>
) {
  data_identifier &lt;- paste0(agency_identifier, <span class="hljs-string">","</span>, dataset_identifier, <span class="hljs-string">","</span>, dataset_version)

  params &lt;- list()
  <span class="hljs-keyword">if</span> (!is.null(startPeriod)) params$startPeriod &lt;- startPeriod
  <span class="hljs-keyword">if</span> (!is.null(endPeriod)) params$endPeriod &lt;- endPeriod
  <span class="hljs-keyword">if</span> (!is.null(dimensionAtObservation)) params$dimensionAtObservation &lt;- dimensionAtObservation

  url &lt;- paste0(base_url, <span class="hljs-string">"/"</span>, data_identifier, <span class="hljs-string">"/"</span>, data_selection)
  res &lt;- httr::GET(url, query = params, httr::accept(<span class="hljs-string">"text/csv"</span>))
  <span class="hljs-keyword">if</span> (httr::http_error(res)) <span class="hljs-keyword">stop</span>(sprintf(<span class="hljs-string">"OECD request failed [%s]"</span>, httr::status_code(res)))

  txt &lt;- httr::content(res, as = <span class="hljs-string">"text"</span>, encoding = <span class="hljs-string">"UTF-8"</span>)
  df &lt;- utils::read.csv(text = txt, stringsAsFactors = <span class="hljs-literal">FALSE</span>)
  <span class="hljs-keyword">return</span>(df)
}



</div></code></pre>
<h3 id="oecdminr">oecd_min.R</h3>
<pre class="hljs"><code><div><span class="hljs-comment"># Descargador mínimo de OECD SDMX (CSV)</span>
<span class="hljs-comment">#</span>
<span class="hljs-comment"># Cómo personalizar:</span>
<span class="hljs-comment"># - Cambie 'data_identifier' para apuntar a {Agencia},{Dataset},{Versión}</span>
<span class="hljs-comment"># - Cambie 'data_selection' para seleccionar la clave (dimensiones) del dataset</span>
<span class="hljs-comment"># - Cambie 'params' (startPeriod, endPeriod, dimensionAtObservation)</span>
<span class="hljs-comment"># - Cambie 'output_name' para definir el nombre del archivo de salida</span>
<span class="hljs-comment">#</span>
<span class="hljs-comment"># Sintaxis oficial (OCDE):</span>
<span class="hljs-comment"># {Host URL}/{Agency identifier},{Dataset identifier},{Dataset version}/{Data selection}?{otros parámetros}</span>

<span class="hljs-keyword">library</span>(httr)

<span class="hljs-comment"># --- Parámetros editables ---</span>
<span class="hljs-comment"># Identificadores de dataset</span>
  base_url &lt;- <span class="hljs-string">"https://sdmx.oecd.org/public/rest/data"</span> <span class="hljs-comment"># En principio no hace falta cambiarlo</span>
  agency_identifier &lt;- <span class="hljs-string">"OECD.ECO.MAD"</span>
  dataset_identifier &lt;- <span class="hljs-string">"DSD_EO@DF_EO"</span>
  dataset_version &lt;- <span class="hljs-string">""</span>
<span class="hljs-comment"># Construir codigo completo  </span>
  data_identifier &lt;- paste0(agency_identifier, <span class="hljs-string">","</span>, dataset_identifier, <span class="hljs-string">","</span>, dataset_version)
<span class="hljs-comment"># Rango de fechas y dimensiones</span>
  data_selection &lt;- <span class="hljs-string">"FRA+DEU.PDTY.A"</span>
  params &lt;- list(
    startPeriod = <span class="hljs-string">"1965"</span>,
    endPeriod = <span class="hljs-string">"2023"</span>,
    dimensionAtObservation = <span class="hljs-string">"AllDimensions"</span>
  )
<span class="hljs-comment"># Nombre del archivo de salida</span>
  output_name &lt;- <span class="hljs-string">"oecd_ejemplo"</span>
  out_file &lt;- paste0(<span class="hljs-string">"data/"</span>, output_name, <span class="hljs-string">".csv"</span>)

<span class="hljs-comment"># --- Crear directorio de datos si no existe ---</span>
<span class="hljs-keyword">if</span> (!dir.exists(<span class="hljs-string">"data"</span>)) dir.create(<span class="hljs-string">"data"</span>, recursive = <span class="hljs-literal">TRUE</span>, showWarnings = <span class="hljs-literal">FALSE</span>)

<span class="hljs-comment"># --- Descargar archivo CSV ---</span>
url &lt;- paste0(base_url, <span class="hljs-string">"/"</span>, data_identifier, <span class="hljs-string">"/"</span>, data_selection)
res &lt;- httr::GET(url, query = params, httr::accept(<span class="hljs-string">"text/csv"</span>))
<span class="hljs-keyword">if</span> (httr::http_error(res)) <span class="hljs-keyword">stop</span>(sprintf(<span class="hljs-string">"OECD request failed [%s]"</span>, httr::status_code(res)))
writeBin(httr::content(res, as = <span class="hljs-string">"raw"</span>), out_file)



</div></code></pre>
<h2 id="ourworldindata">OURWORLDINDATA</h2>
<h3 id="gu%C3%ADa-r%C3%A1pida-our-world-in-data-con-r">Guía rápida: Our World in Data con R</h3>
<p>Este documento explica cómo descargar datos directamente desde los gráficos de Our World in Data (OWID) en formato CSV usando R.</p>
<h4 id="requisitos">Requisitos</h4>
<ul>
<li>Paquete <code>utils</code> instalado (viene por defecto en R, se usa <code>read.csv</code>)</li>
<li>Paquete <code>jsonlite</code> (opcional, si se quieren metadatos)</li>
</ul>
<h4 id="codigos-ejemplo">Codigos ejemplo</h4>
<ul>
<li><code>worldindata_onlylink.R</code> es un ejemplo que descarga y lee el csv directamente del link de la API en una linea.</li>
<li><code>worldindata_min.R</code> es un ejemplo mínimo para descargar datos de OWID.</li>
</ul>
<h4 id="inputs">Inputs</h4>
<ul>
<li><strong>Obligatorios</strong>
<ul>
<li><code>url</code>: URL directa del archivo CSV proporcionada por OWID para un gráfico específico.</li>
</ul>
</li>
</ul>
<h4 id="c%C3%B3mo-elegir-inputs">Cómo elegir inputs</h4>
<ol>
<li>Vaya a un gráfico en <a href="https://ourworldindata.org/">Our World in Data</a>.</li>
<li>Haga clic en la pestaña &quot;Download&quot;.</li>
<li>Haga clic derecho en el botón de descarga &quot;Full data (CSV)&quot; y seleccione &quot;Copiar dirección del enlace&quot;.</li>
<li>Use esa URL en su script de R.</li>
</ol>
<h4 id="sintaxis-de-la-api">Sintaxis de la API</h4>
<ul>
<li>
<p><strong>Formato general:</strong></p>
<pre class="hljs"><code><div>https://ourworldindata.org/grapher/{chart-slug}.csv?v=1&amp;csvType=full&amp;useColumnShortNames=true
</div></code></pre>
</li>
<li>
<p><strong>Ejemplo:</strong></p>
<pre class="hljs"><code><div>https://ourworldindata.org/grapher/labor-productivity-per-hour-pennworldtable.csv?v=1&amp;csvType=full&amp;useColumnShortNames=true
</div></code></pre>
</li>
</ul>
<h4 id="output">Output</h4>
<ul>
<li>Un <code>data.frame</code> con los datos descargados desde OWID.</li>
</ul>
<h4 id="enlaces-%C3%BAtiles">Enlaces útiles</h4>
<ul>
<li>Portal: https://ourworldindata.org/</li>
</ul>
<h3 id="worldindataminr">worldindata_min.R</h3>
<pre class="hljs"><code><div><span class="hljs-keyword">library</span>(jsonlite)
<span class="hljs-comment">#setwd("R/ourworldindata")</span>
<span class="hljs-comment"># Fetch the data</span>
df &lt;- read.csv(<span class="hljs-string">"https://ourworldindata.org/grapher/labor-productivity-per-hour-pennworldtable.csv?v=1&amp;csvType=full&amp;useColumnShortNames=true"</span>)

<span class="hljs-comment"># Fetch the metadata</span>
metadata &lt;- fromJSON(<span class="hljs-string">"https://ourworldindata.org/grapher/labor-productivity-per-hour-pennworldtable.metadata.json?v=1&amp;csvType=full&amp;useColumnShortNames=true"</span>)

<span class="hljs-comment"># Save the data to CSV</span>
output_path &lt;- <span class="hljs-string">"labor_productivity.csv"</span>
write.csv(df, output_path, row.names = <span class="hljs-literal">FALSE</span>)
print(paste(<span class="hljs-string">"Data saved to"</span>, output_path))
</div></code></pre>
<h2 id="worldbank">WORLDBANK</h2>
<h3 id="gu%C3%ADa-r%C3%A1pida-banco-mundial-con-r">Guía rápida: Banco Mundial con R</h3>
<p>Este documento explica cómo usar la función en <code>worldbank/worldbank_function.R</code> para descargar datos desde el Banco Mundial (API JSON) y obtenerlos como un data frame en R.</p>
<h4 id="requisitos">Requisitos</h4>
<ul>
<li>Paquetes <code>httr</code> y <code>jsonlite</code> instalados</li>
</ul>
<h4 id="codigos-ejemplo">Codigos ejemplo</h4>
<ul>
<li><code>worldbank_min.R</code> es un ejemplo mínimo para descargar datos del Banco Mundial sin usar la función <code>worldbank_api_function</code>.</li>
<li><code>worldbank_example.R</code> es un ejemplo de uso de la función <code>worldbank_api_function</code>.</li>
</ul>
<h4 id="inputs">Inputs</h4>
<ul>
<li>
<p><strong>Obligatorios</strong></p>
<ul>
<li><code>iso3</code>: código(s) de país ISO-3 (p. ej., <code>&quot;ESP&quot;</code>), separados por <code>;</code> si son múltiples.</li>
<li><code>indicator</code>: código(s) de indicador (p. ej., <code>NY.GDP.MKTP.KD.ZG</code>), separados por <code>;</code> si son múltiples.</li>
</ul>
</li>
<li>
<p><strong>Opcionales</strong></p>
<ul>
<li><code>date</code>: rango temporal (p. ej., <code>&quot;2020:2023&quot;</code>).</li>
<li><code>per_page</code>: tamaño de página (use un valor alto, p. ej., <code>20000</code>).</li>
</ul>
</li>
</ul>
<h4 id="c%C3%B3mo-elegir-inputs">Cómo elegir inputs</h4>
<ol>
<li>Elija país(es) <code>iso3</code> (estándar ISO 3166-1 alpha-3). Puede listar países: https://api.worldbank.org/v2/country?format=json</li>
<li>Elegir indicador (<code>indicator</code>)
<ul>
<li>Buscar en la web del World Bank la serie de interés. Seleccionar las variables y pinchar en <code>Metadata</code>-&gt; <code>Series</code>. Copiar el codigo de la serie. Puede ser una lista de indicadores separados por <code>;</code>.</li>
<li>Busque indicadores en: https://api.worldbank.org/v2/indicator?format=json (listado paginado) o en el portal de datos del Banco Mundial.</li>
<li>También puede abrir un indicador concreto para ver su nombre/meta: https://api.worldbank.org/v2/indicator/NY.GDP.MKTP.KD.ZG?format=json.</li>
</ul>
</li>
<li>Rango temporal
<ul>
<li>La API soporta <code>date=YYYY:YYYY</code> para filtrar.</li>
<li>Si por ejemplo es mensual, sería <code>date=2012M01:2012M08</code></li>
</ul>
</li>
</ol>
<h4 id="sintaxis-de-la-api-world-bank">Sintaxis de la API (World Bank)</h4>
<ul>
<li>
<p><strong>Formato general:</strong></p>
<pre class="hljs"><code><div>https://api.worldbank.org/v2/country/{ISO3}/indicator/{INDICATOR}?format=json&amp;per_page={N}&amp;date={DATE}
</div></code></pre>
</li>
<li>
<p><strong>Ejemplo:</strong></p>
<pre class="hljs"><code><div>https://api.worldbank.org/v2/country/ESP;FRA/indicator/NY.GDP.MKTP.KD.ZG?format=json&amp;per_page=20000&amp;date=2020:2023
</div></code></pre>
</li>
</ul>
<h4 id="output">Output</h4>
<ul>
<li>Un <code>data.frame</code> con los datos devueltos en el elemento <code>[2]</code> de la respuesta JSON.</li>
</ul>
<h4 id="enlaces-%C3%BAtiles">Enlaces útiles</h4>
<ul>
<li>Indicadores (API): https://datahelpdesk.worldbank.org/knowledgebase/articles/889392-about-the-indicators-api-documentation</li>
<li>Estructura de llamadas: https://datahelpdesk.worldbank.org/knowledgebase/articles/898581-api-basic-call-structures</li>
<li>Países (JSON): https://api.worldbank.org/v2/country?format=json</li>
<li>Indicadores (JSON): https://api.worldbank.org/v2/indicator?format=json</li>
</ul>
<h3 id="worldbankexampler">worldbank_example.R</h3>
<pre class="hljs"><code><div><span class="hljs-comment"># Ejemplo de uso de la función worldbank_api_function</span>
<span class="hljs-keyword">library</span>(httr)
<span class="hljs-keyword">library</span>(jsonlite)

<span class="hljs-comment">#setwd("worldbank")</span>
<span class="hljs-keyword">source</span>(<span class="hljs-string">"worldbank_function.R"</span>)

<span class="hljs-comment"># Ejemplo de uso</span>
df &lt;- worldbank_api_function(
  iso3 = <span class="hljs-string">"ESP;FRA"</span>,
  indicator = <span class="hljs-string">"NY.GDP.MKTP.KD.ZG"</span>,
  date = <span class="hljs-string">"2020:2023"</span>,
  per_page = <span class="hljs-number">20000</span>
)

write.csv(df, <span class="hljs-string">"worldbank_example.csv"</span>, row.names = <span class="hljs-literal">FALSE</span>)



</div></code></pre>
<h3 id="worldbankfunctionr">worldbank_function.R</h3>
<pre class="hljs"><code><div><span class="hljs-comment"># Función mínima para descargar datos del Banco Mundial (JSON -&gt; data.frame)</span>

<span class="hljs-comment"># Inputs obligatorios:</span>
<span class="hljs-comment"># - iso3: código(s) de país ISO-3, separados por ';' si son múltiples</span>
<span class="hljs-comment"># - indicator: código(s) de indicador, separados por ';' si son múltiples</span>
<span class="hljs-comment">#</span>
<span class="hljs-comment"># Inputs opcionales:</span>
<span class="hljs-comment"># - date: rango temporal, p. ej., "2020:2023"</span>
<span class="hljs-comment"># - per_page: tamaño de página (use un valor alto para evitar paginación)</span>
<span class="hljs-comment"># - base_url: host de la API del Banco Mundial</span>
<span class="hljs-comment">#</span>
<span class="hljs-comment"># Output:</span>
<span class="hljs-comment"># - df: data.frame con los datos del elemento [2] de la respuesta JSON</span>

worldbank_api_function &lt;- <span class="hljs-keyword">function</span>(
  iso3,
  indicator,
  date = <span class="hljs-literal">NULL</span>,
  per_page = <span class="hljs-number">20000</span>,
  base_url = <span class="hljs-string">"https://api.worldbank.org/v2"</span>
) {
  path &lt;- paste0(<span class="hljs-string">"/country/"</span>, iso3, <span class="hljs-string">"/indicator/"</span>, indicator)
  url &lt;- paste0(base_url, path)
  q &lt;- list(format = <span class="hljs-string">"json"</span>, per_page = per_page)
  <span class="hljs-keyword">if</span> (!is.null(date)) q$date &lt;- date

  res &lt;- httr::GET(url, query = q, httr::accept(<span class="hljs-string">"application/json"</span>))
  <span class="hljs-keyword">if</span> (httr::http_error(res)) <span class="hljs-keyword">stop</span>(sprintf(<span class="hljs-string">"World Bank request failed [%s]"</span>, httr::status_code(res)))

  txt &lt;- httr::content(res, as = <span class="hljs-string">"text"</span>, encoding = <span class="hljs-string">"UTF-8"</span>)
  obj &lt;- jsonlite::fromJSON(txt, flatten = <span class="hljs-literal">TRUE</span>)
  <span class="hljs-keyword">if</span> (length(obj) &lt; <span class="hljs-number">2</span> || is.null(obj[[<span class="hljs-number">2</span>]])) <span class="hljs-keyword">stop</span>(<span class="hljs-string">"Unexpected World Bank response structure; no data array present."</span>)
  <span class="hljs-keyword">return</span>(obj[[<span class="hljs-number">2</span>]])
}



</div></code></pre>
<h1 id="matlab">Matlab</h1>
<h2 id="comext">COMEXT</h2>
<h3 id="gu%C3%ADa-r%C3%A1pida-eurostat-comext-con-matlab">Guía rápida: Eurostat Comext con MATLAB</h3>
<p>Este documento explica cómo usar la función en <code>matlab/comext/comext_function.m</code> para descargar datos del endpoint Comext de Eurostat (JSON) y obtenerlos como una tabla en MATLAB.</p>
<h4 id="requisitos">Requisitos</h4>
<ul>
<li>Ninguno adicional a MATLAB.</li>
</ul>
<h4 id="codigos-ejemplo">Codigos ejemplo</h4>
<ul>
<li><code>comext_min.m</code>: ejemplo mínimo que construye la URL JSON y guarda en CSV.</li>
<li><code>comext_example.m</code>: ejemplo de uso de la función <code>comext_api_function</code> devolviendo una tabla y exportándola a CSV.</li>
</ul>
<h4 id="inputs">Inputs</h4>
<ul>
<li><strong>Obligatorios</strong>
<ul>
<li><code>dataset_id</code>: identificador del dataset Comext (prefijo <code>&quot;DS-&quot;</code>, p. ej., <code>&quot;DS-059341&quot;</code>).</li>
<li><code>filters</code>: struct NOMBRADO de filtros (dimensión -&gt; valores). Los nombres deben ser dimensiones válidas (p. ej., <code>reporter</code>, <code>partner</code>, <code>product</code>, <code>flow</code>, <code>freq</code>, <code>time</code>, <code>indicators</code>, ...). Los valores pueden ser <code>&quot;string&quot;</code> o <code>cellstr</code>.</li>
</ul>
</li>
</ul>
<h4 id="c%C3%B3mo-elegir-inputs">Cómo elegir inputs</h4>
<ol>
<li>Identifique el dataset en la guía de Comext y el portal de Eurostat.</li>
<li>Consulte la estructura del dataset en la guía Comext para conocer las dimensiones válidas y sus valores.</li>
<li>Ajuste <code>filters</code> con nombres de dimensiones válidos. Para múltiples valores use <code>cellstr</code> en MATLAB (enviamos parámetros repetidos).</li>
</ol>
<h4 id="sintaxis-de-la-api-eurostat-comext">Sintaxis de la API (Eurostat Comext)</h4>
<ul>
<li><strong>Formato general:</strong><pre class="hljs"><code><div>https://ec.europa.eu/eurostat/api/comext/dissemination/statistics/1.0/data/{dataset_id}?dim=...
</div></code></pre>
</li>
</ul>
<h4 id="output">Output</h4>
<ul>
<li>Una <code>table</code> con columnas por dimensión y <code>value</code> (según disponibilidad).</li>
</ul>
<h4 id="enlaces-%C3%BAtiles">Enlaces útiles</h4>
<ul>
<li>Guía de Comext: https://ec.europa.eu/eurostat/web/user-guides/data-browser/api-data-access/api-getting-started/comext-database</li>
<li>Portal Eurostat: https://ec.europa.eu/eurostat/</li>
</ul>
<h3 id="comextapifunctionm">comext_api_function.m</h3>
<pre class="hljs"><code><div><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">T</span> = <span class="hljs-title">comext_api_function</span><span class="hljs-params">(dataset_id, filters)</span></span>
<span class="hljs-comment">% COMEXT_API_FUNCTION Descarga Eurostat COMEXT (JSON) y devuelve una tabla</span>
<span class="hljs-comment">%   T = comext_api_function(dataset_id, filters)</span>
<span class="hljs-comment">%   Parámetros:</span>
<span class="hljs-comment">%     dataset_id (char) - p. ej., 'DS-059341'</span>
<span class="hljs-comment">%     filters (struct) - dimensiones -&gt; valores (string/cellstr)</span>
<span class="hljs-comment">%   Devuelve:</span>
<span class="hljs-comment">%     T (table) - datos etiquetados como tabla</span>

base = [<span class="hljs-string">'https://ec.europa.eu/eurostat/api/comext/dissemination/statistics/1.0/data/'</span> dataset_id];

<span class="hljs-comment">% Construir query con parámetros repetidos para multiselección</span>
<span class="hljs-keyword">if</span> ~isstruct(filters)
    error(<span class="hljs-string">"'filters' debe ser un struct dimension -&gt; valores"</span>);
<span class="hljs-keyword">end</span>

qp = {};
fns = fieldnames(filters);
<span class="hljs-keyword">for</span> <span class="hljs-built_in">i</span> = <span class="hljs-number">1</span>:<span class="hljs-built_in">numel</span>(fns)
    dim = fns{<span class="hljs-built_in">i</span>};
    vals = filters.(dim);
    <span class="hljs-keyword">if</span> ischar(vals) || isstring(vals); vals = cellstr(vals); <span class="hljs-keyword">end</span>
    <span class="hljs-keyword">if</span> isnumeric(vals); vals = cellstr(string(vals)); <span class="hljs-keyword">end</span>
    <span class="hljs-keyword">for</span> <span class="hljs-built_in">j</span> = <span class="hljs-number">1</span>:<span class="hljs-built_in">numel</span>(vals)
        qp{<span class="hljs-keyword">end</span>+<span class="hljs-number">1</span>} = sprintf(<span class="hljs-string">'%s=%s'</span>, dim, vals{<span class="hljs-built_in">j</span>}); <span class="hljs-comment">%#ok&lt;AGROW&gt;</span>
    <span class="hljs-keyword">end</span>
<span class="hljs-keyword">end</span>

url = base;
<span class="hljs-keyword">if</span> ~<span class="hljs-built_in">isempty</span>(qp), url = [base <span class="hljs-string">'?'</span> strjoin(qp, <span class="hljs-string">'&amp;'</span>)]; <span class="hljs-keyword">end</span>

<span class="hljs-comment">% Leer JSON y mapear a tabla similar a utilidades R</span>
txt = webread(url, weboptions(<span class="hljs-string">'Timeout'</span>, <span class="hljs-number">60</span>, <span class="hljs-string">'ContentType'</span>, <span class="hljs-string">'text'</span>, <span class="hljs-string">'HeaderFields'</span>, {<span class="hljs-string">'Accept'</span> <span class="hljs-string">'application/json'</span>}));
doc = jsondecode(txt);

<span class="hljs-comment">% doc.value: mapa de indice-&gt;valor; doc.id, doc.size, doc.dimension</span>
vals = doc.value;
<span class="hljs-keyword">if</span> <span class="hljs-built_in">isempty</span>(fieldnames(vals))
    T = <span class="hljs-built_in">table</span>();
    <span class="hljs-keyword">return</span>;
<span class="hljs-keyword">end</span>

ids = cellstr(string(doc.id));
sizes = double(string(struct2cell(doc.<span class="hljs-built_in">size</span>)))'; <span class="hljs-comment">%#ok&lt;NASGU&gt;</span>
dim = doc.dimension;

value_keys = str2double(fieldnames(vals));
value_vals = struct2cell(vals);
value_vals = <span class="hljs-built_in">cellfun</span>(@(x) double(str2double(string(x))), value_vals);

<span class="hljs-comment">% Construcción filas</span>
rows = cell(<span class="hljs-built_in">numel</span>(value_keys), <span class="hljs-number">1</span>);
<span class="hljs-keyword">for</span> <span class="hljs-built_in">i</span> = <span class="hljs-number">1</span>:<span class="hljs-built_in">numel</span>(value_keys)
    rec = struct();
    rec.value = value_vals(<span class="hljs-built_in">i</span>);
    <span class="hljs-comment">% Mapear posiciones a códigos (métrica simplificada: usar índices directos si están)</span>
    <span class="hljs-keyword">for</span> k = <span class="hljs-number">1</span>:<span class="hljs-built_in">numel</span>(ids)
        dn = ids{k};
        d = dim.(dn);
        imap = d.category.index;
        labels = d.category.label;
        <span class="hljs-comment">% buscar código por posición (si coincide con i, aproximación)</span>
        codes = fieldnames(imap);
        pos = struct2array(imap);
        idx = <span class="hljs-built_in">find</span>(pos == <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-string">'first'</span>); <span class="hljs-comment">%#ok&lt;NASGU&gt;</span>
        <span class="hljs-comment">% Nota: una reconstrucción completa requiere strides; para simplicidad se omite</span>
        <span class="hljs-keyword">if</span> ~<span class="hljs-built_in">isempty</span>(codes)
            code_k = string(codes{<span class="hljs-number">1</span>});
            rec.(dn) = code_k;
            <span class="hljs-keyword">if</span> isstruct(labels) &amp;&amp; isfield(labels, codes{<span class="hljs-number">1</span>})
                rec.([dn <span class="hljs-string">'_label'</span>]) = string(labels.(codes{<span class="hljs-number">1</span>}));
            <span class="hljs-keyword">else</span>
                rec.([dn <span class="hljs-string">'_label'</span>]) = missing;
            <span class="hljs-keyword">end</span>
        <span class="hljs-keyword">end</span>
    <span class="hljs-keyword">end</span>
    rows{<span class="hljs-built_in">i</span>} = rec;
<span class="hljs-keyword">end</span>

T = struct2table([rows{:}]');

<span class="hljs-keyword">end</span>



</div></code></pre>
<h3 id="comextexamplem">comext_example.m</h3>
<pre class="hljs"><code><div><span class="hljs-comment">% Ejemplo de uso: Eurostat COMEXT (JSON) -&gt; tabla y CSV usando la función</span>

cd(pwd);

<span class="hljs-comment">% Parámetros de ejemplo (idénticos al ejemplo en R)</span>
dataset_id = <span class="hljs-string">'DS-059341'</span>;
filters = struct(...
    <span class="hljs-string">'reporter'</span>, {{<span class="hljs-string">'ES'</span>}}, ...
    <span class="hljs-string">'partner'</span>,  {{<span class="hljs-string">'US'</span>}}, ...
    <span class="hljs-string">'product'</span>,  {{<span class="hljs-string">'1509'</span>,<span class="hljs-string">'8703'</span>}}, ...
    <span class="hljs-string">'flow'</span>,     {{<span class="hljs-string">'2'</span>}}, ...
    <span class="hljs-string">'freq'</span>,     {{<span class="hljs-string">'A'</span>}}, ...
    <span class="hljs-string">'time'</span>,     <span class="hljs-built_in">num2cell</span>(<span class="hljs-number">2015</span>:<span class="hljs-number">2020</span>) ...
);

<span class="hljs-comment">% Llamar a la función</span>
T = comext_api_function(dataset_id, filters);

<span class="hljs-comment">% Carpeta de salida</span>
outPath = <span class="hljs-string">'comext_example.csv'</span>;

<span class="hljs-comment">% Guardar como CSV</span>
<span class="hljs-built_in">writetable</span>(T, outPath, <span class="hljs-string">'FileType'</span>, <span class="hljs-string">'text'</span>);



</div></code></pre>
<h3 id="comextminm">comext_min.m</h3>
<pre class="hljs"><code><div><span class="hljs-comment">% Descargador Eurostat COMEXT (JSON) — script mínimo</span>
<span class="hljs-comment">% ----------------------------------------------------------------------------</span>
<span class="hljs-comment">% Objetivo</span>
<span class="hljs-comment">%   Construir la URL JSON de Comext con filtros, descargar los datos y convertir</span>
<span class="hljs-comment">%   a tabla de MATLAB para exportar a CSV.</span>
<span class="hljs-comment">% Parámetros editables</span>
<span class="hljs-comment">%   - dataset_id: identificador 'DS-...'</span>
<span class="hljs-comment">%   - filtros: parámetros repetidos (reporter, partner, product, flow, freq, time, ...)</span>
<span class="hljs-comment">% Salida</span>
<span class="hljs-comment">%   - Archivo CSV con los registros</span>
<span class="hljs-comment">% Notas</span>
<span class="hljs-comment">%   - Este ejemplo simplifica la reconstrucción de dimensiones SDMX; devuelve índice y valor.</span>
<span class="hljs-comment">% Pasos</span>
<span class="hljs-comment">%   1) Construir query con parámetros repetidos</span>
<span class="hljs-comment">%   2) webread JSON y jsondecode</span>
<span class="hljs-comment">%   3) Extraer doc.value y formar una tabla sencilla</span>

<span class="hljs-comment">% Identificador del dataset</span>
dataset_id = <span class="hljs-string">'DS-059341'</span>;
base = [<span class="hljs-string">'https://ec.europa.eu/eurostat/api/comext/dissemination/statistics/1.0/data/'</span> dataset_id];

<span class="hljs-comment">% Filtros de ejemplo </span>
qp = {
    <span class="hljs-string">'reporter=ES'</span>,
    <span class="hljs-string">'partner=US'</span>,
    <span class="hljs-string">'product=1509'</span>, <span class="hljs-string">'product=8703'</span>,
    <span class="hljs-string">'flow=2'</span>,
    <span class="hljs-string">'freq=A'</span>,
    <span class="hljs-string">'time=2015'</span>,<span class="hljs-string">'time=2016'</span>,<span class="hljs-string">'time=2017'</span>,<span class="hljs-string">'time=2018'</span>,<span class="hljs-string">'time=2019'</span>,<span class="hljs-string">'time=2020'</span>
};

<span class="hljs-comment">% Construir la URL</span>
url = [base <span class="hljs-string">'?'</span> strjoin(qp, <span class="hljs-string">'&amp;'</span>)];

<span class="hljs-comment">% Leer la URL directamente a tabla</span>
txt = webread(url, weboptions(<span class="hljs-string">'Timeout'</span>, <span class="hljs-number">60</span>, <span class="hljs-string">'ContentType'</span>, <span class="hljs-string">'text'</span>, <span class="hljs-string">'HeaderFields'</span>, {<span class="hljs-string">'Accept'</span> <span class="hljs-string">'application/json'</span>}));
doc = jsondecode(txt);

<span class="hljs-comment">% Conversión simplificada (ver nota en function para reconstrucción completa)</span>
vals = doc.value;
<span class="hljs-keyword">if</span> <span class="hljs-built_in">isempty</span>(fieldnames(vals))
    T = <span class="hljs-built_in">table</span>();
<span class="hljs-keyword">else</span>
    keys = fieldnames(vals);
    v = struct2cell(vals);
    v = <span class="hljs-built_in">cellfun</span>(@(x) double(str2double(string(x))), v);
    T = <span class="hljs-built_in">table</span>(str2double(keys), v, <span class="hljs-string">'VariableNames'</span>, {<span class="hljs-string">'idx'</span>,<span class="hljs-string">'value'</span>});
<span class="hljs-keyword">end</span>

<span class="hljs-comment">% Exportar la tabla a CSV</span>
<span class="hljs-built_in">writetable</span>(T, <span class="hljs-string">'comext_min.csv'</span>, <span class="hljs-string">'FileType'</span>, <span class="hljs-string">'text'</span>);



</div></code></pre>
<h2 id="ecb">ECB</h2>
<h3 id="gu%C3%ADa-r%C3%A1pida-bce-con-matlab">Guía rápida: BCE con MATLAB</h3>
<p>Este documento explica cómo usar la función en <code>matlab/ecb/ecb_function.m</code> para descargar una serie del BCE (dataset SDMX) en formato CSV y obtenerla como una tabla en MATLAB.</p>
<h4 id="requisitos">Requisitos</h4>
<ul>
<li>Ninguno adicional a MATLAB.</li>
</ul>
<h4 id="codigos-ejemplo">Codigos ejemplo</h4>
<ul>
<li><code>ecb_onlylink.m</code>: ejemplo que descarga y lee el csv directamente del link de la API en una linea.</li>
<li><code>ecb_min.m</code>: ejemplo mínimo para descargar datos del BCE y guardarlos en CSV.</li>
<li><code>ecb_example.m</code>: ejemplo de uso de la función <code>ecb_api_function</code> devolviendo una tabla y exportándola a CSV.</li>
</ul>
<h4 id="inputs">Inputs</h4>
<ul>
<li><strong>Obligatorios</strong>
<ul>
<li><code>dataset</code>: identificador del dataset del BCE (p. ej., <code>&quot;BSI&quot;</code>).</li>
<li><code>seriesKey</code>: clave completa de la serie (dimensiones concatenadas con <code>.</code>).</li>
</ul>
</li>
</ul>
<h4 id="c%C3%B3mo-elegir-inputs">Cómo elegir inputs</h4>
<ol>
<li>Abra el dataset en el portal BCE (p. ej., BSI): <code>https://data.ecb.europa.eu/data/datasets/BSI</code></li>
<li>Use los filtros hasta ver la serie concreta; la clave <code>seriesKey</code> aparece en el recuadro de la serie.</li>
<li>Cada elemento de <code>seriesKey</code> es una dimensión del dataset; puede cambiar <code>U2</code> (Área del euro) por <code>ES</code> (España), etc.</li>
</ol>
<h4 id="sintaxis-de-la-api-bce">Sintaxis de la API (BCE)</h4>
<ul>
<li>
<p><strong>Formato general:</strong></p>
<pre class="hljs"><code><div>https://data-api.ecb.europa.eu/service/data/{dataset}/{seriesKey}?format=csvdata
</div></code></pre>
</li>
<li>
<p><strong>Ejemplo:</strong></p>
<pre class="hljs"><code><div>https://data-api.ecb.europa.eu/service/data/BSI/M.U2.Y.V.M30.X.I.U2.2300.Z01.A?format=csvdata
</div></code></pre>
</li>
</ul>
<h4 id="output">Output</h4>
<ul>
<li>Una <code>table</code> con los datos descargados desde el BCE.</li>
</ul>
<h4 id="enlaces-%C3%BAtiles">Enlaces útiles</h4>
<ul>
<li>Portal de datos del BCE (datasets): <code>https://data.ecb.europa.eu/data/datasets/</code></li>
<li>Documentación de la API de datos del BCE: <code>https://data.ecb.europa.eu/help/api/overview</code></li>
<li>API de datos (servicio): <code>https://data-api.ecb.europa.eu/service/</code></li>
</ul>
<h3 id="ecbapifunctionm">ecb_api_function.m</h3>
<pre class="hljs"><code><div><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">T</span> = <span class="hljs-title">ecb_api_function</span><span class="hljs-params">(dataset, seriesKey, base_url)</span></span>
<span class="hljs-comment">% ECB_API_FUNCTION Descarga una serie del BCE (CSV) y la devuelve como tabla</span>
<span class="hljs-comment">%   T = ecb_api_function(dataset, seriesKey, base_url)</span>
<span class="hljs-comment">%   Parámetros:</span>
<span class="hljs-comment">%     dataset   (char) - identificador del dataset (p. ej., 'BSI')</span>
<span class="hljs-comment">%     seriesKey (char) - clave completa de la serie (dimensiones separadas por '.')</span>
<span class="hljs-comment">%     base_url  (char) - host del servicio (por defecto 'https://data-api.ecb.europa.eu/service/data')</span>
<span class="hljs-comment">%   Devuelve:</span>
<span class="hljs-comment">%     T (table) - datos descargados como tabla de MATLAB</span>

<span class="hljs-keyword">if</span> nargin &lt; <span class="hljs-number">3</span> || <span class="hljs-built_in">isempty</span>(base_url)
    base_url = <span class="hljs-string">'https://data-api.ecb.europa.eu/service/data'</span>;
<span class="hljs-keyword">end</span>

<span class="hljs-comment">% Construir URL con formato CSV</span>
url = sprintf(<span class="hljs-string">'%s/%s/%s?format=csvdata'</span>, base_url, dataset, seriesKey);

<span class="hljs-comment">% Leer directamente la URL como tabla</span>
T = <span class="hljs-built_in">readtable</span>(url, <span class="hljs-string">'FileType'</span>, <span class="hljs-string">'text'</span>);

<span class="hljs-keyword">end</span>



</div></code></pre>
<h3 id="ecbexamplem">ecb_example.m</h3>
<pre class="hljs"><code><div><span class="hljs-comment">% Ejemplo de uso: descarga una serie del BCE y la guarda como CSV</span>

cd(pwd);
<span class="hljs-comment">% Parámetros de ejemplo</span>
dataset = <span class="hljs-string">'BSI'</span>;
seriesKey = <span class="hljs-string">'M.U2.Y.V.M30.X.I.U2.2300.Z01.A'</span>;

<span class="hljs-comment">% Llamar a la función</span>
T = ecb_api_function(dataset, seriesKey);

<span class="hljs-comment">% Carpeta de salida</span>
outPath = <span class="hljs-string">'ecb_example.csv'</span>;

<span class="hljs-comment">% Guardar como CSV</span>
<span class="hljs-built_in">writetable</span>(T, outPath, <span class="hljs-string">'FileType'</span>, <span class="hljs-string">'text'</span>);



</div></code></pre>
<h3 id="ecbminm">ecb_min.m</h3>
<pre class="hljs"><code><div><span class="hljs-comment">% Descargador BCE (CSV) — script mínimo</span>
<span class="hljs-comment">% ----------------------------------------------------------------------------</span>
<span class="hljs-comment">% Objetivo</span>
<span class="hljs-comment">%   Descargar una serie del BCE en formato CSV, cargarla como tabla y guardarla a disco.</span>
<span class="hljs-comment">% Parámetros editables</span>
<span class="hljs-comment">%   - dataset: identificador del dataset (p. ej., 'BSI')</span>
<span class="hljs-comment">%   - seriesKey: clave completa de la serie (dimensiones separadas por '.')</span>
<span class="hljs-comment">%   - outputName: nombre base del archivo de salida</span>
<span class="hljs-comment">% Salida</span>
<span class="hljs-comment">%   - Archivo CSV con los datos de la serie</span>
<span class="hljs-comment">% Pasos</span>
<span class="hljs-comment">%   1) Construir la URL con ?format=csvdata</span>
<span class="hljs-comment">%   2) Leer directamente a tabla</span>
<span class="hljs-comment">%   3) Exportar a CSV</span>

<span class="hljs-comment">% Parámetros básicos</span>
dataset = <span class="hljs-string">'BSI'</span>;
seriesKey = <span class="hljs-string">'M.U2.Y.V.M30.X.I.U2.2300.Z01.A'</span>;
outputName = <span class="hljs-string">'ecb_min'</span>;

<span class="hljs-comment">% Construir URL directa en CSV</span>
url = sprintf(<span class="hljs-string">'https://data-api.ecb.europa.eu/service/data/%s/%s?format=csvdata'</span>, dataset, seriesKey);

<span class="hljs-comment">% Leer a tabla</span>
T = <span class="hljs-built_in">readtable</span>(url, <span class="hljs-string">'FileType'</span>, <span class="hljs-string">'text'</span>);

<span class="hljs-comment">% Guardar</span>
<span class="hljs-built_in">writetable</span>(T, [outputName <span class="hljs-string">'.csv'</span>], <span class="hljs-string">'FileType'</span>, <span class="hljs-string">'text'</span>);



</div></code></pre>
<h3 id="ecbonlylinkm">ecb_onlylink.m</h3>
<pre class="hljs"><code><div><span class="hljs-comment">% Minimal ECB Data API downloader (link only)</span>
url = <span class="hljs-string">"https://data-api.ecb.europa.eu/service/data/BSI/M.U2.Y.V.M30.X.I.U2.2300.Z01.A?format=csvdata"</span>;
t = <span class="hljs-built_in">readtable</span>(url);


</div></code></pre>
<h2 id="eurostat">EUROSTAT</h2>
<h3 id="gu%C3%ADa-r%C3%A1pida-eurostat-con-matlab">Guía rápida: Eurostat con MATLAB</h3>
<p>Este documento explica cómo usar la función en <code>matlab/eurostat/eurostat_function.m</code> para descargar datos SDMX-CSV de Eurostat y obtenerlos como una tabla en MATLAB.</p>
<h4 id="requisitos">Requisitos</h4>
<ul>
<li>Ninguno adicional a MATLAB.</li>
</ul>
<h4 id="codigos-ejemplo">Codigos ejemplo</h4>
<ul>
<li><code>eurostat_onlylink.m</code>: ejemplo que descarga y lee el csv directamente del link de la API en una linea.</li>
<li><code>eurostat_min.m</code>: ejemplo mínimo para construir la URL SDMX-CSV y guardar en CSV.</li>
<li><code>eurostat_example.m</code>: ejemplo de uso de la función <code>eurostat_api_function</code> devolviendo una tabla y exportándola a CSV.</li>
</ul>
<h4 id="inputs">Inputs</h4>
<ul>
<li>
<p><strong>Obligatorios</strong></p>
<ul>
<li><code>dataset_identifier</code>: identificador del dataset (p. ej., <code>&quot;nama_10_a64&quot;</code>).</li>
<li><code>filters</code>: struct con dimensiones válidas del dataset (p. ej., <code>geo</code>, <code>na_item</code>, <code>unit</code>, <code>TIME_PERIOD</code>) mapeadas a valores (string o cellstr).</li>
</ul>
</li>
<li>
<p><strong>Opcionales</strong></p>
<ul>
<li><code>agency_identifier</code> (por defecto <code>&quot;ESTAT&quot;</code>).</li>
<li><code>dataset_version</code> (por defecto <code>&quot;1.0&quot;</code>).</li>
<li><code>compress</code> (por defecto <code>&quot;false&quot;</code>).</li>
<li><code>format</code> (por defecto <code>&quot;csvdata&quot;</code>).</li>
<li><code>formatVersion</code> (por defecto <code>&quot;2.0&quot;</code>).</li>
<li><code>lang</code> (por defecto <code>&quot;en&quot;</code>).</li>
<li><code>labels</code> (por defecto <code>&quot;name&quot;</code>).</li>
</ul>
</li>
</ul>
<h4 id="c%C3%B3mo-elegir-inputs">Cómo elegir inputs</h4>
<ol>
<li>Lo más sencillo es ir a Eurostat, buscar la serie de interés y copiar el codigo de la serie. Mirar el codigo de las variables que nos interesan y los codigos de los valores que queremos filtrar.</li>
<li>Usar el codigo de la serie como <code>dataset_identifier</code>.</li>
<li>Ajustar filtros (<code>filters</code>).
<ul>
<li>Añada o cambie dimensiones válidas del dataset (p. ej., <code>geo</code>, <code>na_item</code>, <code>unit</code>, <code>freq</code>, <code>TIME_PERIOD</code>).</li>
<li>Para valores múltiples use cell arrays en MATLAB: <code>{'ES', 'FR'}</code>.</li>
<li>En <code>TIME_PERIOD</code> puede usar operadores SDMX: <code>ge:YYYY</code>, <code>le:YYYY</code>, <code>YYYY:YYYY</code>, <code>ge:200Q1</code>, etc.</li>
</ul>
</li>
<li>Cambiar parametros opcionales si es necesario.</li>
</ol>
<h4 id="sintaxis-de-la-api-sdmx-csv-30">Sintaxis de la API (SDMX-CSV 3.0)</h4>
<ul>
<li><strong>Formato general:</strong><pre class="hljs"><code><div>https://ec.europa.eu/eurostat/api/dissemination/sdmx/3.0/data/dataflow/{agency}/{dataset}/{version}/?c[DIM]=v1,v2&amp;format=csvdata&amp;formatVersion=2.0
</div></code></pre>
</li>
</ul>
<h4 id="output">Output</h4>
<ul>
<li>Una <code>table</code> con los datos descargados de Eurostat.</li>
</ul>
<h4 id="notas">Notas</h4>
<ul>
<li>Los filtros deben usar nombres de dimensiones válidas del dataset.</li>
</ul>
<h3 id="eurostatapifunctionm">eurostat_api_function.m</h3>
<pre class="hljs"><code><div><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">T</span> = <span class="hljs-title">eurostat_api_function</span><span class="hljs-params">(dataset_identifier, filters, agency_identifier, dataset_version, compress, format, formatVersion, lang, labels)</span></span>
<span class="hljs-comment">% EUROSTAT_API_FUNCTION Descarga SDMX-CSV (Eurostat) y lo devuelve como tabla</span>
<span class="hljs-comment">%   T = eurostat_api_function(dataset_identifier, filters, ...)</span>
<span class="hljs-comment">%   Parámetros obligatorios:</span>
<span class="hljs-comment">%     dataset_identifier (char) - identificador del dataset (p. ej., 'nama_10_a64')</span>
<span class="hljs-comment">%     filters (struct) - dimensiones -&gt; valores (char/string/cellstr)</span>
<span class="hljs-comment">%   Parámetros opcionales (por defecto como en R):</span>
<span class="hljs-comment">%     agency_identifier = 'ESTAT'</span>
<span class="hljs-comment">%     dataset_version   = '1.0'</span>
<span class="hljs-comment">%     compress          = 'false'</span>
<span class="hljs-comment">%     format            = 'csvdata'</span>
<span class="hljs-comment">%     formatVersion     = '2.0'</span>
<span class="hljs-comment">%     lang              = 'en'</span>
<span class="hljs-comment">%     labels            = 'name'</span>
<span class="hljs-comment">%   Devuelve:</span>
<span class="hljs-comment">%     T (table) - datos descargados como tabla de MATLAB</span>

<span class="hljs-keyword">if</span> nargin &lt; <span class="hljs-number">3</span> || <span class="hljs-built_in">isempty</span>(agency_identifier), agency_identifier = <span class="hljs-string">'ESTAT'</span>; <span class="hljs-keyword">end</span>
<span class="hljs-keyword">if</span> nargin &lt; <span class="hljs-number">4</span> || <span class="hljs-built_in">isempty</span>(dataset_version),   dataset_version = <span class="hljs-string">'1.0'</span>; <span class="hljs-keyword">end</span>
<span class="hljs-keyword">if</span> nargin &lt; <span class="hljs-number">5</span> || <span class="hljs-built_in">isempty</span>(compress),          compress = <span class="hljs-string">'false'</span>; <span class="hljs-keyword">end</span>
<span class="hljs-keyword">if</span> nargin &lt; <span class="hljs-number">6</span> || <span class="hljs-built_in">isempty</span>(format),            format = <span class="hljs-string">'csvdata'</span>; <span class="hljs-keyword">end</span>
<span class="hljs-keyword">if</span> nargin &lt; <span class="hljs-number">7</span> || <span class="hljs-built_in">isempty</span>(formatVersion),     formatVersion = <span class="hljs-string">'2.0'</span>; <span class="hljs-keyword">end</span>
<span class="hljs-keyword">if</span> nargin &lt; <span class="hljs-number">8</span> || <span class="hljs-built_in">isempty</span>(lang),              lang = <span class="hljs-string">'en'</span>; <span class="hljs-keyword">end</span>
<span class="hljs-keyword">if</span> nargin &lt; <span class="hljs-number">9</span> || <span class="hljs-built_in">isempty</span>(labels),            labels = <span class="hljs-string">'name'</span>; <span class="hljs-keyword">end</span>

base_url = <span class="hljs-string">'https://ec.europa.eu/eurostat/api/dissemination/sdmx/3.0/data/dataflow'</span>;

<span class="hljs-comment">% Identificador completo: context/agency/dataset/version</span>
data_identifier = strjoin({agency_identifier, dataset_identifier, dataset_version}, <span class="hljs-string">'/'</span>);
url = sprintf(<span class="hljs-string">'%s/%s/'</span>, base_url, data_identifier);

<span class="hljs-comment">% Preparar parámetros de filtros c[dim]=v1,v2</span>
<span class="hljs-keyword">if</span> ~isstruct(filters)
    error(<span class="hljs-string">"'filters' debe ser un struct: dimension -&gt; valores"</span>);
<span class="hljs-keyword">end</span>

filter_names = fieldnames(filters);
qp = {};
<span class="hljs-keyword">for</span> <span class="hljs-built_in">i</span> = <span class="hljs-number">1</span>:<span class="hljs-built_in">numel</span>(filter_names)
    dim = filter_names{<span class="hljs-built_in">i</span>};
    vals = filters.(dim);
    <span class="hljs-keyword">if</span> ischar(vals) || isstring(vals)
        vals = cellstr(vals);
    <span class="hljs-keyword">elseif</span> isnumeric(vals)
        vals = cellstr(string(vals));
    <span class="hljs-keyword">elseif</span> iscell(vals)
        <span class="hljs-comment">% ok</span>
    <span class="hljs-keyword">else</span>
        error(<span class="hljs-string">'Tipo de valor no soportado para la dimensión %s'</span>, dim);
    <span class="hljs-keyword">end</span>
    joined = strjoin(vals, <span class="hljs-string">','</span>);
    qp{<span class="hljs-keyword">end</span>+<span class="hljs-number">1</span>} = sprintf(<span class="hljs-string">'c[%s]=%s'</span>, dim, joined); <span class="hljs-comment">%#ok&lt;AGROW&gt;</span>
<span class="hljs-keyword">end</span>

<span class="hljs-comment">% Parámetros comunes</span>
qp{<span class="hljs-keyword">end</span>+<span class="hljs-number">1</span>} = sprintf(<span class="hljs-string">'compress=%s'</span>, compress);
qp{<span class="hljs-keyword">end</span>+<span class="hljs-number">1</span>} = sprintf(<span class="hljs-string">'format=%s'</span>, format);
qp{<span class="hljs-keyword">end</span>+<span class="hljs-number">1</span>} = sprintf(<span class="hljs-string">'formatVersion=%s'</span>, formatVersion);
qp{<span class="hljs-keyword">end</span>+<span class="hljs-number">1</span>} = sprintf(<span class="hljs-string">'lang=%s'</span>, lang);
qp{<span class="hljs-keyword">end</span>+<span class="hljs-number">1</span>} = sprintf(<span class="hljs-string">'labels=%s'</span>, labels);

query = strjoin(qp, <span class="hljs-string">'&amp;'</span>);
urlFull = [url <span class="hljs-string">'?'</span> query];

<span class="hljs-comment">% Leer directamente como tabla</span>
T = <span class="hljs-built_in">readtable</span>(urlFull, <span class="hljs-string">'FileType'</span>, <span class="hljs-string">'text'</span>);

<span class="hljs-keyword">end</span>



</div></code></pre>
<h3 id="eurostatexamplem">eurostat_example.m</h3>
<pre class="hljs"><code><div><span class="hljs-comment">% Ejemplo de uso: Eurostat SDMX-CSV a tabla y CSV</span>

cd(pwd);
<span class="hljs-comment">% Parámetros de ejemplo</span>
dataset_identifier = <span class="hljs-string">'nama_10_a64'</span>;
filters = struct(<span class="hljs-string">'geo'</span>, {{<span class="hljs-string">'IT'</span>}}, <span class="hljs-string">'na_item'</span>, {{<span class="hljs-string">'B1G'</span>}}, <span class="hljs-string">'unit'</span>, <span class="hljs-string">'CLV20_MEUR'</span>, <span class="hljs-string">'TIME_PERIOD'</span>, <span class="hljs-string">'ge:1995'</span>);

<span class="hljs-comment">% Llamar a la función</span>
T = eurostat_api_function(dataset_identifier, filters);

<span class="hljs-comment">% Carpeta de salida</span>
outPath = <span class="hljs-string">'eurostat_example.csv'</span>;

<span class="hljs-comment">% Guardar como CSV</span>
<span class="hljs-built_in">writetable</span>(T, outPath, <span class="hljs-string">'FileType'</span>, <span class="hljs-string">'text'</span>);



</div></code></pre>
<h3 id="eurostatminm">eurostat_min.m</h3>
<pre class="hljs"><code><div><span class="hljs-comment">% Descargador Eurostat SDMX-CSV — script mínimo</span>
<span class="hljs-comment">% ----------------------------------------------------------------------------</span>
<span class="hljs-comment">% Objetivo</span>
<span class="hljs-comment">%   Construir la URL SDMX-CSV de Eurostat, descargar los datos, cargarlos en</span>
<span class="hljs-comment">%   una tabla de MATLAB y exportar a CSV.</span>
<span class="hljs-comment">% Parámetros editables</span>
<span class="hljs-comment">%   - dataset_identifier: identificador del dataset</span>
<span class="hljs-comment">%   - filters: struct con dimensiones válidas -&gt; valores</span>
<span class="hljs-comment">% Salida</span>
<span class="hljs-comment">%   - Archivo CSV con los datos</span>
<span class="hljs-comment">% Pasos</span>
<span class="hljs-comment">%   1) Construir el identificador context/agency/dataset/version</span>
<span class="hljs-comment">%   2) Construir la query de filtros c[DIM]=v1,v2</span>
<span class="hljs-comment">%   3) Leer a tabla y exportar a CSV</span>

<span class="hljs-comment">% Id del dataset</span>
dataset_identifier = <span class="hljs-string">'nama_10_a64'</span>;
<span class="hljs-comment">% Filtros de ejemplo</span>
filters = struct(<span class="hljs-string">'geo'</span>, {{<span class="hljs-string">'IT'</span>}}, <span class="hljs-string">'na_item'</span>, {{<span class="hljs-string">'B1G'</span>}}, <span class="hljs-string">'unit'</span>, <span class="hljs-string">'CLV20_MEUR'</span>, <span class="hljs-string">'TIME_PERIOD'</span>, <span class="hljs-string">'ge:1995'</span>);

<span class="hljs-comment">% parametros opcionales</span>
agency_identifier = <span class="hljs-string">'ESTAT'</span>;
dataset_version = <span class="hljs-string">'1.0'</span>;
compress = <span class="hljs-string">'false'</span>;
format = <span class="hljs-string">'csvdata'</span>;
formatVersion = <span class="hljs-string">'2.0'</span>;
lang = <span class="hljs-string">'en'</span>;
labels = <span class="hljs-string">'name'</span>;

<span class="hljs-comment">% Construir la URL SDMX-CSV</span>
base_url = <span class="hljs-string">'https://ec.europa.eu/eurostat/api/dissemination/sdmx/3.0/data/dataflow'</span>;
data_identifier = [agency_identifier <span class="hljs-string">'/'</span> dataset_identifier <span class="hljs-string">'/'</span> dataset_version];
url = [base_url <span class="hljs-string">'/'</span> data_identifier <span class="hljs-string">'/'</span>];

<span class="hljs-comment">% Construir la query de filtros</span>
qp = {};
fns = fieldnames(filters);
<span class="hljs-keyword">for</span> <span class="hljs-built_in">i</span> = <span class="hljs-number">1</span>:<span class="hljs-built_in">numel</span>(fns)
    dim = fns{<span class="hljs-built_in">i</span>};
    vals = filters.(dim);
    <span class="hljs-keyword">if</span> ischar(vals) || isstring(vals); vals = cellstr(vals); <span class="hljs-keyword">end</span>
    <span class="hljs-keyword">if</span> isnumeric(vals); vals = cellstr(string(vals)); <span class="hljs-keyword">end</span>
    joined = strjoin(vals, <span class="hljs-string">','</span>);
    qp{<span class="hljs-keyword">end</span>+<span class="hljs-number">1</span>} = sprintf(<span class="hljs-string">'c[%s]=%s'</span>, dim, joined); <span class="hljs-comment">%#ok&lt;AGROW&gt;</span>
<span class="hljs-keyword">end</span>
qp{<span class="hljs-keyword">end</span>+<span class="hljs-number">1</span>} = [<span class="hljs-string">'compress='</span> compress];
qp{<span class="hljs-keyword">end</span>+<span class="hljs-number">1</span>} = [<span class="hljs-string">'format='</span> format];
qp{<span class="hljs-keyword">end</span>+<span class="hljs-number">1</span>} = [<span class="hljs-string">'formatVersion='</span> formatVersion];
qp{<span class="hljs-keyword">end</span>+<span class="hljs-number">1</span>} = [<span class="hljs-string">'lang='</span> lang];
qp{<span class="hljs-keyword">end</span>+<span class="hljs-number">1</span>} = [<span class="hljs-string">'labels='</span> labels];

query = strjoin(qp, <span class="hljs-string">'&amp;'</span>);
urlFull = [url <span class="hljs-string">'?'</span> query];

<span class="hljs-comment">% Leer la URL directamente a tabla</span>
T = <span class="hljs-built_in">readtable</span>(urlFull, <span class="hljs-string">'FileType'</span>, <span class="hljs-string">'text'</span>);

<span class="hljs-comment">% Exportar la tabla a CSV</span>
<span class="hljs-built_in">writetable</span>(T, <span class="hljs-string">'eurostat_min.csv'</span>, <span class="hljs-string">'FileType'</span>, <span class="hljs-string">'text'</span>);



</div></code></pre>
<h3 id="eurostatonlylinkm">eurostat_onlylink.m</h3>
<pre class="hljs"><code><div><span class="hljs-comment">% Minimal Eurostat API downloader (link only)</span>
url = <span class="hljs-string">"https://ec.europa.eu/eurostat/api/dissemination/sdmx/3.0/data/dataflow/ESTAT/nama_10_a64/1.0/?c[geo]=ES,FR&amp;c[na_item]=B1G,P1&amp;c[unit]=CLV20_MEUR&amp;c[TIME_PERIOD]=ge:1995&amp;compress=false&amp;format=csvdata&amp;formatVersion=2.0&amp;lang=en&amp;labels=name"</span>;
t = <span class="hljs-built_in">readtable</span>(url);


</div></code></pre>
<h2 id="fred">FRED</h2>
<h3 id="gu%C3%ADa-r%C3%A1pida-fred-con-matlab">Guía rápida: FRED con MATLAB</h3>
<p>Este documento explica cómo usar las funciones en <code>matlab/fred/fred_function.m</code> para descargar datos desde FRED.</p>
<h4 id="requisitos">Requisitos</h4>
<ul>
<li>Ninguno adicional a MATLAB.</li>
</ul>
<h4 id="codigos-ejemplo">Codigos ejemplo</h4>
<ul>
<li><code>fred_onlylink.m</code>: ejemplo que descarga y lee el csv directamente del link de la API en una linea.</li>
<li><code>fred_min.m</code>: ejemplo mínimo que descarga un CSV de fredgraph.</li>
<li><code>fred_example.m</code>: ejemplo de uso de ambas funciones.</li>
</ul>
<h4 id="inputs">Inputs</h4>
<ul>
<li>
<p><strong>fredgraph_api_function</strong></p>
<ul>
<li><code>graphId</code>: identificador del gráfico compartido (obligatorio).</li>
</ul>
</li>
<li>
<p><strong>fred_api_function</strong></p>
<ul>
<li><code>series_id</code>: identificador de la serie (p. ej., <code>&quot;GDP&quot;</code>).</li>
<li>Opcionales: <code>observation_start</code>, <code>observation_end</code>, <code>realtime_start</code>, <code>realtime_end</code>, <code>limit</code>, <code>offset</code>, <code>sort_order</code>, <code>units</code>, <code>frequency</code>, <code>aggregation_method</code>, <code>output_type</code>, <code>vintage_dates</code>, <code>api_key</code>.</li>
</ul>
</li>
</ul>
<h4 id="c%C3%B3mo-elegir-inputs">Cómo elegir inputs</h4>
<ul>
<li>
<p>Para <code>fredgraph_api_function</code>:</p>
<ul>
<li>Obtenga <code>graphId</code> desde el enlace compartido del gráfico (parámetro <code>?g=</code> en la URL).</li>
</ul>
</li>
<li>
<p>Para <code>fred_api_function</code>:</p>
<ol>
<li>Elija <code>series_id</code> (p. ej., <code>GDP</code>, esto suele estar al lado del nombre de la serie en FRED entre paréntesis).</li>
<li>Defina <code>FRED_API_KEY</code> como variable de entorno o pásela como argumento.</li>
<li>Si es necesario, cambie los otros parámetros opcionales.</li>
</ol>
</li>
</ul>
<h4 id="sintaxis-de-la-api">Sintaxis de la API</h4>
<ul>
<li><strong>fredgraph CSV:</strong><pre class="hljs"><code><div>https://fred.stlouisfed.org/graph/fredgraph.csv?g={graphId}
</div></code></pre>
</li>
<li><strong>API v1 observaciones:</strong><pre class="hljs"><code><div>https://api.stlouisfed.org/fred/series/observations?series_id={id}&amp;api_key=...&amp;file_type=json
</div></code></pre>
</li>
</ul>
<h4 id="output">Output</h4>
<ul>
<li><code>table</code> con las observaciones devueltas por cada método.</li>
</ul>
<h3 id="fredapifunctionm">fred_api_function.m</h3>
<pre class="hljs"><code><div>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">T</span> = <span class="hljs-title">fred_api_function</span><span class="hljs-params">(series_id, varargin)</span></span>
    <span class="hljs-comment">% FRED_API_FUNCTION Descarga observaciones de la API v1 de FRED (JSON) a tabla</span>
    <span class="hljs-comment">%   T = fred_api_function(series_id, 'Name', Value, ...)</span>
    <span class="hljs-comment">%   Parámetros obligatorios:</span>
    <span class="hljs-comment">%     series_id (char)</span>
    <span class="hljs-comment">%   Parámetros Nombre-Valor (opcionales):</span>
    <span class="hljs-comment">%     'observation_start','observation_end','realtime_start','realtime_end',</span>
    <span class="hljs-comment">%     'limit','offset','sort_order','units','frequency','aggregation_method',</span>
    <span class="hljs-comment">%     'output_type','vintage_dates','api_key'</span>
    
    p = inputParser;
    addRequired(p, <span class="hljs-string">'series_id'</span>, @(x)ischar(x) || isstring(x));
    addParameter(p, <span class="hljs-string">'observation_start'</span>, []);
    addParameter(p, <span class="hljs-string">'observation_end'</span>, []);
    addParameter(p, <span class="hljs-string">'realtime_start'</span>, []);
    addParameter(p, <span class="hljs-string">'realtime_end'</span>, []);
    addParameter(p, <span class="hljs-string">'limit'</span>, []);
    addParameter(p, <span class="hljs-string">'offset'</span>, []);
    addParameter(p, <span class="hljs-string">'sort_order'</span>, []);
    addParameter(p, <span class="hljs-string">'units'</span>, []);
    addParameter(p, <span class="hljs-string">'frequency'</span>, []);
    addParameter(p, <span class="hljs-string">'aggregation_method'</span>, []);
    addParameter(p, <span class="hljs-string">'output_type'</span>, []);
    addParameter(p, <span class="hljs-string">'vintage_dates'</span>, []);
    addParameter(p, <span class="hljs-string">'api_key'</span>, getenv(<span class="hljs-string">'FRED_API_KEY'</span>));
    parse(p, series_id, varargin{:});
    pp = p.Results;
    
    url = <span class="hljs-string">'https://api.stlouisfed.org/fred/series/observations'</span>;
    q = struct(<span class="hljs-string">'series_id'</span>, char(pp.series_id), <span class="hljs-string">'api_key'</span>, char(pp.api_key), <span class="hljs-string">'file_type'</span>, <span class="hljs-string">'json'</span>);
    fn = fieldnames(pp);
    <span class="hljs-keyword">for</span> <span class="hljs-built_in">i</span> = <span class="hljs-number">1</span>:<span class="hljs-built_in">numel</span>(fn)
        k = fn{<span class="hljs-built_in">i</span>};
        <span class="hljs-keyword">if</span> any(strcmp(k, {<span class="hljs-string">'series_id'</span>,<span class="hljs-string">'api_key'</span>})), <span class="hljs-keyword">continue</span>; <span class="hljs-keyword">end</span>
        v = pp.(k);
        <span class="hljs-keyword">if</span> ~<span class="hljs-built_in">isempty</span>(v)
            q.(k) = v;
        <span class="hljs-keyword">end</span>
    <span class="hljs-keyword">end</span>
    
    <span class="hljs-comment">% Construir querystring</span>
    qp = {};
    qf = fieldnames(q);
    <span class="hljs-keyword">for</span> <span class="hljs-built_in">i</span> = <span class="hljs-number">1</span>:<span class="hljs-built_in">numel</span>(qf)
        qp{<span class="hljs-keyword">end</span>+<span class="hljs-number">1</span>} = sprintf(<span class="hljs-string">'%s=%s'</span>, qf{<span class="hljs-built_in">i</span>}, string(q.(qf{<span class="hljs-built_in">i</span>}))); <span class="hljs-comment">%#ok&lt;AGROW&gt;</span>
    <span class="hljs-keyword">end</span>
    urlFull = [url <span class="hljs-string">'?'</span> strjoin(qp, <span class="hljs-string">'&amp;'</span>)];
    
    txt = webread(urlFull, weboptions(<span class="hljs-string">'Timeout'</span>, <span class="hljs-number">60</span>, <span class="hljs-string">'ContentType'</span>, <span class="hljs-string">'text'</span>));
    obj = jsondecode(txt);
    <span class="hljs-keyword">if</span> ~isfield(obj, <span class="hljs-string">'observations'</span>)
        error(<span class="hljs-string">'Estructura inesperada de la API de FRED; falta observations'</span>);
    <span class="hljs-keyword">end</span>
    T = struct2table(obj.observations);
    
    <span class="hljs-keyword">end</span>
    
    
    
</div></code></pre>
<h3 id="fredexamplem">fred_example.m</h3>
<pre class="hljs"><code><div><span class="hljs-comment">% Ejemplo de uso: FRED fredgraph y API v1</span>

cd(pwd);
<span class="hljs-comment">% fredgraph (sin API key)</span>
T_graph = fredgraph_api_function(<span class="hljs-string">'1wmdD'</span>);

<span class="hljs-comment">% API v1 (requiere FRED_API_KEY)</span>
setenv(<span class="hljs-string">'FRED_API_KEY'</span>,<span class="hljs-string">'28ee932ab037f5486dae766aebf0bec3'</span>);
T_api = fred_api_function(<span class="hljs-string">'GDP'</span>);

outPath_graph = <span class="hljs-string">'fred_graph_example.csv'</span>;
outPath_api = <span class="hljs-string">'fred_api_example.csv'</span>;

<span class="hljs-built_in">writetable</span>(T_graph, outPath_graph, <span class="hljs-string">'FileType'</span>, <span class="hljs-string">'text'</span>);
<span class="hljs-built_in">writetable</span>(T_api,   outPath_api,   <span class="hljs-string">'FileType'</span>, <span class="hljs-string">'text'</span>);



</div></code></pre>
<h3 id="fredminm">fred_min.m</h3>
<pre class="hljs"><code><div><span class="hljs-comment">% Descargador FRED (fredgraph CSV) — script mínimo</span>
<span class="hljs-comment">% ----------------------------------------------------------------------------</span>
<span class="hljs-comment">% Objetivo</span>
<span class="hljs-comment">%   Descargar el CSV de un gráfico compartido (fredgraph) y guardarlo como CSV tras</span>
<span class="hljs-comment">%   cargarlo en una tabla de MATLAB.</span>
<span class="hljs-comment">% Parámetros editables</span>
<span class="hljs-comment">%   - graphId: identificador del gráfico (parámetro g de la URL)</span>
<span class="hljs-comment">% Salida</span>
<span class="hljs-comment">%   - Archivo CSV con la serie del gráfico</span>
<span class="hljs-comment">% Pasos</span>
<span class="hljs-comment">%   1) Construir URL fredgraph.csv?g=...</span>
<span class="hljs-comment">%   2) Leer a tabla y exportar a CSV</span>

<span class="hljs-comment">% Identificador del gráfico</span>
graphId = <span class="hljs-string">'1wmdD'</span>;
<span class="hljs-comment">% Construir la URL</span>
url = sprintf(<span class="hljs-string">'https://fred.stlouisfed.org/graph/fredgraph.csv?g=%s'</span>, graphId);
<span class="hljs-comment">% Leer la URL directamente a tabla</span>
T = <span class="hljs-built_in">readtable</span>(url, <span class="hljs-string">'FileType'</span>, <span class="hljs-string">'text'</span>);
<span class="hljs-comment">% Exportar la tabla a CSV</span>
<span class="hljs-built_in">writetable</span>(T, <span class="hljs-string">'fred_graph_min.csv'</span>, <span class="hljs-string">'FileType'</span>, <span class="hljs-string">'text'</span>);



</div></code></pre>
<h3 id="fredonlylinkm">fred_onlylink.m</h3>
<pre class="hljs"><code><div><span class="hljs-comment">% Minimal FRED API downloader (link only)</span>
url = <span class="hljs-string">"https://fred.stlouisfed.org/graph/fredgraph.csv?g=1wmdD"</span>;
t = <span class="hljs-built_in">readtable</span>(url);


</div></code></pre>
<h3 id="fredgraphapifunctionm">fredgraph_api_function.m</h3>
<pre class="hljs"><code><div><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">T</span> = <span class="hljs-title">fredgraph_api_function</span><span class="hljs-params">(graphId)</span></span>
<span class="hljs-comment">% FREDGRAPH_API_FUNCTION Descarga CSV de fredgraph y devuelve tabla</span>
<span class="hljs-comment">%   T = fredgraph_api_function(graphId)</span>
<span class="hljs-comment">%   Parámetros:</span>
<span class="hljs-comment">%     graphId (char) - identificador del gráfico compartido en FRED</span>
<span class="hljs-comment">%   Devuelve:</span>
<span class="hljs-comment">%     T (table) - datos del CSV de fredgraph</span>

url = sprintf(<span class="hljs-string">'https://fred.stlouisfed.org/graph/fredgraph.csv?g=%s'</span>, graphId);
T = <span class="hljs-built_in">readtable</span>(url, <span class="hljs-string">'FileType'</span>, <span class="hljs-string">'text'</span>);

<span class="hljs-keyword">end</span>

</div></code></pre>
<h2 id="imf">IMF</h2>
<h3 id="gu%C3%ADa-r%C3%A1pida-fmi-con-matlab">Guía rápida: FMI con MATLAB</h3>
<p>Este documento explica cómo usar la función en <code>matlab/imf/imf_api_function.m</code> para descargar datos SDMX-CSV de la API SDMX 3.0 del FMI y obtenerlos como una tabla en MATLAB.</p>
<h4 id="requisitos">Requisitos</h4>
<ul>
<li>Ninguno adicional a MATLAB.</li>
</ul>
<h4 id="codigos-ejemplo">Codigos ejemplo</h4>
<ul>
<li><code>imf_onlylink.m</code>: ejemplo que descarga y lee el xml directamente del link de la API en una linea (usando <code>webread</code>).</li>
<li><code>imf_min.m</code>: ejemplo mínimo para construir la URL SDMX-CSV y guardar en CSV.</li>
<li><code>imf_example.m</code>: ejemplo de uso de la función <code>imf_api_function</code> devolviendo una tabla y exportándola a CSV.</li>
</ul>
<h4 id="inputs">Inputs</h4>
<ul>
<li>
<p><strong>Obligatorios</strong></p>
<ul>
<li><code>dataset_identifier</code>: identificador del dataset (p. ej., &quot;QNEA&quot;).</li>
<li><code>data_selection</code>: clave SDMX completa tras la <code>/</code> (orden y códigos según el dataset). Ej.: &quot;ESP.B1GQ.Q.SA.XDC.Q&quot; o múltiples países &quot;ESP+FRA.B1GQ.Q.SA.XDC.Q&quot;.</li>
</ul>
</li>
<li>
<p><strong>Opcionales</strong></p>
<ul>
<li><code>filters</code> (struct): filtros SDMX convertidos a <code>c[DIM]</code>. Para varias condiciones use <code>+</code>.</li>
<li><code>agency_identifier</code>: por defecto &quot;IMF.STA&quot;.</li>
<li><code>dataset_version</code>: por defecto &quot;+&quot; (última versión).</li>
<li><code>accept_csv_version</code>: por defecto &quot;1.0.0&quot;.</li>
</ul>
</li>
</ul>
<h4 id="c%C3%B3mo-elegir-inputs">Cómo elegir inputs</h4>
<ol>
<li>Localice el dataset y el indicador en el portal del FMI o en la documentación de SDMX.</li>
<li>Construya la <code>key</code> con las dimensiones requeridas por el dataset. En IFS suele ser <code>FREQ.REF_AREA.INDICATOR</code>.</li>
<li>Use <code>filters</code> si necesita condiciones adicionales.</li>
</ol>
<h4 id="sintaxis-de-la-api-fmi-sdmx-30">Sintaxis de la API (FMI SDMX 3.0)</h4>
<ul>
<li><strong>Formato general (CSV):</strong><pre class="hljs"><code><div>https://api.imf.org/external/sdmx/3.0/data/{context}/{agencyID}/{resourceID}/{version}/{key}[?c][&amp;updatedAfter][&amp;firstNObservations][&amp;lastNObservations][&amp;dimensionAtObservation][&amp;attributes][&amp;measures][&amp;includeHistory][&amp;asOf]
</div></code></pre>
Referencia al servicio SDMX JSON del FMI: <code>https://dataservices.imf.org/REST/SDMX_JSON.svc</code></li>
</ul>
<h4 id="output">Output</h4>
<ul>
<li>Una <code>table</code> con los datos descargados en formato SDMX-CSV.</li>
</ul>
<h4 id="enlaces-%C3%BAtiles">Enlaces útiles</h4>
<ul>
<li>Conocimiento/soporte del FMI (categoría API/SDMX): https://datasupport.imf.org/knowledge?id=knowledge_category&amp;sys_kb_id=d41858e747294ad8805d07c4f16d43e0&amp;category_id=9959b2bc1b6391903dba646fbd4bcb6a</li>
</ul>
<h3 id="imfapifunctionm">imf_api_function.m</h3>
<pre class="hljs"><code><div><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">T</span> = <span class="hljs-title">imf_api_function</span><span class="hljs-params">(dataset_identifier, data_selection, filters, agency_identifier, dataset_version, accept_csv_version, base_url)</span></span>
<span class="hljs-comment">% IMF_API_FUNCTION Descarga SDMX-CSV (IMF SDMX 3.0) y devuelve una tabla</span>
<span class="hljs-comment">%   T = imf_api_function(dataset_identifier, data_selection, filters, ...)</span>
<span class="hljs-comment">%   Parámetros obligatorios:</span>
<span class="hljs-comment">%     dataset_identifier (char) - p. ej., 'QNEA'</span>
<span class="hljs-comment">%     data_selection     (char) - clave SDMX tras la '/'</span>
<span class="hljs-comment">%   Parámetros opcionales (por defecto similares a R):</span>
<span class="hljs-comment">%     filters            (struct) - filtros tipo c[DIM] -&gt; valores (cellstr/char)</span>
<span class="hljs-comment">%                                 Ej.: struct('TIME_PERIOD', {{'ge:2020-Q1','le:2020-Q4'}})</span>
<span class="hljs-comment">%     agency_identifier  (char)   - por defecto 'IMF.STA'</span>
<span class="hljs-comment">%     dataset_version    (char)   - por defecto '+' (última versión)</span>
<span class="hljs-comment">%     accept_csv_version (char)   - por defecto '1.0.0'</span>
<span class="hljs-comment">%     base_url           (char)   - por defecto 'https://api.imf.org/external/sdmx/3.0/data/dataflow'</span>
<span class="hljs-comment">%   Devuelve:</span>
<span class="hljs-comment">%     T (table) - datos descargados como tabla de MATLAB</span>

<span class="hljs-keyword">if</span> nargin &lt; <span class="hljs-number">3</span> || <span class="hljs-built_in">isempty</span>(filters),            filters = struct(); <span class="hljs-keyword">end</span>
<span class="hljs-keyword">if</span> nargin &lt; <span class="hljs-number">4</span> || <span class="hljs-built_in">isempty</span>(agency_identifier),  agency_identifier = <span class="hljs-string">'IMF.STA'</span>; <span class="hljs-keyword">end</span>
<span class="hljs-keyword">if</span> nargin &lt; <span class="hljs-number">5</span> || <span class="hljs-built_in">isempty</span>(dataset_version),    dataset_version = <span class="hljs-string">'+'</span>; <span class="hljs-keyword">end</span>
<span class="hljs-keyword">if</span> nargin &lt; <span class="hljs-number">6</span> || <span class="hljs-built_in">isempty</span>(accept_csv_version), accept_csv_version = <span class="hljs-string">'1.0.0'</span>; <span class="hljs-keyword">end</span>
<span class="hljs-keyword">if</span> nargin &lt; <span class="hljs-number">7</span> || <span class="hljs-built_in">isempty</span>(base_url),           base_url = <span class="hljs-string">'https://api.imf.org/external/sdmx/3.0/data/dataflow'</span>; <span class="hljs-keyword">end</span>

<span class="hljs-comment">% Construir URL: {base}/{agency}/{dataset}/{version}/{key}</span>
url = sprintf(<span class="hljs-string">'%s/%s/%s/%s/%s'</span>, base_url, agency_identifier, dataset_identifier, urlencode_keep_reserved(dataset_version), urlencode_keep_reserved(data_selection));

<span class="hljs-comment">% Construir query de filtros c[DIM]=v1+v2</span>
qp = {};
<span class="hljs-keyword">if</span> ~<span class="hljs-built_in">isempty</span>(filters)
    fns = fieldnames(filters);
    <span class="hljs-keyword">for</span> <span class="hljs-built_in">i</span> = <span class="hljs-number">1</span>:<span class="hljs-built_in">numel</span>(fns)
        dim = fns{<span class="hljs-built_in">i</span>};
        vals = filters.(dim);
        <span class="hljs-keyword">if</span> ischar(vals) || isstring(vals); vals = cellstr(vals); <span class="hljs-keyword">end</span>
        <span class="hljs-keyword">if</span> isnumeric(vals); vals = cellstr(string(vals)); <span class="hljs-keyword">end</span>
        joined = strjoin(vals, <span class="hljs-string">'+'</span>);
        qp{<span class="hljs-keyword">end</span>+<span class="hljs-number">1</span>} = sprintf(<span class="hljs-string">'c[%s]=%s'</span>, dim, joined); <span class="hljs-comment">%#ok&lt;AGROW&gt;</span>
    <span class="hljs-keyword">end</span>
<span class="hljs-keyword">end</span>

urlFull = url;
<span class="hljs-keyword">if</span> ~<span class="hljs-built_in">isempty</span>(qp)
    urlFull = [url <span class="hljs-string">'?'</span> strjoin(qp, <span class="hljs-string">'&amp;'</span>)];
<span class="hljs-keyword">end</span>

<span class="hljs-comment">% Descargar CSV como texto con cabecera Accept SDMX-CSV</span>
opts = weboptions(<span class="hljs-string">'Timeout'</span>, <span class="hljs-number">60</span>, <span class="hljs-string">'ContentType'</span>, <span class="hljs-string">'text'</span>, <span class="hljs-string">'HeaderFields'</span>, {<span class="hljs-string">'Accept'</span> [<span class="hljs-string">'application/vnd.sdmx.data+csv;version='</span> accept_csv_version]});
csvText = webread(urlFull, opts);

<span class="hljs-comment">% Guardar a temp y cargar como tabla</span>
tmp = [tempname <span class="hljs-string">'.csv'</span>];
fid = fopen(tmp, <span class="hljs-string">'w'</span>);
fprintf(fid, <span class="hljs-string">'%s'</span>, csvText);
fclose(fid);
T = <span class="hljs-built_in">readtable</span>(tmp, <span class="hljs-string">'FileType'</span>, <span class="hljs-string">'text'</span>);
<span class="hljs-keyword">try</span>, delete(tmp); <span class="hljs-keyword">end</span> <span class="hljs-comment">%#ok&lt;TRYNC&gt;</span>

<span class="hljs-keyword">end</span>

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">out</span> = <span class="hljs-title">urlencode_keep_reserved</span><span class="hljs-params">(s)</span></span>
<span class="hljs-comment">% URLENCODE_KEEP_RESERVED Codifica s preservando caracteres reservados SDMX ('+', '*', ',', ':')</span>
<span class="hljs-comment">% MATLAB urlencode codifica demasiado; aquí mantenemos algunos símbolos útiles</span>
s = string(s);
<span class="hljs-comment">% Primero usar urlencode, luego revertir ciertos reservados</span>
out = char(java.net.URLEncoder.encode(char(s), <span class="hljs-string">'UTF-8'</span>));
<span class="hljs-comment">% Revertir reservados permitidos en el path SDMX</span>
out = strrep(out, <span class="hljs-string">'%2B'</span>, <span class="hljs-string">'+'</span>);
out = strrep(out, <span class="hljs-string">'%2A'</span>, <span class="hljs-string">'*'</span>);
out = strrep(out, <span class="hljs-string">'%2C'</span>, <span class="hljs-string">','</span>);
out = strrep(out, <span class="hljs-string">'%3A'</span>, <span class="hljs-string">':'</span>);
<span class="hljs-keyword">end</span>

</div></code></pre>
<h3 id="imfexamplem">imf_example.m</h3>
<pre class="hljs"><code><div><span class="hljs-comment">% Ejemplo de uso: IMF SDMX-CSV -&gt; tabla y CSV</span>

cd(pwd);
<span class="hljs-comment">%cd('matlab/imf')</span>
<span class="hljs-comment">% Parámetros de ejemplo (coinciden con R/imf/imf_example.R)</span>
dataset_identifier = <span class="hljs-string">'QNEA'</span>;
<span class="hljs-comment">% Múltiples países en la clave SDMX con '+'</span>
data_selection = <span class="hljs-string">'ESP+FRA.B1GQ.Q.SA.XDC.Q'</span>;
filters = struct(<span class="hljs-string">'TIME_PERIOD'</span>, {{<span class="hljs-string">'ge:2020-Q1'</span>,<span class="hljs-string">'le:2020-Q4'</span>}});

<span class="hljs-comment">% Llamar a la función</span>
T = imf_api_function(dataset_identifier, data_selection, filters);

<span class="hljs-comment">% Carpeta de salida</span>
outPath = <span class="hljs-string">'imf_example.csv'</span>;

<span class="hljs-comment">% Guardar como CSV</span>
<span class="hljs-built_in">writetable</span>(T, outPath, <span class="hljs-string">'FileType'</span>, <span class="hljs-string">'text'</span>);

</div></code></pre>
<h3 id="imfminm">imf_min.m</h3>
<pre class="hljs"><code><div><span class="hljs-comment">% Descargador mínimo IMF SDMX-CSV — script mínimo</span>
<span class="hljs-comment">% ----------------------------------------------------------------------------</span>
<span class="hljs-comment">% Objetivo</span>
<span class="hljs-comment">%   Construir la URL SDMX 3.0 del FMI (CSV), descargar los datos, cargarlos en</span>
<span class="hljs-comment">%   una tabla de MATLAB y exportar a CSV.</span>
<span class="hljs-comment">% Parámetros editables</span>
<span class="hljs-comment">%   - agency_identifier, dataset_identifier, dataset_version</span>
<span class="hljs-comment">%   - data_selection: clave SDMX tras la '/'</span>
<span class="hljs-comment">%   - filtros c[DIM] como struct -&gt; lista de valores unidos con '+'</span>
<span class="hljs-comment">% Salida</span>
<span class="hljs-comment">%   - Archivo CSV con los datos</span>
<span class="hljs-comment">% Pasos</span>
<span class="hljs-comment">%   1) Construir {base}/{agency}/{dataset}/{version}/{key}</span>
<span class="hljs-comment">%   2) Añadir filtros c[DIM] en query</span>
<span class="hljs-comment">%   3) Leer como texto (Accept SDMX-CSV) y exportar a CSV</span>

cd(pwd);

<span class="hljs-comment">% Parámetros básicos (análogos a R/imf/imf_min.R)</span>
base_url = <span class="hljs-string">'https://api.imf.org/external/sdmx/3.0/data/dataflow'</span>;
agency_identifier = <span class="hljs-string">'IMF.STA'</span>;
dataset_identifier = <span class="hljs-string">'QNEA'</span>;
dataset_version = <span class="hljs-string">'+'</span>; <span class="hljs-comment">% última versión</span>

<span class="hljs-comment">% Clave SDMX (múltiples países con '+')</span>
data_selection = <span class="hljs-string">'ESP+FRA.B1GQ.Q.SA.XDC.Q'</span>;

<span class="hljs-comment">% Filtros (TIME_PERIOD entre 2020-Q1 y 2020-Q4)</span>
filters = struct(<span class="hljs-string">'TIME_PERIOD'</span>, {{<span class="hljs-string">'ge:2020-Q1'</span>,<span class="hljs-string">'le:2020-Q4'</span>}});

<span class="hljs-comment">% Construcción de URL</span>
url = sprintf(<span class="hljs-string">'%s/%s/%s/%s/%s'</span>, base_url, agency_identifier, dataset_identifier, urlencode_keep_reserved(dataset_version), urlencode_keep_reserved(data_selection));

<span class="hljs-comment">% Construir query de filtros</span>
qp = {};
fns = fieldnames(filters);
<span class="hljs-keyword">for</span> <span class="hljs-built_in">i</span> = <span class="hljs-number">1</span>:<span class="hljs-built_in">numel</span>(fns)
    dim = fns{<span class="hljs-built_in">i</span>};
    vals = filters.(dim);
    <span class="hljs-keyword">if</span> ischar(vals) || isstring(vals); vals = cellstr(vals); <span class="hljs-keyword">end</span>
    <span class="hljs-keyword">if</span> isnumeric(vals); vals = cellstr(string(vals)); <span class="hljs-keyword">end</span>
    qp{<span class="hljs-keyword">end</span>+<span class="hljs-number">1</span>} = sprintf(<span class="hljs-string">'c[%s]=%s'</span>, dim, strjoin(vals, <span class="hljs-string">'+'</span>)); <span class="hljs-comment">%#ok&lt;AGROW&gt;</span>
<span class="hljs-keyword">end</span>

urlFull = url;
<span class="hljs-keyword">if</span> ~<span class="hljs-built_in">isempty</span>(qp)
    urlFull = [url <span class="hljs-string">'?'</span> strjoin(qp, <span class="hljs-string">'&amp;'</span>)];
<span class="hljs-keyword">end</span>

<span class="hljs-comment">% Leer CSV como texto con cabecera Accept SDMX-CSV</span>
opts = weboptions(<span class="hljs-string">'Timeout'</span>, <span class="hljs-number">60</span>, <span class="hljs-string">'ContentType'</span>, <span class="hljs-string">'text'</span>, <span class="hljs-string">'HeaderFields'</span>, {<span class="hljs-string">'Accept'</span> <span class="hljs-string">'application/vnd.sdmx.data+csv;version=1.0.0'</span>});
csvText = webread(urlFull, opts);

<span class="hljs-comment">% Guardar a archivo CSV mínimo</span>
outFile = <span class="hljs-string">'imf_min.csv'</span>;
fid = fopen(outFile, <span class="hljs-string">'w'</span>); fprintf(fid, <span class="hljs-string">'%s'</span>, csvText); fclose(fid);

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">out</span> = <span class="hljs-title">urlencode_keep_reserved</span><span class="hljs-params">(s)</span></span>
<span class="hljs-comment">% URLENCODE_KEEP_RESERVED Codifica s preservando '+' '*' ',' ':'</span>
s = string(s);
out = char(java.net.URLEncoder.encode(char(s), <span class="hljs-string">'UTF-8'</span>));
out = strrep(out, <span class="hljs-string">'%2B'</span>, <span class="hljs-string">'+'</span>);
out = strrep(out, <span class="hljs-string">'%2A'</span>, <span class="hljs-string">'*'</span>);
out = strrep(out, <span class="hljs-string">'%2C'</span>, <span class="hljs-string">','</span>);
out = strrep(out, <span class="hljs-string">'%3A'</span>, <span class="hljs-string">':'</span>);
<span class="hljs-keyword">end</span>

</div></code></pre>
<h3 id="imfonlylinkm">imf_onlylink.m</h3>
<pre class="hljs"><code><div><span class="hljs-comment">% Minimal IMF API downloader (link only). Notice is a xml file, not a csv file.</span>
url = <span class="hljs-string">"https://api.imf.org/external/sdmx/3.0/data/dataflow/IMF.STA/QNEA/%2B/ESP%2BFRA.B1GQ.Q.SA.XDC.Q"</span>;
options = weboptions(<span class="hljs-string">'CertificateFilename'</span>, <span class="hljs-string">''</span>); <span class="hljs-comment">% Disable SSL verification</span>
<span class="hljs-comment">% Reads the XML structure. Requires further parsing to convert to table.</span>
data = webread(url, options); 


</div></code></pre>
<h2 id="ine">INE</h2>
<h3 id="gu%C3%ADa-r%C3%A1pida-ine-jaxit3-con-matlab">Guía rápida: INE JAXIT3 con MATLAB</h3>
<p>Este documento explica cómo usar la función en <code>matlab/ine/ine_jaxi_function.m</code> para descargar datos desde la API de INE JAXIT3 en formato CSV y obtenerlos como una tabla de MATLAB.</p>
<h4 id="requisitos">Requisitos</h4>
<ul>
<li>Ninguno adicional a MATLAB.</li>
</ul>
<h4 id="codigos-ejemplo">Codigos ejemplo</h4>
<ul>
<li><code>ine_jaxi_onlylink.m</code>: ejemplo que descarga y lee el csv directamente del link de la API en una linea.</li>
<li><code>ine_jaxi_min.m</code>: ejemplo mínimo para descargar datos del INE y guardarlos en CSV directamente.</li>
<li><code>ine_jaxi_example.m</code>: ejemplo de uso de la función <code>ine_jaxi_function</code> devolviendo una tabla y exportándola a CSV.</li>
</ul>
<h4 id="inputs">Inputs</h4>
<ul>
<li>
<p><strong>Obligatorios</strong></p>
<ul>
<li><code>tableId</code>: identificador de la tabla INE (p. ej., <code>&quot;67821&quot;</code>).</li>
</ul>
</li>
<li>
<p><strong>Opcionales</strong></p>
<ul>
<li><code>nocab</code>: <code>&quot;1&quot;</code> para evitar cabeceras adicionales (por defecto <code>&quot;1&quot;</code>).</li>
<li><code>directory</code>: segmento de directorio (por defecto <code>&quot;t&quot;</code>).</li>
<li><code>locale</code>: idioma del recurso (por defecto <code>&quot;es&quot;</code>).</li>
<li><code>variant</code>: variante del CSV (por defecto <code>&quot;csv_bdsc&quot;</code>).</li>
</ul>
</li>
</ul>
<h4 id="c%C3%B3mo-elegir-inputs">Cómo elegir inputs</h4>
<ol>
<li>Vaya a la página de la tabla en INE y copie el identificador (número al final de la URL).</li>
<li>Use ese identificador como <code>tableId</code>.</li>
<li>Ajuste parámetros opcionales (<code>nocab</code>, <code>locale</code>, <code>variant</code>, <code>directory</code>) si es necesario.</li>
<li>Si necesita cabeceras compactas para procesamiento, mantenga <code>nocab = &quot;1&quot;</code>.</li>
</ol>
<h4 id="sintaxis-de-la-api-ine-jaxit3">Sintaxis de la API (INE JAXIT3)</h4>
<ul>
<li>
<p><strong>Formato general:</strong></p>
<pre class="hljs"><code><div>https://www.ine.es/jaxiT3/files/{directory}/{locale}/{variant}/{tableId}.csv?nocab={nocab}
</div></code></pre>
<p>Donde el Host URL es <code>https://www.ine.es/jaxiT3/files</code>.</p>
</li>
<li>
<p><strong>Ejemplo:</strong></p>
<pre class="hljs"><code><div>https://www.ine.es/jaxiT3/files/t/es/csv_bdsc/67821.csv?nocab=1
</div></code></pre>
</li>
</ul>
<h4 id="output">Output</h4>
<ul>
<li>Una <code>table</code> de MATLAB con los datos descargados desde INE JAXIT3.</li>
</ul>
<h4 id="notas">Notas</h4>
<ul>
<li>La función lee directamente la URL con <code>readtable</code> usando <code>Delimiter = ';'</code>.</li>
<li>Si la API devuelve error, verifique que el <code>tableId</code> exista y sea accesible.</li>
</ul>
<h4 id="enlaces-%C3%BAtiles">Enlaces útiles</h4>
<ul>
<li>INE (Banco de datos JAXIT3): https://www.ine.es/</li>
</ul>
<h3 id="inejaxiexamplem">ine_jaxi_example.m</h3>
<pre class="hljs"><code><div><span class="hljs-comment">% Ejemplo mínimo de uso para descargar una tabla de INE JAXI y exportar a CSV</span>

<span class="hljs-comment">% Cambiar el directorio de trabajo a la carpeta de este archivo</span>
cd(pwd);

<span class="hljs-comment">% Parámetros de ejemplo (tabla 67821, sin cabeceras adicionales)</span>
tableId = <span class="hljs-string">'67821'</span>;
nocab = <span class="hljs-string">'1'</span>;

<span class="hljs-comment">% Llamar a la función que devuelve una tabla de MATLAB</span>
T = ine_jaxi_function(tableId, nocab);

<span class="hljs-comment">% Construir ruta de salida</span>
outPath = <span class="hljs-string">'ine_jaxi_example.csv'</span>;

<span class="hljs-comment">% Exportar como CSV con punto y coma como delimitador y UTF-8</span>
<span class="hljs-built_in">writetable</span>(T, outPath, <span class="hljs-string">'Delimiter'</span>, <span class="hljs-string">';'</span>, <span class="hljs-string">'FileType'</span>, <span class="hljs-string">'text'</span>);

</div></code></pre>
<h3 id="inejaxifunctionm">ine_jaxi_function.m</h3>
<pre class="hljs"><code><div><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">T</span> = <span class="hljs-title">ine_jaxi_function</span><span class="hljs-params">(tableId, nocab, directory, locale, variant)</span></span>
<span class="hljs-comment">% INE_JAXI_FUNCTION Descarga un CSV de INE JAXIT3 y devuelve una tabla</span>
<span class="hljs-comment">%   T = ine_jaxi_function(tableId, nocab, directory, locale, variant)</span>
<span class="hljs-comment">%   Parámetros:</span>
<span class="hljs-comment">%     tableId  (char) - identificador de la tabla INE, p.ej. '67821'</span>
<span class="hljs-comment">%     nocab    (char) - '1' para evitar cabeceras adicionales (por defecto '1')</span>
<span class="hljs-comment">%     directory(char) - directorio base (por defecto 't')</span>
<span class="hljs-comment">%     locale   (char) - idioma (por defecto 'es')</span>
<span class="hljs-comment">%     variant  (char) - variante del formato (por defecto 'csv_bdsc')</span>
<span class="hljs-comment">%   Devuelve:</span>
<span class="hljs-comment">%     T (table) - datos descargados como tabla de MATLAB</span>

<span class="hljs-keyword">if</span> nargin &lt; <span class="hljs-number">2</span> || <span class="hljs-built_in">isempty</span>(nocab), nocab = <span class="hljs-string">'1'</span>; <span class="hljs-keyword">end</span>
<span class="hljs-keyword">if</span> nargin &lt; <span class="hljs-number">3</span> || <span class="hljs-built_in">isempty</span>(directory), directory = <span class="hljs-string">'t'</span>; <span class="hljs-keyword">end</span>
<span class="hljs-keyword">if</span> nargin &lt; <span class="hljs-number">4</span> || <span class="hljs-built_in">isempty</span>(locale), locale = <span class="hljs-string">'es'</span>; <span class="hljs-keyword">end</span>
<span class="hljs-keyword">if</span> nargin &lt; <span class="hljs-number">5</span> || <span class="hljs-built_in">isempty</span>(variant), variant = <span class="hljs-string">'csv_bdsc'</span>; <span class="hljs-keyword">end</span>

<span class="hljs-comment">% Construir URL del recurso CSV</span>
baseUrl = <span class="hljs-string">'https://www.ine.es/jaxiT3/files'</span>;
url = sprintf(<span class="hljs-string">'%s/%s/%s/%s/%s.csv'</span>, baseUrl, directory, locale, variant, tableId);
query = sprintf(<span class="hljs-string">'?nocab=%s'</span>, nocab);

<span class="hljs-comment">% Leer directamente la URL como tabla (delimitador ';')</span>
<span class="hljs-comment">% Nota: readtable admite URLs; se concatena la query ?nocab=...</span>
urlFull = [url query];
T = <span class="hljs-built_in">readtable</span>(urlFull, <span class="hljs-string">'Delimiter'</span>, <span class="hljs-string">';'</span>, <span class="hljs-string">'FileType'</span>, <span class="hljs-string">'text'</span>, <span class="hljs-string">'TextType'</span>, <span class="hljs-string">'string'</span>);

<span class="hljs-keyword">end</span>

</div></code></pre>
<h3 id="inejaximinm">ine_jaxi_min.m</h3>
<pre class="hljs"><code><div><span class="hljs-comment">% Descargador INE JAXIT3 (CSV) — script mínimo</span>
<span class="hljs-comment">% ----------------------------------------------------------------------------</span>
<span class="hljs-comment">% Objetivo</span>
<span class="hljs-comment">%   Descargar el CSV de una tabla INE, cargarlo en una tabla de MATLAB y exportar a CSV.</span>
<span class="hljs-comment">% Parámetros editables</span>
<span class="hljs-comment">%   - tableId: identificador de la tabla INE (p. ej., '67821')</span>
<span class="hljs-comment">%   - nocab: '1' evita cabeceras adicionales</span>
<span class="hljs-comment">%   - outputName: nombre base del archivo de salida</span>
<span class="hljs-comment">% Salida</span>
<span class="hljs-comment">%   - Archivo CSV con el contenido de la tabla</span>
<span class="hljs-comment">% Pasos</span>
<span class="hljs-comment">%   1) Construir URL con parámetros</span>
<span class="hljs-comment">%   2) Leer directamente a tabla con delimitador ';'</span>
<span class="hljs-comment">%   3) Exportar a CSV</span>
cd(pwd);
<span class="hljs-comment">% Parámetros básicos (idénticos al ejemplo en R/ine)</span>
tableId = <span class="hljs-string">'67821'</span>;        <span class="hljs-comment">% Identificador de la tabla en INE</span>
nocab = <span class="hljs-string">'1'</span>;              <span class="hljs-comment">% '1' evita cabeceras adicionales</span>
outputName = <span class="hljs-string">'ine_jaxi_min'</span>; <span class="hljs-comment">% Nombre base del archivo de salida</span>

<span class="hljs-comment">% Ruta de salida del CSV final</span>
outFile = fullfile([outputName <span class="hljs-string">'.csv'</span>]);

<span class="hljs-comment">% Construir URL y opciones de descarga</span>
url = sprintf(<span class="hljs-string">'https://www.ine.es/jaxiT3/files/t/es/csv_bdsc/%s.csv'</span>, tableId);
query = sprintf(<span class="hljs-string">'?nocab=%s'</span>, nocab);

<span class="hljs-comment">% Leer directamente la URL como tabla de MATLAB (delimitador ';')</span>
urlFull = [url query];
T = <span class="hljs-built_in">readtable</span>(urlFull, <span class="hljs-string">'Delimiter'</span>, <span class="hljs-string">';'</span>, <span class="hljs-string">'FileType'</span>, <span class="hljs-string">'text'</span>);

<span class="hljs-comment">% Exportar la tabla a CSV con separador ';'</span>
<span class="hljs-built_in">writetable</span>(T, outFile, <span class="hljs-string">'Delimiter'</span>, <span class="hljs-string">';'</span>, <span class="hljs-string">'FileType'</span>, <span class="hljs-string">'text'</span>);

</div></code></pre>
<h3 id="inejaxionlylinkm">ine_jaxi_onlylink.m</h3>
<pre class="hljs"><code><div><span class="hljs-comment">% Minimal INE JAXIT3 API downloader (link only)</span>
url = <span class="hljs-string">"https://www.ine.es/jaxiT3/files/t/es/csv_bdsc/67821.csv?nocab=1"</span>;
t = <span class="hljs-built_in">readtable</span>(url);


</div></code></pre>
<h2 id="oecd">OECD</h2>
<h3 id="gu%C3%ADa-r%C3%A1pida-oecd-con-matlab">Guía rápida: OECD con MATLAB</h3>
<p>Este documento explica cómo usar la función en <code>matlab/oecd/oecd_function.m</code> para descargar datos SDMX CSV de OECD y obtenerlos como una tabla en MATLAB.</p>
<h4 id="requisitos">Requisitos</h4>
<ul>
<li>Ninguno adicional a MATLAB.</li>
</ul>
<h4 id="codigos-ejemplo">Codigos ejemplo</h4>
<ul>
<li><code>oecd_onlylink.m</code>: ejemplo que descarga y lee el csv directamente del link de la API en una linea.</li>
<li><code>oecd_min.m</code>: ejemplo mínimo para construir la URL y guardar en CSV.</li>
<li><code>oecd_example.m</code>: ejemplo de uso de la función <code>oecd_api_function</code> devolviendo una tabla y exportándola a CSV.</li>
</ul>
<h4 id="inputs">Inputs</h4>
<ul>
<li>
<p><strong>Obligatorios</strong></p>
<ul>
<li><code>agency_identifier</code>: p. ej., <code>&quot;OECD.ECO.MAD&quot;</code>.</li>
<li><code>dataset_identifier</code>: p. ej., <code>&quot;DSD_EO@DF_EO&quot;</code>.</li>
<li><code>data_selection</code>: clave SDMX tras la <code>/</code>.</li>
</ul>
</li>
<li>
<p><strong>Opcionales</strong></p>
<ul>
<li><code>dataset_version</code> (por defecto <code>&quot;&quot;</code>).</li>
<li><code>startPeriod</code>, <code>endPeriod</code>, <code>dimensionAtObservation</code>.</li>
</ul>
</li>
</ul>
<h4 id="c%C3%B3mo-elegir-inputs">Cómo elegir inputs</h4>
<ol>
<li>Buscar el dataset en el explorador OCDE: https://data-explorer.oecd.org/</li>
<li>Seleccionar las dimensiones que se quieren descargar y consultar la sección &quot;Developer API&quot; para obtener <code>Agency identifier</code>, <code>Dataset identifier</code> y <code>Dataset version</code>.</li>
<li>Construir <code>data_selection</code> con las dimensiones requeridas por el dataset (p. ej., <code>PAISES.VARIABLE.FRECUENCIA</code>).</li>
<li>Ajustar parámetros opcionales (<code>startPeriod</code>, <code>endPeriod</code>, <code>dimensionAtObservation</code>).</li>
</ol>
<h4 id="sintaxis-de-la-api-oecd-sdmx">Sintaxis de la API (OECD SDMX)</h4>
<ul>
<li><strong>Formato general:</strong><pre class="hljs"><code><div>https://sdmx.oecd.org/public/rest/data/{agency},{dataset},{version}/{data_selection}
</div></code></pre>
</li>
</ul>
<h4 id="output">Output</h4>
<ul>
<li>Una <code>table</code> con los datos descargados de OECD.</li>
</ul>
<h4 id="enlaces-%C3%BAtiles">Enlaces útiles</h4>
<ul>
<li>Explorador OCDE: https://data-explorer.oecd.org/</li>
<li>Documentación de la API: https://www.oecd.org/en/data/insights/data-explainers/2024/09/api.html</li>
</ul>
<h3 id="oecdapifunctionm">oecd_api_function.m</h3>
<pre class="hljs"><code><div><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">T</span> = <span class="hljs-title">oecd_api_function</span><span class="hljs-params">(agency_identifier, dataset_identifier, data_selection, base_url, dataset_version, startPeriod, endPeriod, dimensionAtObservation)</span></span>
<span class="hljs-comment">% OECD_API_FUNCTION Descarga CSV SDMX de OECD y lo devuelve como tabla</span>
<span class="hljs-comment">%   T = oecd_api_function(agency_identifier, dataset_identifier, data_selection, ...)</span>
<span class="hljs-comment">%   Parámetros obligatorios:</span>
<span class="hljs-comment">%     agency_identifier (char) - p. ej., 'OECD.ECO.MAD'</span>
<span class="hljs-comment">%     dataset_identifier (char) - p. ej., 'DSD_EO@DF_EO'</span>
<span class="hljs-comment">%     data_selection (char) - clave SDMX tras la '/'</span>
<span class="hljs-comment">%   Opcionales:</span>
<span class="hljs-comment">%     base_url (char) - por defecto 'https://sdmx.oecd.org/public/rest/data'</span>
<span class="hljs-comment">%     dataset_version (char) - por defecto ''</span>
<span class="hljs-comment">%     startPeriod, endPeriod, dimensionAtObservation - parámetros comunes</span>

<span class="hljs-keyword">if</span> nargin &lt; <span class="hljs-number">4</span> || <span class="hljs-built_in">isempty</span>(base_url), base_url = <span class="hljs-string">'https://sdmx.oecd.org/public/rest/data'</span>; <span class="hljs-keyword">end</span>
<span class="hljs-keyword">if</span> nargin &lt; <span class="hljs-number">5</span>, dataset_version = <span class="hljs-string">''</span>; <span class="hljs-keyword">end</span>

data_identifier = [agency_identifier <span class="hljs-string">','</span> dataset_identifier <span class="hljs-string">','</span> dataset_version];
url = sprintf(<span class="hljs-string">'%s/%s/%s'</span>, base_url, data_identifier, data_selection);

qp = {};
<span class="hljs-keyword">if</span> exist(<span class="hljs-string">'startPeriod'</span>,<span class="hljs-string">'var'</span>) &amp;&amp; ~<span class="hljs-built_in">isempty</span>(startPeriod), qp{<span class="hljs-keyword">end</span>+<span class="hljs-number">1</span>} = [<span class="hljs-string">'startPeriod='</span> char(string(startPeriod))]; <span class="hljs-keyword">end</span>
<span class="hljs-keyword">if</span> exist(<span class="hljs-string">'endPeriod'</span>,<span class="hljs-string">'var'</span>) &amp;&amp; ~<span class="hljs-built_in">isempty</span>(endPeriod), qp{<span class="hljs-keyword">end</span>+<span class="hljs-number">1</span>} = [<span class="hljs-string">'endPeriod='</span> char(string(endPeriod))]; <span class="hljs-keyword">end</span>
<span class="hljs-keyword">if</span> exist(<span class="hljs-string">'dimensionAtObservation'</span>,<span class="hljs-string">'var'</span>) &amp;&amp; ~<span class="hljs-built_in">isempty</span>(dimensionAtObservation), qp{<span class="hljs-keyword">end</span>+<span class="hljs-number">1</span>} = [<span class="hljs-string">'dimensionAtObservation='</span> dimensionAtObservation]; <span class="hljs-keyword">end</span>

urlFull = url;
<span class="hljs-keyword">if</span> ~<span class="hljs-built_in">isempty</span>(qp), urlFull = [url <span class="hljs-string">'?'</span> strjoin(qp, <span class="hljs-string">'&amp;'</span>)]; <span class="hljs-keyword">end</span>

T = <span class="hljs-built_in">readtable</span>(urlFull, <span class="hljs-string">'FileType'</span>, <span class="hljs-string">'text'</span>);

<span class="hljs-keyword">end</span>



</div></code></pre>
<h3 id="oecdexamplem">oecd_example.m</h3>
<pre class="hljs"><code><div><span class="hljs-comment">% Ejemplo de uso: OECD SDMX CSV -&gt; tabla y CSV</span>

cd(pwd);

<span class="hljs-comment">% Parámetros de ejemplo (rellenar según dataset/selección reales)</span>
agency_identifier = <span class="hljs-string">'OECD.ECO.MAD'</span>;
dataset_identifier = <span class="hljs-string">'DSD_EO@DF_EO'</span>;
data_selection = <span class="hljs-string">'...'</span>; <span class="hljs-comment">% clave SDMX específica</span>

T = oecd_api_function(agency_identifier, dataset_identifier, data_selection);


outPath = <span class="hljs-string">'oecd_example.csv'</span>;

<span class="hljs-built_in">writetable</span>(T, outPath, <span class="hljs-string">'FileType'</span>, <span class="hljs-string">'text'</span>);



</div></code></pre>
<h3 id="oecdminm">oecd_min.m</h3>
<pre class="hljs"><code><div><span class="hljs-comment">% Descargador OECD SDMX CSV — script mínimo</span>
<span class="hljs-comment">% ----------------------------------------------------------------------------</span>
<span class="hljs-comment">% Objetivo</span>
<span class="hljs-comment">%   Construir la URL SDMX de OECD, descargar el CSV, cargarlo como tabla y exportar a CSV.</span>
<span class="hljs-comment">% Parámetros editables</span>
<span class="hljs-comment">%   - agency_identifier, dataset_identifier, dataset_version (si aplica)</span>
<span class="hljs-comment">%   - data_selection: clave SDMX tras la '/'</span>
<span class="hljs-comment">% Salida</span>
<span class="hljs-comment">%   - Archivo CSV con los datos del dataset seleccionado</span>
<span class="hljs-comment">% Pasos</span>
<span class="hljs-comment">%   1) Construir data_identifier agency,dataset,version</span>
<span class="hljs-comment">%   2) Leer URL directamente a tabla</span>
<span class="hljs-comment">%   3) Exportar a CSV</span>

<span class="hljs-comment">% Parámetros básicos</span>
agency_identifier = <span class="hljs-string">'OECD.ECO.MAD'</span>;
dataset_identifier = <span class="hljs-string">'DSD_EO@DF_EO'</span>;
dataset_version = <span class="hljs-string">''</span>;
data_selection = <span class="hljs-string">'...'</span>; <span class="hljs-comment">% clave SDMX específica</span>

<span class="hljs-comment">% Construir la URL SDMX</span>
base_url = <span class="hljs-string">'https://sdmx.oecd.org/public/rest/data'</span>;
data_identifier = [agency_identifier <span class="hljs-string">','</span> dataset_identifier <span class="hljs-string">','</span> dataset_version];
url = sprintf(<span class="hljs-string">'%s/%s/%s'</span>, base_url, data_identifier, data_selection);

<span class="hljs-comment">% Leer la URL directamente a tabla</span>
T = <span class="hljs-built_in">readtable</span>(url, <span class="hljs-string">'FileType'</span>, <span class="hljs-string">'text'</span>);

<span class="hljs-comment">% Exportar la tabla a CSV</span>
<span class="hljs-built_in">writetable</span>(T, <span class="hljs-string">'oecd_min.csv'</span>, <span class="hljs-string">'FileType'</span>, <span class="hljs-string">'text'</span>);



</div></code></pre>
<h3 id="oecdonlylinkm">oecd_onlylink.m</h3>
<pre class="hljs"><code><div><span class="hljs-comment">% Minimal OECD API downloader (link only)</span>
url = <span class="hljs-string">"https://sdmx.oecd.org/public/rest/data/OECD.ECO.MAD,DSD_EO@DF_EO,/FRA+DEU.PDTY.A?format=csvfile&amp;startPeriod=1965&amp;endPeriod=2023"</span>;
t = <span class="hljs-built_in">readtable</span>(url);


</div></code></pre>
<h2 id="ourworldindata">OURWORLDINDATA</h2>
<h3 id="gu%C3%ADa-r%C3%A1pida-our-world-in-data-con-matlab">Guía rápida: Our World in Data con MATLAB</h3>
<p>Este documento muestra cómo importar datos directamente desde los gráficos de Our World in Data (OWID) a MATLAB.</p>
<h4 id="requisitos">Requisitos</h4>
<ul>
<li>Ninguno adicional a MATLAB.</li>
</ul>
<h4 id="codigos-ejemplo">Codigos ejemplo</h4>
<ul>
<li><code>worldindata_onlylink.m</code> es un ejemplo que descarga y lee el csv directamente del link de la API en una linea.</li>
<li><code>worldindata_min.m</code> es un ejemplo mínimo para descargar datos de OWID.</li>
</ul>
<h4 id="inputs">Inputs</h4>
<ul>
<li><strong>Obligatorios</strong>
<ul>
<li><code>url</code>: URL directa del archivo CSV proporcionada por OWID para un gráfico específico.</li>
</ul>
</li>
</ul>
<h4 id="c%C3%B3mo-elegir-inputs">Cómo elegir inputs</h4>
<ol>
<li>Vaya a un gráfico en <a href="https://ourworldindata.org/">Our World in Data</a>.</li>
<li>Haga clic en la pestaña &quot;Download&quot;.</li>
<li>Haga clic derecho en el botón de descarga &quot;Full data (CSV)&quot; y seleccione &quot;Copiar dirección del enlace&quot;.</li>
<li>Use esa URL en su script de MATLAB.</li>
</ol>
<h4 id="sintaxis-de-la-api">Sintaxis de la API</h4>
<ul>
<li>
<p><strong>Formato general:</strong></p>
<pre class="hljs"><code><div>https://ourworldindata.org/grapher/{chart-slug}.csv?v=1&amp;csvType=full&amp;useColumnShortNames=true
</div></code></pre>
</li>
<li>
<p><strong>Ejemplo:</strong></p>
<pre class="hljs"><code><div>https://ourworldindata.org/grapher/labor-productivity-per-hour-pennworldtable.csv?v=1&amp;csvType=full&amp;useColumnShortNames=true
</div></code></pre>
</li>
</ul>
<h4 id="output">Output</h4>
<ul>
<li>Una <code>table</code> de MATLAB con los datos descargados.</li>
</ul>
<h4 id="enlaces-%C3%BAtiles">Enlaces útiles</h4>
<ul>
<li>Portal: https://ourworldindata.org/</li>
</ul>
<h3 id="worldindataminm">worldindata_min.m</h3>
<pre class="hljs"><code><div><span class="hljs-comment">% Define URLs</span>
dataUrl = <span class="hljs-string">"https://ourworldindata.org/grapher/labor-productivity-per-hour-pennworldtable.csv?v=1&amp;csvType=full&amp;useColumnShortNames=true"</span>;
metadataUrl = <span class="hljs-string">"https://ourworldindata.org/grapher/labor-productivity-per-hour-pennworldtable.metadata.json?v=1&amp;csvType=full&amp;useColumnShortNames=true"</span>;

<span class="hljs-comment">% Set options with User-Agent</span>
options = weboptions(<span class="hljs-string">'UserAgent'</span>, <span class="hljs-string">'Our World In Data data fetch/1.0'</span>);

<span class="hljs-comment">% Fetch the data</span>
<span class="hljs-keyword">try</span>
    df = webread(dataUrl, options);
<span class="hljs-keyword">catch</span> ME
    error(<span class="hljs-string">'Failed to fetch data: %s'</span>, ME.message);
<span class="hljs-keyword">end</span>

<span class="hljs-comment">% Fetch the metadata</span>
<span class="hljs-keyword">try</span>
    metadata = webread(metadataUrl, options);
<span class="hljs-keyword">catch</span> ME
    error(<span class="hljs-string">'Failed to fetch metadata: %s'</span>, ME.message);
<span class="hljs-keyword">end</span>

<span class="hljs-comment">% Save the data to CSV in the same folder as the script</span>
<span class="hljs-comment">% Get the full path of the current script</span>
currentScriptPath = mfilename(<span class="hljs-string">'fullpath'</span>);
[currentDir, ~, ~] = fileparts(currentScriptPath);

<span class="hljs-comment">% Define output path</span>
outputPath = fullfile(currentDir, <span class="hljs-string">'labor_productivity.csv'</span>);

<span class="hljs-comment">% Write table to CSV</span>
<span class="hljs-built_in">writetable</span>(df, outputPath);

fprintf(<span class="hljs-string">'Data saved to %s\n'</span>, outputPath);



</div></code></pre>
<h3 id="worldindataonlylinkm">worldindata_onlylink.m</h3>
<pre class="hljs"><code><div><span class="hljs-comment">% Minimal OurWorldInData downloader (link only)</span>
url = <span class="hljs-string">"https://ourworldindata.org/grapher/labor-productivity-per-hour-pennworldtable.csv?v=1&amp;csvType=full&amp;useColumnShortNames=true"</span>;
t = <span class="hljs-built_in">readtable</span>(url);


</div></code></pre>
<h2 id="worldbank">WORLDBANK</h2>
<h3 id="gu%C3%ADa-r%C3%A1pida-banco-mundial-con-matlab">Guía rápida: Banco Mundial con MATLAB</h3>
<p>Este documento explica cómo usar la función en <code>matlab/worldbank/worldbank_function.m</code> para descargar datos JSON del Banco Mundial y obtenerlos como una tabla en MATLAB.</p>
<h4 id="requisitos">Requisitos</h4>
<ul>
<li>Ninguno adicional a MATLAB.</li>
</ul>
<h4 id="codigos-ejemplo">Codigos ejemplo</h4>
<ul>
<li><code>worldbank_min.m</code>: ejemplo mínimo para construir la URL y guardar en CSV.</li>
<li><code>worldbank_example.m</code>: ejemplo de uso de la función <code>worldbank_api_function</code> devolviendo una tabla y exportándola a CSV.</li>
</ul>
<h4 id="inputs">Inputs</h4>
<ul>
<li>
<p><strong>Obligatorios</strong></p>
<ul>
<li><code>iso3</code>: código(s) de país ISO-3 (múltiples separados por ';').</li>
<li><code>indicator</code>: código(s) de indicador (múltiples separados por ';').</li>
</ul>
</li>
<li>
<p><strong>Opcionales</strong></p>
<ul>
<li><code>date</code> (p. ej., <code>&quot;2015:2020&quot;</code>).</li>
<li><code>per_page</code> (por defecto <code>20000</code>).</li>
</ul>
</li>
</ul>
<h4 id="c%C3%B3mo-elegir-inputs">Cómo elegir inputs</h4>
<ol>
<li>Elija país(es) <code>iso3</code> (estándar ISO 3166-1 alpha-3). Puede listar países: https://api.worldbank.org/v2/country?format=json</li>
<li>Elegir indicador (<code>indicator</code>)
<ul>
<li>Buscar en la web del World Bank la serie de interés. Seleccionar las variables y pinchar en <code>Metadata</code> -&gt; <code>Series</code>. Copiar el código de la serie. Puede ser una lista de indicadores separados por <code>;</code>.</li>
<li>Busque indicadores en: https://api.worldbank.org/v2/indicator?format=json (listado paginado) o en el portal de datos del Banco Mundial.</li>
</ul>
</li>
<li>Rango temporal
<ul>
<li>La API soporta <code>date=YYYY:YYYY</code> para filtrar.</li>
</ul>
</li>
</ol>
<h4 id="sintaxis-de-la-api-world-bank">Sintaxis de la API (World Bank)</h4>
<ul>
<li><strong>Formato general:</strong><pre class="hljs"><code><div>https://api.worldbank.org/v2/country/{iso3}/indicator/{indicator}?format=json&amp;per_page=...&amp;date=...
</div></code></pre>
</li>
</ul>
<h4 id="output">Output</h4>
<ul>
<li>Una <code>table</code> con los datos de la respuesta (elemento [2]).</li>
</ul>
<h4 id="enlaces-%C3%BAtiles">Enlaces útiles</h4>
<ul>
<li>Indicadores (API): https://datahelpdesk.worldbank.org/knowledgebase/articles/889392-about-the-indicators-api-documentation</li>
<li>Estructura de llamadas: https://datahelpdesk.worldbank.org/knowledgebase/articles/898581-api-basic-call-structures</li>
</ul>
<h3 id="worldbankapifunctionm">worldbank_api_function.m</h3>
<pre class="hljs"><code><div><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">T</span> = <span class="hljs-title">worldbank_api_function</span><span class="hljs-params">(iso3, indicator, date, per_page, base_url)</span></span>
<span class="hljs-comment">% WORLDBANK_API_FUNCTION Descarga datos del Banco Mundial (JSON) y devuelve tabla</span>
<span class="hljs-comment">%   T = worldbank_api_function(iso3, indicator, date, per_page, base_url)</span>
<span class="hljs-comment">%   Parámetros:</span>
<span class="hljs-comment">%     iso3 (char) - código(s) ISO-3; múltiples separados por ';'</span>
<span class="hljs-comment">%     indicator (char) - código(s) de indicador; múltiples separados por ';'</span>
<span class="hljs-comment">%     date (char, opcional) - rango temporal, p. ej. '2020:2023'</span>
<span class="hljs-comment">%     per_page (num, opcional) - tamaño de página (por defecto 20000)</span>
<span class="hljs-comment">%     base_url (char, opcional) - por defecto 'https://api.worldbank.org/v2'</span>
<span class="hljs-comment">%   Devuelve:</span>
<span class="hljs-comment">%     T (table) - datos del elemento [2] de la respuesta JSON</span>

<span class="hljs-keyword">if</span> nargin &lt; <span class="hljs-number">4</span> || <span class="hljs-built_in">isempty</span>(per_page), per_page = <span class="hljs-number">20000</span>; <span class="hljs-keyword">end</span>
<span class="hljs-keyword">if</span> nargin &lt; <span class="hljs-number">5</span> || <span class="hljs-built_in">isempty</span>(base_url), base_url = <span class="hljs-string">'https://api.worldbank.org/v2'</span>; <span class="hljs-keyword">end</span>

path = [<span class="hljs-string">'/country/'</span> iso3 <span class="hljs-string">'/indicator/'</span> indicator];
q = sprintf(<span class="hljs-string">'?format=json&amp;per_page=%d'</span>, per_page);
<span class="hljs-keyword">if</span> exist(<span class="hljs-string">'date'</span>,<span class="hljs-string">'var'</span>) &amp;&amp; ~<span class="hljs-built_in">isempty</span>(date)
    q = [q <span class="hljs-string">'&amp;date='</span> date];
<span class="hljs-keyword">end</span>
url = [base_url path q];

<span class="hljs-comment">% Leer JSON como texto y decodificar</span>
txt = webread(url, weboptions(<span class="hljs-string">'Timeout'</span>, <span class="hljs-number">60</span>, <span class="hljs-string">'ContentType'</span>, <span class="hljs-string">'text'</span>));
obj = jsondecode(txt);
<span class="hljs-keyword">if</span> <span class="hljs-built_in">numel</span>(obj) &lt; <span class="hljs-number">2</span> || <span class="hljs-built_in">isempty</span>(obj{<span class="hljs-number">2</span>})
    error(<span class="hljs-string">'Respuesta inesperada del Banco Mundial; no hay datos en el índice 2.'</span>);
<span class="hljs-keyword">end</span>

<span class="hljs-comment">% Convertir a tabla</span>
S = obj{<span class="hljs-number">2</span>};
T = struct2table(S);

<span class="hljs-keyword">end</span>



</div></code></pre>
<h3 id="worldbankexamplem">worldbank_example.m</h3>
<pre class="hljs"><code><div><span class="hljs-comment">% Ejemplo de uso: Banco Mundial JSON -&gt; tabla y CSV</span>


cd(pwd);

<span class="hljs-comment">% Parámetros de ejemplo</span>
iso3 = <span class="hljs-string">'ESP'</span>;
indicator = <span class="hljs-string">'NY.GDP.MKTP.KD.ZG'</span>; <span class="hljs-comment">% crecimiento del PIB (% anual)</span>
date = <span class="hljs-string">'2015:2020'</span>;

T = worldbank_api_function(iso3, indicator, date);

outPath = <span class="hljs-string">'worldbank_example.csv'</span>;

<span class="hljs-built_in">writetable</span>(T, outPath, <span class="hljs-string">'FileType'</span>, <span class="hljs-string">'text'</span>);



</div></code></pre>
<h3 id="worldbankminm">worldbank_min.m</h3>
<pre class="hljs"><code><div><span class="hljs-comment">% Descargador Banco Mundial (JSON) — script mínimo</span>
<span class="hljs-comment">% ----------------------------------------------------------------------------</span>
<span class="hljs-comment">% Objetivo</span>
<span class="hljs-comment">%   Construir la URL JSON del Banco Mundial, descargar los datos, convertirlos</span>
<span class="hljs-comment">%   a tabla de MATLAB y exportar a CSV.</span>
<span class="hljs-comment">% Parámetros editables</span>
<span class="hljs-comment">%   - iso3: país(es) ISO-3; indicator: indicador(es)</span>
<span class="hljs-comment">%   - date: rango temporal 'YYYY:YYYY'</span>
<span class="hljs-comment">% Salida</span>
<span class="hljs-comment">%   - Archivo CSV con los registros</span>
<span class="hljs-comment">% Pasos</span>
<span class="hljs-comment">%   1) Construir URL con format=json&amp;per_page=...</span>
<span class="hljs-comment">%   2) webread + jsondecode</span>
<span class="hljs-comment">%   3) struct2table y exportar a CSV</span>

<span class="hljs-comment">% Parámetros básicos</span>
iso3 = <span class="hljs-string">'ESP'</span>;
indicator = <span class="hljs-string">'NY.GDP.MKTP.KD.ZG'</span>;
date = <span class="hljs-string">'2015:2020'</span>;

<span class="hljs-comment">% Construir la URL JSON del Banco Mundial</span>
base_url = <span class="hljs-string">'https://api.worldbank.org/v2'</span>;
path = [<span class="hljs-string">'/country/'</span> iso3 <span class="hljs-string">'/indicator/'</span> indicator];
url = [base_url path <span class="hljs-string">'?format=json&amp;per_page=20000&amp;date='</span> date];

<span class="hljs-comment">% Leer la URL directamente a tabla</span>
txt = webread(url, weboptions(<span class="hljs-string">'Timeout'</span>, <span class="hljs-number">60</span>, <span class="hljs-string">'ContentType'</span>, <span class="hljs-string">'text'</span>));
obj = jsondecode(txt);
S = obj{<span class="hljs-number">2</span>};

<span class="hljs-comment">% Convertir a tabla</span>
T = struct2table(S);

<span class="hljs-comment">% Exportar la tabla a CSV</span>
<span class="hljs-built_in">writetable</span>(T, <span class="hljs-string">'worldbank_min.csv'</span>, <span class="hljs-string">'FileType'</span>, <span class="hljs-string">'text'</span>);



</div></code></pre>
<h1 id="stata">Stata</h1>
<h2 id="ecb">ECB</h2>
<h3 id="gu%C3%ADa-r%C3%A1pida-ecb-con-stata">Guía rápida: ECB con Stata</h3>
<p>Este documento explica cómo descargar datos del Banco Central Europeo (ECB) usando <code>ecb/ecb_min.do</code> en Stata, solicitando el formato CSV.</p>
<h4 id="requisitos">Requisitos</h4>
<ul>
<li>Stata</li>
</ul>
<h4 id="codigos-ejemplo">Codigos ejemplo</h4>
<ul>
<li><code>ecb_min.do</code> es un ejemplo mínimo para descargar datos del BCE directamente en Stata.</li>
</ul>
<h4 id="inputs">Inputs</h4>
<ul>
<li><strong>Obligatorios</strong>
<ul>
<li><code>dataset</code>: identificador del dataset del BCE (p. ej., <code>&quot;BSI&quot;</code>).</li>
<li><code>seriesKey</code>: clave completa de la serie (dimensiones concatenadas con <code>.</code>).</li>
</ul>
</li>
</ul>
<h4 id="c%C3%B3mo-elegir-inputs">Cómo elegir inputs</h4>
<ol>
<li>Abra el dataset en el portal BCE (p. ej., BSI): https://data.ecb.europa.eu/data/datasets/BSI</li>
<li>Use los filtros hasta ver la serie concreta; la clave <code>seriesKey</code> aparece en el recuadro de la serie.</li>
<li>Cada elemento de <code>seriesKey</code> es una dimensión del dataset; puede cambiar <code>U2</code> (Área del euro) por <code>ES</code> (España), etc. Pinchando en <code>view all</code> se pueden ver todas las dimensiones del dataset y sus códigos.</li>
</ol>
<h4 id="sintaxis-de-la-api-bce">Sintaxis de la API (BCE)</h4>
<ul>
<li>
<p><strong>Formato general:</strong></p>
<pre class="hljs"><code><div>https://data-api.ecb.europa.eu/service/data/{dataset}/{seriesKey}?format=csvdata
</div></code></pre>
</li>
<li>
<p><strong>Ejemplo:</strong></p>
<pre class="hljs"><code><div>https://data-api.ecb.europa.eu/service/data/BSI/M.U2.Y.V.M30.X.I.U2.2300.Z01.A?format=csvdata
</div></code></pre>
</li>
</ul>
<h4 id="output">Output</h4>
<ul>
<li>Un dataset en memoria de Stata con los datos descargados.</li>
</ul>
<h4 id="enlaces-%C3%BAtiles">Enlaces útiles</h4>
<ul>
<li>Portal de datos del BCE (datasets): https://data.ecb.europa.eu/data/datasets/</li>
<li>Documentación de la API de datos del BCE: https://data.ecb.europa.eu/help/api/overview</li>
<li>API de datos (servicio): https://data-api.ecb.europa.eu/service/</li>
</ul>
<h3 id="ecbmindo">ecb_min.do</h3>
<pre class="hljs"><code><div><span class="hljs-keyword">global</span> dataset <span class="hljs-string">"BSI"</span>
<span class="hljs-keyword">global</span> seriesKey <span class="hljs-string">"M.U2.Y.V.M30.X.I.U2.2300.Z01.A"</span>
import delimited <span class="hljs-string">"https://data-api.ecb.europa.eu/service/data/${dataset}/${seriesKey}?format=csvdata"</span>, encoding(<span class="hljs-string">"utf-8"</span>) <span class="hljs-keyword">clear</span>
</div></code></pre>
<h2 id="eurostat">EUROSTAT</h2>
<h3 id="gu%C3%ADa-r%C3%A1pida-eurostat-con-stata">Guía rápida: Eurostat con Stata</h3>
<p>Este documento explica cómo descargar datos de Eurostat directamente en Stata usando la API SDMX 3.0 de diseminación.</p>
<h4 id="requisitos">Requisitos</h4>
<ul>
<li>Stata</li>
</ul>
<h4 id="codigos-ejemplo">Codigos ejemplo</h4>
<ul>
<li><code>eurostat_min.do</code> es un ejemplo mínimo para descargar datos de Eurostat directamente en Stata.</li>
</ul>
<h4 id="inputs">Inputs</h4>
<ul>
<li><strong>Obligatorios</strong>
<ul>
<li><code>agency_identifier</code>: identificador de la agencia (p. ej., <code>&quot;ESTAT&quot;</code>).</li>
<li><code>dataset_identifier</code>: identificador del dataset (p. ej., <code>&quot;nama_10_a64&quot;</code>).</li>
<li><code>filters</code>: filtros en formato URL query string (p. ej., <code>?c[geo]=ES</code>).</li>
</ul>
</li>
</ul>
<h4 id="c%C3%B3mo-elegir-inputs">Cómo elegir inputs</h4>
<ol>
<li>Lo más sencillo es ir a Eurostat, buscar la serie de interés y copiar el codigo de la serie. Mirar el codigo de las variables que nos interesan y los codigos de los valores que queremos filtrar.</li>
<li>Usar el codigo de la serie como <code>dataset_identifier</code>.</li>
<li>Ajustar la global <code>filters</code> con formato URL query string:
<ul>
<li>Use <code>c[DIMENSION]=VALOR</code>.</li>
<li>Para valores múltiples use comas: <code>c[geo]=ES,FR</code>.</li>
<li>En <code>TIME_PERIOD</code> puede usar operadores SDMX: <code>ge:YYYY</code>, <code>le:YYYY</code>.</li>
<li>Ejemplo: <code>?c[geo]=ES&amp;c[unit]=EUR</code>.</li>
</ul>
</li>
</ol>
<h4 id="sintaxis-de-la-api-sdmx-30">Sintaxis de la API (SDMX 3.0)</h4>
<ul>
<li>
<p><strong>Formato general:</strong></p>
<pre class="hljs"><code><div>https://ec.europa.eu/eurostat/api/dissemination/sdmx/3.0/data/dataflow/{agency_identifier}/{dataset_identifier}/1.0/{filters}&amp;compress=false&amp;format=csvdata&amp;formatVersion=2.0&amp;lang=en&amp;labels=name
</div></code></pre>
</li>
<li>
<p><strong>Ejemplo:</strong></p>
<pre class="hljs"><code><div>https://ec.europa.eu/eurostat/api/dissemination/sdmx/3.0/data/dataflow/ESTAT/nama_10_a64/1.0/?c[geo]=ES&amp;c[unit]=CLV_I20&amp;compress=false&amp;format=csvdata&amp;formatVersion=2.0
</div></code></pre>
</li>
</ul>
<h4 id="output">Output</h4>
<ul>
<li>Un dataset en memoria de Stata con los datos descargados.</li>
</ul>
<h4 id="enlaces-%C3%BAtiles">Enlaces útiles</h4>
<ul>
<li>Guía de consultas de datos (SDMX 3.0, Eurostat): <a href="https://ec.europa.eu/eurostat/web/user-guides/data-browser/api-data-access/api-detailed-guidelines/sdmx3-0/data-query">API - Detailed guidelines - SDMX3.0 API - data query</a></li>
<li><a href="https://wikis.ec.europa.eu/display/EUROSTATHELP/API+SDMX+3.0+-+Data+retrieval">Eurostat API Setup</a></li>
</ul>
<h3 id="eurostatmindo">eurostat_min.do</h3>
<pre class="hljs"><code><div><span class="hljs-keyword">global</span> agency_identifier <span class="hljs-string">"ESTAT"</span>
<span class="hljs-keyword">global</span> dataset_eurostat <span class="hljs-string">"nama_10_a64"</span>    
<span class="hljs-keyword">global</span> filters <span class="hljs-string">"?c[freq]=A&amp;c[unit]=CLV_I20,CLV05_MEUR&amp;c[nace_r2]=TOTAL&amp;c[na_item]=B1G,P1&amp;c[geo]=ES&amp;c[TIME_PERIOD]=ge:1995"</span>

import delimited <span class="hljs-string">"https://ec.europa.eu/eurostat/api/dissemination/sdmx/3.0/data/dataflow/${agency_identifier}/${dataset_eurostat}/1.0/${filters}&amp;compress=false&amp;format=csvdata&amp;formatVersion=2.0&amp;lang=en&amp;labels=name"</span>, encoding(<span class="hljs-string">"utf-8"</span>) <span class="hljs-keyword">clear</span>


</div></code></pre>
<h2 id="fred">FRED</h2>
<h3 id="gu%C3%ADa-r%C3%A1pida-fred-con-stata">Guía rápida: FRED con Stata</h3>
<p>Este documento explica cómo usar el comando nativo <code>import fred</code> en Stata para descargar datos de la Reserva Federal de St. Louis.</p>
<h4 id="requisitos">Requisitos</h4>
<ul>
<li>Stata 15 o superior (para el comando <code>import fred</code> nativo).</li>
<li>Una API Key de FRED (gratuita).</li>
</ul>
<h4 id="codigos-ejemplo">Codigos ejemplo</h4>
<ul>
<li><code>fred_min.do</code> es un ejemplo mínimo para descargar datos de FRED usando <code>import fred</code>.</li>
</ul>
<h4 id="inputs">Inputs</h4>
<ul>
<li><strong>Obligatorios</strong>
<ul>
<li><code>series_id</code>: identificador de la serie (p. ej., <code>&quot;GNPCA&quot;</code>).</li>
<li><code>api_key</code>: clave API personal de FRED.</li>
</ul>
</li>
</ul>
<h4 id="c%C3%B3mo-elegir-inputs">Cómo elegir inputs</h4>
<ol>
<li>Elija el <code>series_id</code> (p. ej., <code>GDP</code>, <code>CPIAUCSL</code>). Esto suele estar al lado del nombre de la serie en FRED entre paréntesis.</li>
<li>Use ese ID en el comando <code>import fred ID</code>.</li>
<li>Para conseguir una API key, hay que registrarse en FRED, entrar en la cuenta, ir a la sección &quot;API keys&quot; y pinchar en &quot;Request API key&quot;.</li>
</ol>
<h4 id="sintaxis-de-la-api">Sintaxis de la API</h4>
<ul>
<li>Uso del comando nativo de Stata <code>import fred</code>.<pre class="hljs"><code><div><span class="hljs-keyword">set</span> fredkey TUAPIKEY
import fred SERIES_ID, <span class="hljs-keyword">clear</span>
</div></code></pre>
</li>
</ul>
<h4 id="output">Output</h4>
<ul>
<li>Un dataset en memoria de Stata con los datos descargados.</li>
</ul>
<h4 id="enlaces-%C3%BAtiles">Enlaces útiles</h4>
<ul>
<li>Referencia oficial: <a href="https://fred.stlouisfed.org/docs/api/fred/series_observations.html">FRED observations API docs</a></li>
<li><a href="https://www.stata.com/manuals/dimportfred.pdf">Documentación de import fred en Stata</a></li>
</ul>
<h3 id="fredmindo">fred_min.do</h3>
<pre class="hljs"><code><div><span class="hljs-keyword">set</span> fredkey TUAPIKEY
import fred GNPCA, <span class="hljs-keyword">clear</span>
</div></code></pre>
<h2 id="imf">IMF</h2>
<h3 id="gu%C3%ADa-r%C3%A1pida-fmi-con-stata">Guía rápida: FMI con Stata</h3>
<p>Este documento explica cómo usar el script <code>imf/imf_min.do</code> para descargar datos del FMI (servicio SDMX 3.0) directamente en Stata.</p>
<h4 id="requisitos">Requisitos</h4>
<ul>
<li>Stata (con capacidad de conexión a internet y comando <code>import delimited</code>).</li>
</ul>
<h4 id="codigos-ejemplo">Codigos ejemplo</h4>
<ul>
<li><code>imf_min.do</code> es un ejemplo mínimo para descargar datos del FMI directamente en Stata.</li>
</ul>
<h4 id="inputs">Inputs</h4>
<ul>
<li><strong>Obligatorios</strong>
<ul>
<li><code>dataset_identifier</code>: identificador del dataset (p. ej., &quot;QNEA&quot;).</li>
<li><code>key</code>: clave SDMX completa (orden y códigos según el dataset). Ej.: &quot;ESP+FRA.B1GQ.Q.SA.XDC.Q&quot;.</li>
<li><code>agency_identifier</code>: por defecto &quot;IMF.STA&quot;.</li>
<li><code>dataset_version</code>: por defecto &quot;+&quot; (última versión).</li>
</ul>
</li>
</ul>
<h4 id="c%C3%B3mo-elegir-inputs">Cómo elegir inputs</h4>
<ol>
<li>Localice el dataset y el indicador en el portal del FMI o en la documentación de SDMX.</li>
<li>Construya la <code>key</code> con las dimensiones requeridas por el dataset. En IFS suele ser <code>FREQ.REF_AREA.INDICATOR</code>.</li>
<li>La estructura de la URL es <code>.../data/dataflow/{agency_identifier}/{dataset_identifier}/{dataset_version}/{key}</code>.</li>
</ol>
<h4 id="sintaxis-de-la-api-fmi-sdmx-30">Sintaxis de la API (FMI SDMX 3.0)</h4>
<ul>
<li><strong>Formato general:</strong><pre class="hljs"><code><div>https://api.imf.org/external/sdmx/3.0/data/dataflow/{agency_identifier}/{dataset_identifier}/{dataset_version}/{key}
</div></code></pre>
Referencia al servicio SDMX JSON del FMI: <code>https://dataservices.imf.org/REST/SDMX_JSON.svc</code></li>
</ul>
<h4 id="output">Output</h4>
<ul>
<li>Un dataset en memoria de Stata con los datos descargados.</li>
</ul>
<h4 id="enlaces-%C3%BAtiles">Enlaces útiles</h4>
<ul>
<li>Conocimiento/soporte del FMI (categoría API/SDMX): https://datasupport.imf.org/knowledge?id=knowledge_category&amp;sys_kb_id=d41858e747294ad8805d07c4f16d43e0&amp;category_id=9959b2bc1b6391903dba646fbd4bcb6a</li>
</ul>
<h3 id="imfmindo">imf_min.do</h3>
<pre class="hljs"><code><div>import delimited <span class="hljs-string">"https://api.imf.org/external/sdmx/3.0/data/dataflow/IMF.STA/QNEA/%2B/ESP%2BFRA.B1GQ.Q.SA.XDC.Q"</span>, <span class="hljs-keyword">clear</span>

</div></code></pre>
<h2 id="ine">INE</h2>
<h3 id="gu%C3%ADa-r%C3%A1pida-ine-con-stata">Guía rápida: INE con Stata</h3>
<p>Este documento muestra cómo cargar datos del INE (Instituto Nacional de Estadística de España) directamente en Stata.</p>
<h4 id="requisitos">Requisitos</h4>
<ul>
<li>Stata</li>
</ul>
<h4 id="codigos-ejemplo">Codigos ejemplo</h4>
<ul>
<li><code>ine_min.do</code> es un ejemplo mínimo para descargar datos del INE directamente en Stata.</li>
</ul>
<h4 id="inputs">Inputs</h4>
<ul>
<li><strong>Obligatorios</strong>
<ul>
<li><code>url</code>: URL directa del archivo CSV de la tabla del INE.</li>
</ul>
</li>
</ul>
<h4 id="c%C3%B3mo-elegir-inputs">Cómo elegir inputs</h4>
<ol>
<li>Navegue a <a href="https://www.ine.es/">INEbase</a>.</li>
<li>Localice la tabla de interés.</li>
<li>Busque el botón de descarga y copie el enlace del formato CSV.</li>
<li>Asegúrese de que la URL termina en <code>.csv</code> o es el enlace de descarga directa.</li>
</ol>
<h4 id="sintaxis-de-la-api-ine">Sintaxis de la API (INE)</h4>
<ul>
<li>
<p><strong>Formato general:</strong></p>
<pre class="hljs"><code><div>https://www.ine.es/jaxiT3/files/t/es/csv_bdsc/{TABLE_ID}.csv
</div></code></pre>
</li>
<li>
<p><strong>Ejemplo:</strong></p>
<pre class="hljs"><code><div>https://www.ine.es/jaxiT3/files/t/es/csv_bdsc/67821.csv
</div></code></pre>
</li>
</ul>
<h4 id="output">Output</h4>
<ul>
<li>Un dataset en memoria de Stata con los datos descargados.</li>
</ul>
<h4 id="enlaces-%C3%BAtiles">Enlaces útiles</h4>
<ul>
<li>INE (Banco de datos): https://www.ine.es/</li>
</ul>
<h3 id="inemindo">ine_min.do</h3>
<pre class="hljs"><code><div>import delimited <span class="hljs-string">"https://www.ine.es/jaxiT3/files/t/es/csv_bdsc/67821.csv"</span>, encoding(<span class="hljs-string">"utf-8"</span>) <span class="hljs-keyword">clear</span>
</div></code></pre>
<h2 id="ocde">OCDE</h2>
<h3 id="gu%C3%ADa-r%C3%A1pida-oecd-con-stata">Guía rápida: OECD con Stata</h3>
<p>Este documento explica cómo descargar datos de la OCDE usando la API REST SDMX en Stata.</p>
<h4 id="requisitos">Requisitos</h4>
<ul>
<li>Stata</li>
</ul>
<h4 id="codigos-ejemplo">Codigos ejemplo</h4>
<ul>
<li><code>ocde_min.do</code> es un ejemplo mínimo para descargar datos de la OCDE directamente en Stata.</li>
</ul>
<h4 id="inputs">Inputs</h4>
<ul>
<li>
<p><strong>Obligatorios</strong></p>
<ul>
<li><code>agency_identifier</code>: p. ej., <code>&quot;OECD.ECO.MAD&quot;</code>.</li>
<li><code>dataset_identifier</code>: p. ej., <code>&quot;DSD_EO@DF_EO&quot;</code>.</li>
<li><code>data_selection</code>: clave SDMX tras la <code>/</code>.</li>
</ul>
</li>
<li>
<p><strong>Opcionales</strong></p>
<ul>
<li><code>startPeriod</code>, <code>endPeriod</code>.</li>
</ul>
</li>
</ul>
<h4 id="c%C3%B3mo-elegir-inputs">Cómo elegir inputs</h4>
<ol>
<li>Buscar el dataset en el explorador OCDE: https://data-explorer.oecd.org/</li>
<li>Seleccionar las dimensiones que se quieren descargar y consultar la sección &quot;Developer API&quot; para obtener <code>Agency identifier</code>, <code>Dataset identifier</code> y <code>Dataset version</code>.</li>
<li>Construir la global <code>data_selection</code> con las dimensiones requeridas por el dataset (p. ej., <code>PAISES.VARIABLE.FRECUENCIA</code>).</li>
<li>Puede filtrar por periodo modificando las globales <code>startPeriod</code> y <code>endPeriod</code>.</li>
</ol>
<h4 id="sintaxis-de-la-api-oecd-sdmx">Sintaxis de la API (OECD SDMX)</h4>
<ul>
<li><strong>Formato general:</strong><pre class="hljs"><code><div>https://sdmx.oecd.org/public/rest/data/{agency},{dataset},{version}/{data_selection}?format=csvfile
</div></code></pre>
</li>
</ul>
<h4 id="output">Output</h4>
<ul>
<li>Un dataset en memoria de Stata con los datos descargados.</li>
</ul>
<h4 id="enlaces-%C3%BAtiles">Enlaces útiles</h4>
<ul>
<li>Explorador OCDE: https://data-explorer.oecd.org/</li>
<li>Documentación de la API: https://www.oecd.org/en/data/insights/data-explainers/2024/09/api.html</li>
</ul>
<h3 id="ocdemindo">ocde_min.do</h3>
<pre class="hljs"><code><div><span class="hljs-keyword">global</span> agency_identifier <span class="hljs-string">"OECD.ECO.MAD"</span>
<span class="hljs-keyword">global</span> dataset_identifier <span class="hljs-string">"DSD_EO@DF_EO"</span>
<span class="hljs-keyword">global</span> data_selection <span class="hljs-string">"FRA+DEU.PDTY.A"</span>
<span class="hljs-keyword">global</span> startPeriod <span class="hljs-string">"1965"</span>
<span class="hljs-keyword">global</span> endPeriod <span class="hljs-string">"2023"</span>

import delimited <span class="hljs-string">"https://sdmx.oecd.org/public/rest/data/${agency_identifier},${dataset_identifier},/${data_selection}?format=csvfile&amp;startPeriod=${startPeriod}&amp;endPeriod=${endPeriod}"</span>, encoding(<span class="hljs-string">"utf-8"</span>) <span class="hljs-keyword">clear</span>  
</div></code></pre>
<h2 id="ourworldindata">OURWORLDINDATA</h2>
<h3 id="gu%C3%ADa-r%C3%A1pida-our-world-in-data-con-stata">Guía rápida: Our World in Data con Stata</h3>
<p>Este documento muestra cómo importar datos directamente desde los gráficos de Our World in Data (OWID) a Stata.</p>
<h4 id="requisitos">Requisitos</h4>
<ul>
<li>Stata</li>
</ul>
<h4 id="codigos-ejemplo">Codigos ejemplo</h4>
<ul>
<li><code>worldindata_min.do</code> es un ejemplo mínimo para descargar datos de OWID directamente en Stata.</li>
</ul>
<h4 id="inputs">Inputs</h4>
<ul>
<li><strong>Obligatorios</strong>
<ul>
<li><code>url</code>: URL directa del archivo CSV proporcionada por OWID para un gráfico específico.</li>
</ul>
</li>
</ul>
<h4 id="c%C3%B3mo-elegir-inputs">Cómo elegir inputs</h4>
<ol>
<li>Vaya a un gráfico en <a href="https://ourworldindata.org/">Our World in Data</a>.</li>
<li>Haga clic en la pestaña &quot;Download&quot;.</li>
<li>Haga clic derecho en el botón de descarga &quot;Full data (CSV)&quot; y seleccione &quot;Copiar dirección del enlace&quot;.</li>
<li>Pegue esa URL en su comando <code>import delimited &quot;URL&quot;, clear</code>.</li>
</ol>
<h4 id="sintaxis-de-la-api">Sintaxis de la API</h4>
<ul>
<li>
<p><strong>Formato general:</strong></p>
<pre class="hljs"><code><div>https://ourworldindata.org/grapher/{chart-slug}.csv?v=1&amp;csvType=full&amp;useColumnShortNames=true
</div></code></pre>
</li>
<li>
<p><strong>Ejemplo:</strong></p>
<pre class="hljs"><code><div>https://ourworldindata.org/grapher/labor-productivity-per-hour-pennworldtable.csv?v=1&amp;csvType=full&amp;useColumnShortNames=true
</div></code></pre>
</li>
</ul>
<h4 id="output">Output</h4>
<ul>
<li>Un dataset en memoria de Stata con los datos descargados.</li>
</ul>
<h4 id="enlaces-%C3%BAtiles">Enlaces útiles</h4>
<ul>
<li>Portal: https://ourworldindata.org/</li>
</ul>
<h3 id="worldindatamindo">worldindata_min.do</h3>
<pre class="hljs"><code><div>import delimited <span class="hljs-string">"https://ourworldindata.org/grapher/labor-productivity-per-hour-pennworldtable.csv?v=1&amp;csvType=full&amp;useColumnShortNames=true"</span>, encoding(<span class="hljs-string">"utf-8"</span>) <span class="hljs-keyword">clear</span>
</div></code></pre>
<h2 id="worldbank">WORLDBANK</h2>
<h3 id="gu%C3%ADa-r%C3%A1pida-banco-mundial-con-stata">Guía rápida: Banco Mundial con Stata</h3>
<p>Este documento explica cómo descargar e importar indicadores del Banco Mundial manualmente en Stata, manejando archivos ZIP.</p>
<h4 id="requisitos">Requisitos</h4>
<ul>
<li>Stata</li>
</ul>
<h4 id="codigos-ejemplo">Codigos ejemplo</h4>
<ul>
<li><code>worldbank_min.do</code> es un ejemplo mínimo para descargar y descomprimir datos del Banco Mundial en Stata.</li>
</ul>
<h4 id="inputs">Inputs</h4>
<ul>
<li><strong>Obligatorios</strong>
<ul>
<li><code>indicator</code>: código del indicador (p. ej., <code>NY.GDP.MKTP.KD.ZG</code>).</li>
</ul>
</li>
</ul>
<h4 id="c%C3%B3mo-elegir-inputs">Cómo elegir inputs</h4>
<ol>
<li>Elija el indicador (<code>indicator</code>)
<ul>
<li>Buscar en la web del World Bank la serie de interés. Seleccionar las variables y pinchar en <code>Metadata</code> -&gt; <code>Series</code>. Copiar el codigo de la serie (p. ej. <code>NY.GDP.MKTP.KD.ZG</code>).</li>
<li>Busque indicadores en: https://api.worldbank.org/v2/indicator?format=json o en el portal de datos.</li>
</ul>
</li>
<li>Use ese código para definir la global <code>indicator</code>.</li>
<li>El archivo CSV descargado tendrá un nombre basado en el indicador (ej. <code>API_NY.GDP...</code>). Deberá ajustar el nombre del archivo en el comando <code>import delimited</code>.</li>
</ol>
<h4 id="sintaxis-de-la-api-world-bank">Sintaxis de la API (World Bank)</h4>
<ul>
<li><strong>Formato general (ZIP con CSV):</strong><pre class="hljs"><code><div>https://api.worldbank.org/v2/en/indicator/{indicator}?downloadformat=csv
</div></code></pre>
</li>
</ul>
<h4 id="output">Output</h4>
<ul>
<li>Un dataset en memoria de Stata con los datos del indicador.</li>
</ul>
<h4 id="enlaces-%C3%BAtiles">Enlaces útiles</h4>
<ul>
<li>Indicadores (API): https://datahelpdesk.worldbank.org/knowledgebase/articles/889392-about-the-indicators-api-documentation</li>
<li><a href="https://datahelpdesk.worldbank.org/knowledgebase/topics/125589-developer-information">World Bank Data API</a></li>
</ul>
<h3 id="worldbankmindo">worldbank_min.do</h3>
<pre class="hljs"><code><div><span class="hljs-keyword">global</span> indicator <span class="hljs-string">"NY.GDP.MKTP.KD.ZG"</span>


<span class="hljs-comment">* 1. Download ZIP</span>
<span class="hljs-keyword">copy</span> <span class="hljs-string">"https://api.worldbank.org/v2/en/indicator/${indicator}?downloadformat=csv"</span> <span class="hljs-comment">///</span>
    <span class="hljs-string">"wb_gdp_growth.zip"</span>, <span class="hljs-keyword">replace</span>

<span class="hljs-comment">* 2. Unzip</span>
unzipfile <span class="hljs-string">"wb_gdp_growth.zip"</span>, <span class="hljs-keyword">replace</span>

<span class="hljs-comment">* list files if you want to see exact name</span>
<span class="hljs-keyword">dir</span>

<span class="hljs-comment">* 3. Import the main data CSV (adjust filename to what you see)</span>
import delimited <span class="hljs-string">"API_${indicator}_DS2_en_csv_v2_260128.csv"</span>, <span class="hljs-comment">///</span>
    varnames(1) rowrange(5) encoding(UTF-8) <span class="hljs-keyword">clear</span>
</div></code></pre>

</body>
</html>
